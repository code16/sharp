var ma=Object.defineProperty;var pa=(t,e,s)=>e in t?ma(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var M=(t,e,s)=>(pa(t,typeof e!="symbol"?e+"":e,s),s);import{B as fa,a as _a,D as St,b as ga,c as va,d as ba,t as kt,V as m,q as Ce,e as xt,f as X,g as ya,F as Ca,h as w,i as Ye,j as Ft,k as E,l as $a,M as _e,m as wa,n as Sa,o as ka,p as xa,r as Fa,s as La,_ as Lt,u as Ba,v as Oa,w as Ea,x as Bt,y as Ia,z as Ta,A as Aa,L as Ot,C as Et,E as It,N as Tt,P as J,G as Z,H as ee,I as Ra,J as Da,K as Pa,O as za,Q as Ma,R as ja,S as te,T as Na,U as Va,W as At,X as Ua,Y as Ha,Z as qa,$ as Ka,a0 as Ga,a1 as Wa,a2 as Qa,a3 as Ya,a4 as Xe,a5 as Rt,a6 as Xa,a7 as Ja,a8 as Za,a9 as en,aa as tn,ab as sn,ac as an,ad as nn,ae as rn,af as ln,ag as on,ah as dn,ai as Dt,aj as cn,ak as un,al as hn,am as Pt,an as A,ao as mn,ap as pn,aq as fn,ar as _n,as as gn,at as $e,au as we,av as vn,aw as bn,ax as yn,ay as Cn}from"./vendor-2ad66ae0.js";const Je=t=>{let e=!1,s;return()=>(e||(e=!0,s=t()),s)};let Ze=!1;const zt=(t,e)=>{if(!(typeof document>"u")){if(Ze)throw new Error("You already started the loading of google maps");{Ze=!0;const s=document.createElement("SCRIPT");if(typeof t!="object")throw new Error("options should  be an object");Array.prototype.isPrototypeOf(t.libraries)&&(t.libraries=t.libraries.join(",")),t.callback="vueGoogleMapsInit";let a="https://maps.googleapis.com/";typeof e=="boolean"&&e===!0&&(a="https://maps.google.cn/");let n=a+"maps/api/js?"+Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t[i])).join("&");s.setAttribute("src",n),s.setAttribute("async",""),s.setAttribute("defer",""),document.head.appendChild(s)}}},Mt=(t,e,s)=>{for(let a of s)(t.$gmapOptions.autobindAllEvents||t.$listeners[a])&&e.addListener(a,n=>{t.$emit(a,n)})};function jt(t,e,s,a=!1){let n=!1;function i(){n||(n=!0,t.$nextTick(()=>{n=!1,s()}))}for(let l of e)t.$watch(l,i,{immediate:a})}function et(t){return t.charAt(0).toUpperCase()+t.slice(1)}function ge(t,e){return Object.keys(e).reduce((s,a)=>(t[a]!==void 0&&(s[a]=t[a]),s),{})}function Nt(t,e,s,a){for(let n in s){let{twoWay:i,type:l,trackProperties:d,noBind:u}=s[n];if(u)continue;const c="set"+et(n),p="get"+et(n),g=n.toLowerCase()+"_changed",f=t[n];if(typeof e[c]>"u")throw new Error(`${c} is not a method of (the Maps object corresponding to) ${t.$options._componentTag}`);l!==Object||!d?t.$watch(n,()=>{const C=t[n];e[c](C)},{immediate:typeof f<"u",deep:l===Object}):jt(t,d.map(C=>`${n}.${C}`),()=>{e[c](t[n])},t[n]!==void 0),i&&(t.$gmapOptions.autobindAllEvents||t.$listeners[g])&&e.addListener(g,C=>{t.$emit(g,e[p]())})}}const $n={inject:{$mapPromise:{default:"abcdef"}},provide(){return this.$mapPromise.then(t=>{this.$map=t}),{}}};function Vt(t){const{mappedProps:e,name:s,ctr:a,ctrArgs:n,events:i,beforeCreate:l,afterCreate:d,props:u,...c}=t,p=`$${s}Promise`,g=`$${s}Object`;return wn(!(c.props instanceof Array),"`props` should be an object, not Array"),{...typeof GENERATE_DOC<"u"?{$vgmOptions:t}:{},mixins:[$n],props:{...u,...Ut(e)},render(){return""},provide(){const f=this.$mapPromise.then(C=>{this.$map=C;const k={...this.options,map:C,...ge(this,e)};if(delete k.options,l){const Qe=l.bind(this)(k);if(Qe instanceof Promise)return Qe.then(()=>({options:k}))}return{options:k}}).then(({options:C})=>{const k=a();return this[g]=n?new(Function.prototype.bind.call(k,null,...n(C,ge(this,u||{})))):new k(C),Nt(this,this[g],e),Mt(this,this[g],i),d&&d.bind(this)(this[g]),this[g]});return this[p]=f,{[p]:f}},destroyed(){this[g]&&this[g].setMap&&this[g].setMap(null)},...c}}function wn(t,e){if(!t)throw new Error(e)}function Ut(t){return Object.entries(t).map(([e,s])=>{const a={};return"type"in s&&(a.type=s.type),"default"in s&&(a.default=s.default),"required"in s&&(a.required=s.required),[e,a]}).reduce((e,[s,a])=>(e[s]=a,e),{})}const Sn={animation:{twoWay:!0,type:Number},attribution:{type:Object},clickable:{type:Boolean,twoWay:!0,default:!0},cursor:{type:String,twoWay:!0},draggable:{type:Boolean,twoWay:!0,default:!1},icon:{twoWay:!0},label:{},opacity:{type:Number,default:1},options:{type:Object},place:{type:Object},position:{type:Object,twoWay:!0},shape:{type:Object,twoWay:!0},title:{type:String,twoWay:!0},zIndex:{type:Number,twoWay:!0},visible:{twoWay:!0,default:!0}},kn=["click","rightclick","dblclick","drag","dragstart","dragend","mouseup","mousedown","mouseover","mouseout"],Se=Vt({mappedProps:Sn,events:kn,name:"marker",ctr:()=>google.maps.Marker,inject:{$clusterPromise:{default:null}},render(t){return!this.$slots.default||this.$slots.default.length===0?"":this.$slots.default.length===1?this.$slots.default[0]:t("div",this.$slots.default)},destroyed(){this.$markerObject&&(this.$clusterObject?this.$clusterObject.removeMarker(this.$markerObject,!0):this.$markerObject.setMap(null))},beforeCreate(t){return this.$clusterPromise&&(t.map=null),this.$clusterPromise},afterCreate(t){this.$clusterPromise&&this.$clusterPromise.then(e=>{e.addMarker(t),this.$clusterObject=e})}}),xn={options:{type:Object,required:!1,default(){return{}}},position:{type:Object,twoWay:!0},zIndex:{type:Number,twoWay:!0}},Fn=["domready","closeclick","content_changed"],Ln=Vt({mappedProps:xn,events:Fn,name:"infoWindow",ctr:()=>google.maps.InfoWindow,props:{opened:{type:Boolean,default:!0}},inject:{$markerPromise:{default:null}},mounted(){const t=this.$refs.flyaway;t.parentNode.removeChild(t)},beforeCreate(t){if(t.content=this.$refs.flyaway,this.$markerPromise)return delete t.position,this.$markerPromise.then(e=>(this.$markerObject=e,e))},methods:{_openInfoWindow(){this.opened?this.$markerObject!==null?this.$infoWindowObject.open(this.$map,this.$markerObject):this.$infoWindowObject.open(this.$map):this.$infoWindowObject.close()}},afterCreate(){this._openInfoWindow(),this.$watch("opened",()=>{this._openInfoWindow()})}});function r(t,e,s,a,n,i,l,d){var u=typeof t=="function"?t.options:t;e&&(u.render=e,u.staticRenderFns=s,u._compiled=!0),a&&(u.functional=!0),i&&(u._scopeId="data-v-"+i);var c;if(l?(c=function(f){f=f||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!f&&typeof __VUE_SSR_CONTEXT__<"u"&&(f=__VUE_SSR_CONTEXT__),n&&n.call(this,f),f&&f._registeredComponents&&f._registeredComponents.add(l)},u._ssrRegister=c):n&&(c=d?function(){n.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:n),c)if(u.functional){u._injectStyles=c;var p=u.render;u.render=function(C,k){return c.call(k),p(C,k)}}else{var g=u.beforeCreate;u.beforeCreate=g?[].concat(g,c):[c]}return{exports:t,options:u}}var Bn=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("div",[s("div",{ref:"flyaway"},[e._t("default")],2)])},On=[],En=r(Ln,Bn,On,!1,null,null,null,null);const In=En.exports,Tn={props:["resizeBus"],data(){return{_actualResizeBus:null}},created(){typeof this.resizeBus>"u"?this.$data._actualResizeBus=this.$gmapDefaultResizeBus:this.$data._actualResizeBus=this.resizeBus},methods:{_resizeCallback(){this.resize()},_delayedResizeCallback(){this.$nextTick(()=>this._resizeCallback())}},watch:{resizeBus(t,e){this.$data._actualResizeBus=t},"$data._actualResizeBus"(t,e){e&&e.$off("resize",this._delayedResizeCallback),t&&t.$on("resize",this._delayedResizeCallback)}},destroyed(){this.$data._actualResizeBus&&this.$data._actualResizeBus.$off("resize",this._delayedResizeCallback)}};function An(t){let e=0;t(()=>{e+=1},()=>{e=Math.max(0,e-1)},()=>e===0)}const ce={center:{required:!0,twoWay:!0,type:Object,noBind:!0},zoom:{required:!1,twoWay:!0,type:Number,noBind:!0},heading:{type:Number,twoWay:!0},mapTypeId:{twoWay:!0,type:String},tilt:{twoWay:!0,type:Number},options:{type:Object,default(){return{}}}},Rn=["bounds_changed","click","dblclick","drag","dragend","dragstart","idle","mousemove","mouseout","mouseover","resize","rightclick","tilesloaded"],Dn=["panBy","panTo","panToBounds","fitBounds"].reduce((t,e)=>(t[e]=function(){this.$mapObject&&this.$mapObject[e].apply(this.$mapObject,arguments)},t),{}),Pn={resize(){this.$mapObject&&google.maps.event.trigger(this.$mapObject,"resize")},resizePreserveCenter(){if(!this.$mapObject)return;const t=this.$mapObject.getCenter();google.maps.event.trigger(this.$mapObject,"resize"),this.$mapObject.setCenter(t)},_resizeCallback(){this.resizePreserveCenter()}},zn={mixins:[Tn],props:Ut(ce),provide(){return this.$mapPromise=new Promise((t,e)=>{this.$mapPromiseDeferred={resolve:t,reject:e}}),{$mapPromise:this.$mapPromise}},computed:{finalLat(){return this.center&&typeof this.center.lat=="function"?this.center.lat():this.center.lat},finalLng(){return this.center&&typeof this.center.lng=="function"?this.center.lng():this.center.lng},finalLatLng(){return{lat:this.finalLat,lng:this.finalLng}}},watch:{zoom(t){this.$mapObject&&this.$mapObject.setZoom(t)}},mounted(){return this.$gmapApiPromiseLazy().then(()=>{const t=this.$refs["vue-map"],e={...this.options,...ge(this,ce)};return delete e.options,this.$mapObject=new google.maps.Map(t,e),Nt(this,this.$mapObject,ce),Mt(this,this.$mapObject,Rn),An((s,a,n)=>{this.$mapObject.addListener("center_changed",()=>{n()&&this.$emit("center_changed",this.$mapObject.getCenter()),a()}),jt(this,["finalLat","finalLng"],()=>{s(),this.$mapObject.setCenter(this.finalLatLng)})}),this.$mapObject.addListener("zoom_changed",()=>{this.$emit("zoom_changed",this.$mapObject.getZoom())}),this.$mapObject.addListener("bounds_changed",()=>{this.$emit("bounds_changed",this.$mapObject.getBounds())}),this.$mapPromiseDeferred.resolve(this.$mapObject),this.$mapObject}).catch(t=>{throw t})},methods:{...Pn,...Dn}};var Mn=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("div",{staticClass:"vue-map-container"},[s("div",{ref:"vue-map",staticClass:"vue-map"}),s("div",{staticClass:"vue-map-hidden"},[e._t("default")],2),e._t("visible")],2)},jn=[],Nn=r(zn,Mn,jn,!1,null,null,null,null);const ke=Nn.exports;let Ht=null;function Vn(t,e){e={installComponents:!0,autobindAllEvents:!1,...e},Ht=new t({data:{gmapApi:null}});const s=new t;let a=Un(e);t.mixin({created(){this.$gmapDefaultResizeBus=s,this.$gmapOptions=e,this.$gmapApiPromiseLazy=a}}),t.$gmapDefaultResizeBus=s,t.$gmapApiPromiseLazy=a,e.installComponents&&(t.component("GmapMap",ke),t.component("GmapMarker",Se),t.component("GmapInfoWindow",In),t.component("GmapPolyline",Polyline),t.component("GmapPolygon",Polygon),t.component("GmapCircle",Circle),t.component("GmapRectangle",Rectangle),t.component("GmapAutocomplete",Autocomplete),t.component("GmapPlaceInput",PlaceInput),t.component("GmapStreetViewPanorama",StreetViewPanorama))}function Un(t){function e(){return Ht.gmapApi={},window.google}if(t.load)return Je(()=>typeof window>"u"?new Promise(()=>{}).then(e):new Promise((s,a)=>{try{window.vueGoogleMapsInit=s,zt(t.load,t.loadCn)}catch(n){a(n)}}).then(e));{const s=new Promise(a=>{typeof window>"u"||(window.vueGoogleMapsInit=a)}).then(e);return Je(()=>s)}}const Hn={props:{items:Array},computed:{icon(){var t;return(t=this.$store.state.currentEntity)==null?void 0:t.icon}},methods:{isActive(t){return t===this.items.length-1}}};var qn=function(){var e=this,s=e._self._c;return s("div",{staticClass:"d-flex"},[s("div",{staticClass:"d-flex align-items-center"},[e.icon&&e.items&&e.items.length?[s("div",{staticClass:"me-2 pe-1"},[s("i",{staticClass:"fa fa-sm d-block text-primary opacity-75 fs-8",class:e.icon})])]:e._e(),s("div",{staticClass:"breadcrumb align-items-center p-0 m-0"},[e._l(e.items,function(a,n){return[s("div",{staticClass:"breadcrumb-item",class:{active:e.isActive(n)}},[e.isActive(n)?[s("span",[e._v(e._s(a.name))])]:[s("a",{attrs:{href:a.url}},[e._v(e._s(a.name))])]],2)]})],2)],2)])},Kn=[],Gn=r(Hn,qn,Kn,!1,null,null,null,null);const xe=Gn.exports,Wn={props:{variant:{type:String,default:"primary"},text:Boolean,outline:Boolean,small:Boolean,large:Boolean,active:Boolean,block:Boolean,href:String,disabled:Boolean},computed:{variantClass(){return!this.hasTextStyle&&this.variant?`btn${this.outline?"-outline":""}-${this.variant}`:null},classes(){return[this.variantClass,{"btn-sm":this.small,"btn-lg":this.large,"btn-text":this.hasTextStyle,"btn-block":this.block,active:this.active,disabled:this.disabled}]},hasTextStyle(){return this.text===!0},tag(){return this.href?"a":"button"}},methods:{focus(){this.$el.focus()}}};var Qn=function(){var e=this,s=e._self._c;return s(e.tag,e._g({tag:"component",staticClass:"SharpButton btn",class:e.classes,attrs:{href:e.href,disabled:e.disabled}},e.$listeners),[e._t("default")],2)},Yn=[],Xn=r(Wn,Qn,Yn,!1,null,null,null,null);const _=Xn.exports,Jn={props:{formControl:{type:Boolean,default:!0}},computed:{classes(){return{"SharpClearButton--form-control":this.formControl}}},methods:{click(){this.$el.click()}}};var Zn=function(){var e=this,s=e._self._c;return s("button",e._g({staticClass:"SharpClearButton btn",class:e.classes,attrs:{type:"button"}},e.$listeners),[s("svg",{staticClass:"SharpClearButton__icon",attrs:{"aria-label":"close",width:"10",height:"10",viewBox:"0 0 10 10","fill-rule":"evenodd"}},[s("path",{attrs:{d:"M9.8 8.6L8.4 10 5 6.4 1.4 10 0 8.6 3.6 5 .1 1.4 1.5 0 5 3.6 8.6 0 10 1.4 6.4 5z"}})])])},ei=[],ti=r(Jn,Zn,ei,!1,null,null,null,null);const se=ti.exports,si={name:"SharpNavItem",props:{current:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},href:String,target:String,linkClass:String}};var ai=function(){var e=this,s=e._self._c;return s("li",{staticClass:"SharpLeftNav__item",class:{"SharpLeftNav__item--active":e.current,"SharpLeftNav__item--disabled":e.disabled},attrs:{role:"menuitem"}},[e.disabled?[s("span",{staticClass:"SharpLeftNav__item-link",class:e.linkClass},[e._t("default")],2)]:[s("a",{staticClass:"SharpLeftNav__item-link",class:e.linkClass,attrs:{href:e.href,target:e.target}},[e._t("default")],2)]],2)},ni=[],ii=r(si,ai,ni,!1,null,null,null,null);const ri=ii.exports,li={components:{BCollapse:fa},props:{label:String,opened:Boolean,collapsible:Boolean},data(){return{expanded:this.opened||!this.collapsible}},methods:{toggle(){this.collapsible&&(this.expanded=!this.expanded)}}};var oi=function(){var e=this,s=e._self._c;return s("li",{staticClass:"SharpLeftNav__item SharpLeftNav__item--has-children",class:{"SharpLeftNav__item--expanded":e.expanded,"SharpLeftNav__item--disabled":!e.collapsible}},[s("div",{staticClass:"SharpLeftNav__item-link",attrs:{tabindex:e.collapsible?"0":"-1"},on:{keydown:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.toggle.apply(null,arguments)},click:e.toggle}},[s("div",{staticClass:"row gx-2 align-items-center flex-nowrap"},[s("div",{staticClass:"col",staticStyle:{"min-width":"0"}},[e._t("label",function(){return[e._v(" "+e._s(e.label)+" ")]})],2),e.collapsible?[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"SharpLeftNav__item-icon"},[s("svg",{staticClass:"SharpLeftNav__icon",attrs:{width:"10",height:"5",viewBox:"0 0 10 5","fill-rule":"evenodd"}},[s("path",{attrs:{d:"M10 0L5 5 0 0z"}})])])])]:e._e()],2)]),s("b-collapse",{attrs:{visible:e.expanded}},[s("ul",{staticClass:"SharpLeftNav__list SharpLeftNav__list--nested",attrs:{role:"menu","aria-hidden":"true"}},[e._t("default")],2)])],1)},di=[],ci=r(li,oi,di,!1,null,null,null,null);const ui=ci.exports,hi={name:"SharpPagination",inheritAttrs:!1,components:{BPagination:_a},props:{totalRows:Number,perPage:Number,minPageEndButtons:{type:Number,default:0}},computed:{hideGotoEndButtons(){return Math.ceil(this.totalRows/Math.max(this.perPage,1))<this.minPageEndButtons}}};var mi=function(){var e=this,s=e._self._c;return s("b-pagination",e._g(e._b({staticClass:"SharpPagination",attrs:{"total-rows":e.totalRows,"per-page":e.perPage,"hide-goto-end-buttons":e.hideGotoEndButtons},scopedSlots:e._u([{key:"first-text",fn:function(){return[s("i",{staticClass:"fas fa-angle-double-left",attrs:{"aria-hidden":"true"}})]},proxy:!0},{key:"prev-text",fn:function(){return[s("i",{staticClass:"fas fa-angle-left",attrs:{"aria-hidden":"true"}})]},proxy:!0},{key:"next-text",fn:function(){return[s("i",{staticClass:"fas fa-angle-right",attrs:{"aria-hidden":"true"}})]},proxy:!0},{key:"last-text",fn:function(){return[s("i",{staticClass:"fas fa-angle-double-right",attrs:{"aria-hidden":"true"}})]},proxy:!0}])},"b-pagination",e.$attrs,!1),e.$listeners))},pi=[],fi=r(hi,mi,pi,!1,null,null,null,null);const _i=fi.exports,gi={props:{columns:Array,row:{type:Object,default:()=>({})},url:String,header:Boolean,highlight:Boolean,selecting:Boolean,deleting:Boolean},data(){return{isHighlighted:this.highlight}},watch:{highlight(){this.isHighlighted=this.highlight}},computed:{hasLink(){return!!this.url},classes(){return{"SharpDataList__row--header":this.header,"SharpDataList__row--disabled":!this.header&&!this.hasLink,"SharpDataList__row--highlight":this.isHighlighted,"SharpDataList__row--deleting":this.deleting}}},methods:{colClasses(t){const{size:e,sizeXS:s,hideOnXS:a}=t;return{col:s==="fill"&&!a,[`col-${s}`]:s!=="fill"&&!a,"col-md":e==="fill",[`col-md-${e}`]:e!=="fill","d-none d-md-block":a}},toggleHighlight(t){this.isHighlighted=t}}};var vi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpDataList__row position-relative px-3",class:e.classes},[s("div",{staticClass:"row gx-0"},[e.$scopedSlots.prepend?[s("div",{staticClass:"col-auto align-self-center"},[s("div",{staticClass:"SharpDataList__row-prepend"},[e._t("prepend")],2)])]:e.header&&e.selecting?[e._m(0)]:e._e(),s("div",{staticClass:"col d-flex flex-column justify-content-center position-relative"},[s("div",{staticClass:"SharpDataList__cols py-3"},[s("div",{staticClass:"row align-items-center gx-n2 gx-md-n3"},[e._l(e.columns,function(a,n){return[s("div",{class:[e.header?"SharpDataList__th":"SharpDataList__td",e.colClasses(a)],staticStyle:{"min-width":"0"}},[e._t("cell",function(){return[a.html?[s("div",{staticClass:"SharpDataList__td-html-container",domProps:{innerHTML:e._s(e.row[a.key])}})]:[e._v(" "+e._s(e.row[a.key])+" ")]]},{row:e.row,column:a})],2)]})],2)]),e.hasLink&&!e.selecting?[s("a",{staticClass:"SharpDataList__row-link position-absolute inset-0",attrs:{href:e.url}})]:e._e()],2),s("div",{staticClass:"col-sm-auto align-self-center"},[e.$scopedSlots.append?[s("div",{staticClass:"SharpDataList__row-append pb-3 pt-sm-3"},[e._t("append",null,null,this)],2)]:[s("div",{staticStyle:{width:"var(--append-width, auto)"}})]],2)],2)])},bi=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"col-auto"},[e("div",{staticStyle:{width:"var(--prepend-width, auto)"}})])}],yi=r(gi,vi,bi,!1,null,null,null,null);const Fe=yi.exports,Ci={components:{Pagination:_i,DataListRow:Fe,Draggable:St},props:{items:Array,columns:Array,paginated:Boolean,totalCount:Number,pageSize:Number,page:Number,reordering:Boolean,sort:String,dir:String,hideHeader:Boolean},data(){return{reorderedItems:null,prependWidth:0,appendWidth:0}},watch:{reordering(t){this.handleReorderingChanged(t)}},computed:{hasPagination(){return!!this.paginated&&this.totalCount/this.pageSize>1},draggableOptions(){return{disabled:!this.reordering}},currentItems(){return this.reordering?this.reorderedItems:this.items},isEmpty(){return(this.items||[]).length===0},styles(){return{"--prepend-width":this.prependWidth?`${this.prependWidth}px`:null,"--append-width":this.appendWidth?`${this.appendWidth}px`:null}}},methods:{handleItemsChanged(t){this.reorderedItems=t,this.$emit("change",t)},handleSortClicked(t){this.$emit("sort-change",{prop:t,dir:this.sort===t&&this.dir==="asc"?"desc":"asc"})},handlePageChanged(t){this.$emit("page-change",t)},handleReorderingChanged(t){this.reorderedItems=t?[...this.items]:null},async updateLayout(){var a,n,i,l,d,u;this.appendWidth=0,await this.$nextTick();const t=((n=(a=this.$refs.head)==null?void 0:a.querySelector(".SharpDataList__row-append"))==null?void 0:n.offsetWidth)??0,e=((l=(i=this.$refs.body)==null?void 0:i.querySelector(".SharpDataList__row-append"))==null?void 0:l.offsetWidth)??0,s=((u=(d=this.$refs.body)==null?void 0:d.querySelector(".SharpDataList__row-prepend"))==null?void 0:u.offsetWidth)??0;this.appendWidth=Math.max(t,e),this.prependWidth=s}},updated(){},mounted(){this.updateLayout(),window.addEventListener("resize",this.updateLayout)},destroyed(){window.removeEventListener("resize",this.updateLayout)}};var $i=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpDataList",class:{"SharpDataList--reordering":e.reordering},style:e.styles},[e.isEmpty?[s("div",{staticClass:"SharpDataList__empty"},[e._t("prepend"),s("div",{staticClass:"p-3"},[e._t("empty"),e._t("append-body")],2)],2)]:[e.$slots["append-head"]?[s("div",{staticClass:"d-flex justify-content-end mb-3 d-sm-none"},[e._t("append-head")],2)]:e._e(),s("div",{staticClass:"SharpDataList__table SharpDataList__table--border"},[e._t("prepend"),e.hideHeader?e._e():[s("div",{ref:"head",staticClass:"SharpDataList__thead"},[s("DataListRow",{attrs:{columns:e.columns,header:""},scopedSlots:e._u([{key:"cell",fn:function({column:a}){return[s("div",{staticClass:"row"},[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"row align-items-center gx-2"},[s("div",{staticClass:"col",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"overflow-hidden"},[e._v(" "+e._s(a.label)+" ")])]),a.sortable?[s("div",{staticClass:"col-auto"},[s("svg",{staticClass:"SharpDataList__caret",class:{"SharpDataList__caret--selected":e.sort===a.key,"SharpDataList__caret--ascending":e.sort===a.key&&e.dir==="asc"},attrs:{width:"10",height:"5",viewBox:"0 0 10 5","fill-rule":"evenodd"}},[s("path",{attrs:{d:"M10 0L5 5 0 0z"}})]),s("a",{staticClass:"SharpDataList__sort-link",attrs:{href:""},on:{click:function(n){return n.preventDefault(),e.handleSortClicked(a.key)}}})])]:e._e()],2)])])]}},e.$slots["append-head"]?{key:"append",fn:function(){return[e._t("append-head")]},proxy:!0}:null],null,!0)})],1)],s("div",{ref:"body",staticClass:"SharpDataList__tbody"},[s("Draggable",{attrs:{options:e.draggableOptions,value:e.reorderedItems},on:{input:e.handleItemsChanged}},[e._l(e.currentItems,function(a){return[e._t("item",null,{item:a})]})],2),e._t("append-body")],2)],2)],e.hasPagination?[s("div",{staticClass:"SharpDataList__pagination-container"},[s("Pagination",{attrs:{"total-rows":e.totalCount,"per-page":e.pageSize,"min-page-end-buttons":3,limit:7,value:e.page},on:{change:e.handlePageChanged}})],1)]:e._e()],2)},wi=[],Si=r(Ci,$i,wi,!1,null,null,null,null);const qt=Si.exports,ki={name:"SharpDropdown",components:{BDropdown:{extends:ga,computed:{boundaryClass:()=>null}}},props:{..._.props,text:[Boolean,String],showCaret:{type:Boolean,default:!0},title:String,disabled:Boolean},data(){return{boundary:"scrollParent"}},computed:{..._.computed,toggleClass(){return[this.classes,this.$attrs["toggle-class"]]},popperOptions(){return{modifiers:{preventOverflow:{padding:8,priority:["left","right"]}}}}},methods:{show(){this.$refs.dropdown.show()},hide(){this.$refs.dropdown.hide()}},mounted(){this.title&&this.$el.querySelector(".dropdown-toggle").setAttribute("title",this.title),this.$el.closest("[data-popover-boundary]")&&(this.boundary=this.$el.closest("[data-popover-boundary]"))}};var xi=function(){var e=this,s=e._self._c;return s("b-dropdown",e._g(e._b({ref:"dropdown",staticClass:"SharpDropdown",attrs:{"toggle-class":e.toggleClass,disabled:e.disabled,"no-caret":!e.showCaret,offset:1,boundary:e.boundary,"popper-opts":e.popperOptions,variant:"custom","no-flip":""},scopedSlots:e._u([{key:"button-content",fn:function(){return[e._t("text",function(){return[e._v(e._s(e.text))]})]},proxy:!0}],null,!0)},"b-dropdown",e.$attrs,!1),e.$listeners),[e._t("default",null,{hide:e.hide})],2)},Fi=[],Li=r(ki,xi,Fi,!1,null,null,null,null);const $=Li.exports,Bi={name:"SharpDropdownItem",props:{active:Boolean,disabled:Boolean},components:{BDropdownItem:va},methods:{handleClick(t){this.$emit("click",t)}}};var Oi=function(){var e=this,s=e._self._c;return s("b-dropdown-item",e._b({attrs:{active:e.active,disabled:e.disabled},on:{click:e.handleClick}},"b-dropdown-item",e.$attrs,!1),[e._t("default")],2)},Ei=[],Ii=r(Bi,Oi,Ei,!1,null,null,null,null);const x=Ii.exports,Ti={name:"SharpDropdownSeparator",components:{BDropdownDivider:ba}};var Ai=function(){var e=this,s=e._self._c;return s("b-dropdown-divider")},Ri=[],Di=r(Ti,Ai,Ri,!1,null,null,null,null);const U=Di.exports,Pi={name:"SharpTemplate",props:{name:String,templateData:Object,templateProps:Array,template:String},computed:{component(){return{name:`SharpTemplate${this.name}`,template:`<div class="SharpTemplate">${this.template??""}</div>`,props:[...this.templateProps||[],...Object.keys(this.templateData??{})],mounted(){var e,s,a;const t=!((e=this.$el.children)!=null&&e.length)&&!((s=this.$el.innerText)!=null&&s.trim());this.$emit("content-change",{isEmpty:t}),((a=this.$el.children)==null?void 0:a.length)>0&&this.$el.classList.add("SharpTemplate--has-children")}}}}};var zi=function(){var e=this,s=e._self._c;return s(e.component,e._g(e._b({tag:"component"},"component",e.templateData,!1),e.$listeners),[e._t("default")],2)},Mi=[],ji=r(Pi,zi,Mi,!1,null,null,null,null);const z=ji.exports;const Ni={props:{name:String}};var Vi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"unknown-field"},[s("span",[e._v("Unknown field «"+e._s(e.name)+"»")])])},Ui=[],Hi=r(Ni,Vi,Ui,!1,null,"33889528",null,null);const Le=Hi.exports,qi={props:{options:Object},computed:{alertClasses(){return[`alert-${this.options.alertLevel}`]}}};var Ki=function(){var e=this,s=e._self._c;return s("div",[e.options.alertLevel?[s("div",{staticClass:"alert mb-0",class:e.alertClasses},[e._t("default")],2)]:[e._t("default")]],2)},Gi=[],Wi=r(qi,Ki,Gi,!1,null,null,null,null);const Qi=Wi.exports,Yi={components:{GlobalMessageLayout:Qi,TemplateRenderer:z},props:{options:Object,fields:Object,data:Object},data(){return{visible:!0}},computed:{fieldKey(){return this.options.fieldKey},fieldOptions(){var t;return(t=this.fields)==null?void 0:t[this.fieldKey]},value(){var t;return(t=this.data)==null?void 0:t[this.fieldKey]}},methods:{handleTemplateContentChanged({isEmpty:t}){this.visible=!t}}};var Xi=function(){var e=this,s=e._self._c;return s("GlobalMessageLayout",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"SharpGlobalMessage",attrs:{options:e.options}},[e.fieldOptions?[s("TemplateRenderer",{attrs:{name:"GlobalMessage","template-data":e.value,template:e.fieldOptions.template},on:{"content-change":e.handleTemplateContentChanged}})]:e._e()],2)},Ji=[],Zi=r(Yi,Xi,Ji,!1,null,null,null,null);const ae=Zi.exports;function er(t){return t.text?t.text.trim().length===0:t.elm instanceof HTMLElement?t.elm.style.display==="none":!t.tag}function tt(t,{value:e},s){!s.children.length||s.children.every(a=>er(a))?t.classList.add(e):t.classList.remove(e)}const tr={inserted:tt,componentUpdated:tt};class st{constructor(e){M(this,"el");M(this,"sentinel");M(this,"listener");M(this,"position");this.el=e,this.listener=kt(()=>this.refresh(),50),this.sentinel=document.createElement("div"),this.scrollContainer=e.closest(".modal")??window,this.position=window.getComputedStyle(e).bottom!=="auto"?"bottom":"top",this.sentinel.dataset.stickySentinel=!0,this.position==="bottom"?this.el.parentElement.insertBefore(this.sentinel,this.el.nextSibling):this.el.parentElement.insertBefore(this.sentinel,this.el),this.scrollContainer.addEventListener("scroll",this.listener),window.addEventListener("resize",this.listener),m.nextTick(()=>this.refresh())}destroy(){this.el=null,this.sentinel.remove(),this.scrollContainer.removeEventListener("scroll",this.listener),window.removeEventListener("resize",this.listener)}refresh(){if(!this.el)return;const e=this.el.getBoundingClientRect(),s=this.el.querySelector("[data-sticky-anchor]");this.position==="bottom"?this.setStuck(e.bottom<this.sentinel.getBoundingClientRect().bottom):this.setStuck(e.top>this.sentinel.getBoundingClientRect().top),s&&this.el.style.setProperty("--sticky-offset",`${e.top-s.getBoundingClientRect().top}px`)}setStuck(e){this.el.classList.toggle("stuck",e),this.el.dispatchEvent(new CustomEvent("stuck-change",{detail:e}))}}const H={inserted(t,{value:e,expression:s}){(e||!s)&&(t._stickyObserver=new st(t))},update(t,{value:e}){var s;e&&!t._stickyObserver&&(t._stickyObserver=new st(t)),(s=t._stickyObserver)==null||s.refresh()},unbind(t){var e;(e=t._stickyObserver)==null||e.destroy()}},sr={name:"SharpGrid",props:{rows:{type:Array,required:!0},rowClass:[Function,String],colClass:{type:Function,default:()=>null}},methods:{colClasses(t){const{size:e,sizeXS:s}=t,a=!!e;return[{[`col-${s}`]:s,[`col-md-${e}`]:a,"col-md":!a},this.colClass(t)]},rowClasses(t){return typeof this.rowClass=="function"?this.rowClass(t):this.rowClass}},directives:{"empty-class":tr}};var ar=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpGrid"},[e._l(e.rows,function(a){return[s("div",{staticClass:"SharpGrid__row row",class:e.rowClasses(a)},[e._l(a,function(n){return[s("div",{directives:[{name:"empty-class",rawName:"v-empty-class",value:"SharpGrid__col--empty",expression:"'SharpGrid__col--empty'"}],staticClass:"SharpGrid__col",class:e.colClasses(n)},[e._t("default",null,{itemLayout:n})],2)]})],2)]})],2)},nr=[],ir=r(sr,ar,nr,!1,null,null,null,null);const R=ir.exports,rr={props:{fade:Boolean},computed:{name(){if(this.fade)return"loading-fade"}}};var lr=function(){var e=this,s=e._self._c;return s("transition",{attrs:{name:e.name,appear:""}},[e._t("default")],2)},or=[],dr=r(rr,lr,or,!1,null,null,null,null);const Kt=dr.exports,cr={components:{LoadingTransition:Kt},props:{visible:{type:Boolean,default:!0},small:Boolean,light:Boolean,fade:Boolean},computed:{classes(){return{"SharpLoading--light":this.light}},spinnerClasses(){return{"spinner-border-sm":this.small}}}};var ur=function(){var e=this,s=e._self._c;return s("loading-transition",{attrs:{fade:e.fade}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"SharpLoading",class:e.classes},[s("div",{staticClass:"d-block spinner-border",class:e.spinnerClasses})])])},hr=[],mr=r(cr,ur,hr,!1,null,null,null,null);const I=mr.exports,pr={components:{LoadingTransition:Kt,Loading:I},props:{visible:{type:Boolean,default:!0},absolute:Boolean,fade:Boolean},computed:{classes(){return{"SharpLoading__overlay--absolute":this.absolute}}}};var fr=function(){var e=this,s=e._self._c;return s("loading-transition",{attrs:{fade:e.fade}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"SharpLoading__overlay",class:e.classes},[s("Loading",e._b({},"Loading",e.$attrs,!1))],1)])},_r=[],gr=r(pr,fr,_r,!1,null,null,null,null);const ne=gr.exports,Be={methods:{getMergedIdentifier(t,e){let s=this.$parent;for(;s&&typeof s[t]>"u";)s=s.$parent;let a="";return s!=null&&s[t]&&(a=s[t]+"."),`${a}${e}`}}},vr={mixins:[Be],props:{errorIdentifier:{type:[String,Number],required:!0}},computed:{mergedErrorIdentifier(){return this.getMergedIdentifier("mergedErrorIdentifier",this.errorIdentifier)}}};function br(){const t=document.head.querySelector("meta[name=base-url]");return t?`/${t.content}`:"/sharp"}let Oe=br(),Ee=`${Oe}/api`,yr=`${Ee}/upload`;function Cr(t){return Array.isArray(t)&&!t.length?null:t}function $r(t){return Object.entries(t).reduce((e,[s,a])=>({...e,[s]:Cr(a)}),t||{})}function wr(t){const e=$r(t);return Ce.stringify(e,{strictNullHandling:!0})}function Gt(t){return new Promise(e=>{let s=new FileReader;s.addEventListener("loadend",function(){e(JSON.parse(s.result))}),s.readAsText(t)})}function Sr(t={}){let{["content-disposition"]:e}=t;if(e&&e.includes("attachment")){let a=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(e);if(a!=null&&a[1])return a[1].replace(/['"]/g,"")}return null}function o(t,e){var a;const s=(a=window.i18n)==null?void 0:a[t];return s||(e!==void 0?e:t)}const kr={state:{loading:!1,dialogs:[],currentEntity:null},mutations:{setLoading(t,e){t.loading=!!e},setDialogs(t,e){t.dialogs=e},setCurrentEntity(t,e){t.currentEntity=e}},getters:{isLoading(t){return!!t.loading}},actions:{setLoading({commit:t},e){t("setLoading",e)},setDialogs({commit:t},e){t("setDialogs",e)},setCurrentEntity({commit:t},e){t("setCurrentEntity",e)}}};let ue=null;function T(){return ue||(ue=new xt.Store(kr))}let xr=0;function Wt({text:t,okCallback:e=()=>{},okCloseOnly:s,isError:a,...n}){const i=xr++;return new Promise((l,d)=>{T().dispatch("setDialogs",[...T().state.dialogs,{id:i,props:{...n,okOnly:s,noCloseOnBackdrop:s,noCloseOnEsc:s,visible:!0,isError:a},okCallback:()=>l(!0),hiddenCallback:()=>{T().dispatch("setDialogs",T().state.dialogs.filter(u=>u.id!==i)),l(!1)},text:t}])})}function D(t,{title:e,...s}={}){return Wt({okCloseOnly:!0,text:t,title:e,...s})}function Qt(t,{title:e,...s}={}){return Wt({text:t,title:e,size:"sm",hideHeader:!0,okTitle:o("modals.confirm.ok_button"),bodyClass:"pt-4",...s})}function Yt(t){return Qt(t,{okTitle:o("modals.confirm.delete.ok_button"),okVariant:"danger"})}function Xt({data:t,status:e}){return o(`modals.${e}.message`,null)||`${e}: ${t.message}`||o("modals.error.message")}async function Jt({data:t,method:e,status:s}){const a=Xt({data:t,status:s}),n=o(`modals.${s}.title`,null)||o("modals.error.title");s===404&&e==="get"||s===422||(await D(a,{title:n,isError:!0}),(s===401||s===419)&&location.reload())}function Fr(t){t.interceptors.response.use(e=>(Lr(e),e),async e=>{const s=e.response;return s.data instanceof Blob&&s.data.type==="application/json"&&(s.data=await Gt(s.data)),Jt({data:s.data,status:s.status,method:e.config.method}),Promise.reject(e)})}function Lr(t){var s;const e=t.headers["content-type"];if(!(e!=null&&e.includes("application/json"))&&!((s=t.headers["content-disposition"])!=null&&s.includes("attachment"))){const{method:a,url:n}=t.config,i=`${a.toUpperCase()} ${n} : Invalid response content-type "${e}", expected JSON`;throw console.error(i),new Error(i)}}const v=Zt();function Zt(){const t=X.create({baseURL:Ee,paramsSerializer:wr});return Fr(t),t}function Br(t,{params:e}={}){return v.getUri({url:`${Ee}/${t.replace(/^\//,"")}`,params:e})}function Or(){return ya.read("XSRF-TOKEN")}const Er={caseSensitive:!1,include:[],minMatchCharLength:1,shouldSort:!0,tokenize:!0,matchAllTokens:!1,findAllMatches:!1,id:null,keys:["value"],location:0,threshold:0,distance:0,maxPatternLength:64};function Ir(t,e,{searchKeys:s}={}){return new Ca(t,{...Er,keys:s}).search(e)}const Q="YYYYMMDD";function Tr(t){return Ce.stringify(t,{addQueryPrefix:!0,skipNulls:!0})}function Ar(t){return Ce.parse(t,{ignoreQueryPrefix:!0,strictNullHandling:!0})}function Rr(t){const[e,s]=(t||"").split("..");return{start:e?w(e,Q).toDate():null,end:s?w(s,Q).toDate():null}}function Dr(t){if(typeof t=="string")return t;let e=(t||{}).start,s=(t||{}).end;return e&&(e=w(e).format(Q)),s&&(s=w(s).format(Q)),e||s?`${e||""}..${s||""}`:null}function Ie(t){return`SHARP : ${t}`}function Pr(t,...e){console.log(Ie(t),...e)}function zr(t,...e){console.warn(Ie(t),...e)}function b(t,...e){console.error(Ie(t),...e)}function Mr(){return(navigator.language||"").slice(0,2)||"en"}function jr(t){if(t==="fr")return{KB:"Ko",MB:"Mo"}}function Te(t){const e=Mr(),s=Math.max(Ye(t,{output:"exponent"}),1),a=Math.max(t,128),n=Ye(a,{standard:"jedec",round:2,exponent:s,locale:!0,symbols:jr(e)});return t<128?`< ${n}`:n}function es(t){const e=t[t.length-2];return e?e.url:null}function Nr(t,e){return!t||!e?!1:t.replace(/:(.*)/,"")===e.replace(/:(.*)/,"")}const ts=/^custom-(.+)$/;function ss(t){return ts.test(t)}function as(t){const[e,s]=t.match(ts)||[],a=s?m.options.components[`SharpCustomField_${s}`]:null;return a||b(`unknown custom field type '${t}', make sure you register it correctly (https://sharp.code16.fr/docs/guide/custom-form-fields.html#register-the-custom-field)`),a}function Vr({level:t,title:e,message:s,autoHide:a}){m.notify({title:e,type:t,text:s,duration:a?4e3:-1})}function ns(t){setTimeout(()=>{var e;(e=t==null?void 0:t.forEach)==null||e.call(t,s=>Vr(s))},500)}function Y(t){return T().dispatch("setLoading",!0),t.finally(()=>{T().dispatch("setLoading",!1)})}function Ur(t){return t.uid||t._uid}function is(t){t&&!m.config.ignoredElements.includes(t)&&m.config.ignoredElements.push(t)}const Hr=[];let he=null;function V(t){return!he||t?he=new Ft({mode:"history",routes:Hr,base:`${Oe}/`,parseQuery:Ar,stringifyQuery:Tr}):he}function rs(t,{append:e}={}){let{href:s,route:a}=V().resolve(t);if(e){const n=V().currentRoute.path.replace(/\/$/,"");s=V().resolve(n+a.fullPath).href}return s}function qr(){if(!document.referrer)return;const t=new URL(document.referrer);if(t.origin!==location.origin)return;const{route:e}=V().resolve(t.pathname+t.search);return e}function ls({entityKey:t,instanceId:e},s){return rs({name:"form",params:{entityKey:t,instanceId:e}},s)}function Kr({entityKey:t,instanceId:e},s){return rs({name:"show",params:{entityKey:t,instanceId:e}},s)}const y={computed:{language(){return document.documentElement.lang}},methods:{l:o}};let Gr=t=>({methods:{lSub(e){return o(`${t}.${e}`)}}});function Wr(t="sm"){return{data(){return{isViewportSmall:!1}},methods:{$_responsiveUpdate(){let{offsetWidth:e}=this.$_testElm;this.isViewportSmall=!!e}},created(){let e=`viewport-down-${t}`;this.$_testElm=document.getElementById(e),this.$_testElm||(this.$_testElm=document.createElement("div"),this.$_testElm.id=e,this.$_testElm.classList.add(`d-${t}-none`),document.body.appendChild(this.$_testElm)),this.$_responsiveUpdate(),this.$_debouncedRespnsiveUpdate=E(this.$_responsiveUpdate,300),window.addEventListener("resize",this.$_debouncedRespnsiveUpdate)},destroyed(){window.removeEventListener("resize",this.$_debouncedRespnsiveUpdate)}}}const os={mixins:[Be],props:{configIdentifier:{type:String,required:!0}},computed:{mergedConfigIdentifier(){return this.getMergedIdentifier("mergedConfigIdentifier",this.configIdentifier)}}},Qr={inject:["axiosInstance"],methods:{showLoading(){this.$store.dispatch("setLoading",!0)},hideLoading(){this.$store.dispatch("setLoading",!1)},installInterceptors(){this.axiosInstance.interceptors.request.use(t=>(this.showLoading(),t),t=>Promise.reject(t)),this.axiosInstance.interceptors.response.use(t=>(this.hideLoading(),t),t=>(this.hideLoading(),Promise.reject(t)))}},created(){this.synchronous||(this.installInterceptors(),this.showLoading())}},ds={mixins:[Qr],inject:["axiosInstance"],data(){return{data:null,layout:null}},methods:{get(){return this.axiosInstance.get(this.apiPath,{params:this.apiParams}).then(t=>(this.mount(t.data),ns(t.data.notifications),Promise.resolve(t)))},post(t=this.apiPath,e=this.data,s){return this.axiosInstance.post(t,e,s)}}},Ae={data(){return{currentCommand:null,commandViewContent:null,commandEndpoints:{postCommand:null,getForm:null},commandFormProps:{loading:!1}}},computed:{commandFormListeners(){return{submit:this.handleCommandFormSubmitClicked,close:this.handleCommandFormClosed,"update:loading":t=>{this.commandFormProps.loading=t}}}},methods:{transformCommandForm(t){return{...t,layout:{tabs:[{columns:[{fields:t.layout}]}]}}},downloadCommandFile(t){let e=document.createElement("a");this.$el.appendChild(e),e.href=URL.createObjectURL(t.data),e.download=Sr(t.headers),e.click()},async handleCommandResponse(t){if(t.data.type!=="application/json")return this.downloadCommandFile(t),null;const e=await Gt(t.data);return await this.handleCommandActionRequested(e.action,e),e},async postCommandForm(t){const{postCommand:e}=this.commandEndpoints,s=await t.submit({postFn:n=>e({data:n,command_step:this.currentCommand.step})}),a=await this.handleCommandResponse(s);(a==null?void 0:a.action)==="step"?(this.currentCommand={...this.currentCommand,step:a.step},await this.showCommandForm(this.currentCommand)):this.currentCommand=null},async getCommandForm(){const{getForm:t}=this.commandEndpoints;return this.currentCommand?(this.commandFormProps.loading=!0,t({command_step:this.currentCommand.step}).finally(()=>{this.commandFormProps.loading=!1})):Y(t())},async showCommandForm(t){const e=await this.getCommandForm();this.currentCommand={...t,form:this.transformCommandForm(e)}},async sendCommand(t,{postCommand:e,getForm:s}){if(this.commandEndpoints={postCommand:e,getForm:s},t.has_form)return this.showCommandForm(t);if(!(t.confirmation&&!await Qt(t.confirmation)))try{let a=await Y(e());await this.handleCommandResponse(a)}catch(a){console.error(a)}},addCommandActionHandlers(t){this.commandHandlers={...this.commandHandlers,...t}},async handleCommandActionRequested(t,e){const s=this.commandHandlers[t];s&&await s(e)},async handleReloadCommand(){await this.init()},async handleInfoCommand(t){await D(t.message,{title:o("modals.command.info.title")})},handleViewCommand(t){this.commandViewContent=t.html},handleLinkCommand(t){window.location.href=t.link},handleCommandFormSubmitClicked(t){this.postCommandForm(t)},handleCommandFormClosed(){this.currentCommand=null},handleCommandViewPanelClosed(){this.commandViewContent=null}},created(){this.addCommandActionHandlers({reload:this.handleReloadCommand,info:this.handleInfoCommand,link:this.handleLinkCommand,view:this.handleViewCommand})}},Yr={name:"SharpModal",mixins:[y],components:{LoadingOverlay:ne,Loading:I,BModal:$a},inheritAttrs:!1,props:{visible:Boolean,cancelTitle:String,title:String,okTitle:String,okOnly:Boolean,okVariant:{type:String,default:"primary"},static:Boolean,modalClass:String,noCloseOnBackdrop:{type:Boolean,default:!0},noEnforceFocus:{type:Boolean,default:!0},isError:Boolean,loading:Boolean},computed:{okClasses(){return{"btn-lg":this.okOnly,[`btn-${this.okVariant}`]:!!this.okVariant}}},methods:{show(){this.$refs.modal.show()},hide(){this.$refs.modal.hide()},handleVisiblityChanged(t){this.$emit("update:visible",t)}}};var Xr=function(){var e=this,s=e._self._c;return s("b-modal",e._g(e._b({ref:"modal",attrs:{title:e.title,visible:e.visible,"ok-only":e.okOnly,static:e.static,"modal-class":[e.modalClass,"SharpModal"],"title-class":{"text-danger":e.isError},"header-class":{"pb-0":!e.title},"no-enforce-focus":e.noEnforceFocus,"no-close-on-backdrop":e.noCloseOnBackdrop},on:{change:e.handleVisiblityChanged},scopedSlots:e._u([e.$slots.title?{key:"modal-title",fn:function(){return[e._t("title")]},proxy:!0}:null,{key:"modal-footer",fn:function({cancel:a,ok:n}){return[s("div",{staticClass:"w-100"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[e._t("footer-prepend")],2),s("div",{staticClass:"col-auto align-self-end"},[s("div",{staticClass:"row gx-2"},[e.okOnly?e._e():[s("div",{staticClass:"col-auto"},[s("button",{staticClass:"btn btn-outline-primary",on:{click:a}},[e._v(" "+e._s(e.cancelTitle||e.l("modals.cancel_button"))+" ")])])],s("div",{staticClass:"col-auto"},[s("button",{staticClass:"btn position-relative",class:e.okClasses,staticStyle:{"min-width":"70px"},attrs:{disabled:e.loading},on:{click:n}},[s("span",{class:{invisible:e.loading}},[e._v(" "+e._s(e.okTitle||e.l("modals.ok_button"))+" ")]),e.loading?[s("LoadingOverlay",{staticClass:"bg-transparent",attrs:{absolute:"",small:""}})]:e._e()],2)])],2)])])])]}}],null,!0)},"b-modal",e.$attrs,!1),e.$listeners),[e._t("default")],2)},Jr=[],Zr=r(Yr,Xr,Jr,!1,null,null,null,null);const F=Zr.exports,el={components:{Modal:F},props:{value:[Number,String],visible:Boolean,options:Array,title:String,okTitle:String,size:String},data(){return{modalVisible:this.visible,selected:this.value??null}},watch:{visible(t){this.modalVisible=t},value(t){this.selected=t}},methods:{itemClass(t){return{"active bg-white text-primary":this.isSelected(t)}},isSelected(t){return t.value===this.selected},handleOptionSelected(t){this.$emit("select",t),this.selected=t.value},handleButtonClicked(){this.modalVisible=!0,this.$emit("update:visible",!0)},handleVisibleChanged(t){this.modalVisible=t,this.$emit("update:visible",t)},handleModalOkClicked(){this.$emit("input",this.selected),this.$emit("change",this.selected)}}};var tl=function(){var e=this,s=e._self._c;return s("div",[e._t("default",null,{on:{click:e.handleButtonClicked}}),s("Modal",{attrs:{visible:e.modalVisible,title:e.title,"ok-title":e.okTitle,"ok-only":"",size:e.size},on:{ok:e.handleModalOkClicked,change:e.handleVisibleChanged}},[s("div",{staticClass:"list-group",attrs:{role:"menu"}},[e._l(e.options,function(a){return[s("div",{key:a.value,staticClass:"list-group-item list-group-item-action pe-2",class:e.itemClass(a),staticStyle:{cursor:"pointer","outline-offset":"4px"},attrs:{role:"menuitemradio",tabindex:"0","aria-checked":e.isSelected(a)},on:{click:function(n){return e.handleOptionSelected(a)},keydown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")&&e._k(n.keyCode,"space",32,n.key,[" ","Spacebar"])?null:e.handleOptionSelected(a)}}},[s("div",{staticClass:"py-1"},[s("div",{staticClass:"row align-items-center gx-3"},[e.$scopedSlots["item-prepend"]?[s("div",{staticClass:"col-auto"},[e._t("item-prepend",null,{option:a})],2)]:e._e(),s("div",{staticClass:"col"},[e._v(" "+e._s(a.label)+" ")]),s("div",{staticClass:"col-auto",class:{invisible:!e.isSelected(a)}},[s("div",{staticClass:"bg-primary text-inverted d-inline-flex rounded-circle justify-content-center align-items-center",staticStyle:{width:"1.5em",height:"1.5em"}},[s("i",{staticClass:"fas fa-check fa-sm"})])])],2)])])]})],2)])],2)},sl=[],al=r(el,tl,sl,!1,null,null,null,null);const Re=al.exports;async function cs(t){await new Promise(a=>setTimeout(a,10));const s=t.$el.querySelector(".multiselect__content").getBoundingClientRect();s.bottom>window.innerHeight&&window.scrollBy({top:s.bottom-window.innerHeight+20,behavior:"smooth"})}function nl(){const t=document.documentElement.style.getPropertyValue("--navbar-height");return parseInt(t)||0}const il={name:"SharpMultiselect",functional:!0,render(t,{data:e,children:s=[],props:a}){return a.placeholder||(e.attrs.placeholder=o("form.multiselect.placeholder")),e.class=["form-control",e.class],e.attrs.showPointer=!1,a.disabled&&(e.attrs.tabindex=-1),t({extends:_e,watch:{isOpen(n){n&&cs(this)}},computed:{isSingleLabelVisible(){return this.singleValue===0||_e.computed.isSingleLabelVisible.call(this)}},mounted(){this.$el.addEventListener("blur",()=>this.deactivate())}},e,[t("template",{slot:"maxElements"},o("form.multiselect.max_text")),...s])}},rl=null,ll=null;var ol=r(il,rl,ll,!1,null,null,null,null);const us=ol.exports,dl={props:{value:String,placeholder:String,disabled:Boolean},data(){return{search:null,focused:!1}},watch:{value:{immediate:!0,handler:"handleValueChanged"}},computed:{clearVisible(){var t;return((t=this.search)==null?void 0:t.length)>0}},methods:{handleValueChanged(t){this.search=t},handleClearButtonClicked(){this.search="",this.$emit("submit",""),this.$emit("clear"),this.$refs.input.focus()},handleFocused(){this.$emit("focus"),this.focused=!0},handleBlur(){this.$emit("blur"),this.focused=!1},handleFocusout(t){(!t.relatedTarget||!this.$el.contains(t.relatedTarget))&&(this.search=this.value)},handleSubmitted(){this.$emit("submit",this.search)}}};var cl=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpSearch",class:{"SharpSearch--focused":e.focused||e.search},attrs:{role:"search"}},[s("form",{staticClass:"h-100",on:{submit:function(a){return a.preventDefault(),e.handleSubmitted.apply(null,arguments)}}},[s("label",{staticClass:"SharpSearch__label visually-hidden",attrs:{id:"ab-search-label",for:"ab-search-input"}},[e._v(e._s(e.placeholder))]),s("div",{staticClass:"input-group input-group-sm flex-nowrap"},[s("div",{staticClass:"position-relative flex-fill",staticStyle:{"min-width":"0"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],ref:"input",staticClass:"SharpSearch__input form-control form-control-sm h-100 fs-8",attrs:{placeholder:e.placeholder,disabled:e.disabled,type:"text",id:"ab-search-input",role:"search","aria-labelledby":"ab-search-label"},domProps:{value:e.search},on:{focus:e.handleFocused,blur:e.handleBlur,focusout:e.handleFocusout,input:function(a){a.target.composing||(e.search=a.target.value)}}}),s("button",{staticClass:"btn btn-sm SharpSearch__clear h-100 d-inline-flex align-items-center position-absolute",class:{invisible:!e.clearVisible},attrs:{type:"button","aria-label":"Clear search"},on:{click:e.handleClearButtonClicked}},[s("svg",{attrs:{width:"1em",height:"1em",viewBox:"0 0 16 16","fill-rule":"evenodd"}},[s("path",{attrs:{d:"M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm3.5 10.1l-1.4 1.4L8 9.4l-2.1 2.1-1.4-1.4L6.6 8 4.5 5.9l1.4-1.4L8 6.6l2.1-2.1 1.4 1.4L9.4 8l2.1 2.1z"}})])])]),s("button",{staticClass:"btn btn-sm btn-outline-primary d-inline-flex SharpSearch__button",attrs:{tabindex:"0"}},[s("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor"}},[s("path",{attrs:{"fill-rule":"evenodd",d:"M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z","clip-rule":"evenodd"}})])])])])])},ul=[],hl=r(dl,cl,ul,!1,null,null,null,null);const hs=hl.exports,ml={props:{section:Object,collapsed:Boolean,collapsable:Boolean}};var pl=function(){var e=this,s=e._self._c;return s("div",[e.collapsable?[s("details",{attrs:{open:!e.collapsed},on:{toggle:function(a){return e.$emit("toggle",a.target.open)}}},[s("summary",{staticClass:"section__header section__header--collapsable"},[s("h2",{staticClass:"section__title d-inline-block mb-0"},[e._v(e._s(e.section.title||" "))])])])]:e.section.title?[s("div",{staticClass:"section__header"},[s("h2",{staticClass:"section__title"},[e._v(e._s(e.section.title))])])]:e._e()],2)},fl=[],_l=r(ml,pl,fl,!1,null,null,null,null);const ms=_l.exports,gl={name:"SharpStateIcon",props:{color:{required:!0,type:String}},computed:{style(){return{background:this.color}}}};var vl=function(){var e=this,s=e._self._c;return s("span",{staticClass:"StateIcon",style:e.style})},bl=[],yl=r(gl,vl,bl,!1,null,null,null,null);const De=yl.exports,Cl={name:"SharpTab",components:{BTab:wa},provide(){return{$tab:this}},props:{title:String,active:Boolean},data(){return{errors:{}}},computed:{hasError(){return Object.keys(this.errors).length>0},classes(){return{"is-invalid":this.hasError}}},methods:{setError(t){this.$set(this.errors,t,!0)},clearError(t){this.$delete(this.errors,t)},async handleActiveChanged(t){t&&(await this.$nextTick(),this.$emit("active"))}},created(){this.$on("error",t=>this.setError(t)),this.$on("clear",t=>this.clearError(t))}};var $l=function(){var e=this,s=e._self._c;return s("b-tab",{attrs:{"title-link-class":e.classes,active:e.active},on:{"update:active":e.handleActiveChanged},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.title)+" ")]},proxy:!0}])},[e._t("default")],2)},wl=[],Sl=r(Cl,$l,wl,!1,null,null,null,null);const kl=Sl.exports,xl={name:"SharpTabs",props:{navClass:String},components:{BTabs:Sa},computed:{dropdownButtonClasses(){return this.tabs[this.currentTab].hasError?"error-dot":this.tabsHaveError?"error-dot--partial":""}}};var Fl=function(){var e=this,s=e._self._c;return s("b-tabs",{staticClass:"SharpTabs",attrs:{"nav-class":["SharpTabs__nav align-items-center nav-tabs",e.navClass]},scopedSlots:e._u([{key:"tabs-end",fn:function(){return[s("li",{staticClass:"nav-item ms-auto"},[e._t("nav-append")],2)]},proxy:!0}],null,!0)},[e._t("default")],2)},Ll=[],Bl=r(xl,Fl,Ll,!1,null,null,null,null);const Ol=Bl.exports;function at(t){return t.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").replace(/[^\w ]+/g,"").replace(/ +/g,"-")}const El={name:"SharpTabbedLayout",props:{layout:Object},components:{Tabs:Ol,Tab:kl},computed:{showTabs(){return this.layout.tabbed&&this.layout.tabs.length>1}},methods:{isActive(t){return this.$route.query.tab===at(t.title)},handleTabActivated(t){this.$router.replace({query:{...this.$route.query,tab:at(t.title)}})}}};var Il=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpTabbedLayout"},[e.showTabs?[s("Tabs",{attrs:{"nav-class":"bg-white border-bottom p-3 pb-0"},scopedSlots:e._u([{key:"nav-append",fn:function(){return[e._t("nav-append")]},proxy:!0}],null,!0)},[e._l(e.layout.tabs,function(a,n){return[s("Tab",{key:`tab-${n}`,attrs:{title:a.title,active:e.isActive(a)},on:{active:function(i){return e.handleTabActivated(a)}}},[e._t("default",null,{tab:a})],2)]})],2)]:[e.$slots["nav-append"]?[s("div",{staticClass:"d-flex justify-content-end bg-white border-bottom p-3"},[e._t("nav-append")],2)]:e._e(),s("div",{staticClass:"tab-pane"},[e._l(e.layout.tabs,function(a){return[e._t("default",null,{tab:a}),s("hr",{staticClass:"SharpTabbedLayout__divider"})]})],2)]],2)},Tl=[],Al=r(El,Il,Tl,!1,null,null,null,null);const Rl=Al.exports,Dl={name:"SharpActionBar",props:{container:Boolean},data(){return{title:null,showTitle:!1}},computed:{hasExtras(){return this.$slots.extras||this.$slots["extras-right"]}},methods:{layout(t){},handleScroll(){var t;this.title=(t=document.querySelector("h1[data-top-bar-title]"))==null?void 0:t.innerText,this.showTitle=window.scrollY>150}},async mounted(){this.layout(this.$refs.bar.getBoundingClientRect()),window.ResizeObserver&&new ResizeObserver(t=>{this.layout(t[0].target.getBoundingClientRect())}).observe(this.$refs.bar),window.addEventListener("scroll",kt(this.handleScroll,100))}};var Pl=function(){var e=this,s=e._self._c;return s("div",{ref:"bar",staticClass:"SharpTopBar d-flex flex-column sticky-top"},[s("div",{staticClass:"container flex-fill d-flex flex-column"},[s("div",{staticClass:"row align-items-center flex-fill g-2 gx-md-4"},[s("div",{staticClass:"col",staticStyle:{"min-width":"0"}},[e.title?[s("div",{staticClass:"SharpTopBar__title d-none d-md-block"},[s("div",{staticClass:"h5 mb-0 text-truncate",class:{"opacity-0":!e.showTitle},staticStyle:{transition:"opacity .2s ease-in-out"}},[e._v(" "+e._s(e.title)+" ")])])]:e._e()],2),s("div",{staticClass:"col-auto"},[e._t("right")],2)])])])},zl=[],Ml=r(Dl,Pl,zl,!1,null,null,null,null);const jl=Ml.exports,Nl={components:{BTooltip:ka},props:{target:Function,triggers:String,placement:String,overflowOnly:Boolean,disabled:Boolean},data(){return{isOverflowing:!1}},computed:{isEnabled(){return this.disabled?!1:this.overflowOnly?this.isOverflowing:!0}},methods:{layout(t){this.isOverflowing=t.scrollWidth>t.offsetWidth},getTarget(){return this.target()}},async mounted(){await this.$nextTick();const t=this.getTarget();this.layout(t),"ResizeObserver"in window&&(this.observer=new ResizeObserver(()=>this.layout(t)),this.observer.observe(t))},beforeDestroy(){var t;(t=this.observer)==null||t.disconnect()}};var Vl=function(){var e=this,s=e._self._c;return s("b-tooltip",{attrs:{target:e.target,triggers:e.triggers,placement:e.placement,disabled:!e.isEnabled}},[e._t("default")],2)},Ul=[],Hl=r(Nl,Vl,Ul,!1,null,null,null,null);const ql=Hl.exports;function Kl(t,{store:e,router:s}){t.component("sharp-dropdown",$),t.component("sharp-dropdown-item",x)}function Gl({results:t,dataWrapper:e,fieldKey:s,url:a}){if(t){if(e&&!t.hasOwnProperty(e))return b(`Autocomplete (${s}): dataWrapper "${e}" seems to be invalid :`),b(`- search url "${a}"`),b("- results",t),!1;if(!e&&!Array.isArray(t))return b(`Autocomplete (${s}): search results response is not an array, please use setDataWrapper() if results are wrapped inside an object (https://sharp.code16.fr/docs/guide/form-fields/autocomplete.html#setdatawrapper)`),b(`- search url "${a}"`),b("- response",t),!1}return!0}function Wl({url:t,method:e,locale:s,searchAttribute:a,query:n,dataWrapper:i,fieldKey:l,cancelToken:d}){const u=e.toLowerCase()==="get",c={locale:s,[a]:n};return X({url:t,method:e,params:u?c:void 0,data:u?void 0:c,cancelToken:d}).then(p=>{var g;return Gl({results:p.data,dataWrapper:i,fieldKey:l,url:t})?i?((g=p.data)==null?void 0:g[i])??[]:p.data??[]:[]})}const Pe={inject:{$form:{default:()=>({})}},props:{locale:String,localized:Boolean},computed:{locales(){return this.$form.locales},isLocalized(){return this.$form.localized&&this.localized}}},Ql=["text","textarea"];function Yl(t,e){return!t||typeof t!="object"?!1:e.every(s=>s in t)}function Xl(t){return t===null||t===""}function Jl(t){return Object.entries(t).every(([e,s])=>Xl(s))}function ze(t){return Ql.includes(t.type)}function Zl({locales:t,resolve:e=()=>null}){return t.reduce((s,a)=>({...s,[a]:e(a)}),{})}function ps({localeObject:t,locale:e,value:s}){let a={...t,[e]:s};return Jl(a)?null:a}function eo({field:t,value:e}){return t.type==="editor"?(e||{}).text:e}const to={mixins:[Pe],computed:{localizedSearchKeys(){return this.localized?this.searchKeys.map(t=>{let e=t;return this.localizedDataKeys.includes(t)&&(e+=`.${this.locale}`),e}):this.searchKeys},localizedDataKeys(){return Array.isArray(this.localValues)&&this.localValues.length?Object.keys(this.localValues[0]).filter(t=>this.isLocaleObject(this.localValues[0][t])):[]}},methods:{isLocaleObject(t){return this.locales&&Yl(t,this.locales)},localizedTemplateData(t){return this.localized?Object.entries(t).reduce((e,[s,a])=>(e[s]=this.isLocaleObject(a)?a[this.locale]:a,e),{}):t}}},fs=/{{([\s\S]+?)}}/g;function so({contextSources:t,contextData:e}){return t.filter(s=>{const a=e[s];return a==null||a===""})}function _s(t,e){return(t||[]).find(s=>s.name===e)}function ao({map:t,path:e,contextData:s}){const a=e.map(n=>s[n]);return xa(t,a)}function no(t){return[...t.matchAll(fs)].map(e=>e[1].trim())}function io({template:t,sources:e,contextData:s}){const a=Fa(t,{interpolate:fs,evaluate:!1,escape:!1}),n=(e||[]).reduce((i,l)=>({...i,[l]:null}),{});return a({...n,...s})}function gs({dynamicOptions:t={},attributeValue:e}){return t.type==="map"?t.path:t.type==="template"?no(e):[]}function ro({dynamicOptions:t,attributeValue:e,contextData:s,contextSources:a}){return t.type==="map"?ao({map:e,path:t.path,contextData:s}):t.type==="template"?io({template:e,sources:a,contextData:s}):e}function lo(t,e,{dynamicAttributes:s,contextData:a}){const n=_s(s,t),i=gs({dynamicOptions:n,attributeValue:e});return n?so({contextSources:i,contextData:a}).length>0?{isEmpty:n.default==null,value:n.default}:{value:ro({dynamicOptions:n,attributeValue:e,contextData:a,contextSources:i})}:{value:e}}function oo(t,e,s){return(e||[]).some(a=>{const n=s[a.name];return gs({dynamicOptions:a,attributeValue:n}).includes(t)})}function co(t,e,s){const a=Object.entries(t||{}).reduce((n,[i,l])=>{const d=lo(i,l,{dynamicAttributes:e,contextData:s}),u=n.resolvedEmptyAttributes||[];return d.isEmpty&&u.push(i),{...n,resolvedEmptyAttributes:u,attributes:{...n.attributes,[i]:d.value}}},{});return{attributes:a.attributes,resolvedEmptyAttributes:a.resolvedEmptyAttributes}}function vs(t,e,s){return Object.values(t).filter(a=>oo(e,a.dynamicAttributes,a)).reduce((a,n)=>({...a,[n.key]:s?s(n,null):null}),{})}function bs(t,e,{dependantAttributes:s}={}){const a=t.$attrs.dynamicAttributes;(s||[]).some(i=>_s(a,i))?t.$nextTick(e):e()}function uo(t){return t==="editor"?{}:null}function ho(t,e){return t==="autocomplete"?e&&e.id:e}function mo(t,e){return Object.entries(t).reduce((s,[a,n])=>{const i=e[a];return{...s,[a]:i?ho(i.type,n):null}},{})}function ys(t,e){const s=mo(e,t);return Object.entries(t).reduce((a,[n,i])=>{const{attributes:l,resolvedEmptyAttributes:d}=co(i,i.dynamicAttributes,s),u=l.readOnly||d.length>0;return{...a,[n]:{...l,readOnly:u}}},{})}const po={name:"SharpAutocomplete",components:{Multiselect:_e,TemplateRenderer:z,Loading:I,ClearButton:se},mixins:[y,to],props:{id:String,fieldKey:String,value:[String,Number,Object,Array],mode:String,localValues:{type:Array,default:()=>[]},placeholder:{type:String,default:()=>o("form.multiselect.placeholder")},remoteEndpoint:String,remoteMethod:String,remoteSearchAttribute:{type:String,default:"query"},itemIdAttribute:{type:String,default:"id"},searchMinChars:{type:Number,default:1},searchKeys:{type:Array,default:()=>["value"]},dataWrapper:String,readOnly:Boolean,listItemTemplate:String,resultItemTemplate:String,templateData:Object,noResultItem:Boolean,multiple:Boolean,hideSelected:Boolean,searchable:{type:Boolean,default:!0},allowEmpty:{type:Boolean,default:!0},clearOnSelect:Boolean,preserveSearch:{type:Boolean,default:!0},showPointer:{type:Boolean,default:!0},dynamicAttributes:Array,debounceDelay:{type:Number,default:400},nowrap:Boolean},data(){return{ready:!1,query:"",suggestions:this.localValues,opened:!1,isLoading:!1}},watch:{localValues(){this.isRemote||this.updateLocalSuggestions(this.query)}},computed:{isRemote(){return this.mode==="remote"},hideDropdown(){return this.isQueryTooShort},isQueryTooShort(){return this.isRemote&&this.query.length<this.searchMinChars},clearButtonVisible(){return!!this.value&&!this.opened},classes(){return{"SharpAutocomplete--remote":this.isRemote,"SharpAutocomplete--disabled":this.readOnly,"SharpAutocomplete--wrap":!this.nowrap}},overlayVisible(){const t=!!this.fieldKey;return this.value&&t}},methods:{updateSuggestions(t){this.query=t,!this.isQueryTooShort&&(this.isRemote?(this.isLoading=!0,this.updateRemoteSuggestions(t)):this.updateLocalSuggestions(t))},updateLocalSuggestions(t){this.suggestions=t.length>=this.searchMinChars?Ir(this.localValues,t,{searchKeys:this.searchKeys}):this.localValues},updateRemoteSuggestions(t){var e;return(e=this.cancelSource)==null||e.cancel(),this.cancelSource=La.CancelToken.source(),Wl({url:this.remoteEndpoint,method:this.remoteMethod,locale:this.locale,searchAttribute:this.remoteSearchAttribute,dataWrapper:this.dataWrapper,fieldKey:this.fieldKey,query:t,cancelToken:this.cancelSource.token}).then(s=>{this.suggestions=s,this.scroll()}).finally(()=>{this.isLoading=!1})},scroll(){cs(this)},handleSelect(t){this.$emit("input",t)},handleDropdownClose(){this.opened=!1,this.$emit("close")},handleDropdownOpen(){this.opened=!0,this.$emit("open"),this.scroll()},handleClearButtonClicked(){this.$emit("input",null),this.$nextTick(()=>{this.$refs.multiselect.activate()})},resolveTemplateData(t){return{...this.templateData,...this.localizedTemplateData(t)}},itemMatchValue(t){return t[this.itemIdAttribute]==this.value[this.itemIdAttribute]},findLocalValue(){return!this.value||this.value[this.itemIdAttribute]==null?null:this.localValues.some(this.itemMatchValue)?this.localValues.find(this.itemMatchValue):(b(`Autocomplete (key: ${this.fieldKey}) can't find local value matching : ${JSON.stringify(this.value)}`),null)},async setDefault(){this.$emit("input",this.findLocalValue(),{force:!0}),await this.$nextTick(),this.ready=!0}},created(){this.updateRemoteSuggestions=E(this.updateRemoteSuggestions,this.debounceDelay),this.mode==="local"&&!this.searchKeys&&zr(`Autocomplete (key: ${this.fieldKey}) has local mode but no searchKeys, default set to ['value']`),this.isRemote?this.ready=!0:bs(this,this.setDefault,{dependantAttributes:["localValues"]})}};var fo=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpAutocomplete",class:e.classes},[e.ready?[e.overlayVisible?[s("div",{staticClass:"form-control clearable SharpAutocomplete__result"},[s("TemplateRenderer",{attrs:{name:"ResultItem",template:e.resultItemTemplate,"template-data":e.resolveTemplateData(e.value),"template-props":e.searchKeys}}),s("ClearButton",{on:{click:e.handleClearButtonClicked}})],1)]:[s("Multiselect",{ref:"multiselect",staticClass:"SharpAutocomplete__multiselect form-control",class:{"form-select":!this.isRemote,"SharpAutocomplete__multiselect--hide-dropdown":e.hideDropdown},attrs:{id:e.id,value:e.value,options:e.suggestions,"track-by":e.itemIdAttribute,"internal-search":!1,placeholder:e.placeholder,loading:e.isLoading,multiple:e.multiple,disabled:e.readOnly,"hide-selected":e.hideSelected,"allow-empty":e.allowEmpty,"preserve-search":e.preserveSearch,"show-pointer":e.showPointer,searchable:e.searchable,readonly:e.readOnly,tabindex:e.readOnly?-1:0},on:{"search-change":function(a){return e.updateSuggestions(a)},select:e.handleSelect,input:function(a){return e.$emit("multiselect-input",a)},close:e.handleDropdownClose,open:e.handleDropdownOpen},scopedSlots:e._u([{key:"clear",fn:function(){return[e.clearButtonVisible?[s("ClearButton",{on:{click:e.handleClearButtonClicked}})]:e._e()]},proxy:!0},{key:"singleLabel",fn:function({option:a}){return[s("TemplateRenderer",{attrs:{name:"ResultItem",template:e.resultItemTemplate,"template-data":e.resolveTemplateData(a),"template-props":e.searchKeys}})]}},{key:"option",fn:function({option:a}){return[s("TemplateRenderer",{attrs:{name:"ListItem",template:e.listItemTemplate,"template-data":e.resolveTemplateData(a),"template-props":e.searchKeys}})]}},{key:"loading",fn:function(){return[s("Loading",{attrs:{visible:e.isLoading,small:""}})]},proxy:!0},{key:"noResult",fn:function(){return[e._v(" "+e._s(e.l("form.autocomplete.no_results_text"))+" ")]},proxy:!0}],null,!1,1447355180)})]]:e._e()],2)},_o=[],go=r(po,fo,_o,!1,null,null,null,null);const Cs=go.exports;function $s(t,{maxlength:e}){return e&&(t==null?void 0:t.length)>e?o("form.text.validation.maxlength").replace(":maxlength",e):null}function ie(t){return t.normalize()}const vo={name:"SharpTextarea",props:{value:String,placeholder:String,readOnly:Boolean,maxLength:Number,rows:Number},methods:{validate(t){return $s(t,{maxlength:this.maxLength})},handleInput(t){const e=ie(t.target.value),s=this.validate(e);this.$emit("input",e,{error:s})}}};var bo=function(){var e=this,s=e._self._c;return s("textarea",{staticClass:"SharpTextarea form-control",attrs:{rows:e.rows,placeholder:e.placeholder,disabled:e.readOnly},domProps:{value:e.value},on:{input:e.handleInput}})},yo=[],Co=r(vo,bo,yo,!1,null,null,null,null);const $o=Co.exports,wo={name:"SharpText",props:{value:[String,Number],type:String,placeholder:String,readOnly:Boolean,maxLength:Number,inputType:{type:String,default:"text"}},methods:{validate(t){return $s(t,{maxlength:this.maxLength})},handleInput(t){const e=ie(t.target.value),s=this.validate(e);this.$emit("input",e,{error:s})},focus(){this.$refs.input.focus()}}};var So=function(){var e=this,s=e._self._c;return s("input",{ref:"input",staticClass:"SharpText form-control",attrs:{type:e.inputType,placeholder:e.placeholder,disabled:e.readOnly},domProps:{value:e.value},on:{input:e.handleInput}})},ko=[],xo=r(wo,So,ko,!1,null,null,null,null);const re=xo.exports,Fo={components:{TextField:re},props:{value:[String,Number],showControls:Boolean,min:Number,max:Number,step:Number}};var Lo=function(){var e=this,s=e._self._c;return s("TextField",e._g(e._b({class:{"hide-controls":!e.showControls},attrs:{value:e.value,step:e.step,min:e.min,max:e.max,"input-type":"number"}},"TextField",e.$attrs,!1),e.$listeners))},Bo=[],Oo=r(Fo,Lo,Bo,!1,null,null,null,null);const Eo=Oo.exports;function Me({entityKey:t,instanceId:e,files:s,thumbnailWidth:a,thumbnailHeight:n}){return v.post(`/files/${t}/${e??""}`,{files:s,thumbnail_width:a,thumbnail_height:n}).then(i=>i.data.files)}function ws({entityKey:t,instanceId:e,disk:s,path:a}){return Br(`/download/${t}/${e??""}`,{params:{disk:s,path:a}})}function P(t,e){return typeof t!="number"?null:Math.round((t+Number.EPSILON)*10**e)/10**e}function j(t,e){return P(t,e)}function Io(t){let{x:e,y:s,width:a,height:n}=t??{};return e=P(e,4)??0,s=P(s,4)??0,a=P(a,4)??1,n=P(n,4)??1,e===0&&s===0&&a===1&&n===1?null:`${e},${s},${a},${n}`}function Ss(t){if(!t)return null;const[e,s,a,n]=t.split(",");return{x:Number(e),y:Number(s),width:Number(a),height:Number(n)}}function To(t){return P(t==null?void 0:t.angle,4)||null}function ks(t){return t?{angle:Number(t)}:null}const xs=200,Fs=200;function W(t,e){return!t.path||!e.path?t.name===e.name:`${t.disk}:${t.path}`==`${e.disk}:${e.path}`}function Ao({filters:t,imageWidth:e,imageHeight:s}){var p;const a=((p=t==null?void 0:t.rotate)==null?void 0:p.angle)??0;let n=e,i=s;Math.abs(a)%180&&(n=s,i=e);const{width:l,height:d,x:u,y:c}=(t==null?void 0:t.crop)??{};return{width:(l??1)*n,height:(d??1)*i,x:(u??0)*n,y:(c??0)*i,rotate:a*-1}}function Ro({cropData:t,imageWidth:e,imageHeight:s}){let a=e,n=s;return Math.abs(t.rotate)%180&&(a=s,n=e),{crop:{width:j(t.width/a,4),height:j(t.height/n,4),x:j(t.x/a,4),y:j(t.y/n,4)},rotate:{angle:j(t.rotate*-1,4)}}}function Do(t){if(!t.type.match(/^image\//))return Promise.resolve(null);const e=new Image;return e.src=URL.createObjectURL(t),new Promise((s,a)=>{e.onload=()=>s(e.src),e.onerror=n=>{URL.revokeObjectURL(e.src),a(`Image format not handled by browser for "${t.name}"`)}})}function Po(t,e){const s=t.getData();Ls(t,s.rotate+e)}function Ls(t,e){const s=t.getCropBoxData(),a=t.getContainerData();s.width=2,s.height=2,s.top=0;let n=a.width/2-1;s.left=n,t.setCropBoxData(s),t.rotateTo(e);let i=t.getCanvasData(),l=i.height,d=a.height,u=d/l,c=Math.min(i.width*u,a.width);i.height=d,i.width=c,i.top=0,i.left=(a.width-i.width)/2,t.setCanvasData(i),s.left=0,s.top=0,s.width=i.width,s.height=i.height,t.setCropBoxData(s)}const zo={components:{Modal:F,Loading:I,VueCropper:Lt,Button:_},inject:{$form:{default:null}},props:{value:Object,visible:Boolean,src:String,ratioX:Number,ratioY:Number},data(){return{ready:!1,cropData:null,originalImg:null}},watch:{value:"handleValueChanged"},computed:{imageSrc(){return this.originalImg||this.src},cropperOptions(){return{viewMode:2,dragMode:"move",aspectRatio:this.ratioX/this.ratioY,autoCropArea:1,guides:!1,background:!0,rotatable:!0,restore:!1,data:this.cropData,ready:this.handleCropperReady}}},methods:{l:o,handleRotateClicked(t){Po(this.$refs.cropper.cropper,t)},handleValueChanged(){this.value||(this.cropData=null,this.originalImg=null)},handleOkClicked(){const t=this.$refs.cropper,e=t.getData(!0);this.cropData=e,this.$emit("submit",t)},handleShow(){this.init()},async initOriginalThumbnail(){var e;if(this.originalImg)return;const t=await Me({entityKey:this.$form.entityKey,instanceId:this.$form.instanceId,files:[{path:this.value.path,disk:this.value.disk}],thumbnailWidth:1200,thumbnailHeight:1e3});if(this.originalImg=(e=t[0])==null?void 0:e.thumbnail,!this.originalImg)return Promise.reject("Sharp Upload: original thumbnail not found in POST /api/files request");await new Promise(s=>{const a=new Image;a.src=this.originalImg,a.onload=()=>{this.cropData=Ao({filters:this.value.filters,imageWidth:a.naturalWidth,imageHeight:a.naturalHeight}),s()},a.onerror=()=>{this.originalImg=null,s()}})},async init(){var t;this.ready=!1,(t=this.value)!=null&&t.path&&await this.initOriginalThumbnail(),this.ready=!0},handleCropperReady(){var e;const t=this.$refs.cropper.cropper;(e=this.cropData)!=null&&e.rotate&&(Ls(t,this.cropData.rotate),t.setData(this.cropData))}}};var Mo=function(){var e=this,s=e._self._c;return s("Modal",e._g({ref:"modal",attrs:{visible:e.visible,title:e.l("modals.cropper.title"),"no-close-on-backdrop":"","dialog-class":"modal-dialog-scrollable","content-class":"h-100",size:"xl"},on:{ok:e.handleOkClicked,show:e.handleShow},scopedSlots:e._u([{key:"footer-prepend",fn:function(){return[s("div",{staticClass:"row align-items-center"},[s("div",{staticClass:"col-auto"},[s("Button",{attrs:{text:""},on:{click:function(a){return e.handleRotateClicked(-90)}}},[s("i",{staticClass:"fas fa-undo"})]),s("Button",{staticClass:"me-auto",attrs:{text:""},on:{click:function(a){return e.handleRotateClicked(90)}}},[s("i",{staticClass:"fas fa-redo"})])],1),s("div",{staticClass:"col d-none d-lg-block"},[s("div",{staticClass:"text-muted fs-7 lh-sm"},[e._v(" "+e._s(e.l("form.upload.edit_modal.description"))+" ")])])])]},proxy:!0}])},e.$listeners),[e.ready?[s("vue-cropper",e._b({ref:"cropper",staticClass:"SharpUpload__modal-vue-cropper h-100",attrs:{src:e.imageSrc,alt:"Source image"}},"vue-cropper",e.cropperOptions,!1))]:[s("div",{staticClass:"d-flex align-items-center justify-content-center",staticStyle:{height:"300px"}},[s("Loading")],1)]],2)},jo=[],No=r(zo,Mo,jo,!1,null,null,null,null);const Vo=No.exports,Uo={name:"SharpVueClip",extends:Ba,components:{EditModal:Vo,VueCropper:Lt,Button:_},inject:{$form:{default:null}},mixins:[y],props:{ratioX:Number,ratioY:Number,value:Object,transformable:{type:Boolean,default:!0},transformableFileTypes:Array,transformKeepOriginal:Boolean,readOnly:Boolean,root:Boolean,compactThumbnail:Boolean,focused:Boolean,invalid:Boolean,uniqueIdentifier:String,fieldConfigIdentifier:String,persistThumbnails:Boolean},data(){return{showEditModal:!1,transformedImg:null}},watch:{value:"init","file.status"(t){t in this.statusFunction&&this[this.statusFunction[t]]()}},computed:{classes(){return{"SharpUpload--empty":!this.file,"SharpUpload--disabled":this.readOnly,"SharpUpload--compacted":this.compactThumbnail,"SharpUpload--focused":this.focused}},file(){return this.files[0]},originalImageSrc(){var t,e;return((t=this.file)==null?void 0:t.thumbnail)||((e=this.file)==null?void 0:e.blobUrl)},imageSrc(){return this.transformedImg||this.originalImageSrc},size(){return this.file.size!=null?Te(this.file.size):null},operationFinished(){return{transform:this.hasInitialTransform?!!this.transformedImg:null}},operations(){return Object.keys(this.operationFinished)},activeOperationsCount(){return this.operations.filter(t=>this.operationFinished[t]!==null).length},operationFinishedCount(){return this.operations.filter(t=>this.operationFinished[t]).length},progress(){let t=this.file?this.file.progress:100,s=1-(this.activeOperationsCount-this.operationFinishedCount)*.05;return Math.floor(t)*s},inProgress(){var t;return((t=this.file)==null?void 0:t.status)==="exist"||this.hasError?!1:this.progress<100},statusFunction(){return{error:"onStatusError",success:"onStatusSuccess",added:"onStatusAdded"}},hasError(){var t;return((t=this.file)==null?void 0:t.status)==="error"||this.invalid},fileName(){let t=this.file.name.split("/");return t.length?t[t.length-1]:""},fileExtension(){let t=this.fileName.split(".").pop();return t?`.${t}`:null},downloadUrl(){var t,e;return ws({entityKey:(t=this.$form)==null?void 0:t.entityKey,instanceId:(e=this.$form)==null?void 0:e.instanceId,disk:this.value.disk,path:this.value.path})},showThumbnail(){return!!this.imageSrc},isTransformable(){var t;return!this.transformable||!this.originalImageSrc||(t=this.file)!=null&&t.type&&!this.file.type.match(/^image\//)?!1:!this.transformableFileTypes||this.transformableFileTypes.includes(this.fileExtension)},hasInitialTransform(){var t;return((t=this.file)==null?void 0:t.status)==="exist"&&!this.value.uploaded?!1:this.isTransformable&&!!this.ratioX&&!!this.ratioY},hasEdit(){return this.isTransformable&&!this.inProgress},hasDownload(){var t;return((t=this.file)==null?void 0:t.status)==="exist"&&!!this.value.path}},methods:{setPending(t){var e;(e=this.$form)==null||e.setUploading(this.uniqueIdentifier,t)},onStatusAdded(){const t=this.file._file;this.$emit("add",t),this.setPending(!0),Do(t).then(e=>{e&&(this.$set(this.file,"blobUrl",e),this.$emit("thumbnail",e))}).catch(e=>{console.error(e)})},async onStatusError(){const t=this.file.xhrResponse,e=this.file.errorMessage;this.setPending(!1),await this.$nextTick(),t!=null&&t.statusCode?this.handleUploadError(t):this.$emit("error",e,this.file._file)},handleUploadError(t){const e=JSON.parse(t.responseText),s=t.statusCode;if(s===422){const a=Object.values(e.errors??{}).join(", ");this.$emit("error",a)}else{const a=Xt({data:e,status:s});Jt({data:e,status:s}),this.$emit("error",a)}},onStatusSuccess(){let t={};try{t=JSON.parse(this.file.xhrResponse.responseText)}catch(s){console.log(s)}const e={...this.value,...t,uploaded:!0};this.$emit("success",{...e,size:this.file.size}),this.$emit("input",e),this.setPending(!1)},remove(t=!0){this.removeFile(this.file),this.files.splice(0,1),this.setPending(!1),this.resetThumbnails(),this.transformedImg=null,t&&(this.$emit("input",null),this.$emit("reset"))},handleEditButtonClick(){this.showEditModal=!0},handleRemoveClicked(){this.remove(),this.$emit("removed")},handleClick(){this.uploader._uploader.hiddenFileInput.click()},handleDrop(t){var e,s;this.file&&((s=(e=t.dataTransfer)==null?void 0:e.files)==null?void 0:s.length)>0&&this.remove(!1)},handleEditSubmitted(t){this.updateTransformedImage(t),this.updateFilters(t)},onCropperReady(){this.hasInitialTransform&&(this.updateTransformedImage(this.$refs.cropper),this.updateFilters(this.$refs.cropper))},updateFilters(t){var n;const e=t.getData(!0),s=t.getImageData(),a={...this.value,transformed:!0,filters:{...(n=this.value)==null?void 0:n.filters,...Ro({cropData:e,imageWidth:s.naturalWidth,imageHeight:s.naturalHeight})}};this.$emit("input",a),this.$emit("updated",a)},updateTransformedImage(t){this.resetTransformedImage(),t.getCroppedCanvas({width:300,height:300}).toBlob(e=>{this.transformedImg=URL.createObjectURL(e)})},resetTransformedImage(){this.transformedImg&&URL.revokeObjectURL(this.transformedImg)},resetThumbnails(){var t;(t=this.file)!=null&&t.blobUrl&&!this.persistThumbnails&&URL.revokeObjectURL(this.file.blobUrl),this.resetTransformedImage()},validateValue(){return this.value.name?!0:b(`Upload field '${this.downloadId}' has an invalid value: expects to have a "name", given :`,JSON.parse(JSON.stringify(this.value)))},init(){this.value?(this.file?Object.assign(this.file,this.value):this.addedFile({...this.value,upload:{}}),this.$set(this.file,"thumbnail",this.value.thumbnail??null)):this.files=[]}},created(){this.options.thumbnailWidth=null,this.options.thumbnailHeight=null,this.options.maxFiles=1,!(!this.value||this.value.file)&&this.validateValue()&&(this.init(),this.file.status="exist")},mounted(){var e;const t=this.uploader._uploader;t.disable(),t.listeners=t.listeners.filter(s=>!s.events.click),t.enable(),t.on("drop",this.handleDrop),t.on("thumbnail",this.onThumbnail),(e=this.value)!=null&&e.file&&(t.addFile(this.value.file),this.$emit("input",{}))},beforeDestroy(){this.resetThumbnails(),this.setPending(!1),this.uploader._uploader.destroy()}};var Ho=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpUpload",class:e.classes},[s("div",[e.file?[s("div",{staticClass:"card card-body SharpUpload__card",class:{"border-danger":e.hasError}},[s("div",{class:{row:e.showThumbnail}},[e.showThumbnail?[s("div",{staticClass:"SharpUpload__thumbnail",class:[e.compactThumbnail?"col-4 col-sm-3 col-xl-2":"col-4 col-md-4"]},[s("img",{attrs:{src:e.imageSrc,alt:""}})])]:e._e(),s("div",{staticClass:"SharpUpload__infos",class:{[e.compactThumbnail?"col-8 col-sm-9 col-xl-10":"col-8 col-md-8"]:e.showThumbnail}},[s("div",{staticClass:"mb-3"},[s("label",{staticClass:"SharpUpload__filename text-truncate d-block"},[e._v(e._s(e.fileName))]),s("div",{staticClass:"SharpUpload__info mt-2"},[s("div",{staticClass:"row g-2"},[e.size?[s("div",{staticClass:"col-auto"},[e._v(e._s(e.size))])]:e._e(),e.hasDownload?[s("div",{staticClass:"col-auto"},[s("a",{staticClass:"SharpUpload__download-link",attrs:{href:e.downloadUrl,download:e.fileName}},[s("i",{staticClass:"fas fa-download"}),e._v(" "+e._s(e.l("form.upload.download_link"))+" ")])])]:e._e()],2)]),s("transition",{attrs:{name:"SharpUpload__progress"}},[e.inProgress?[s("div",{staticClass:"SharpUpload__progress mt-2"},[s("div",{staticClass:"SharpUpload__progress-bar",style:{width:`${e.progress}%`},attrs:{role:"progressbar","aria-valuenow":e.progress,"aria-valuemin":"0","aria-valuemax":"100"}})])]:e._e()],2)],1),e.readOnly?e._e():[s("div",[e.hasEdit&&!e.hasError?[s("Button",{staticClass:"me-2",attrs:{outline:"",small:""},on:{click:e.handleEditButtonClick}},[e._v(" "+e._s(e.l("form.upload.edit_button"))+" ")])]:e._e(),s("Button",{staticClass:"SharpUpload__remove-button",attrs:{variant:"danger",outline:"",small:""},on:{click:e.handleRemoveClicked}},[e._v(" "+e._s(e.l("form.upload.remove_button"))+" ")])],2)]],2)],2)])]:[s("Button",{staticClass:"SharpUpload__browse dz-message",attrs:{text:"",block:"",disabled:e.readOnly,type:"button"},on:{click:e.handleClick}},[e._v(" "+e._s(e.l("form.upload.browse_button"))+" ")])],s("div",{ref:"clip-preview-template",staticClass:"clip-preview-template",staticStyle:{display:"none"}},[s("div")])],2),s("EditModal",{ref:"modal",attrs:{value:e.value,visible:e.showEditModal,src:e.originalImageSrc,"ratio-x":e.ratioX,"ratio-y":e.ratioY},on:{"update:visible":function(a){e.showEditModal=a},submit:e.handleEditSubmitted}}),e.hasInitialTransform?[s("vue-cropper",{ref:"cropper",staticClass:"d-none",attrs:{src:e.originalImageSrc,"aspect-ratio":e.ratioX/e.ratioY,"auto-crop-area":1,ready:e.onCropperReady}})]:e._e(),s("a",{ref:"dlLink",staticStyle:{display:"none"}})],2)},qo=[],Ko=r(Uo,Ho,qo,!1,null,null,null,null);const ve=Ko.exports;function Go(t){const e=t*1024*1024;return o("form.upload.message.file_too_big").replace(":size",Te(e))}function Bs({fileFilter:t,maxFileSize:e}){return{url:yr,uploadMultiple:!1,headers:{"X-XSRF-TOKEN":Or()},...t?{acceptedFiles:{extensions:t,message:o("form.upload.message.bad_extension")}}:null,...e?{maxFilesize:{limit:e,message:Go(e)}}:null,createImageThumbnails:!1}}const Wo={name:"SharpUpload",components:{VueClip:ve},props:{...ve.props,value:Object,fileFilter:Array,maxFileSize:Number,root:Boolean},computed:{options(){return Bs({fileFilter:this.fileFilter,maxFileSize:this.maxFileSize})}}};var Qo=function(){var e=this,s=e._self._c;return s("VueClip",e._b({attrs:{value:e.value,options:e.options,root:e.root},on:{input:function(a){return e.$emit("input",a)},error:function(a){return e.$emit("error",a)},add:function(a){return e.$emit("clear")}}},"VueClip",e.$props,!1))},Yo=[],Xo=r(Wo,Qo,Yo,!1,null,null,null,null);const Jo=Xo.exports,Os={mixins:[Pe],methods:{localizeLabel(t){return this.isLocalized?t[this.locale]:t},localizedOptionLabel(t){return this.localizeLabel(t.label)}}},Zo={extends:Os,methods:{localizeLabel(t){return this.isLocalized?t[this.locale]||o("form.tags.unknown_label"):t},localizedTagLabel(t){return this.isLocalized?Zl({locales:this.locales,resolve:e=>e===this.locale?t:null}):t},localizedCustomLabel(t){return this.localizeLabel(t.label)}}};class Es{constructor(e){this.id=e.id,this.label=e.label}set internalId(e){this._internalId=e}get internalId(){return this._internalId}}class ed extends Es{}class me extends Es{}const td={name:"SharpTags",mixins:[Zo],components:{Multiselect:us},props:{id:String,value:Array,options:Array,placeholder:String,maxTagCount:Number,createText:String,creatable:{type:Boolean,default:!0},readOnly:Boolean},data(){return{tags:[],lastIndex:0}},computed:{indexedOptions(){return this.options.map(this.patchOption)},dynamicPlaceholder(){return this.tags.length<(this.maxTagCount||1/0)?this.placeholder:""},ids(){return this.tags.map(t=>t.internalId)}},watch:{tags:"onTagsChanged"},methods:{patchOption(t,e){let s=new ed(t);return s.internalId=e,s},patchTag(t){let e=this.indexedOptions.find(a=>a.id===t.id),s=new me(e);return s.internalId=e.internalId,s},handleNewTag(t){let e=new me({id:null,label:this.localizedTagLabel(t)});e.internalId=this.lastIndex++,this.tags.push(e)},handleInput(t){this.tags=t},handleTextInput(t){t.length>0&&this.$refs.multiselect.filteredOptions.length>1?this.$refs.multiselect.pointer=1:this.$refs.multiselect.pointer=0},onTagsChanged(){this.$emit("input",this.tags.map(t=>new me(t)))}},created(){this.lastIndex+=this.options.length,this.tags=(this.value||[]).map(this.patchTag)}};var sd=function(){var e=this,s=e._self._c;return s("Multiselect",{ref:"multiselect",staticClass:"SharpTags form-select",attrs:{id:e.id,value:e.tags,options:e.indexedOptions,placeholder:e.dynamicPlaceholder,"tag-placeholder":e.createText,max:e.maxTagCount,taggable:e.creatable,"close-on-select":!1,disabled:e.readOnly,"track-by":"_internalId",label:"label","custom-label":e.localizedCustomLabel,multiple:"",searchable:"","hide-selected":"","show-labels":!1},on:{"search-change":e.handleTextInput,input:e.handleInput,tag:e.handleNewTag}})},ad=[],nd=r(td,sd,ad,!1,null,null,null,null);const id=nd.exports,rd={name:"SharpDatePicker",components:{VDatePicker:Oa.DatePicker},props:{value:[Date,Object],isRange:Boolean,mondayFirst:Boolean,displayFormat:String},computed:{popoverOptions(){return{visibility:"focus",hideDelay:10,placement:"bottom",modifiers:[{name:"preventOverflow",options:{boundary:document.querySelector("[data-popover-boundary]")??"clippingParents",padding:8}},{name:"flip",enabled:!1}]}},masks(){return{input:this.displayFormat||void 0}},locale(){return document.documentElement.lang},firstDayOfWeek(){return this.mondayFirst?2:1},attributes(){return[{key:"today",dot:!0,dates:new Date}]}},methods:{handleInput(t){this.$emit("input",t)}}};var ld=function(){var e=this,s=e._self._c;return s("v-date-picker",e._g(e._b({staticClass:"SharpDatePicker",attrs:{value:e.value,popover:e.popoverOptions,"is-range":e.isRange,locale:e.locale,"first-day-of-week":e.firstDayOfWeek,attributes:e.attributes,color:"primary",is24hr:"","trim-weeks":""},on:{input:e.handleInput},scopedSlots:e._u([{key:"default",fn:function(a){return[e._t("default",null,null,a)]}}],null,!0)},"v-date-picker",e.$attrs,!1),e.$listeners))},od=[],dd=r(rd,ld,od,!1,null,null,null,null);const Is=dd.exports;w.locale(w.locales().includes(document.documentElement.lang)?document.documentElement.lang:"en");const cd={name:"SharpDate",components:{DatePicker:Is,ClearButton:se},mixins:[y],props:{id:String,value:{type:[Date,String]},hasDate:{type:Boolean,default:!0},hasTime:{type:Boolean,default:!1},displayFormat:String,mondayFirst:Boolean,stepTime:{type:Number,default:30},minTime:String,maxTime:String,readOnly:Boolean},data(){return{localInputValue:null}},computed:{format(){return this.hasTime&&!this.hasDate?"HH:mm":null},mode(){return this.hasDate&&this.hasTime?"dateTime":this.hasTime?"time":"date"},validHours(){return{min:this.minTime?parseInt(this.minTime):null,max:this.maxTime?parseInt(this.maxTime):null}},pickerValue(){return this.value?w(this.value,this.format).toDate():null},inputValue(){return typeof this.localInputValue=="string"?this.localInputValue:this.value?w(this.value,this.format).format(this.displayFormat):""},hasClearButton(){return!!this.value}},methods:{getMoment(){return this.value?w(this.value,this.format):w()},formatDateValue(t){return t?this.hasDate?this.hasTime?w(t).format():w(t).format("YYYY-MM-DD"):w(t).format("HH:mm"):null},handleDateChanged(t){this.$emit("input",this.formatDateValue(t))},handleInput(t){const e=w(t.target.value,this.displayFormat,!0);this.localInputValue=t.target.value,e.isValid()?(this.rollback(),this.$emit("input",this.formatDateValue(e.toDate())),this.updatePopover()):this.$emit("error",`${o("form.date.validation_error.format")} (${this.displayFormat})`)},handlePrependButtonClicked(){setTimeout(()=>this.$refs.input.focus())},handleBlur(){this.localInputValue&&this.rollback()},updatePopover(){this.$refs.input.dispatchEvent(new Event("change",{bubbles:!0}))},increase(t){this.translate(t.target,1)},decrease(t){this.translate(t.target,-1)},async translate(t,e){let s=this.changeOnArrowPressed(t.selectionStart,e);s&&(await this.$nextTick(),t.setSelectionRange(s.start,s.end),this.updatePopover())},add(t,e){const s=this.getMoment();s.add(t,e),this.$emit("input",this.formatDateValue(s.toDate()))},nearestMinutesDist(t){let e=this.getMoment().minutes();if(e%this.stepTime===0)return t*this.stepTime;let s=t<0?"floor":"ceil";return this.stepTime*Math[s](e/this.stepTime)-e},updateMoment(t,e){switch(t){case"H":this.add(e,"hours");break;case"m":this.add(this.nearestMinutesDist(e),"minutes");break;case"s":this.add(e,"seconds");break;case"Y":this.add(e,"years");break;case"M":this.add(e,"months");break;case"D":this.add(e,"days");break;default:return!1}return!0},changeOnArrowPressed(t,e){let s=t;if(!this.updateMoment(this.displayFormat[s],e)&&t&&(s--,!this.updateMoment(this.displayFormat[s],e)))return null;let a=this.displayFormat[s];return{start:this.displayFormat.indexOf(a),end:this.displayFormat.lastIndexOf(a)+1}},rollback(){this.$emit("clear"),this.localInputValue=null},clear(){this.rollback(),this.$emit("input",null),setTimeout(()=>this.$refs.input.focus())}}};var ud=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpDate"},[s("div",{staticClass:"SharpDate__input-wrapper position-relative"},[s("DatePicker",{attrs:{value:e.pickerValue,mode:e.mode,"minute-increment":e.stepTime,"monday-first":e.mondayFirst,"update-on-input":!1},on:{input:e.handleDateChanged},scopedSlots:e._u([{key:"default",fn:function({inputEvents:a,togglePopover:n}){return[s("div",{staticClass:"input-group",class:{"input-group--clearable":e.hasClearButton}},[s("button",{staticClass:"input-group-text btn",on:{click:e.handlePrependButtonClicked}},[s("svg",{staticClass:"align-middle",staticStyle:{fill:"currentColor"},attrs:{width:"1.25em",height:"1.25em",viewBox:"0 0 32 32"}},[s("path",{attrs:{d:"M26,4h-4V2h-2v2h-8V2h-2v2H6C4.9,4,4,4.9,4,6v20c0,1.1,0.9,2,2,2h20c1.1,0,2-0.9,2-2V6C28,4.9,27.1,4,26,4z M26,26H6V12h20  V26z M26,10H6V6h4v2h2V6h8v2h2V6h4V10z"}})])]),s("input",e._g({ref:"input",staticClass:"form-control clearable SharpDate__input",class:{"SharpDate__input--valuated":e.value},attrs:{id:e.id,placeholder:e.displayFormat,disabled:e.readOnly,autocomplete:"off"},domProps:{value:e.inputValue},on:{input:e.handleInput,blur:e.handleBlur,keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"up",38,i.key,["Up","ArrowUp"])?null:(i.preventDefault(),e.increase.apply(null,arguments))},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"down",40,i.key,["Down","ArrowDown"])?null:(i.preventDefault(),e.decrease.apply(null,arguments))}]}},a)),e.hasClearButton?[s("ClearButton",{ref:"clearButton",on:{click:e.clear}})]:e._e()],2)]}}])})],1)])},hd=[],md=r(cd,ud,hd,!1,null,null,null,null);const pd=md.exports,fd={name:"SharpCheck",props:{value:Boolean,text:String,readOnly:Boolean,uniqueIdentifier:String,id:String},computed:{resolvedId(){return this.id??this.uniqueIdentifier}},methods:{handleCheck(t){this.$emit("input",t.target.checked)}}};var _d=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpCheck form-check"},[s("input",{staticClass:"form-check-input",attrs:{type:"checkbox",id:e.resolvedId,disabled:e.readOnly},domProps:{checked:e.value},on:{change:e.handleCheck}}),s("label",{staticClass:"form-check-label",attrs:{for:e.resolvedId}},[e._v(" "+e._s(e.text)+" ")])])},gd=[],vd=r(fd,_d,gd,!1,null,null,null,null);const Ts=vd.exports,bd={name:"FieldsLayout",components:{Grid:R},props:{layout:{type:Array,required:!0},visible:{type:Object,default:()=>({})}},data(){return{fieldsetMap:{}}},methods:{isFieldset(t){return!!t.legend},isFieldsetVisible(t){return(t.fields||[]).flat().some(e=>this.visible[e.key])},updateLayout(){this.$el.querySelectorAll(":scope > .SharpGrid__row").forEach(e=>{const s=!!e.querySelector(":scope > .SharpGrid__col > .SharpForm__form-item--has-label"),a=!!e.querySelector(".SharpFieldLocaleSelect");e.classList.toggle("SharpGrid__row--has-label",s),e.classList.toggle("SharpGrid__row--has-locale-select",a)})}},mounted(){this.updateLayout()},updated(){this.updateLayout()}};var yd=function(){var e=this,s=e._self._c;return s("Grid",{attrs:{rows:e.layout},scopedSlots:e._u([{key:"default",fn:function({itemLayout:a}){return[e.isFieldset(a)?[s("fieldset",{directives:[{name:"show",rawName:"v-show",value:e.isFieldsetVisible(a),expression:"isFieldsetVisible(fieldLayout)"}]},[s("legend",{staticClass:"SharpForm__label form-label"},[e._v(e._s(a.legend))]),s("div",{staticClass:"card SharpForm__fieldset shadow-sm"},[s("div",{staticClass:"card-body"},[s("FieldsLayout",{attrs:{layout:a.fields},scopedSlots:e._u([{key:"default",fn:function({fieldLayout:n}){return[e._t("default",null,{fieldLayout:n})]}}],null,!0)})],1)])])]:[e._t("default",null,{fieldLayout:a})]]}}])})},Cd=[],$d=r(bd,yd,Cd,!1,null,null,null,null);const As=$d.exports,wd={name:"SharpListItem",extends:As,mixins:[vr]},Sd=null,kd=null;var xd=r(wd,Sd,kd,!1,null,null,null,null);const Fd=xd.exports;function Rs(t){return{_localizedForm:t,methods:{fieldLocalizedValue(e,s,a=this.data,n=this.fieldLocale){let i=this[t][e];return this.localized&&i.localized&&ze(i)?ps({localeObject:a[e],locale:n[e],value:s}):s},defaultFieldLocaleMap({fields:e,locales:s},a){return Object.values(e).filter(n=>n.type==="list"?Object.values(n.itemFields??{}).some(i=>i.localized):n.localized).reduce((n,i)=>({...n,[i.key]:a||s&&s[0]}),{})}}}}const Ld={props:{field:Object,limit:Number,disabled:Boolean},data(){return{dragActive:!1}},computed:{classes(){return{"SharpListUpload--active":this.dragActive,"SharpListUpload--disabled":this.disabled}},text(){return this.getText({link:'<a href="#" class="text-reset" tabindex="-1">$1</a>'})},label(){return this.getText()},accept(){var t;return(t=this.field.fileFilter)==null?void 0:t.join(",")},helpText(){return o("form.list.bulk_upload.help_text").replace(":limit",this.limit)}},methods:{getText({link:t}={}){return o("form.list.bulk_upload.text").replace(/\[(.+?)]\(.*?\)/,t??"$1")},handleDragEnter(){this.dragActive=!0},handleDragLeave(){this.dragActive=!1},handleDrop(){this.dragActive=!1},handleTextClicked(){this.$refs.input.click()},handleChanged(t){this.$emit("change",t),t.target.value=""}}};var Bd=function(){var e=this,s=e._self._c;return s("div",{staticClass:"list-group-item text-muted SharpListUpload",class:e.classes},[s("div",{staticClass:"SharpListUpload__content d-flex align-items-center justify-content-center"},[s("div",{staticClass:"SharpListUpload__text"},[s("div",{staticClass:"row align-items-center gx-0"},[s("div",{staticClass:"col-auto"},[s("svg",{staticClass:"SharpListUpload__icon",attrs:{width:"2em",height:"2em",viewBox:"0 0 32 32"}},[s("path",{attrs:{d:"M26,24v4H6V24H4v4H4a2,2,0,0,0,2,2H26a2,2,0,0,0,2-2h0V24Z"}}),s("polygon",{attrs:{points:"26 14 24.59 12.59 17 20.17 17 2 15 2 15 20.17 7.41 12.59 6 14 16 24 26 14"}})])]),s("div",{staticClass:"col"},[s("div",{domProps:{innerHTML:e._s(e.text)},on:{click:function(a){return a.preventDefault(),e.handleTextClicked.apply(null,arguments)}}})])])])]),s("div",{staticClass:"SharpListUpload__help"},[e._v(" "+e._s(e.helpText)+" ")]),s("input",{ref:"input",staticClass:"SharpListUpload__input",attrs:{type:"file","aria-label":e.label,disabled:e.disabled,accept:e.accept,multiple:""},on:{change:e.handleChanged,dragenter:e.handleDragEnter,dragleave:e.handleDragLeave,drop:e.handleDrop}})])},Od=[],Ed=r(Ld,Bd,Od,!1,null,null,null,null);const Id=Ed.exports,Td={name:"SharpList",inject:["$form"],mixins:[y,Rs("itemFields")],components:{ListUpload:Id,Draggable:St,ListItem:Fd,Button:_,TemplateRenderer:z},props:{fieldKey:String,fieldLayout:Object,value:Array,addable:{type:Boolean,default:!0},sortable:{type:Boolean,default:!1},removable:{type:Boolean,default:!1},addText:{type:String,default:"Ajouter un élément"},itemFields:{type:Object,required:!0},collapsedItemTemplate:String,maxItemCount:Number,bulkUploadField:String,bulkUploadLimit:{type:Number,default:10},itemIdAttribute:String,readOnly:Boolean,locale:[String,Array]},data(){return{list:[],dragActive:!1,dragging:!1,lastIndex:0}},watch:{list:"handleListChanged",locale:"handleLocaleChanged"},computed:{classes(){return{"SharpList--can-sort":this.showSortButton,"SharpList--dragging":this.dragging}},dragOptions(){return{handle:this.dragActive?".SharpList__item":".SharpList__drag-handle",filter:".SharpListUpload"}},canAddItem(){return this.addable&&(this.list.length<this.maxItemCount||!this.maxItemCount)&&!this.readOnly},showAddButton(){return this.canAddItem},showInsertButton(){return this.canAddItem&&this.sortable&&!this.isReadOnly},showSortButton(){return!this.hasPendingActions&&this.sortable&&this.list.length>1},showRemoveButton(){return this.removable&&!this.isReadOnly},dragIndexSymbol(){return Symbol("dragIndex")},indexSymbol(){return Symbol("index")},hasPendingActions(){var t;return(t=this.$form)==null?void 0:t.hasUploadingFields(this.fieldKey)},isReadOnly(){return this.readOnly||this.dragActive},hasUpload(){var t;return((t=this.uploadField)==null?void 0:t.type)==="upload"&&this.canAddItem&&this.uploadLimit>0},uploadField(){return this.bulkUploadField?this.itemFields[this.bulkUploadField]:null},uploadLimit(){if(this.maxItemCount){const t=this.maxItemCount-this.list.length;return Math.min(t,this.bulkUploadLimit)}return this.bulkUploadLimit}},methods:{handleListChanged(){this.$emit("locale-change",this.list.map(t=>t._fieldsLocale))},handleLocaleChanged(t){typeof t=="string"&&this.list.forEach(e=>{Object.assign(e,this.withLocale(null,t))})},itemData(t){const{_fieldsLocale:e,...s}=t;return s},transformedFields(t){const e=this.list[t],s=this.itemData(e);return ys(this.itemFields,s)},indexedList(){return(this.value||[]).map((t,e)=>this.withLocale({[this.indexSymbol]:e,...t}))},createItem(){return Object.entries(this.itemFields).reduce((t,[e,s])=>(t[e]=uo(s.type),t),this.withLocale({[this.itemIdAttribute]:null,[this.indexSymbol]:this.lastIndex++}))},insertNewItem(t,e){e.target&&e.target.blur(),this.list.splice(t,0,this.createItem())},add(){this.list.push(this.createItem())},remove(t){this.list.splice(t,1)},update(t){return(e,s,{forced:a}={})=>{const n={...this.list[t]},i={...a?null:vs(this.itemFields,e,()=>this.fieldLocalizedValue(e,null,n,n._fieldsLocale)),[e]:this.fieldLocalizedValue(e,s,n,n._fieldsLocale)};Object.assign(this.list[t],i)}},updateLocale(t,e,s){this.$set(this.list[t]._fieldsLocale,e,s),this.handleListChanged()},collapsedItemData(t){return{$index:t[this.dragIndexSymbol],...t}},toggleDrag(){this.dragActive=!this.dragActive,this.list.forEach((t,e)=>t[this.dragIndexSymbol]=e)},withLocale(t,e){var s;return{...t,_fieldsLocale:this.defaultFieldLocaleMap({fields:this.itemFields,locales:(s=this.$form)==null?void 0:s.locales},e)}},handleUploadChanged(t){const e=[...t.target.files].slice(0,this.uploadLimit);if(t.target.files.length>this.uploadLimit){const s=o("form.list.bulk_upload.validation.limit").replace(":limit",this.uploadLimit);D(s,{title:o("modals.error.title")})}e.forEach(s=>{const a=this.createItem();a[this.bulkUploadField]={file:s},this.list.push(a)})},initList(){this.list=this.indexedList(),this.lastIndex=this.list.length,this.$emit("input",this.list)}},created(){var t;this.localized=(t=this.$form)==null?void 0:t.localized,this.initList()}};var Ad=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpList",class:e.classes,on:{dragstart:function(a){e.dragging=!0},dragend:function(a){e.dragging=!1}}},[s("div",{staticClass:"SharpList__sticky-wrapper text-end"},[e.showSortButton?[s("Button",{staticClass:"SharpList__sort-button",staticStyle:{"pointer-events":"auto"},attrs:{text:"",small:"",active:e.dragActive},on:{click:e.toggleDrag}},[e._v(" "+e._s(e.l("form.list.sort_button.inactive"))+" "),s("svg",{staticStyle:{"margin-left":".5em"},attrs:{width:"1.125em",height:"1.125em",viewBox:"0 0 24 22","fill-rule":"evenodd"}},[s("path",{attrs:{d:"M20 14V0h-4v14h-4l6 8 6-8zM4 8v14h4V8h4L6 0 0 8z"}})])])]:e._e()],2),s("Draggable",{ref:"draggable",attrs:{options:e.dragOptions,list:e.list},scopedSlots:e._u([e.showAddButton?{key:"footer",fn:function(){return[s("div",{class:{"mt-3":e.list.length>0||e.hasUpload}},[s("Button",{key:-1,staticClass:"SharpList__add-button",attrs:{disabled:e.isReadOnly,text:"",block:""},on:{click:e.add}},[e._v(" ＋ "+e._s(e.addText)+" ")])],1)]},proxy:!0}:null],null,!0)},[s("transition-group",{staticClass:"list-group shadow-sm",attrs:{name:"expand",tag:"div"}},[e._l(e.list,function(a,n){return[s("div",{key:a[e.indexSymbol],staticClass:"SharpList__item list-group-item",class:{"SharpList__item--drag-active":e.dragActive}},[e.showInsertButton?[s("div",{staticClass:"SharpList__new-item-zone"},[s("Button",{attrs:{small:""},on:{click:function(i){return e.insertNewItem(n,i)}}},[e._v(" "+e._s(e.l("form.list.insert_button"))+" ")])],1)]:e._e(),e.dragActive&&e.collapsedItemTemplate?[s("TemplateRenderer",{attrs:{name:"CollapsedItem",template:e.collapsedItemTemplate,"template-data":e.collapsedItemData(a)}})]:[s("ListItem",{attrs:{layout:e.fieldLayout.item,"error-identifier":n},scopedSlots:e._u([{key:"default",fn:function({fieldLayout:i}){return[s("FieldDisplay",{attrs:{"field-key":i.key,"context-fields":e.transformedFields(n),"context-data":a,"error-identifier":i.key,"config-identifier":i.key,"update-data":e.update(n),locale:a._fieldsLocale[i.key],"read-only":e.isReadOnly,list:!0},on:{"locale-change":(l,d)=>e.updateLocale(n,l,d)}})]}}],null,!0)}),e.showRemoveButton?[s("button",{staticClass:"SharpList__remove-button btn-close",attrs:{"aria-label":e.l("form.list.remove_button")},on:{click:function(i){return e.remove(n)}}})]:e._e()],e.showSortButton?[s("div",{staticClass:"SharpList__drag-handle d-flex align-items-center px-1"},[s("i",{staticClass:"fas fa-grip-vertical opacity-25"})])]:e._e()],2)]}),e.hasUpload?[s("ListUpload",{key:"upload",attrs:{field:e.uploadField,limit:e.uploadLimit,disabled:e.isReadOnly},on:{change:e.handleUploadChanged}})]:e._e()],2)],1),e.readOnly&&!e.list.length?[s("em",{staticClass:"SharpList__empty-alert"},[e._v(e._s(e.l("form.list.empty")))])]:e._e()],2)},Rd=[],Dd=r(Td,Ad,Rd,!1,null,null,null,null);const Pd=Dd.exports;function Ds(t,e,s){if(!e)return;const a=document.querySelector(`label[for="${e}"]`);a&&(a.addEventListener("click",s),t.$on("hook:beforeDestroy",()=>{a.removeEventListener("click",s)}))}const zd={components:{Multiselect:us,ClearButton:se},props:{id:String,value:[Array,String,Number],options:Array,labels:Object,multiple:Boolean,clearable:Boolean,placeholder:String,maxSelected:Number,readOnly:Boolean},computed:{multiselectOptions(){return this.options.map(t=>t.id)},hasClearButton(){return this.clearable&&!this.multiple&&this.value!=null}},methods:{multiselectLabel(t){return this.labels[t]},remove(){this.$emit("input",null),this.$refs.multiselect.activate()},handleInput(t){this.$emit("input",t)}},mounted(){Ds(this,this.id,()=>{this.$el.focus()})}};var Md=function(){var e=this,s=e._self._c;return s("Multiselect",{ref:"multiselect",attrs:{id:e.id,value:e.value,searchable:!1,options:e.multiselectOptions,multiple:e.multiple,"hide-selected":e.multiple,"close-on-select":!e.multiple,"custom-label":e.multiselectLabel,placeholder:e.placeholder,disabled:e.readOnly,max:e.maxSelected,"allow-empty":e.clearable},on:{input:e.handleInput,open:function(a){return e.$emit("open")},close:function(a){return e.$emit("close")}},scopedSlots:e._u([e.hasClearButton?{key:"caret",fn:function(){return[s("ClearButton",{staticClass:"SharpSelect__clear-button",on:{click:e.remove}})]},proxy:!0}:null,{key:"tag",fn:function({option:a,remove:n}){return[s("span",{key:a,staticClass:"multiselect__tag"},[s("span",[e._v(e._s(e.multiselectLabel(a)))]),s("i",{staticClass:"multiselect__tag-icon",attrs:{"aria-hidden":"true",tabindex:"1"},on:{keypress:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:(i.preventDefault(),n(a))},mousedown:function(i){return i.preventDefault(),i.stopPropagation(),n(a)}}})])]}},{key:"option",fn:function(){return[e._t("option")]},proxy:!0}],null,!0)})},jd=[],Nd=r(zd,Md,jd,!1,null,null,null,null);const Vd=Nd.exports;function be(t,e){return t.id==null||e==null?!1:t.id==e}const Ud={components:{Check:Ts},props:{value:Array,options:Array,readOnly:Boolean,labels:Object,showSelectAll:Boolean,maxSelected:Number,inline:Boolean,root:Boolean,uniqueIdentifier:String},methods:{lang:o,isChecked(t){var e;return(e=this.value)==null?void 0:e.some(s=>be(t,s))},checkboxId(t){return`${this.uniqueIdentifier}.${t}`},handleSelectAllClicked(){this.$emit("input",this.options.map(t=>t.id))},handleUnselectAllClicked(){this.$emit("input",[])},handleCheckboxChanged(t,e){const s=t?[...this.value??[],e.id]:(this.value??[]).filter(n=>!be(e,n)),a=this.validate(s);this.$emit("input",s,{error:a})},validate(t){return this.maxSelected&&(t==null?void 0:t.length)>this.maxSelected?o("form.select.validation.max_selected").replace(":max_selected",this.maxSelected):null}}};var Hd=function(){var e=this,s=e._self._c;return s("div",{class:{"card card-body form-control":e.root}},[s("div",{staticClass:"row gy-1 gx-3",class:e.inline?"row-cols-auto":"row-cols-1"},[e._l(e.options,function(a,n){return[s("div",{staticClass:"col"},[s("Check",{key:a.id,staticClass:"mb-0",attrs:{id:e.checkboxId(n),value:e.isChecked(a),text:e.labels[a.id],"read-only":e.readOnly},on:{input:function(i){return e.handleCheckboxChanged(i,a)}}})],1)]})],2),e.showSelectAll?[s("div",{staticClass:"SharpSelect__links mt-3"},[s("div",{staticClass:"row gx-3"},[s("div",{staticClass:"col-auto"},[s("a",{attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),e.handleSelectAllClicked.apply(null,arguments)}}},[e._v(e._s(e.lang("form.select.select_all")))])]),s("div",{staticClass:"col-auto"},[s("a",{attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),e.handleUnselectAllClicked.apply(null,arguments)}}},[e._v(e._s(e.lang("form.select.unselect_all")))])])])])]:e._e()],2)},qd=[],Kd=r(Ud,Hd,qd,!1,null,null,null,null);const Gd=Kd.exports,Wd={props:{value:[String,Number],options:Array,labels:Object,uniqueIdentifier:String,readOnly:Boolean,inline:Boolean,root:Boolean},methods:{isSelected(t){return be(t,this.value)},handleRadioChanged(t){this.$emit("input",t.id)}}};var Qd=function(){var e=this,s=e._self._c;return s("div",{class:{"card card-body form-control":e.root}},[s("div",{staticClass:"row gy-1 gx-3",class:e.inline?"row-cols-auto":"row-cols-1"},[e._l(e.options,function(a,n){return[s("div",{key:a.id,staticClass:"col"},[s("div",{staticClass:"form-check mb-0"},[s("input",{staticClass:"form-check-input",attrs:{type:"radio",tabindex:"0",id:`${e.uniqueIdentifier}.${n}`,disabled:e.readOnly,name:e.uniqueIdentifier},domProps:{checked:e.isSelected(a),value:a.id},on:{change:function(i){return e.handleRadioChanged(a)}}}),s("label",{staticClass:"form-check-label",attrs:{for:`${e.uniqueIdentifier}.${n}`}},[e._v(" "+e._s(e.labels[a.id])+" ")])])])]})],2)])},Yd=[],Xd=r(Wd,Qd,Yd,!1,null,null,null,null);const Jd=Xd.exports,Zd={name:"SharpSelect",mixins:[Os],props:{value:[Array,String,Number],uniqueIdentifier:String,options:{type:Array,required:!0,default:()=>[]},multiple:{type:Boolean,default:!1},display:{type:String,default:"dropdown"},clearable:{type:Boolean,default:!1},showSelectAll:{type:Boolean,default:!0},placeholder:{type:String,default:"-"},maxSelected:Number,readOnly:Boolean,inline:{type:Boolean,default:!0},root:Boolean},watch:{options(){this.init()}},computed:{classes(){return[`SharpSelect--${this.display}`,{"SharpSelect--multiple":this.multiple}]},component(){return this.display==="dropdown"?Vd:this.multiple?Gd:Jd},optionsLabel(){return this.options.reduce((t,e)=>(t[e.id]=this.localizedOptionLabel(e),t),{})}},methods:{handleInput(t,{error:e}={}){this.$emit("input",t,{error:e})},setDefault(){!this.clearable&&!this.multiple&&this.value==null&&this.options.length>0&&this.$emit("input",this.options[0].id,{force:!0})},init(){bs(this,this.setDefault,{dependantAttributes:["options"]})},blur(){var t;(t=this.$refs.component.$refs)==null||t.multiselect.deactivate()}},created(){this.init()}};var ec=function(){var e=this,s=e._self._c;return s(e.component,e._b({ref:"component",tag:"component",staticClass:"SharpSelect",class:e.classes,attrs:{labels:e.optionsLabel},on:{input:e.handleInput}},"component",[e.$props,e.$attrs],!1))},tc=[],sc=r(Zd,ec,tc,!1,null,null,null,null);const Ps=sc.exports,ac={name:"SharpHtml",components:{TemplateRenderer:z},props:{value:Object,template:String}};var nc=function(){var e=this,s=e._self._c;return s("TemplateRenderer",{attrs:{name:"Html",template:e.template,"template-data":e.value}})},ic=[],rc=r(ac,nc,ic,!1,null,null,null,null);const lc=rc.exports,zs={mapTypeControl:!1,streetViewControl:!1};function oc(t){return[t.getSouthWest().toJSON(),t.getNorthEast().toJSON()]}function Ms(t){const e=t;return Array.isArray(e)?new google.maps.LatLngBounds(e[0],e[1]):null}function js({maxBounds:t,...e}){const s={...e};return Array.isArray(t)&&(s.restriction={latLngBounds:Ms(t)}),s}const dc={name:"SharpGmaps",components:{GmapMap:ke,GmapMarker:Se},props:{markerPosition:Object,center:Object,zoom:Number},computed:{options(){return js({...zs,maxBounds:this.maxBounds,controlSize:32})}}};var cc=function(){var e=this,s=e._self._c;return s("GmapMap",{ref:"map",attrs:{center:e.center,zoom:e.zoom,options:e.options}},[s("GmapMarker",{attrs:{position:e.markerPosition}})],1)},uc=[],hc=r(dc,cc,uc,!1,null,null,null,null);const mc=hc.exports,pc={name:"SharpGmapsEditable",components:{GmapMap:ke,GmapMarker:Se},props:{markerPosition:Object,bounds:Array,center:Object,zoom:Number,maxBounds:Array},computed:{options(){return js({...zs,maxBounds:this.maxBounds,draggableCursor:"crosshair"})},hasMarker(){return!!this.markerPosition}},watch:{bounds(t){const e=Ms(t);e&&this.$refs.map.$mapObject.fitBounds(e)}},methods:{handleMapClicked(t){this.$emit("change",t.latLng.toJSON())},handleMarkerDragEnd(t){this.$emit("change",t.latLng.toJSON())}}};var fc=function(){var e=this,s=e._self._c;return s("GmapMap",{ref:"map",attrs:{center:e.center,zoom:e.zoom,options:e.options},on:{click:e.handleMapClicked}},[e.hasMarker?[s("GmapMarker",{attrs:{position:e.markerPosition,draggable:""},on:{dragend:e.handleMarkerDragEnd}})]:e._e()],2)},_c=[],gc=r(pc,fc,_c,!1,null,null,null,null);const vc=gc.exports,bc=Ea(({apiKey:t})=>{const e={v:3};return t&&(e.key=t),zt(e),m.$gmapApiPromiseLazy()});let pe=null;function yc({address:t,latLng:e}){return pe||(pe=new google.maps.Geocoder),new Promise((s,a)=>{pe.geocode({address:t,location:e},(n,i)=>{i==="OK"?s(n.map(l=>({location:l.geometry.location.toJSON(),bounds:oc(l.geometry.viewport),address:l.formatted_address}))):i==="ZERO_RESULTS"?s([]):a(i)})})}function ye(t){const e=t;return Array.isArray(e)?Bt.latLngBounds(e[0],e[1]):null}Bt.Icon.Default.mergeOptions({iconUrl:Ia,iconRetinaUrl:Ta,shadowUrl:Aa});const Cc={name:"SharpOsm",components:{LMap:Ot,LMarker:Et,LTileLayer:It},props:{markerPosition:Object,zoom:Number,center:Object,maxBounds:Array,tilesUrl:{type:String,default:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}},computed:{transformedMaxBounds(){return ye(this.maxBounds)}}};var $c=function(){var e=this,s=e._self._c;return s("LMap",{attrs:{zoom:e.zoom,center:e.center,"max-bounds":e.transformedMaxBounds}},[s("LTileLayer",{attrs:{url:e.tilesUrl}}),s("LMarker",{attrs:{"lat-lng":e.markerPosition}})],1)},wc=[],Sc=r(Cc,$c,wc,!1,null,null,null,null);const kc=Sc.exports;function nt(t,e){let s=t<0?e?"W":"S":e?"E":"N",a=0|(t<0?t=-t:t),n=0|t%1*60,i=(0|t*60%1*6e3)/100;return`${a}°${n}"${i}' ${s}`}function G(t){return t?t.name:null}function fe(t){return t?t.options||{}:{}}function Ns(t){return t?t.tilesUrl:null}function Vs(){window.dispatchEvent(new Event("resize"))}const xc={name:"SharpOsmEditable",components:{LMap:Ot,LMarker:Et,LTileLayer:It},props:{markerPosition:Object,center:Object,zoom:Number,bounds:Array,maxBounds:Array,tilesUrl:{type:String,default:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}},computed:{hasMarker(){return!!this.markerPosition},transformedBounds(){return ye(this.bounds)},transformedMaxBounds(){return ye(this.maxBounds)}},methods:{handleMapClicked(t){this.$emit("change",t.latlng)},handleMarkerDragEnd(t){this.$emit("change",t.target.getLatLng())}},mounted(){Vs()}};var Fc=function(){var e=this,s=e._self._c;return s("LMap",{attrs:{zoom:e.zoom,center:e.center,bounds:e.transformedBounds,"max-bounds":e.transformedMaxBounds},on:{click:e.handleMapClicked}},[s("LTileLayer",{attrs:{url:e.tilesUrl}}),e.hasMarker?[s("LMarker",{attrs:{"lat-lng":e.markerPosition,draggable:""},on:{dragend:e.handleMarkerDragEnd}})]:e._e()],2)},Lc=[],Bc=r(xc,Fc,Lc,!1,null,null,null,null);const Oc=Bc.exports;function Ec(t){return X.get("https://nominatim.openstreetmap.org/search",{params:{q:t,format:"json"}}).then(e=>e.data)}function Ic(t){return X.get("https://nominatim.openstreetmap.org/reverse",{params:{lat:t.lat,lon:t.lng,format:"json"}}).then(e=>[e.data])}async function Tc({address:t,latLng:e}){return(e?await Ic(e):await Ec(t)).map(a=>({location:{lat:Number(a.lat),lng:Number(a.lon)},bounds:[{lat:Number(a.boundingbox[0]),lng:Number(a.boundingbox[2])},{lat:Number(a.boundingbox[1]),lng:Number(a.boundingbox[3])}],address:a.display_name}))}function Ac(t){if(t==="gmaps")return mc;if(t==="osm")return kc}function Rc(t){if(t==="gmaps")return vc;if(t==="osm")return Oc}function Dc(t,e){return t==="gmaps"?Promise.resolve(bc(e)):Promise.resolve()}function it(t,e,s){return t==="gmaps"?yc(e):t==="osm"?Tc(e):Promise.resolve([])}const Pc={mixins:[Gr("form.geolocation.modal")],components:{Loading:I,Modal:F,TextField:re,Button:_},props:{location:Object,center:Object,bounds:Object,zoom:Number,maxBounds:Array,geocoding:Boolean,mapsProvider:{type:String,default:"gmaps"},mapsOptions:Object,geocodingProvider:{type:String,default:"gmaps"},geocodingOptions:Object},data(){return{loading:!1,search:null,message:null,currentLocation:this.location,currentBounds:this.bounds}},computed:{editableMapComponent(){return Rc(this.mapsProvider)},hasGeocoding(){return this.geocoding},classes(){return{"SharpGeolocationEdit--loading":this.loading}},mapClasses(){return[`SharpGeolocationEdit__map--${this.mapsProvider}`]},tilesUrl(){return Ns(this.mapsOptions)}},methods:{handleSearchInput(t){this.search=t},handleMarkerPositionChanged(t){this.currentLocation=t,this.message="",this.$emit("change",this.currentLocation),this.hasGeocoding&&(this.loading=!0,it(this.geocodingProvider,{latLng:t},this.geocodingOptions).then(e=>{e.length>0&&(this.search=e[0].address)}).finally(()=>{this.loading=!1}))},handleSearchSubmitted(){const t=this.search;this.message="",this.loading=!0,it(this.geocodingProvider,{address:t},this.geocodingOptions).then(e=>{e.length>0?(this.currentLocation=e[0].location,this.currentBounds=e[0].bounds,this.$emit("change",this.currentLocation)):this.message=this.lSub("geocode_input.message.no_results").replace(":query",t||"")}).catch(e=>{this.message=`${this.lSub("geocode_input.message.error")}${e?` (${e})`:""}`}).finally(()=>{this.loading=!1})}}};var zc=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpGeolocationEdit",class:e.classes},[e.hasGeocoding?[s("div",{staticClass:"mb-2"},[s("form",{on:{submit:function(a){return a.preventDefault(),e.handleSearchSubmitted.apply(null,arguments)}}},[s("div",{staticClass:"row no-gutters"},[s("div",{staticClass:"col position-relative"},[s("TextField",{staticClass:"SharpGeolocationEdit__input",attrs:{value:e.search,placeholder:e.lSub("geocode_input.placeholder")},on:{input:e.handleSearchInput}}),s("Loading",{staticClass:"SharpGeolocationEdit__loading",attrs:{visible:e.loading,small:""}})],1),s("div",{staticClass:"col-auto pl-2"},[s("Button",{attrs:{outline:""}},[e._v(e._s(e.lSub("search_button")))])],1)])]),e.message?[s("small",[e._v(e._s(e.message))])]:e._e()],2)]:e._e(),s(e.editableMapComponent,{tag:"component",staticClass:"SharpGeolocationEdit__map",class:e.mapClasses,attrs:{"marker-position":e.currentLocation,center:e.center,bounds:e.currentBounds,zoom:e.zoom,"max-bounds":e.maxBounds,"tiles-url":e.tilesUrl},on:{change:e.handleMarkerPositionChanged}})],2)},Mc=[],jc=r(Pc,zc,Mc,!1,null,null,null,null);const Nc=jc.exports,Vc={name:"SharpGeolocation",mixins:[y],inject:{$tab:{default:null}},components:{GeolocationEdit:Nc,Button:_,Modal:F},props:{value:Object,readOnly:Boolean,uniqueIdentifier:String,geocoding:Boolean,apiKey:String,boundaries:Object,zoomLevel:{type:Number,default:4},initialPosition:{type:Object,default:()=>({lat:46.1445458,lng:-2.4343779})},displayUnit:{type:String,default:"DD",validator:t=>t==="DMS"||t==="DD"},mapsProvider:{type:Object,default:()=>({name:"gmaps"})},geocodingProvider:{type:Object,default:()=>({name:"gmaps"})}},data(){return{ready:!1,modalVisible:!1,location:this.value}},computed:{isLoading(){return!this.ready},isEmpty(){return!this.value},latLngString(){if(this.displayUnit==="DMS")return{lat:nt(this.value.lat),lng:nt(this.value.lng,!0)};if(this.displayUnit==="DD")return this.value},mapComponent(){return Ac(G(this.mapsProvider))},mapClasses(){return[`SharpGeolocation__map--${G(this.mapsProvider)}`]},tilesUrl(){const t=fe(this.mapsProvider);return Ns(t)},maxBounds(){return this.boundaries?[this.boundaries.sw,this.boundaries.ne]:null},modalTitle(){return this.geocoding?this.l("form.geolocation.modal.title"):this.l("form.geolocation.modal.title-no-geocoding")}},methods:{providerName:G,providerOptions:fe,handleModalSubmitted(){this.$emit("input",this.location)},handleRemoveButtonClicked(){this.$emit("input",null)},handleShowModalButtonClicked(){this.modalVisible=!0},handleEditButtonClicked(){this.modalVisible=!0},handleLocationChanged(t){this.location=t},loadProvider(t){const e=G(t),{apiKey:s}=fe(t);return Dc(e,{apiKey:s})},async init(){await this.loadProvider(this.mapsProvider),this.geocodingProvider&&await this.loadProvider(this.geocodingProvider),this.ready=!0}},created(){this.init()},mounted(){var t;(t=this.$tab)==null||t.$once("active",()=>{Vs()})}};var Uc=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpGeolocation"},[e.isLoading?[e._v(" "+e._s(e.l("form.geolocation.loading"))+" ")]:e.isEmpty?[s("Button",{attrs:{text:"",block:""},on:{click:e.handleShowModalButtonClicked}},[e._v(" "+e._s(e.l("form.geolocation.browse_button"))+" ")])]:[s("div",{staticClass:"card card-body form-control"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-7"},[s(e.mapComponent,{tag:"component",staticClass:"SharpGeolocation__map",class:e.mapClasses,attrs:{"marker-position":e.value,center:e.value,zoom:e.zoomLevel,"max-bounds":e.maxBounds,"tiles-url":e.tilesUrl}})],1),s("div",{staticClass:"col-5 pl-0"},[s("div",{staticClass:"d-flex flex-column justify-content-between h-100"},[s("div",[s("div",[s("small",[e._v("Latitude : "+e._s(e.latLngString.lat))])]),s("div",[s("small",[e._v("Longitude : "+e._s(e.latLngString.lng))])])]),s("div",[s("Button",{staticClass:"remove-button",attrs:{variant:"danger",small:"",outline:"",disabled:e.readOnly},on:{click:e.handleRemoveButtonClicked}},[e._v(" "+e._s(e.l("form.geolocation.remove_button"))+" ")]),s("Button",{attrs:{small:"",outline:"",disabled:e.readOnly},on:{click:e.handleEditButtonClicked}},[e._v(" "+e._s(e.l("form.geolocation.edit_button"))+" ")])],1)])])])])],s("Modal",{attrs:{title:e.modalTitle,visible:e.modalVisible,"no-close-on-backdrop":""},on:{"update:visible":function(a){e.modalVisible=a},ok:e.handleModalSubmitted}},[s("transition",{attrs:{duration:300}},[e.modalVisible?[s("GeolocationEdit",{attrs:{location:e.value,center:e.value||e.initialPosition,zoom:e.zoomLevel,"max-bounds":e.maxBounds,"maps-provider":e.providerName(e.mapsProvider),"maps-options":e.providerOptions(e.mapsProvider),geocoding:e.geocoding,"geocoding-provider":e.providerName(e.geocodingProvider),"geocoding-options":e.providerOptions(e.geocodingProvider)},on:{change:e.handleLocationChanged}})]:e._e()],2)],1)],2)},Hc=[],qc=r(Vc,Uc,Hc,!1,null,null,null,null);const Kc=qc.exports,Gc={extends:Tt,props:{node:Object},computed:{rendered(){return this.node.type.spec.toDOM(this.node)},tag(){return this.rendered instanceof HTMLElement?this.rendered.tagName:this.rendered[0]},attributes(){return this.rendered instanceof HTMLElement?[...this.rendered.attributes].reduce((t,e)=>({...t,[e.name]:e.value}),{}):this.rendered[1]}},created(){is(this.tag)}};var Wc=function(){var e=this,s=e._self._c;return s(e.tag,e._b({tag:"component",class:e.decorationClasses.value,staticStyle:{"white-space":"normal"},attrs:{"data-node-view-wrapper":""},on:{dragstart:e.onDragStart}},"component",e.attributes,!1),[e._t("default")],2)},Qc=[],Yc=r(Gc,Wc,Qc,!1,null,null,null,null);const je=Yc.exports,Xc={components:{NodeRenderer:je,VueClip:ve},props:{editor:Object,node:Object,selected:Object,extension:Object,getPos:Function,updateAttributes:Function,deleteNode:Function},computed:{value(){const t=this.node.attrs;return t.file?{file:t.file}:{path:t.path,disk:t.disk,name:t.name,filters:t.filters,thumbnail:t.thumbnail,size:t.size,uploaded:t.uploaded}},error(){if(this.node.attrs.notFound)return o("form.editor.errors.unknown_file").replace(":path",this.node.attrs.path??"")},fieldProps(){const t=this.extension.options.fieldProps;return{...t,uniqueIdentifier:`${t.uniqueIdentifier}.upload.${Ur(this)}`}},options(){return Bs({fileFilter:this.fieldProps.fileFilter,maxFileSize:this.fieldProps.maxFileSize})}},methods:{handleThumbnailChanged(t){this.updateAttributes({thumbnail:t})},handleRemoveClicked(){this.deleteNode(),setTimeout(()=>{this.editor.commands.focus()},0)},handleError(t,e){this.deleteNode(),D(`${t}<br>&gt;&nbsp;${e.name}`,{isError:!0,title:o("modals.error.title")})},handleUpdated(t){this.updateAttributes({filters:t.filters}),this.node.attrs.file||this.extension.options.onUpdate(t)},handleSuccess(t){this.updateAttributes({...t,file:null,uploaded:!0}),this.extension.options.onSuccess(t)},async init(){if(this.node.attrs.file||this.node.attrs.notFound)return;const t=await this.extension.options.registerFile(this.value);t?this.updateAttributes(t):this.updateAttributes({notFound:!0})}},created(){this.init()},beforeDestroy(){this.node.attrs.file||this.extension.options.onRemove(this.value)}};var Jc=function(){var e=this,s=e._self._c;return s("NodeRenderer",{staticClass:"editor__node",attrs:{node:e.node}},[s("VueClip",e._b({attrs:{value:e.value,root:!1,options:e.options,invalid:!!e.error,"persist-thumbnails":""},on:{thumbnail:e.handleThumbnailChanged,updated:e.handleUpdated,removed:e.handleRemoveClicked,success:e.handleSuccess,error:e.handleError}},"VueClip",e.fieldProps,!1)),e.error?[s("div",{staticClass:"invalid-feedback d-block",staticStyle:{"font-size":".75rem"}},[e._v(" "+e._s(e.error)+" ")])]:e._e()],2)},Zc=[],eu=r(Xc,Jc,Zc,!1,null,null,null,null);const tu=eu.exports;function rt(t,{editor:e,pos:s}){[...t].reverse().reduce((a,n)=>a.insertUpload({file:n,pos:s}),e.chain()).run()}function su(t){return new J({props:{handlePaste(e,s){const a=s.clipboardData||s.originalEvent.clipboardData;if(a.files.length)return s.preventDefault(),rt(a.files,{pos:t.state.selection,editor:t}),!1},handleDOMEvents:{drop(e,s){var n,i;if(!((i=(n=s.dataTransfer)==null?void 0:n.files)!=null&&i.length))return;s.preventDefault();const a=e.posAtCoords({left:s.clientX,top:s.clientY});return rt(s.dataTransfer.files,{pos:a.pos,editor:t}),!0}}}})}const Ne=Z.create({name:"upload",group:"block",atom:!0,isolating:!0,priority:150,addOptions:()=>({fieldProps:{},isReady:()=>!0,getFile:()=>{},registerFile:()=>{},onInput:()=>{},onRemove:()=>{},onUpdate:()=>{}}),addAttributes(){return{disk:{default:null},path:{default:null},name:{default:null},size:{default:null,renderHTML:()=>null},thumbnail:{default:null,renderHTML:()=>null},filters:{parseHTML:t=>({crop:Ss(t.getAttribute("filter-crop")),rotate:ks(t.getAttribute("filter-rotate"))}),renderHTML:()=>null},"filter-crop":{default:null,renderHTML:t=>{var e;return{"filter-crop":Io((e=t.filters)==null?void 0:e.crop)}}},"filter-rotate":{default:null,renderHTML:t=>{var e;return{"filter-rotate":To((e=t.filters)==null?void 0:e.rotate)}}},file:{default:null,renderHTML:()=>null},isImage:{default:!1,parseHTML:t=>t.matches("x-sharp-image"),renderHTML:()=>null},uploaded:{default:!1,renderHTML:()=>null},notFound:{default:!1,renderHTML:()=>null}}},parseHTML(){return[{tag:"x-sharp-image"},{tag:"x-sharp-file"}]},renderHTML({node:t,HTMLAttributes:e}){return t.attrs.isImage?["x-sharp-image",e]:["x-sharp-file",e]},addProseMirrorPlugins(){return[su(this.editor)]},addCommands(){return{insertUpload:({file:t,pos:e})=>({commands:s,tr:a})=>s.insertContentAt(e??a.selection.to,{type:this.name,attrs:{file:t,isImage:t.type.match(/^image\//)}}),newUpload:()=>({editor:t})=>{t.emit("new-upload")}}},addNodeView(){return ee(tu)}}),au={props:{editor:Object},computed:{uploadExtension(){return this.editor.options.extensions.find(t=>t.name===Ne.name)},accept(){var t;return(t=this.uploadExtension)==null?void 0:t.options.fieldProps.fileFilter}},methods:{handleChanged(t){this.editor.chain().focus().insertUpload({file:t.target.files[0]}).run()},handleUploadRequested(){this.$refs.input.value="",setTimeout(()=>{this.$refs.input.click()})}},mounted(){this.editor.on("new-upload",this.handleUploadRequested)}};var nu=function(){var e=this,s=e._self._c;return s("input",{ref:"input",staticStyle:{display:"none"},attrs:{type:"file",accept:e.accept},on:{change:e.handleChanged}})},iu=[],ru=r(au,nu,iu,!1,null,null,null,null);const lu=ru.exports,ou={bold:"fas fa-bold",italic:"fas fa-italic",strike:"fas fa-strikethrough",link:"fas fa-link",highlight:"fas fa-highlighter",small:"fas fa-font",h1:"fas fa-heading",h2:"fas fa-heading fa-sm",h3:"fas fa-heading fa-xs",quote:"fas fa-quote-right",code:"fas fa-code",ul:"fas fa-list-ul",ol:"fas fa-list-ol",indent:"fas fa-indent","de-indent":"fas fa-outdent",undo:"fas fa-undo",redo:"fas fa-redo",hr:"fas fa-minus",image:"far fa-image",document:"fas fa-paperclip",iframe:"far fa-caret-square-right",table:"fas fa-table",html:"far fa-file-code","code-block":"fas fa-file-code",superscript:"fas fa-superscript","align-left":"fas fa-align-left","align-center":"fas fa-align-center","align-right":"fas fa-align-right","align-justify":"fas fa-align-justify","align-unset":"fas fa-text-slash"};function h(t){return ou[t]||null}const N={bold:{command:t=>t.chain().focus().toggleBold().run(),isActive:t=>t.isActive("bold"),icon:h("bold"),label:o("form.editor.toolbar.bold.title")},italic:{command:t=>t.chain().focus().toggleItalic().run(),isActive:t=>t.isActive("italic"),icon:h("italic"),label:o("form.editor.toolbar.italic.title")},highlight:{command:t=>t.chain().focus().toggleHighlight().run(),isActive:t=>t.isActive("highlight"),icon:h("highlight"),label:o("form.editor.toolbar.highlight.title")},small:{command:t=>t.chain().focus().toggleSmall().run(),isActive:t=>t.isActive("small"),icon:h("small"),label:o("form.editor.toolbar.small.title")},"heading-1":{command:t=>t.chain().focus().toggleHeading({level:1}).run(),isActive:t=>t.isActive("heading",{level:1}),icon:h("h1"),label:o("form.editor.toolbar.heading_1.title")},"heading-2":{command:t=>t.chain().focus().toggleHeading({level:2}).run(),isActive:t=>t.isActive("heading",{level:2}),icon:h("h2"),label:o("form.editor.toolbar.heading_2.title")},"heading-3":{command:t=>t.chain().focus().toggleHeading({level:3}).run(),isActive:t=>t.isActive("heading",{level:3}),icon:h("h3"),label:o("form.editor.toolbar.heading_3.title")},code:{command:t=>t.chain().focus().toggleCode().run(),isActive:t=>t.isActive("code"),icon:h("code"),label:o("form.editor.toolbar.code.title")},blockquote:{command:t=>t.chain().focus().toggleBlockquote().run(),isActive:t=>t.isActive("blockquote"),icon:h("quote"),label:o("form.editor.toolbar.quote.title")},"bullet-list":{command:t=>t.chain().focus().toggleBulletList().run(),isActive:t=>t.isActive("bulletList"),icon:h("ul"),label:o("form.editor.toolbar.unordered_list.title")},"ordered-list":{command:t=>t.chain().focus().toggleOrderedList().run(),isActive:t=>t.isActive("orderedList"),icon:h("ol"),label:o("form.editor.toolbar.ordered_list.title")},link:{command:(t,{href:e,label:s})=>{const a=t.state.tr.selection;t.isActive("link")?t.chain().focus().extendMarkRange("link").setLink({href:e}).run():a.empty?t.chain().focus().insertContent(`<a href="${e}">${s||e}</a>`).run():t.chain().focus().setLink({href:e}).run()},isActive:t=>t.isActive("link"),icon:h("link"),label:o("form.editor.toolbar.link.title")},"upload-image":{command:t=>t.chain().focus().newUpload().run(),isActive:t=>t.isActive("upload")||t.isActive("image"),icon:h("image"),label:o("form.editor.toolbar.upload_image.title")},upload:{command:t=>t.chain().focus().newUpload().run(),isActive:t=>t.isActive("upload"),icon:h("document"),label:o("form.editor.toolbar.upload.title")},"horizontal-rule":{command:t=>t.chain().focus().setHorizontalRule().run(),isActive:t=>t.isActive("horizontalRule"),icon:h("hr"),label:o("form.editor.toolbar.horizontal_rule.title")},iframe:{command:t=>t.chain().focus().insertIframe().run(),isActive:t=>t.isActive("iframe"),icon:h("iframe"),label:o("form.editor.toolbar.iframe.title")},table:{command:t=>t.chain().focus().insertTable().run(),isActive:t=>t.isActive("table"),icon:h("table")},html:{command:t=>t.chain().focus().insertHtml().run(),isActive:t=>t.isActive("html"),icon:h("html")},"code-block":{command:t=>t.chain().focus().toggleCodeBlock().run(),isActive:t=>t.isActive("codeBlock"),icon:h("code-block")},superscript:{command:t=>t.chain().focus().toggleSuperscript().run(),isActive:t=>t.isActive("superscript"),icon:h("superscript")},undo:{command:t=>t.chain().undo().run(),icon:h("undo"),label:o("form.editor.toolbar.undo.title")},redo:{command:t=>t.chain().redo().run(),icon:h("redo"),label:o("form.editor.toolbar.redo.title")},"align-left":{command:t=>t.chain().focus().setTextAlign("left").run(),isActive:t=>t.isActive("textAlign",{align:"left"}),icon:h("align-left"),label:o("form.editor.toolbar.align-left.title")},"align-center":{command:t=>t.chain().focus().setTextAlign("center").run(),isActive:t=>t.isActive("textAlign",{align:"center"}),icon:h("align-center"),label:o("form.editor.toolbar.align-center.title")},"align-right":{command:t=>t.chain().focus().setTextAlign("right").run(),isActive:t=>t.isActive("textAlign",{align:"right"}),icon:h("align-right"),label:o("form.editor.toolbar.align-right.title")},"align-justify":{command:t=>t.chain().focus().setTextAlign("justify").run(),isActive:t=>t.isActive("textAlign",{align:"justify"}),icon:h("align-justify"),label:o("form.editor.toolbar.align-justify.title")},"align-unset":{command:t=>t.chain().focus().unsetTextAlign().run(),icon:h("align-unset"),label:o("form.editor.toolbar.align-unset.title")}},du={components:{Button:_,Dropdown:$,BDropdownForm:Ra,BFormGroup:Da,TextInput:re},props:{id:String,active:Boolean,editor:Object},data(){return{label:null,href:null,hasSelectedText:!1,inserted:!1,selection:null}},computed:{hasLabelInput(){return!this.active&&!this.hasSelectedText},isEdit(){return this.inserted}},methods:{lang:o,fieldId(t){return`${this.id}-${t}`},hide(t=!0){this.$refs.dropdown.hide(),t&&this.editor.chain().focus().run()},handleDropdownShow(){const t=this.editor.state.selection;if(this.href=null,this.inserted=!1,this.hasSelectedText=!t.empty,this.active){const e=this.editor.getAttributes("link");this.href=e==null?void 0:e.href,this.inserted=!0}this.hasSelectedText&&(this.editor.commands.setLink({href:"#"}),this.selection={from:t.from,to:t.to})},handleDropdownShown(){setTimeout(()=>{this.$refs.input.focus()},0)},handleDropdownHide(){if(!this.inserted&&this.hasSelectedText){const{from:t,to:e}=this.editor.state.selection;this.editor.chain().setTextSelection(this.selection.from,this.selection.to).unsetLink().setTextSelection(t,e).run()}},handleCancelClicked(){this.hide()},handleLinkSubmitted(){if(!this.href){this.hide();return}this.$emit("submit",{href:this.href,label:this.label}),this.inserted=!0},handleRemoveClicked(){this.$emit("remove")}}};var cu=function(){var e=this,s=e._self._c;return s("Dropdown",e._b({ref:"dropdown",staticClass:"editor__dropdown editor__dropdown--link",attrs:{variant:"light",active:e.active},on:{show:e.handleDropdownShow,shown:e.handleDropdownShown,hide:e.handleDropdownHide},scopedSlots:e._u([{key:"text",fn:function(){return[e._t("default")]},proxy:!0},{key:"default",fn:function({hide:a}){return[s("b-dropdown-form",{on:{submit:function(n){return n.preventDefault(),e.handleLinkSubmitted.apply(null,arguments)}}},[e.isEdit?[s("button",{staticClass:"btn-close position-absolute end-0 top-0 p-2 fs-8",attrs:{type:"button"},on:{click:e.handleCancelClicked}},[s("span",{staticClass:"visually-hidden"},[e._v(e._s(e.lang("modals.cancel_button","Cancel")))])])]:e._e(),e.hasLabelInput?[s("div",{staticClass:"mb-3"},[s("label",{staticClass:"form-label",attrs:{for:e.fieldId("label")}},[e._v(" "+e._s(e.lang("form.editor.dialogs.link.text_label","Text"))+" ")]),s("TextInput",{attrs:{id:e.fieldId("label")},model:{value:e.label,callback:function(n){e.label=n},expression:"label"}})],1)]:e._e(),s("div",{staticClass:"mb-3"},[s("label",{staticClass:"form-label",attrs:{for:e.fieldId("href")}},[e._v(" "+e._s(e.lang("form.editor.dialogs.link.url_label","URL"))+" ")]),s("TextInput",{ref:"input",attrs:{id:e.fieldId("href"),placeholder:"https://example.org",autocomplete:"off"},model:{value:e.href,callback:function(n){e.href=n},expression:"href"}})],1),s("div",{staticClass:"mt-3"},[s("div",{staticClass:"row g-2 flex-sm-nowrap"},[s("div",{staticClass:"col-auto"},[s("Button",{attrs:{type:"submit",small:"",variant:"primary"}},[e.isEdit?[e._v(" "+e._s(e.lang("form.editor.dialogs.link.update_button","Update"))+" ")]:[e._v(" "+e._s(e.lang("form.editor.dialogs.link.insert_button","Insert link"))+" ")]],2)],1),s("div",{staticClass:"col-auto"},[e.isEdit?[s("Button",{attrs:{type:"button",small:"",variant:"danger",outline:""},on:{click:e.handleRemoveClicked}},[e._v(" "+e._s(e.lang("form.editor.dialogs.link.remove_button","Remove link"))+" ")])]:[s("Button",{attrs:{type:"button",small:"",variant:"light"},on:{click:e.handleCancelClicked}},[e._v(" "+e._s(e.lang("modals.cancel_button","Cancel"))+" ")])]],2)])])],2)]}}],null,!0)},"Dropdown",e.$attrs,!1))},uu=[],hu=r(du,cu,uu,!1,null,null,null,null);const mu=hu.exports,pu={components:{Button:_,Dropdown:$,DropdownItem:x,DropdownSeparator:U},props:{id:String,active:Boolean,editor:Object},data(){return{}},methods:{lang:o,handleInsertClicked(){this.command(()=>{this.editor.chain().focus().insertTable().run()})},command(t){t(),setTimeout(()=>{this.editor.chain().focus().run()},0)}}};var fu=function(){var e=this,s=e._self._c;return s("Dropdown",e._b({ref:"dropdown",staticClass:"editor__dropdown editor__dropdown--table",attrs:{variant:"light",active:e.active},scopedSlots:e._u([{key:"text",fn:function(){return[e._t("default")]},proxy:!0},{key:"default",fn:function({hide:a}){return[s("DropdownItem",{attrs:{disabled:e.editor.isActive("table")},on:{click:e.handleInsertClicked}},[e._v(" "+e._s(e.lang("form.editor.dropdown.table.insert_table","Insert table"))+" ")]),s("DropdownSeparator"),s("DropdownItem",{attrs:{disabled:!e.editor.can().toggleHeaderCell()},on:{click:function(n){e.command(()=>e.editor.chain().toggleHeaderCell().run())}}},[e._v(" "+e._s(e.lang("form.editor.dropdown.table.toggle_header_cell"))+" ")]),s("DropdownSeparator"),s("DropdownItem",{attrs:{disabled:!e.editor.can().addRowBefore()},on:{click:function(n){e.command(()=>e.editor.chain().addRowBefore().run())}}},[e._v(" "+e._s(e.lang("form.editor.dropdown.table.insert_row_above","Insert row above"))+" ")]),s("DropdownItem",{attrs:{disabled:!e.editor.can().addRowAfter()},on:{click:function(n){e.command(()=>e.editor.chain().addRowAfter().run())}}},[e._v(" "+e._s(e.lang("form.editor.dropdown.table.insert_row_below","Insert row below"))+" ")]),s("DropdownItem",{attrs:{disabled:!e.editor.can().deleteRow()},on:{click:function(n){e.command(()=>e.editor.chain().deleteRow().run())}}},[e._v(" "+e._s(e.lang("form.editor.dropdown.table.remove_row","Remove row"))+" ")]),s("DropdownSeparator"),s("DropdownItem",{attrs:{disabled:!e.editor.can().addColumnBefore()},on:{click:function(n){e.command(()=>e.editor.chain().addColumnBefore().run())}}},[e._v(" "+e._s(e.lang("form.editor.dropdown.table.insert_col_left","Insert column to the left"))+" ")]),s("DropdownItem",{attrs:{disabled:!e.editor.can().addColumnAfter()},on:{click:function(n){e.command(()=>e.editor.chain().addColumnAfter().run())}}},[e._v(" "+e._s(e.lang("form.editor.dropdown.table.insert_col_right","Insert column to the right"))+" ")]),s("DropdownItem",{attrs:{disabled:!e.editor.can().deleteColumn()},on:{click:function(n){e.command(()=>e.editor.chain().deleteColumn().run())}}},[e._v(" "+e._s(e.lang("form.editor.dropdown.table.remove_col","Remove column"))+" ")]),s("DropdownSeparator"),s("DropdownItem",{attrs:{disabled:!e.editor.can().deleteTable()},on:{click:function(n){e.command(()=>e.editor.chain().deleteTable().run())}}},[e._v(" "+e._s(e.lang("form.editor.dropdown.table.remove_table","Remove table"))+" ")])]}}],null,!0)},"Dropdown",e.$attrs,!1))},_u=[],gu=r(pu,fu,_u,!1,null,null,null,null);const vu=gu.exports,bu={components:{Dropdown:$,DropdownItem:x},props:{id:String,editor:Object,options:Array},data(){return{}},computed:{disabled(){return this.options.every(t=>t.disabled)}},methods:{runCommand(t){t.command(),setTimeout(()=>{this.editor.chain().focus().run()},0)}}};var yu=function(){var e=this,s=e._self._c;return s("Dropdown",e._b({ref:"dropdown",staticClass:"editor__dropdown",attrs:{variant:"light",small:"",disabled:e.disabled},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" Options ")]},proxy:!0},{key:"default",fn:function({hide:a}){return[e._l(e.options,function(n){return[s("DropdownItem",{attrs:{disabled:n.disabled},on:{click:function(i){return e.runCommand(n)}}},[e._v(" "+e._s(n.label)+" ")])]})]}}])},"Dropdown",e.$attrs,!1))},Cu=[],$u=r(bu,yu,Cu,!1,null,null,null,null);const wu=$u.exports,Su={components:{Dropdown:$,DropdownItem:x},props:{embeds:Array,editor:Object},methods:{lang:o,handleClicked(t){this.editor.chain().focus().insertEmbed({embedKey:t.key}).run()}}};var ku=function(){var e=this,s=e._self._c;return s("Dropdown",e._b({ref:"dropdown",staticClass:"editor__dropdown",attrs:{variant:"light",small:""},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(e.lang("form.editor.dropdown.embeds"))+" ")]},proxy:!0},{key:"default",fn:function({hide:a}){return[e._l(e.embeds,function(n){return[s("DropdownItem",{on:{click:function(i){return e.handleClicked(n)}}},[e._v(" "+e._s(n.label)+" ")])]})]}}])},"Dropdown",e.$attrs,!1))},xu=[],Fu=r(Su,ku,xu,!1,null,null,null,null);const Lu=Fu.exports,Bu={components:{EmbedDropdown:Lu,TableDropdown:vu,LinkDropdown:mu,OptionsDropdown:wu,Button:_,Dropdown:$},props:{id:String,editor:Object,toolbar:Array,disabled:Boolean,options:Array,embeds:Object},computed:{toolbarGroups(){return this.toolbar.reduce((t,e)=>e==="|"?[...t,[]]:(t[t.length-1].push(e),t),[[]])},customEmbeds(){const{upload:t,...e}=this.embeds??{};return Object.values(e)}},methods:{getIcon(t){var e;return(e=N[t])==null?void 0:e.icon},isActive(t){var e,s;return(s=(e=N[t])==null?void 0:e.isActive)==null?void 0:s.call(e,this.editor)},buttonTitle(t){var e;return(e=N[t])==null?void 0:e.label},handleClicked(t){var e;(e=N[t])==null||e.command(this.editor)},handleLinkSubmitted({href:t,label:e}){N.link.command(this.editor,{href:t,label:e})},handleRemoveLinkClicked(){this.editor.chain().focus().unsetLink().run()}}};var Ou=function(){var e=this,s=e._self._c;return s("div",{staticClass:"editor__toolbar"},[s("div",{staticClass:"row row-cols-auto g-2"},[e._l(e.toolbarGroups,function(a){return[s("div",{staticClass:"btn-group"},[e._l(a,function(n){return[n==="link"?[s("LinkDropdown",{attrs:{id:e.id,active:e.isActive(n),title:e.buttonTitle(n),editor:e.editor,disabled:e.disabled},on:{submit:e.handleLinkSubmitted,remove:e.handleRemoveLinkClicked}},[s("i",{class:e.getIcon(n),attrs:{"data-test":"link"}})])]:n==="table"?[s("TableDropdown",{attrs:{active:e.isActive(n),disabled:e.disabled,editor:e.editor}},[s("i",{class:e.getIcon(n),attrs:{"data-test":"table"}})])]:[s("Button",{key:n,attrs:{variant:"light",active:e.isActive(n),disabled:e.disabled,title:e.buttonTitle(n),"data-test":n},on:{click:function(i){return e.handleClicked(n)}}},[s("i",{class:e.getIcon(n)}),n==="small"?[s("i",{staticClass:"fas fa-font fa-xs",staticStyle:{"margin-top":".25em"}})]:e._e()],2)]]})],2)]}),e.options&&e.options.length>0?[s("div",{staticClass:"btn-group"},[s("OptionsDropdown",{attrs:{options:e.options,editor:e.editor}})],1)]:e._e(),e.customEmbeds&&e.customEmbeds.length>0?[s("div",{staticClass:"btn-group"},[s("EmbedDropdown",{attrs:{embeds:e.customEmbeds,editor:e.editor}})],1)]:e._e()],2)])},Eu=[],Iu=r(Bu,Ou,Eu,!1,null,null,null,null);const Tu=Iu.exports,Au={inheritAttrs:!1,components:{EditorContent:Pa,MenuBar:Tu,UploadFileInput:lu},props:{id:String,editor:Object,uniqueIdentifier:String,toolbar:Array,minHeight:{type:Number,default:300},maxHeight:Number,readOnly:Boolean,toolbarOptions:Array,embeds:Object,showCharacterCount:Boolean,maxLength:Number},data(){return{firstFocus:!0}},watch:{readOnly(){this.editor.setEditable(!this.readOnly)}},computed:{classes(){return{"editor--disabled":this.readOnly,"editor--no-toolbar":!this.toolbar}},style(){var e;const t=[...new Set((e=this.toolbar)==null?void 0:e.filter(s=>s.startsWith("heading")))].length;return{"--min-height":this.minHeight?`${this.minHeight}px`:null,"--max-height":this.maxHeight?`${this.maxHeight}px`:null,"--heading-depth":t}},hasUpload(){var t;return(t=this.editor.options.extensions)==null?void 0:t.find(e=>e.name===Ne.name)},characterCount(){return this.editor.storage.characterCount.characters()}},methods:{lang:o,validate(){return this.maxLength&&!this.showCharacterCount&&this.characterCount>this.maxLength?o("form.text.validation.maxlength").replace(":maxlength",this.maxLength):null},handleFocus(){this.firstFocus=!1},focus(){const t=this.firstFocus?"end":null;this.editor.commands.focus(t)},handleSelectionUpdated(){const{from:t,to:e}=this.editor.state.selection,s=Math.min(t,e),a=this.editor.view.coordsAtPos(s);if(this.toolbar){const n=this.$refs.header.getBoundingClientRect();a.top<n.bottom&&window.scrollBy(0,a.top-n.bottom-10)}},handleUpdated(){const t=this.validate();this.$emit("update",{editor:this.editor,error:t})}},async mounted(){await this.$nextTick(),this.editor.view.dom.classList.add("card-body","form-control","editor__content"),this.editor.on("focus",this.handleFocus),this.editor.on("selectionUpdate",this.handleSelectionUpdated),this.editor.on("update",E(this.handleUpdated,50)),Ds(this,this.id,()=>this.focus())},directives:{sticky:H}};var Ru=function(){var e=this,s=e._self._c;return s("div",{staticClass:"editor",class:e.classes,style:e.style},[s("div",{staticClass:"card"},[e.editor&&e.toolbar?[s("div",{directives:[{name:"sticky",rawName:"v-sticky"}],ref:"header",staticClass:"card-header editor__header"},[s("MenuBar",{attrs:{id:e.uniqueIdentifier,editor:e.editor,toolbar:e.toolbar,disabled:e.readOnly,options:e.toolbarOptions,embeds:e.embeds}})],1)]:e._e(),s("EditorContent",{attrs:{editor:e.editor}}),e.editor&&!e.readOnly?[e.hasUpload?[s("UploadFileInput",{attrs:{editor:e.editor}})]:e._e()]:e._e(),e.editor&&e.showCharacterCount?[s("div",{staticClass:"card-footer fs-8 text-muted bg-white"},[e.maxLength?[s("span",{class:{"text-danger":e.characterCount>e.maxLength}},[e._v(" "+e._s(e.lang("form.editor.character_count").replace(":count",`${e.characterCount} / ${e.maxLength}`))+" ")])]:[e._v(" "+e._s(e.lang("form.editor.character_count").replace(":count",e.characterCount))+" ")]],2)]:e._e()],2)])},Du=[],Pu=r(Au,Ru,Du,!1,null,null,null,null);const Us=Pu.exports,zu={components:{Modal:F,NodeRenderer:je,Button:_},props:{editor:Object,node:Object,selected:Object,extension:Object,getPos:Function,updateAttributes:Function,deleteNode:Function},data(){return{html:null,previewHtml:null,invalid:!1,modalVisible:this.node.attrs.isNew}},methods:{lang:o,getIframe(t){const e=document.createElement("div");return e.innerHTML=t,e.querySelector("iframe")},handleRemoveClicked(){this.deleteNode()},handleEditClicked(){const t=za(Ma.from(this.node),this.editor.schema);this.html=this.getIframe(t).outerHTML,this.previewHtml=this.html,this.modalVisible=!0,this.invalid=!1},handleChanged(){const t=this.getIframe(this.html);this.invalid=!t,t&&(t.removeAttribute("style"),this.previewHtml=t.outerHTML)},handleInput(){this.handleChanged()},handleModalOk(t){const e=this.getIframe(this.html);e?(this.updateAttributes({...this.node.type.defaultAttrs,...Object.fromEntries([...e.attributes].map(s=>[s.name,s.value])),isNew:!1}),this.modalVisible=!1):t.preventDefault()},handleModalCancel(){this.node.attrs.isNew&&(this.deleteNode(),setTimeout(()=>this.editor.commands.focus()))},handleModalShown(){this.node.attrs.isNew&&this.$refs.textarea.focus()}},created(){this.handleInput=E(this.handleInput,200)}};var Mu=function(){var e=this,s=e._self._c;return s("NodeRenderer",{staticClass:"editor__node d-inline-flex",attrs:{node:e.node}},[e.node.attrs.isNew?e._e():[s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[s("iframe",e._b({},"iframe",e.node.attrs,!1)),s("div",{staticClass:"mt-3"},[s("div",{staticClass:"row row-cols-auto gx-2"},[s("div",[s("Button",{attrs:{outline:"",small:""},on:{click:e.handleEditClicked}},[e._v(" "+e._s(e.lang("form.upload.edit_button"))+" ")])],1),s("div",[s("Button",{attrs:{variant:"danger",outline:"",small:""},on:{click:e.handleRemoveClicked}},[e._v(" "+e._s(e.lang("form.upload.remove_button"))+" ")])],1)])])])])],s("Modal",{ref:"modal",attrs:{visible:e.modalVisible},on:{"update:visible":function(a){e.modalVisible=a},ok:e.handleModalOk,close:e.handleModalCancel,cancel:e.handleModalCancel,shown:e.handleModalShown},scopedSlots:e._u([{key:"title",fn:function(){return[e.node.attrs.isNew?[e._v(" "+e._s(e.lang("form.editor.dialogs.iframe.insert_title"))+" ")]:[e._v(" "+e._s(e.lang("form.editor.dialogs.iframe.update_title"))+" ")]]},proxy:!0}])},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.html,expression:"html"}],ref:"textarea",staticClass:"form-control",class:{"is-invalid":e.invalid},attrs:{placeholder:'<iframe src="..."></iframe>',rows:"6"},domProps:{value:e.html},on:{input:[function(a){a.target.composing||(e.html=a.target.value)},e.handleInput],paste:e.handleChanged,focus:function(a){return a.target.select()}}}),e.previewHtml&&!e.invalid?[s("div",{staticClass:"iframe-node__modal-renderer mt-3",domProps:{innerHTML:e._s(e.previewHtml)}})]:e._e()],2)],2)},ju=[],Nu=r(zu,Mu,ju,!1,null,null,null,null);const Vu=Nu.exports,Hs=Z.create({name:"iframe",group:"block",atom:!0,addOptions:()=>({HTMLAttributes:{class:"iframe-wrapper"}}),addAttributes(){return{src:{default:null},frameborder:{default:0},width:{default:null},height:{default:null},allow:{default:null},allowfullscreen:{default:null},isNew:{default:!1,renderHTML:()=>null}}},parseHTML(){return[{tag:"iframe"}]},renderHTML({HTMLAttributes:t}){return["div",this.options.HTMLAttributes,["iframe",t]]},addPasteRules(){return[new ja({find:/(?:^|\s)(<iframe(.+)<\/iframe>).*/g,handler:({state:t,range:e,match:s})=>{const a=s[1];setTimeout(()=>{this.editor.commands.insertContentAt(e,a)})}})]},addCommands(){return{insertIframe:()=>({commands:t,tr:e})=>t.insertContentAt(e.selection.to,{type:this.name,attrs:{isNew:!0}})}},addNodeView(){return ee(Vu)}}),Uu=te.create({name:"selected",addProseMirrorPlugins(){return[new J({props:{decorations(t){const e=t.selection,s=[];return t.doc.nodesBetween(e.from,e.to,(a,n)=>{a.isBlock&&s.push(Na.node(n,n+a.nodeSize,{class:"selected"}))}),Va.create(t.doc,s)}}})]}});function Ve(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function lt(t,e){const s=At.fromSchema(e),a=Ve(t.outerHTML);return s.parseSlice(a).content}function Hu(t,e){const s=Ve(t);return qs(s,e)}function qs(t,e){return[...t.children].forEach(s=>{var n;if(s.hasAttribute("data-html-content")&&s.children.length===1){(n=lt(s.firstElementChild,e).firstChild)!=null&&n.type.name.startsWith("embed:")&&s.parentElement.replaceChild(s.firstElementChild,s);return}if(!lt(s,e).size){const i=document.createElement("div");i.setAttribute("data-html-content","true"),s.parentElement.replaceChild(i,s),i.appendChild(s)}}),t.innerHTML}const qu={components:{NodeViewWrapper:Tt,Button:_,Modal:F},props:{node:Object,editor:Object,updateAttributes:Function,selected:Boolean,deleteNode:Function},data(){return{editContent:null,editVisible:this.node.attrs.new}},methods:{lang:o,handleEditClicked(){this.editContent=this.node.attrs.content,this.$refs.modal.show()},handleModalOk(){const t=Ve(this.editContent).innerHTML;this.updateAttributes({content:t,new:!1})},handleModalShown(t){t.target.querySelector("textarea").focus()},handleModalHidden(){this.node.attrs.content||this.deleteNode(),setTimeout(()=>{this.editor.commands.focus()})}}};var Ku=function(){var e=this,s=e._self._c;return s("NodeViewWrapper",[s("div",{staticClass:"card editor__node html-node",class:{"shadow border-primary":e.selected}},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col",staticStyle:{"min-width":"0"}},[s("pre",{staticClass:"mb-0"},[e._v(e._s(e.node.attrs.content))])]),s("div",{staticClass:"col-auto me-n2 my-n2"},[s("Button",{attrs:{small:"",variant:"light"},on:{click:e.handleEditClicked}},[s("i",{staticClass:"fas fa-pencil-alt fs-7"})])],1)])])]),s("Modal",{ref:"modal",attrs:{visible:e.editVisible},on:{"update:visible":function(a){e.editVisible=a},ok:e.handleModalOk,hidden:e.handleModalHidden,shown:e.handleModalShown},scopedSlots:e._u([{key:"title",fn:function(){return[e.node.attrs.new?[e._v(" "+e._s(e.lang("form.editor.dialogs.raw_html.insert_title"))+" ")]:[e._v(" "+e._s(e.lang("form.editor.dialogs.raw_html.edit_title"))+" ")]]},proxy:!0}])},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.editContent,expression:"editContent"}],staticClass:"form-control",attrs:{rows:"6"},domProps:{value:e.editContent},on:{input:function(a){a.target.composing||(e.editContent=a.target.value)}}})])],1)},Gu=[],Wu=r(qu,Ku,Gu,!1,null,null,null,null);const Qu=Wu.exports,Yu=Z.create({name:"html-content",group:"block",onBeforeCreate(){this.editor.storage.markdown||this.editor.setOptions({content:Hu(this.editor.options.content,this.editor.schema)})},addStorage(){return{markdown:{parse:{updateDOM(t){qs(t,this.editor.schema)}}}}},addAttributes(){return{content:{default:"",parseHTML(t){return t.innerHTML.trim()}},new:{default:!1}}},renderHTML({node:t}){const e=document.createElement("div");return e.setAttribute("data-html-content","true"),e.innerHTML=t.attrs.content,e},parseHTML(){return[{tag:"[data-html-content]"}]},addCommands(){return{insertHtml:()=>({commands:t})=>t.insertContent({type:this.name,attrs:{new:!0}})}},addNodeView(){return ee(Qu)}});function ot({types:t,node:e}){return Array.isArray(t)&&t.includes(e.type)||e.type===t}const Xu=te.create({name:"trailingNode",addOptions:()=>({node:"paragraph",notAfter:["paragraph"]}),addProseMirrorPlugins(){const t=new Ua(this.name),e=Object.entries(this.editor.schema.nodes).map(([,s])=>s).filter(s=>this.options.notAfter.includes(s.name));return[new J({key:t,appendTransaction:(s,a,n)=>{const{doc:i,tr:l,schema:d}=n,u=t.getState(n),c=i.content.size,p=d.nodes[this.options.node];if(u)return l.insert(c,p.create())},state:{init:(s,a)=>{const n=a.tr.doc.lastChild;return!ot({node:n,types:e})},apply:(s,a)=>{if(!s.docChanged)return a;const n=s.doc.lastChild;return!ot({node:n,types:e})}}})]}}),Ju=te.create({name:"paste",addOptions:()=>({schema:null,inline:!1}),addProseMirrorPlugins(){const t=Zu(this.options.schema,this.editor.schema),e=At.fromSchema(t);return[new J({props:{clipboardParser:e,clipboardTextParser:(s,a)=>{if(this.options.inline){const n=document.createElement("div");return n.innerHTML=s.trim().replace(/(\r\n?|\n)/g,"<br>"),e.parseSlice(n,{preserveWhitespace:!0,context:a})}return null},transformPastedHTML:s=>this.options.inline?s.replace(/<\/p>\s*<p[^>]*>/g,"<br><br>").replace(/<p[^>]*>/g,"").replace(/<\/p>/g,""):s}})]}});function Zu(t,e){const s=new Ha(t.spec);return s.nodes=Object.fromEntries(Object.entries(e.nodes).filter(([a])=>!!t.nodes[a])),s.marks=Object.fromEntries(Object.entries(e.marks).filter(([a])=>!!t.marks[a])),s}const eh=qa.create({name:"small",parseHTML(){return[{tag:"small"}]},renderHTML({HTMLAttributes:t}){return["small",Ka(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleSmall:()=>({commands:t})=>t.toggleMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleSmall()}}});function th(t){return t.map(e=>e.match(/^heading-(\d)$/)).filter(e=>!!e).map(e=>Number(e[1]))}function S(t,e){return!t||t.some(s=>s===e)}function sh({fieldProps:t,uniqueIdentifier:e,fieldConfigIdentifier:s,form:a}){const n=m.observable({registeredFiles:[],created:!1,resolved:null,onResolve:null});n.resolved=new Promise(c=>n.onResolve=c);const i=c=>{this.$emit("input",{...this.value,files:c})},l=c=>Me({entityKey:a.entityKey,instanceId:a.instanceId,files:c,thumbnailWidth:xs,thumbnailHeight:Fs}),d={onBeforeCreate:()=>{i([])},onCreate:E(async()=>{if(n.registeredFiles.length>0){const c=await l(n.registeredFiles);i(c),n.onResolve()}n.created=!0,n.registeredFiles=[]})},u={fieldProps:{...t,uniqueIdentifier:e,fieldConfigIdentifier:s},state:n,registerFile:async c=>n.created?(i([...this.value.files,c]),c):(n.registeredFiles.push(c),await n.resolved,this.value.files.find(p=>W(c,p))),onSuccess:c=>{i([...this.value.files,c])},onRemove:c=>{i(this.value.files.filter(p=>!W(p,c)))},onUpdate:c=>{i(this.value.files.map(p=>W(p,c)?c:p))}};return Ne.extend(d).configure(u)}function ah(t){if(!t)return Xe;const e=th(t);if(e.length>0)return Xe.configure({levels:e})}function nh(t){if(S(t,"link"))return Rt.configure({openOnClick:!1,HTMLAttributes:{rel:null,target:null}})}function ih(t){return Xa.configure({HTMLAttributes:{class:"editor__image"}})}function rh(t){if(S(t,"horizontal-rule"))return Ja.extend({selectable:!1})}function lh(t){if(S(t,"table"))return[Za,en,tn,sn]}function oh(t){if(t)return Ga.configure({placeholder:t})}function dh(t){if(S(t,"iframe"))return Hs}function ch(t){if(S(t,"highlight"))return an}function uh(t){if(S(t,"small"))return eh}function hh(t){if(S(t,"code-block"))return nn}function mh(t){if(S(t,"superscript"))return rn}function ph({toolbar:t,inline:e}){const s=Ks({toolbar:t??[],inline:e}),a=Wa(s);return Ju.configure({schema:a,inline:e})}function fh({inline:t}){return ln.extend({addKeyboardShortcuts(){return t?{Enter:()=>this.editor.commands.setHardBreak(),...this.parent()}:this.parent()}})}function _h(){return Qa}function gh({inline:t}){if(!t)return Xu}function vh(){return te.create({addExtensions(){return[Ya.configure()]}})}function bh(t){const e=S(t,"bullet-list"),s=S(t,"ordered-list"),a=on.configure({blockquote:S(t,"blockquote"),bold:S(t,"bold"),bulletList:e,code:S(t,"code"),codeBlock:!1,document:!0,dropcursor:!0,gapcursor:!0,hardBreak:!1,heading:!1,history:!0,horizontalRule:!1,italic:S(t,"italic"),listItem:e||s,orderedList:s,paragraph:!0,strike:!1,text:!0});return dn(a,"addExtensions",a)()}function Ks({toolbar:t,inline:e}){return[bh(t),ah(t),nh(t),ih(),rh(t),lh(t),ch(t),uh(t),dh(t),hh(t),mh(t),fh({inline:e})].flat().filter(a=>!!a)}function yh({placeholder:t,toolbar:e,inline:s}={}){return[Ks({toolbar:e,inline:s}),ph({toolbar:e,inline:s}),oh(t),gh({inline:s}),vh(),_h(),Yu,Uu].flat().filter(n=>!!n)}const Gs={injectCSS:!1,enableInputRules:!1,enablePasteRules:[Hs,Rt]},Ue={id:String,value:{type:Object,default:()=>({})},markdown:Boolean,locale:String,localized:Boolean,placeholder:String,toolbar:Array,minHeight:Number,maxHeight:Number,embeds:Object,inline:Boolean,uniqueIdentifier:String,fieldConfigIdentifier:String,showCharacterCount:Boolean,maxLength:Number},Ws={mixins:[Pe],computed:{localizedText(){var t,e,s;return this.isLocalized?((e=(t=this.value)==null?void 0:t.text)==null?void 0:e[this.locale])??null:((s=this.value)==null?void 0:s.text)??null}},methods:{localizedValue(t,e){var s;return{...this.value,text:this.isLocalized?ps({localeObject:(s=this.value)==null?void 0:s.text,locale:e,value:t}):t}}}};function Ch(t,{inline:e}){return e?t.replace(/<\/?p>/g,""):t.replace(/(<p>\s*<\/p>)+$/,"")}function $h(t){const e=document.createElement("div");return e.innerHTML=t,wh(e),Sh(e),e.innerHTML}function wh(t){Qs(t).forEach(e=>{var s,a,n;if((a=(s=e.previousElementSibling)==null?void 0:s.matches)!=null&&a.call(s,"div")){const i=e.previousElementSibling,l=i.childNodes[i.childNodes.length-1];(n=l==null?void 0:l.matches)!=null&&n.call(l,"br")||(e.innerHTML=`${i.innerHTML}<br>${e.innerHTML}`,i.remove())}})}function Sh(t){Qs(t).forEach(e=>{if(kh(e),e.childNodes.length){const s=document.createElement("p");s.innerHTML=e.innerHTML,t.replaceChild(s,e)}else e.remove()})}function Qs(t){return[...t.children].filter(e=>e.matches("div")&&!e.attributes.length)}function kh(t){[...t.childNodes].reverse().slice(0,2).filter(e=>{var s;return(s=e.matches)==null?void 0:s.call(e,"br")}).forEach(e=>{e.nextSibling||e.remove()})}const xh={props:{editor:Object,name:String,value:Object,locales:Array,locale:String,createEditor:Function},data(){return{localizedEditors:{}}},methods:{isActive(t){return this.locale===t}},created(){!this.editor&&this.locales&&(this.localizedEditors=Object.fromEntries(this.locales.map(t=>{var e,s;return[t,this.createEditor({content:((s=(e=this.value)==null?void 0:e.text)==null?void 0:s[t])??null})]})))},beforeDestroy(){Object.values(this.localizedEditors).forEach(t=>{t.destroy()})}};var Fh=function(){var e=this,s=e._self._c;return s("div",[e.editor?[e._t("default",null,{editor:e.editor}),s("input",{attrs:{type:"hidden",name:e.name},domProps:{value:e.value&&e.value.text}})]:[e._l(e.locales,function(a){return[s("div",{directives:[{name:"show",rawName:"v-show",value:e.isActive(a),expression:"isActive(locale)"}],key:a},[e._t("default",null,{editor:e.localizedEditors[a],locale:a})],2)]})]],2)},Lh=[],Bh=r(xh,Fh,Lh,!1,null,null,null,null);const Ys=Bh.exports,Oh={mixins:[Ws],components:{SharpEditor:Us,LocalizedEditors:Ys},props:{...Ue,extensions:Array,readOnly:Boolean,uniqueIdentifier:String},data(){return{editor:null}},methods:{handleUpdate({editor:t,locale:e,error:s}){const a=ie(Ch(t.getHTML(),{inline:this.inline}));this.$emit("input",this.localizedValue(a,e),{error:s})},createEditor({content:t}){return new Dt({...Gs,extensions:this.extensions,content:$h(t),editable:!this.readOnly})}},created(){this.isLocalized||(this.editor=this.createEditor({content:this.localizedText}))},beforeDestroy(){var t;(t=this.editor)==null||t.destroy()}};var Eh=function(){var e=this,s=e._self._c;return s("div",[s("LocalizedEditors",{attrs:{editor:e.editor,name:e.uniqueIdentifier,value:e.value,locale:e.locale,locales:e.locales,"create-editor":e.createEditor},scopedSlots:e._u([{key:"default",fn:function({editor:a,locale:n}){return[s("SharpEditor",e._b({attrs:{editor:a},on:{update:function(i){return e.handleUpdate({editor:a,locale:n,...i})}}},"SharpEditor",e.$props,!1))]}}])})],1)},Ih=[],Th=r(Oh,Eh,Ih,!1,null,null,null,null);const Ah=Th.exports,Rh={mixins:[Ws],components:{SharpEditor:Us,LocalizedEditors:Ys},props:{...Ue,extensions:Array,toolbar:Array,nl2br:Boolean,tightListsOnly:Boolean,readOnly:Boolean,uniqueIdentifier:String},data(){return{editor:null}},methods:{handleUpdate({editor:t,locale:e,error:s}){const a=ie(t.storage.markdown.getMarkdown()??"");this.$emit("input",this.localizedValue(a,e),{error:s})},toolbarOptions(t){var a;const e=[],s=(a=this.toolbar)==null?void 0:a.some(n=>n==="bullet-list"||n==="ordered-list");return!this.tightListsOnly&&s&&e.push({command:()=>t.chain().toggleTight().run(),disabled:!t.can().toggleTight(),label:o("form.editor.dropdown.options.toggle_tight_list")}),e},createEditor({content:t}){return new Dt({...Gs,extensions:[...this.extensions,cn.configure({breaks:this.nl2br})],content:t,editable:!this.readOnly})}},created(){this.isLocalized||(this.editor=this.createEditor({content:this.localizedText}))},beforeDestroy(){var t;(t=this.editor)==null||t.destroy()}};var Dh=function(){var e=this,s=e._self._c;return s("div",[s("LocalizedEditors",{attrs:{editor:e.editor,name:e.uniqueIdentifier,value:e.value,locale:e.locale,locales:e.locales,"create-editor":e.createEditor},scopedSlots:e._u([{key:"default",fn:function({editor:a,locale:n}){return[s("SharpEditor",e._b({attrs:{editor:a,"toolbar-options":e.toolbarOptions(a)},on:{update:function(i){return e.handleUpdate({editor:a,locale:n,...i})}}},"SharpEditor",e.$props,!1))]}}])})],1)},Ph=[],zh=r(Rh,Dh,Ph,!1,null,null,null,null);const Mh=zh.exports;function Xs({entityKey:t,instanceId:e,embedKey:s,embeds:a,form:n=!1}){return v.post(`/embeds/${s}/${t}/${e??""}`,{embeds:a,form:n}).then(i=>i.data.embeds)}function jh({entityKey:t,instanceId:e,embedKey:s,attributes:a}){return v.post(`/embeds/${s}/${t}${e?`/${e}`:""}/form/init`,{...a}).then(n=>n.data)}function Nh({entityKey:t,instanceId:e,embedKey:s,data:a}){return v.post(`/embeds/${s}/${t}${e?`/${e}`:""}/form`,{...a}).then(n=>n.data)}function Js(t){try{return JSON.parse(t)}catch{return t}}function Vh(t){return t&&typeof t=="object"?JSON.stringify(t):t}const Uh={components:{TemplateRenderer:z},props:{data:Object,options:Object},computed:{templateData(){const{slot:t,...e}=this.data;return e},templateProps(){return this.options.attributes.filter(t=>t!=="slot")}}};var Hh=function(){var e=this,s=e._self._c;return s("TemplateRenderer",{attrs:{name:"Embed","template-data":e.templateData,"template-props":e.templateProps,template:e.options.template}},[e._t("default",function(){return[e.data.slot?[s("div",{domProps:{innerHTML:e._s(e.data.slot)}})]:e._e()]})],2)},qh=[],Kh=r(Uh,Hh,qh,!1,null,null,null,null);const Zs=Kh.exports,Gh={components:{Dropdown:$,DropdownItem:x},props:{locale:String,locales:Array},methods:{handleChanged(t){this.$emit("change",t)},isActive(t){return this.locale===t}}};var Wh=function(){var e=this,s=e._self._c;return s("Dropdown",e._b({staticClass:"SharpForm__locale-dropdown",attrs:{"toggle-class":"d-flex align-items-center"},scopedSlots:e._u([{key:"text",fn:function(){return[s("svg",{staticClass:"d-block me-2",attrs:{width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"}},[s("path",{attrs:{d:"M7.75 2.75a.75.75 0 00-1.5 0v1.258a32.987 32.987 0 00-3.599.278.75.75 0 10.198 1.487A31.545 31.545 0 018.7 5.545 19.381 19.381 0 017 9.56a19.418 19.418 0 01-1.002-2.05.75.75 0 00-1.384.577 20.935 20.935 0 001.492 2.91 19.613 19.613 0 01-3.828 4.154.75.75 0 10.945 1.164A21.116 21.116 0 007 12.331c.095.132.192.262.29.391a.75.75 0 001.194-.91c-.204-.266-.4-.538-.59-.815a20.888 20.888 0 002.333-5.332c.31.031.618.068.924.108a.75.75 0 00.198-1.487 32.832 32.832 0 00-3.599-.278V2.75z"}}),s("path",{attrs:{"fill-rule":"evenodd",d:"M13 8a.75.75 0 01.671.415l4.25 8.5a.75.75 0 11-1.342.67L15.787 16h-5.573l-.793 1.585a.75.75 0 11-1.342-.67l4.25-8.5A.75.75 0 0113 8zm2.037 6.5L13 10.427 10.964 14.5h4.073z","clip-rule":"evenodd"}})]),e.locale?[s("span",{staticClass:"text-uppercase"},[e._v(e._s(e.locale))])]:[e._v("-")]]},proxy:!0}])},"Dropdown",e.$attrs,!1),[e._l(e.locales,function(a){return[s("DropdownItem",{key:a,staticClass:"text-uppercase small",attrs:{active:e.isActive(a)},on:{click:function(n){return e.handleChanged(a)}}},[e._v(" "+e._s(a)+" ")])]})],2)},Qh=[],Yh=r(Gh,Wh,Qh,!1,null,null,null,null);const le=Yh.exports,Xh={components:{Button:_},props:{showSubmitButton:Boolean,showDeleteButton:Boolean,showBackButton:Boolean,create:Boolean,uploading:Boolean,loading:Boolean,breadcrumb:Array,showBreadcrumb:Boolean,hasDeleteConfirmation:Boolean},data(){return{stuck:!1}},methods:{lang:o,handleCancelClicked(){this.$emit("cancel")},handleSubmitClicked(){this.$emit("submit")},handleDeleteClicked(){this.$emit("delete")}},directives:{sticky:H}};var Jh=function(){var e=this,s=e._self._c;return s("div",{directives:[{name:"sticky",rawName:"v-sticky"}],staticClass:"position-sticky bottom-0 px-4 py-3 bg-white border-top",class:{shadow:e.stuck},staticStyle:{"z-index":"100",transition:"box-shadow .25s ease-in-out"},on:{"stuck-change":function(a){e.stuck=a.detail}}},[s("div",{staticClass:"row justify-content-end align-items-center gx-3"},[s("div",{staticClass:"col"},[e._t("left")],2),s("div",{staticClass:"col-auto"},[s("Button",{attrs:{outline:""},on:{click:e.handleCancelClicked}},[e.showBackButton?[e._v(" "+e._s(e.lang("action_bar.form.back_button"))+" ")]:[e._v(" "+e._s(e.lang("action_bar.form.cancel_button"))+" ")]],2)],1),e.showSubmitButton?[s("div",{staticClass:"col-auto"},[s("Button",{staticStyle:{"min-width":"6.5em"},attrs:{disabled:e.uploading||e.loading},on:{click:e.handleSubmitClicked}},[e.uploading?[e._v(" "+e._s(e.lang("action_bar.form.submit_button.pending.upload"))+" ")]:e.create?[e._v(" "+e._s(e.lang("action_bar.form.submit_button.create"))+" ")]:[e._v(" "+e._s(e.lang("action_bar.form.submit_button.update"))+" ")]],2)],1)]:e._e()],2)])},Zh=[],em=r(Xh,Jh,Zh,!1,null,null,null,null);const tm=em.exports,dt=Symbol("isLocal"),sm={name:"SharpForm",extends:ds,mixins:[y,Rs("fields")],components:{BottomBar:tm,Button:_,TabbedLayout:Rl,FieldsLayout:As,Grid:R,Dropdown:$,DropdownItem:x,LocaleSelect:le,GlobalMessage:ae},props:{entityKey:String,instanceId:[Number,String],independant:Boolean,ignoreAuthorizations:Boolean,noTabs:Boolean,showAlert:{type:Boolean,default:!0},form:Object},provide(){return{$form:this}},data(){return{ready:!1,fields:null,authorizations:null,breadcrumb:null,config:null,errors:{},fieldLocale:{},locales:null,loading:!1,fieldVisible:{},uploadingFields:{},curFieldsetId:0}},watch:{form(){this.independant&&this.init()}},computed:{apiPath(){let t=`form/${this.entityKey}`;return this.instanceId&&(t+=`/${this.instanceId}`),t},localized(){return Array.isArray(this.locales)&&!!this.locales.length},isSingle(){return this.config?this.config.isSingle:!1},isCreation(){return!this.isSingle&&!this.instanceId},isReadOnly(){return this.ignoreAuthorizations?!1:this.isCreation?!this.authorizations.create:!this.authorizations.update},synchronous(){return this.independant},hasErrors(){return Object.values(this.errors).some(t=>!!t&&!t[dt])},baseEntityKey(){return this.entityKey.split(":")[0]},downloadLinkBase(){return`/download/${this.entityKey}/${this.instanceId}`},transformedFields(){return ys(this.fields,this.data)},currentLocale(){var s;const t=Object.values(this.fieldLocale).map(a=>Array.isArray(a)?a.map(n=>Object.values(n)):a).flat(2),e=[...new Set(t)];return e.length?e.length===1?e[0]:null:(s=this.locales)==null?void 0:s[0]},isUploading(){return Object.values(this.uploadingFields).some(t=>!!t)},actionBarProps(){var t,e;return this.ready?{showSubmitButton:this.isCreation?!!this.authorizations.create:!!this.authorizations.update,showBackButton:this.isReadOnly,create:!!this.isCreation,uploading:this.isUploading,loading:this.loading,breadcrumb:(t=this.breadcrumb)==null?void 0:t.items,showBreadcrumb:!!((e=this.breadcrumb)!=null&&e.visible),locales:this.locales,currentLocale:this.currentLocale}:null},actionBarListeners(){return{submit:this.handleSubmitClicked,cancel:this.handleCancelClicked,"locale-change":this.handleLocaleChanged}},mergedErrorIdentifier(){return null},mergedConfigIdentifier(){return null}},methods:{async updateData(t,e,{forced:s}={}){this.data={...this.data,...s?null:vs(this.fields,t,a=>this.fieldLocalizedValue(a.key,null)),[t]:this.fieldLocalizedValue(t,e)}},updateVisibility(t,e){this.$set(this.fieldVisible,t,e)},updateLocale(t,e){this.$set(this.fieldLocale,t,e)},updateFieldError(t,e){e&&(e[dt]=!0),this.errors={...this.errors,[t]:e}},handleLocaleChanged(t){this.fieldLocale=this.defaultFieldLocaleMap({fields:this.fields,locales:this.locales},t)},mount({fields:t,layout:e,data:s,authorizations:a,locales:n,breadcrumb:i,config:l}){this.fields=t,this.data=s??{},this.layout=this.patchLayout(e),this.locales=n,this.authorizations=a??{},this.breadcrumb=i,this.config=l??{},t&&(this.fieldVisible=Object.keys(this.fields).reduce((d,u)=>(d[u]=!0,d),{}),this.fieldLocale=this.defaultFieldLocaleMap({fields:t,locales:n})),this.validate()},validate(){const t=Object.keys(this.fieldLocale),e=s=>D(s,{title:"Data error",isError:!0});t.length>0&&!this.locales.length&&e("Some fields are localized but the form hasn't any locales configured")},handleError(t){var e;return((e=t.response)==null?void 0:e.status)===422&&(this.errors=t.response.data.errors||{}),Promise.reject(t)},patchLayout(t){if(!t)return null;this.noTabs&&(t={tabs:[{columns:[{fields:t}]}]});let e=0;const s=a=>{a.legend?a.id=`${e++}#${a.legend}`:a.fields&&a.fields.forEach(n=>{n.forEach(s)})};return t.tabs.forEach(a=>a.columns.forEach(s)),t},serialize(t=this.data){return Object.fromEntries(Object.entries(t??{}).filter(([e])=>{var s;return((s=this.fields[e])==null?void 0:s.type)!=="html"}))},setLoading(t){this.$emit("loading",t),this.loading=t},get(){return this.axiosInstance.get(this.apiPath,{params:this.apiParams}).then(t=>(this.mount(t.data),this.$emit("update:form",t.data),t)).catch(t=>(this.$emit("error",t),Promise.reject(t)))},async init(){this.independant?(this.mount(this.form),this.ready=!0):this.entityKey?(await this.get(),this.ready=!0):b("no entity key provided")},redirectForResponse(t,{replace:e}={}){const s=t.data.redirectUrl;e?location.replace(s):location.href=s},redirectToParentPage(){location.href=es(this.breadcrumb.items)},async submit({postFn:t}={}){if(this.isUploading)return;this.setLoading(!0);const e=this.serialize(),a=await(()=>t?t(e):this.post(this.apiPath,e))().catch(this.handleError).finally(()=>{this.setLoading(!1)});if(this.independant)return this.$emit("submit",a),a;this.setLoading(!0),this.$store.dispatch("setLoading",!0),this.redirectForResponse(a)},handleSubmitClicked(){this.submit().catch(()=>{})},handleCancelClicked(){this.redirectToParentPage()},setUploading(t,e){this.uploadingFields={...this.uploadingFields,[t]:e}},hasUploadingFields(t){return Object.entries(this.uploadingFields).some(([e,s])=>e.startsWith(`${t}.`)&&s)}},created(){this.init()}};var am=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpForm"},[e._t("action-bar",null,{props:e.actionBarProps,listeners:e.actionBarListeners}),e.ready?[e.config.globalMessage?[s("GlobalMessage",{attrs:{options:e.config.globalMessage,data:e.data,fields:e.fields}})]:e._e(),e.hasErrors&&e.showAlert?[s("div",{staticClass:"alert alert-danger SharpForm__alert",attrs:{role:"alert"}},[s("div",{staticClass:"fw-bold"},[e._v(e._s(e.l("form.validation_error.title")))]),s("div",[e._v(e._s(e.l("form.validation_error.description")))])])]:e._e(),s("TabbedLayout",{ref:"tabbedLayout",attrs:{layout:e.layout,"data-popover-boundary":""},scopedSlots:e._u([{key:"default",fn:function({tab:a}){return[s("Grid",{ref:"columnsGrid",attrs:{rows:[a.columns]},scopedSlots:e._u([{key:"default",fn:function({itemLayout:n}){return[s("FieldsLayout",{ref:"fieldLayout",attrs:{layout:n.fields,visible:e.fieldVisible},scopedSlots:e._u([{key:"default",fn:function({fieldLayout:i}){return[s("FieldDisplay",{ref:"field",attrs:{"field-key":i.key,"context-fields":e.transformedFields,"context-data":e.data,"field-layout":i,locale:e.fieldLocale[i.key],"read-only":e.isReadOnly,"error-identifier":i.key,"config-identifier":i.key,root:"","update-data":e.updateData,"update-visibility":e.updateVisibility},on:{"locale-change":e.updateLocale}})]}}],null,!0)})]}}],null,!0)})]}}],null,!1,477242088)}),e.independant?e._e():[s("BottomBar",e._g(e._b({},"BottomBar",e.actionBarProps,!1),e.actionBarListeners))]]:e._e()],2)},nm=[],im=r(sm,am,nm,!1,null,null,null,null);const He=im.exports,rm={components:{Modal:F,Form:He},inject:{$form:{default:null}},props:{visible:Boolean,form:Object,post:Function},data(){return{loading:!1}},methods:{handleSubmitButtonClicked(t){t.preventDefault(),this.loading=!0,this.$refs.form.submit({postFn:this.post}).finally(()=>{this.loading=!1})},handleCancelClicked(){this.$emit("cancel")}}};var lm=function(){var e=this,s=e._self._c;return s("Modal",e._g({attrs:{"modal-class":"form-modal",visible:e.visible,loading:e.loading},on:{ok:e.handleSubmitButtonClicked,close:e.handleCancelClicked,cancel:e.handleCancelClicked},scopedSlots:e._u([{key:"title",fn:function(){return[e._t("title")]},proxy:!0}],null,!0)},e.$listeners),[s("transition",[e.visible?[s("Form",{ref:"form",staticStyle:{"transition-duration":"300ms"},attrs:{"entity-key":e.$form.entityKey,"instance-id":e.$form.instanceId,form:e.form,"show-alert":!1,independant:"","ignore-authorizations":"","no-tabs":""}})]:e._e()],2)],1)},om=[],dm=r(rm,lm,om,!1,null,null,null,null);const cm=dm.exports,um={components:{EmbedFormModal:cm,NodeRenderer:je,EmbedRenderer:Zs,Button:_},inject:["$form"],props:{editor:Object,node:Object,selected:Object,extension:Object,getPos:Function,updateAttributes:Function,deleteNode:Function},data(){return{id:null,modalVisible:!1,modalForm:null}},computed:{embedData(){return{...this.node.attrs.attributes,...this.node.attrs.additionalData}},hasForm(){return this.extension.options.attributes.length>0}},methods:{lang:o,handleEditClicked(){this.showForm()},handleCancelClicked(){this.node.attrs.isNew&&(this.deleteNode(),setTimeout(()=>{this.editor.commands.focus()},0))},handleRemoveClicked(){this.deleteNode()},async showForm(){this.modalForm=await this.extension.options.resolveForm(this.embedData),this.modalVisible=!0},async postForm(t){const e=await this.extension.options.postForm(t);this.updateAttributes({attributes:e,additionalData:e,isNew:!1}),this.modalVisible=!1},async init(){if(this.node.attrs.isNew){this.hasForm?await this.showForm():(await this.$nextTick(),this.updateAttributes({isNew:!1}),this.editor.commands.focus());return}if(this.hasForm){const t=await this.extension.options.getAdditionalData(this.node.attrs.attributes);t&&this.updateAttributes({additionalData:t})}}},created(){this.init()}};var hm=function(){var e=this,s=e._self._c;return s("NodeRenderer",{staticClass:"editor__node embed-node",attrs:{node:e.node}},[e.node.attrs.isNew?e._e():[s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[s("EmbedRenderer",{staticClass:"embed-node__template",attrs:{data:e.embedData,options:e.extension.options}}),s("div",{staticClass:"mt-3"},[s("div",{staticClass:"row row-cols-auto gx-2"},[e.hasForm?[s("div",[s("Button",{attrs:{outline:"",small:""},on:{click:e.handleEditClicked}},[e._v(" "+e._s(e.lang("form.upload.edit_button"))+" ")])],1)]:e._e(),s("div",[s("Button",{attrs:{variant:"danger",outline:"",small:""},on:{click:e.handleRemoveClicked}},[e._v(" "+e._s(e.lang("form.upload.remove_button"))+" ")])],1)],2)])],1)])],s("EmbedFormModal",{attrs:{visible:e.modalVisible,form:e.modalForm,post:e.postForm},on:{"update:visible":function(a){e.modalVisible=a},cancel:e.handleCancelClicked},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.extension.options.label)+" ")]},proxy:!0}])})],2)},mm=[],pm=r(um,hm,mm,!1,null,null,null,null);const fm=pm.exports;function ct(t){return t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,(e,s)=>(s?"-":"")+e.toLowerCase())}const _m=Z.create({name:"embed",group:"block",atom:!0,isolating:!0,priority:150,addOptions:()=>({label:null,tag:null,attributes:[],template:null}),addAttributes(){return{attributes:{default:{},parseHTML:t=>{const e=this.options.attributes.reduce((s,a)=>({...s,[a]:Js(t.getAttribute(ct(a)))}),{});return this.options.attributes.includes("slot")&&(e.slot=t.innerHTML),e},renderHTML:t=>this.options.attributes.filter(e=>t.attributes[e]!=null).reduce((e,s)=>({...e,[ct(s)]:Vh(t.attributes[s])}),{})},additionalData:{default:null,renderHTML:()=>null},isNew:{default:!1,renderHTML:()=>null}}},parseHTML(){return[{tag:this.options.tag}]},renderHTML({node:t,HTMLAttributes:e}){const s=document.createElement(this.options.tag);return Object.entries(e).filter(([a])=>a!=="slot").forEach(([a,n])=>{s.setAttribute(a,n)}),e.slot&&(s.innerHTML=e.slot),s},addCommands(){return{insertEmbed:({embedKey:t})=>({commands:e,tr:s})=>e.insertContentAt(s.selection.to,{type:`embed:${t}`,attrs:{isNew:!0}})}},addNodeView(){return ee(fm)}});function gm({embedKey:t,embedOptions:e,form:s}){const a=m.observable({embeds:[],currentIndex:0,created:!1,resolved:null,onResolve:null});a.resolved=new Promise(d=>a.onResolve=d);const n=d=>Xs({entityKey:s.entityKey,instanceId:s.instanceId,embedKey:t,embeds:d,form:!0}),i={name:`embed:${t}`,onCreate:E(async()=>{a.currentIndex>0&&(a.embeds=await n(a.embeds),a.onResolve()),a.created=!0})},l={label:e.label,tag:e.tag,attributes:e.attributes??[],template:e.template,state:a,isReady:()=>a.created,getEmbed:d=>a.embeds[d],async getAdditionalData(d){if(a.created)return null;const u=a.currentIndex++;return a.embeds.push(d),await a.resolved,a.embeds[u]},onUpdate:(d,u)=>{a.embeds={...a.embeds,[d]:u}},onRemove:d=>{const{[d]:u,...c}=a.embeds;a.embeds=c},resolveForm(d){return jh({entityKey:s.entityKey,instanceId:s.instanceId,embedKey:t,attributes:d})},postForm(d){return Nh({entityKey:s.entityKey,instanceId:s.instanceId,embedKey:t,data:d})}};return _m.extend(i).configure(l)}const vm={components:{HtmlContentEditor:Ah,MarkdownContentEditor:Mh},inject:["$form"],props:{...Ue},computed:{extensions(){return[...yh({placeholder:this.placeholder,toolbar:this.toolbar,inline:this.inline}),...this.embedExtensions,this.uploadExtension].filter(e=>!!e)},uploadExtension(){var t;return(t=this.embeds)!=null&&t.upload?sh.call(this,{fieldProps:this.embeds.upload,uniqueIdentifier:this.uniqueIdentifier,fieldConfigIdentifier:this.fieldConfigIdentifier,form:this.$form}):null},embedExtensions(){const{upload:t,...e}=this.embeds??{};return Object.entries(e).map(([s,a])=>gm({embedKey:s,embedOptions:a,form:this.$form}))}}};var bm=function(){var e=this,s=e._self._c;return s("div",[e.markdown?[s("MarkdownContentEditor",e._g(e._b({attrs:{extensions:e.extensions}},"MarkdownContentEditor",[e.$props,e.$attrs],!1),e.$listeners))]:[s("HtmlContentEditor",e._g(e._b({attrs:{extensions:e.extensions}},"HtmlContentEditor",[e.$props,e.$attrs],!1),e.$listeners))]],2)},ym=[],Cm=r(vm,bm,ym,!1,null,null,null,null);const $m=Cm.exports,wm={components:{DatePicker:Is,ClearButton:se},props:{value:{default:()=>({start:null,end:null})},displayFormat:{type:String,default:"DD/MM/YYYY"},startPlaceholder:{type:String,default:()=>o("form.daterange.start_placeholder")},endPlaceholder:{type:String,default:()=>o("form.daterange.end_placeholder")},clearable:{type:Boolean,default:!0},readOnly:Boolean,mondayFirst:Boolean,small:Boolean,updateOnInput:{type:Boolean,default:!0}},computed:{hasClearButton(){var t,e;return this.clearable&&!!((t=this.value)!=null&&t.start)&&!!((e=this.value)!=null&&e.end)}},methods:{handleChanged(t){var e,s,a,n,i,l;((e=t==null?void 0:t.start)==null?void 0:e.toDateString())===((a=(s=this.oldValue)==null?void 0:s.start)==null?void 0:a.toDateString())&&((n=t==null?void 0:t.end)==null?void 0:n.toDateString())===((l=(i=this.oldValue)==null?void 0:i.end)==null?void 0:l.toDateString())||(this.$emit("input",t),this.oldValue=t)},handleClearClicked(){this.$emit("input",null)},focus(){setTimeout(()=>{this.$el.querySelector(".form-control").focus()})}}};var Sm=function(){var e=this,s=e._self._c;return s("DatePicker",{staticClass:"SharpDateRange position-relative",attrs:{value:e.value,"monday-first":e.mondayFirst,"display-format":e.displayFormat,columns:e.$screens({default:1,lg:2}),"update-on-input":e.updateOnInput,"is-range":""},on:{input:e.handleChanged},scopedSlots:e._u([{key:"default",fn:function({inputValue:a,inputEvents:n}){return[s("div",{staticClass:"input-group",class:{"input-group-sm":e.small}},[e.small&&!e.value?[s("div",e._g({staticClass:"form-select form-control",attrs:{tabindex:"0"}},n.start),[s("span")])]:[s("input",e._g(e._b({staticClass:"form-control border-end-0",attrs:{placeholder:e.startPlaceholder,disabled:e.readOnly,autocomplete:"off"},domProps:{value:a.start}},"input",e.$props,!1),n.start)),s("div",{staticClass:"form-control SharpDateRange__dash px-0 border-start-0 border-end-0"},[e._v(" - ")]),s("input",e._g(e._b({staticClass:"form-control border-start-0",class:{clearable:e.hasClearButton},attrs:{placeholder:e.endPlaceholder,disabled:e.readOnly,autocomplete:"off"},domProps:{value:a.end}},"input",e.$props,!1),n.end))]],2),e.hasClearButton?[s("ClearButton",{on:{click:e.handleClearClicked}})]:e._e()]}}])})},km=[],xm=r(wm,Sm,km,!1,null,null,null,null);const ea=xm.exports,Fm={autocomplete:Cs,text:re,textarea:$o,editor:$m,number:Eo,upload:Jo,tags:id,date:pd,check:Ts,list:Pd,select:Ps,html:lc,geolocation:Kc,daterange:ea},Lm={name:"SharpField",inheritAttrs:!1,provide(){return{$field:this}},props:{fieldKey:String,fieldType:String,fieldProps:Object,fieldLayout:Object,value:[String,Number,Boolean,Object,Array,Date],locale:[Array,String],uniqueIdentifier:String,fieldConfigIdentifier:String,updateData:Function,readOnly:Boolean,root:Boolean},computed:{isCustom(){return ss(this.fieldType)},component(){return this.isCustom?as(this.fieldType):Fm[this.fieldType]}},render(t){if(!this.component)return this.custom||b(`Unknown field type '${this.fieldType}'`,this.fieldProps),null;let{key:e,...s}=this.fieldProps;return t(this.component,{class:"SharpField",props:{fieldKey:this.fieldKey,fieldLayout:this.fieldLayout,value:this.value,locale:this.locale,uniqueIdentifier:this.uniqueIdentifier,fieldConfigIdentifier:this.fieldConfigIdentifier,root:this.root},attrs:{id:this.$attrs.id,dynamicAttributes:s.dynamicAttributes,...s},on:{...this.$listeners,input:(a,n={})=>{if(this.fieldProps.readOnly&&!n.force){Pr(`SharpField '${this.fieldKey}', can't update because is readOnly`);return}this.updateData(this.fieldKey,a,{forced:n.force}),this.$emit("input",a,{force:n.force,error:n.error})}}})}},Bm=null,Om=null;var Em=r(Lm,Bm,Om,!1,null,null,null,null);const ut=Em.exports,Im={props:{locales:{type:Array,required:!0},currentLocale:{type:String,required:!0},fieldValue:[String,Number,Boolean,Object,Array],isLocaleObject:Boolean,errors:Array},methods:{isActive(t){return this.currentLocale===t},isEmpty(t){const e=this.isLocaleObject?(this.fieldValue||{})[t]:this.fieldValue;return Array.isArray(e)?!e.length:!e},hasError(t){var e;return(e=this.errors)==null?void 0:e.includes(t)},handleButtonClicked(t){this.$emit("change",t)}}};var Tm=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpFieldLocaleSelect"},[s("div",{staticClass:"row gx-1"},[e._l(e.locales,function(a){return[s("div",{staticClass:"col-auto d-flex"},[s("button",{staticClass:"SharpFieldLocaleSelect__btn ml-2",class:{"SharpFieldLocaleSelect__btn--active":e.isActive(a),"SharpFieldLocaleSelect__btn--empty":e.isEmpty(a),"SharpFieldLocaleSelect__btn--error":e.hasError(a)},on:{click:function(n){return e.handleButtonClicked(a)}}},[e._v(" "+e._s(a)+" ")])])]})],2)])},Am=[],Rm=r(Im,Tm,Am,!1,null,null,null,null);const Dm=Rm.exports,Pm={name:"SharpFieldContainer",mixins:[Be,os],components:{Field:ut,FieldLocaleSelect:Dm},inject:{$form:{},$tab:{default:null}},props:{...ut.props,label:String,helpMessage:String,originalValue:[String,Number,Boolean,Object,Array,Date],errorIdentifier:[String,Number],localizedErrorIdentifier:String},data(){return{state:"default",stateMessage:""}},watch:{"$form.errors"(t){this.updateError(t)},locale(){this.updateError(this.$form.errors)}},computed:{fieldId(){return`form-field_${this.mergedErrorIdentifier}`},formGroupClasses(){return[`SharpForm__form-item--type-${this.fieldType}`,{"SharpForm__form-item--danger":this.hasError,"SharpForm__form-item--success":this.state==="ok","SharpForm__form-item--has-label":this.showLabel,"SharpForm__form-item--no-label":!this.showLabel}]},extraStyle(){return this.fieldProps.extraStyle},hasError(){return this.state==="error"||this.errorsLocales.length>0},showLabel(){return!!this.label},resolvedOriginalValue(){return eo({field:this.fieldProps,value:this.originalValue})},isLocaleObject(){return ze(this.fieldProps)||this.fieldProps.type==="editor"},mergedErrorIdentifier(){return this.getMergedIdentifier("mergedErrorIdentifier",this.errorIdentifier)},mergedLocalizedErrorIdentifier(){return this.localizedErrorIdentifier?this.getMergedIdentifier("mergedErrorIdentifier",this.localizedErrorIdentifier):null},errorsLocales(){return Object.entries(this.$form.errors).filter(([t,e])=>!!e).map(([t])=>{const e=t.match(new RegExp(`^${this.mergedErrorIdentifier}\\.([^.]+)$`));return e==null?void 0:e[1]}).filter(t=>{var e;return t&&((e=this.$form.locales)==null?void 0:e.includes(t))})}},methods:{updateError(t){const e=t[this.mergedLocalizedErrorIdentifier]??t[this.mergedErrorIdentifier];if(Array.isArray(e))this.setError(e[0]);else if(this.fieldProps.localized&&this.errorsLocales.length>0){const s=this.errorsLocales.join(", ").toUpperCase(),a=o("form.validation_error.localized").replace(":locales",s);this.setError(a)}else e==null?this.clear(!1):b(`FieldContainer : Not processable error "${this.mergedErrorIdentifier}" : `,e)},setError(t){var e;this.state="error",this.stateMessage=t,(e=this.$tab)==null||e.$emit("error",this.mergedErrorIdentifier)},setOk(){this.state="ok",this.stateMessage=""},clear(t=!0){this.state="default",this.stateMessage="",t&&(this.emitClear(this.mergedErrorIdentifier),this.mergedLocalizedErrorIdentifier&&this.emitClear(this.mergedLocalizedErrorIdentifier))},emitClear(t){var e;(e=this.$tab)==null||e.$emit("clear",t),this.$form.updateFieldError(t,null)},triggerFocus(){this.$set(this.fieldProps,"focused",!0)},handleBlur(){this.$set(this.fieldProps,"focused",!1)},handleValueChanged(t,{error:e}={}){e?this.$form.updateFieldError(this.mergedLocalizedErrorIdentifier??this.mergedErrorIdentifier,[e]):this.state==="error"&&this.clear()},handleLocaleChanged(t){this.$emit("locale-change",this.fieldKey,t)}},directives:{sticky:H}};var zm=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpFieldContainer SharpForm__form-item",class:e.formGroupClasses,style:e.extraStyle},[s("div",{directives:[{name:"sticky",rawName:"v-sticky",value:e.fieldType==="list",expression:"fieldType === 'list'"}],staticClass:"SharpForm__field-header"},[s("div",{staticClass:"row align-items-end"},[s("div",{staticClass:"col d-flex"},[e.showLabel?[s("label",{staticClass:"SharpForm__label form-label",attrs:{for:e.fieldId}},[e._v(" "+e._s(e.label)+" ")])]:[s("div",{staticClass:"SharpForm__label SharpForm__label--placeholder form-label"})]],2),e.fieldProps.localized?[s("div",{staticClass:"col-auto"},[s("FieldLocaleSelect",{attrs:{locales:e.$form.locales,"current-locale":e.locale,"field-value":e.resolvedOriginalValue,"is-locale-object":e.isLocaleObject,errors:e.errorsLocales},on:{change:e.handleLocaleChanged}})],1)]:e._e()],2)]),s("div",{staticClass:"SharpForm__field-content"},[s("Field",e._b({ref:"field",attrs:{id:e.fieldId,"unique-identifier":e.mergedErrorIdentifier,"field-config-identifier":e.mergedConfigIdentifier},on:{error:e.setError,ok:e.setOk,clear:e.clear,blur:e.handleBlur,"locale-change":e.handleLocaleChanged,input:e.handleValueChanged}},"Field",e.$props,!1))],1),e.stateMessage?[s("div",{staticClass:"invalid-feedback d-block"},[e._v(e._s(e.stateMessage))])]:e._e(),e.helpMessage?[s("div",{staticClass:"SharpForm__help-message form-text"},[e._v(e._s(e.helpMessage))])]:e._e()],2)},Mm=[],jm=r(Pm,zm,Mm,!1,null,null,null,null);const Nm=jm.exports,Vm={computeSelectCondition({condValues:t,fieldValue:e,isSingleSelect:s}){if(Array.isArray(t))return s?t.some(a=>a==e):t.some(a=>e.some(n=>n==a));if(t[0]==="!"){let a=t.substring(1);return s?a!=e:!e.some(n=>n==a)}return s?t==e:e.some(a=>a==t)}};function Um(t,e,s){let a=!0,{operator:n}=s;if(n!=="or"&&n!=="and")return b(`Conditional display : unknown operator '${n}'`,s),!0;for(let i of s.fields){i.key in t||(b(`Conditional display : can't find a field with key '${s.key}' in 'fields'`,s),a=!0);let l=t[i.key],d=e[i.key];if(l.type==="autocomplete"||l.type==="select"||l.type==="tags"?a=Vm.computeSelectCondition({condValues:i.values,fieldValue:l.type==="autocomplete"?d&&d.id:d,isSingleSelect:l.type==="select"&&!l.multiple||l.type==="autocomplete"}):l.type==="check"?typeof i.values!="boolean"?(b(`Conditional display : 'values' must be a boolean for a 'check' field ('${i.key}')`,s,l),a=!0):a=!!d===i.values:(b(`Conditional display : unprocessable field type '${l.type}'`,l),a=!0),n==="and"&&!a)return!1;if(n==="or"&&a)return!0}return a}function Hm(t,e,s){return s?Um(t,e,s):!0}const qm=(t,e,s,a)=>t.localized&&e.localized&&s&&ze(e)?typeof s!="object"||un.isArray(s)?(b(`Localized field '${e.key}' value must be a object, given :`,JSON.stringify(s)),s):s[a]:s,Km={name:"SharpFieldDisplay",functional:!0,inject:["$form"],render(t,{props:e,injections:s,data:a}){let{fieldKey:n,contextFields:i,contextData:l,errorIdentifier:d,updateVisibility:u,readOnly:c,...p}=e,{$form:g}=s,f=i[n],C=l[n];if(!(n in i))return b(`Field display ('layout') : Can't find a field with key '${n}' in 'fields'`,i),t(Le,{props:{name:n}});let k=Hm(i,l,f.conditionalDisplay);return u&&u(n,k),k?t(Nm,{...a,attrs:{fieldKey:n,fieldProps:{...f,readOnly:c||f.readOnly},fieldType:f.type,value:qm(g,f,C,e.locale),originalValue:C,label:f.label,helpMessage:f.helpMessage,errorIdentifier:d,localizedErrorIdentifier:f.localized?`${d}.${e.locale}`:null,...p}}):null}},Gm={name:"SharpActionBarForm",mixins:[y],components:{LocaleSelect:le,Breadcrumb:xe,Dropdown:$,DropdownItem:x},props:{showSubmitButton:Boolean,showBackButton:Boolean,create:Boolean,uploading:Boolean,loading:Boolean,breadcrumb:Array,showBreadcrumb:Boolean,currentLocale:String,locales:Array},methods:{handleLocaleChanged(t){this.$emit("locale-change",t)}}};var Wm=function(){var e=this,s=e._self._c;return s("div",{staticClass:"action-bar mt-4 mb-3"},[s("div",{staticClass:"row align-items-center gx-3"},[s("div",{staticClass:"col"},[e.showBreadcrumb?[s("Breadcrumb",{attrs:{items:e.breadcrumb}})]:e._e()],2),e.locales&&e.locales.length?[s("div",{staticClass:"col-auto"},[s("LocaleSelect",{attrs:{outline:"",right:"",locale:e.currentLocale,locales:e.locales},on:{change:e.handleLocaleChanged}})],1)]:e._e()],2)])},Qm=[],Ym=r(Gm,Wm,Qm,!1,null,null,null,null);const Xm=Ym.exports,Jm={components:{Button:_,Form:He,ActionBarForm:Xm},data(){return{form:null}},computed:{entityKey(){return this.$route.params.entityKey},instanceId(){return this.$route.params.instanceId}},methods:{handleError(t){this.$emit("error",t)},handleFormUpdated(t){this.updateDocumentTitle(t)},updateDocumentTitle(t){var s,a;const e=(a=(s=t.breadcrumb)==null?void 0:s.items[t.breadcrumb.items.length-1])==null?void 0:a.documentTitleLabel;e&&(document.title=`${e}, ${document.title}`)}}};var Zm=function(){var e=this,s=e._self._c;return s("div",{staticClass:"FormPage"},[s("div",{staticClass:"container"},[s("Form",{attrs:{form:e.form,"entity-key":e.entityKey,"instance-id":e.instanceId},on:{"update:form":[function(a){e.form=a},e.handleFormUpdated],error:e.handleError},scopedSlots:e._u([{key:"action-bar",fn:function({props:a,listeners:n}){return[s("ActionBarForm",e._g(e._b({},"ActionBarForm",a,!1),n))]}}])})],1)])},ep=[],tp=r(Jm,Zm,ep,!1,null,null,null,null);const sp=tp.exports,ap=[{name:"form",path:"/(.*)?/s-form/:entityKey/:instanceId?",component:sp}];function np(t,{router:e,store:s}){t.component("FieldDisplay",Km),e.addRoutes(ap)}const ip={components:{Modal:F,Form:He,LoadingOverlay:ne},props:{command:Object,entityKey:String,instanceId:[Number,String],loading:Boolean},data(){return{visible:!1}},watch:{command(t){this.visible=!!(t!=null&&t.form)}},computed:{title(){var t,e;return((t=this.command)==null?void 0:t.modal_title)??((e=this.command)==null?void 0:e.label)},confirmLabel(){var t;return(t=this.command)==null?void 0:t.modal_confirm_label}},methods:{submit(...t){return this.$refs.form.submit(...t)},handleSubmitButtonClicked(t){t.preventDefault(),this.$emit("submit",this)},handleClosed(){this.$emit("close")},handleLoadingChanged(t){this.$emit("update:loading",t)}}};var rp=function(){var e=this,s=e._self._c;return s("Modal",{attrs:{"modal-class":"form-modal",visible:e.visible,loading:e.loading,title:e.title,"ok-title":e.confirmLabel},on:{"update:visible":function(a){e.visible=a},ok:e.handleSubmitButtonClicked,hidden:e.handleClosed}},[s("transition",[e.visible?[s("Form",{ref:"form",staticStyle:{"transition-duration":"300ms"},attrs:{"entity-key":e.entityKey,"instance-id":e.instanceId,form:e.command.form,"show-alert":!1,independant:"","ignore-authorizations":""},on:{loading:e.handleLoadingChanged}})]:e._e()],2)],1)},lp=[],op=r(ip,rp,lp,!1,null,null,null,null);const qe=op.exports,dp={name:"SharpCommandsDropdown",components:{Dropdown:$,DropdownItem:x,DropdownSeparator:U},props:{commands:{type:Array},small:{type:Boolean,default:!0},hasState:Boolean,selecting:Boolean},computed:{commandGroups(){return this.commands.filter(t=>t.length>0)},classes(){return{"SharpCommandsDropdown--has-state":this.hasState}}},methods:{lang:o,isDisabled(t){return this.requiresSelection(t)},requiresSelection(t){return!this.selecting&&t.instance_selection==="required"},handleCommandClicked(t){this.$emit("select",t)}},directives:{"b-tooltip":hn}};var cp=function(){var e=this,s=e._self._c;return s("Dropdown",e._g(e._b({staticClass:"SharpCommandsDropdown",class:e.classes,attrs:{small:e.small,right:""},scopedSlots:e._u([{key:"text",fn:function(){return[e._t("text")]},proxy:!0}],null,!0)},"Dropdown",e.$attrs,!1),e.$listeners),[e._t("prepend"),e._l(e.commandGroups,function(a,n){return[n>0?[s("DropdownSeparator")]:e._e(),e._l(a,function(i){return[s("DropdownItem",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.left",value:{disabled:!e.requiresSelection(i)},expression:"{ disabled: !requiresSelection(command) }",modifiers:{hover:!0,left:!0}}],key:i.key,attrs:{disabled:e.isDisabled(i),title:e.requiresSelection(i)?e.lang("entity_list.commands.needs_selection_message"):null},on:{click:function(l){return e.handleCommandClicked(i)}}},[e._v(" "+e._s(i.label)+" "),i.description?[s("div",{staticClass:"SharpCommandsDropdown__description",class:{"opacity-75":e.isDisabled(i)}},[e._v(" "+e._s(i.description)+" ")])]:e._e()],2)]})]}),e._t("append")],2)},up=[],hp=r(dp,cp,up,!1,null,null,null,null);const L=hp.exports,mp={name:"SharpViewPanel",props:{content:String},computed:{visible(){return!!this.content}},methods:{handleBackdropClicked(){this.$emit("close")}}};var pp=function(){var e=this,s=e._self._c;return s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"SharpViewPanel__glasspane",on:{click:e.handleBackdropClicked}}),s("transition",{attrs:{"enter-class":"SharpViewPanel--collapsed","enter-active-class":"SharpViewPanel--expanding","enter-to-class":"SharpViewPanel--expanded","leave-class":"SharpViewPanel--expanded","leave-active-class":"SharpViewPanel--collapsing","leave-to-class":"SharpViewPanel--collapsed"}},[e.visible?[s("div",{staticClass:"SharpViewPanel"},[s("iframe",{attrs:{srcdoc:e.content,sandbox:"allow-forms allow-scripts allow-same-origin allow-popups allow-modals allow-downloads"}})])]:e._e()],2)],1)},fp=[],_p=r(mp,pp,fp,!1,null,null,null,null);const Ke=_p.exports,ht="SET_COMMANDS",gp={namespaced:!0,state:{commands:null},mutations:{[ht](t,e){t.commands=e}},getters:{forType(t){return e=>t.commands?t.commands[e]:null}},actions:{update({commit:t},{commands:e}){t(ht,e)}}};function vp(t,{store:e,router:s}){}function bp({dashboardKey:t,filters:e}){return v.get(`dashboard/${t}`,{params:{...e}}).then(s=>s.data)}function yp({dashboardKey:t,commandKey:e,query:s,data:a}){return v.post(`dashboard/${t}/command/${e}`,{query:s,...a},{responseType:"blob"})}function Cp({dashboardKey:t,commandKey:e,query:s}){return v.get(`dashboard/${t}/command/${e}/form`,{params:{...s}}).then(a=>a.data)}function $p(){return v.get("filters").then(t=>t.data)}function wp({filterKey:t,value:e}){return v.post(`filters/${t}`,{value:e})}const ta="filter_",mt=new RegExp(`^${ta}`);function sa(t){return`${ta}${t}`}function Sp(t,e=s=>s){return Object.entries(t).reduce((s,[a,n])=>({...s,[sa(a)]:e(n,a)}),{})}function kp(t){return Object.entries(t||{}).filter(([e])=>mt.test(e)).reduce((e,[s,a])=>({...e,[s.replace(mt,"")]:a}),{})}const pt="SET_FILTERS",ft="SET_VALUES",oe={namespaced:!0,state:()=>({filters:null,values:{}}),mutations:{[pt](t,e){t.filters=e},[ft](t,e){t.values=e}},getters:{value(t){return e=>t.values[e]},rootFilters(t){var e;return((e=t.filters)==null?void 0:e._root)??[]},values(t){return t.values},isValuated(t,e){return s=>!Pt(e.getQueryParams(Object.fromEntries(s.map(a=>{var n;return[a.key,(n=t.values)==null?void 0:n[a.key]]}))),e.getQueryParams(e.defaultValues(s)))},filterQueryKey(){return t=>sa(t)},getQueryParams(t,e){return s=>{const a=Object.values(t.filters??{}).flat();return Sp(s,(n,i)=>e.serializeValue({filter:a.find(l=>l.key===i),value:n}))}},getValuesFromQuery(){return t=>kp(t)},resolveFilterValue(){return({filter:t,value:e})=>e==null?t==null?void 0:t.default:t.multiple&&!Array.isArray(e)?[e]:t.type==="daterange"?Rr(e):t.type==="check"?e==="1":e},serializeValue(){return({filter:t,value:e})=>t?t.multiple&&!(e!=null&&e.length)?null:t.type==="daterange"?Dr(e):t.type==="check"?e?"1":null:e:e},nextValues(t){return({filter:e,value:s})=>e.master?{...Object.fromEntries(Object.entries(t.values).map(([a,n])=>[a,null])),[e.key]:s}:{...t.values,[e.key]:s}},nextQuery(t,e){return({filter:s,value:a})=>e.getQueryParams(e.nextValues({filter:s,value:a}))},defaultValues(){return t=>Object.fromEntries(t.map(e=>[e.key,e.default]))},defaultQuery(t,e){return s=>e.getQueryParams(e.defaultValues(s))}},actions:{update({state:t,commit:e,dispatch:s,getters:a},{filters:n,values:i}){e(pt,n),e(ft,{...Object.fromEntries(Object.values(n??{}).flat().map(l=>[l.key,a.resolveFilterValue({filter:l,value:i==null?void 0:i[l.key]})]))})}}},xp={namespaced:!0,modules:{filters:oe},actions:{async get({dispatch:t}){const e=await $p();t("filters/update",{filters:e.filters})},post({},{filter:t,value:e}){return wp({filterKey:t.key,value:e})}}},Fp={name:"SharpFilterControl",props:{label:String},methods:{handleLabelClicked(){this.$emit("label-click")},handleClicked(){this.$emit("click")}}};var Lp=function(){var e=this,s=e._self._c;return s("div",{staticClass:"input-group input-group-sm flex-nowrap SharpFilterControl",on:{click:e.handleClicked}},[e.label?[s("div",{staticClass:"input-group-text bg-white border-end-0",on:{click:e.handleLabelClicked}},[e._v(" "+e._s(e.label)+" ")])]:e._e(),e._t("default")],2)},Bp=[],Op=r(Fp,Lp,Bp,!1,null,null,null,null);const aa=Op.exports,Ep={name:"SharpFilterDateRange",components:{DateRange:ea,FilterControl:aa},props:{value:{required:!0},required:Boolean,displayFormat:String,mondayFirst:Boolean,disabled:Boolean,label:String},methods:{handleClicked(){this.$refs.range.focus()},handleInput(t){this.$emit("input",t)}}};var Ip=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpFilterDateRange"},[s("FilterControl",{attrs:{label:e.label},on:{"label-click":e.handleClicked}},[s("DateRange",{ref:"range",staticClass:"SharpFilterDateRange__field",attrs:{value:e.value,"display-format":e.displayFormat,"monday-first":e.mondayFirst,clearable:!e.required,"read-only":e.disabled,"update-on-input":!1,small:""},on:{input:e.handleInput}})],1)],1)},Tp=[],Ap=r(Ep,Ip,Tp,!1,null,null,null,null);const Rp=Ap.exports,Dp={name:"SharpFilterSelect",mixins:[y],components:{Select:Ps,Autocomplete:Cs,FilterControl:aa},props:{label:String,values:{type:Array,required:!0},value:{type:[String,Number,Array]},multiple:Boolean,required:Boolean,searchable:Boolean,searchKeys:Array,template:String,disabled:Boolean,global:Boolean},data(){return{opened:!1,debug:!1}},computed:{optionById(){return this.values.reduce((t,e)=>({...t,[e.id]:e}),{})},empty(){return this.value==null||this.multiple&&!this.value.length},autocompleteValue(){return this.multiple?(this.value||[]).map(t=>this.optionById[t]):this.optionById[this.value]}},methods:{handleSelect(t){this.$emit("input",t)},handleAutocompleteInput(t){this.$emit("input",this.multiple?t.map(e=>e.id):(t||{}).id)},handleClicked(){this.opened?this.close():this.open()},open(){this.opened=!0,this.$emit("open"),this.$nextTick(this.showDropdown)},close(){this.debug||(this.opened=!1,this.$emit("close"),this.$nextTick(this.blur))},showDropdown(){let{autocomplete:{$refs:{multiselect:t}}}=this.$refs;t.activate(),this.debug&&(this.unwatch&&this.unwatch(),this.unwatch=t.$watch("isOpen",function(e){e||(this.isOpen=!0)},{sync:!0}))},blur(){this.$refs.select.blur()}}};var Pp=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpFilterSelect",class:{"SharpFilterSelect--open":e.opened,"SharpFilterSelect--empty":e.empty,"SharpFilterSelect--multiple":e.multiple,"SharpFilterSelect--searchable":e.searchable,"SharpFilterSelect--underlined":!e.global}},[s("Autocomplete",{ref:"autocomplete",staticClass:"SharpFilterSelect__select",staticStyle:{"max-width":"0"},attrs:{value:e.autocompleteValue,"local-values":e.values,"search-keys":e.searchKeys,"list-item-template":e.template,placeholder:e.l("entity_list.filter.search_placeholder"),multiple:e.multiple,"hide-selected":e.multiple,"allow-empty":!e.required,"preserve-search":!1,"show-pointer":!1,searchable:e.searchable,"read-only":e.disabled,nowrap:"","no-result-item":"",mode:"local"},on:{"multiselect-input":e.handleAutocompleteInput,close:e.close}}),s("FilterControl",{attrs:{label:e.label},on:{click:e.handleClicked}},[s("Select",{ref:"select",staticClass:"SharpFilterSelect__select form-select text-wrap",attrs:{value:e.value,options:e.values,multiple:e.multiple,clearable:!e.required,"read-only":e.disabled,inline:!1,placeholder:" "},on:{input:e.handleSelect}})],1)],1)},zp=[],Mp=r(Dp,Pp,zp,!1,null,null,null,null);const na=Mp.exports,jp={props:{filterKey:String,label:String,value:Boolean,disabled:Boolean},computed:{id(){return`filter-${this.filterKey}`}},methods:{handleChanged(t){this.$emit("input",t.target.checked)}}};var Np=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpFilterCheck form-check mt-1 mx-2"},[s("input",{staticClass:"form-check-input",attrs:{id:e.id,type:"checkbox",name:e.filterKey,disabled:e.disabled},domProps:{checked:e.value},on:{change:e.handleChanged}}),s("label",{staticClass:"ui-font fs-8",attrs:{for:e.id}},[e._v(" "+e._s(e.label)+" ")])])},Vp=[],Up=r(jp,Np,Vp,!1,null,null,null,null);const Hp=Up.exports;function qp(t){if(t==="select")return na;if(t==="daterange")return Rp;if(t==="check")return Hp}const Kp={name:"SharpFilter",props:{filter:{type:Object,required:!0},value:[Object,Array,String,Number],disabled:Boolean},computed:{filterComponent(){return qp(this.filter.type)}},methods:{handleInput(t){this.$emit("input",t)}}};var Gp=function(){var e=this,s=e._self._c;return s(e.filterComponent,e._b({tag:"component",attrs:{"filter-key":e.filter.key,value:e.value,disabled:e.disabled},on:{input:e.handleInput}},"component",e.filter,!1))},Wp=[],Qp=r(Kp,Gp,Wp,!1,null,null,null,null);const de=Qp.exports,Yp={components:{FilterSelect:na,Dropdown:$},computed:{...A("global-filters",{rootFilters:"filters/rootFilters",filterValue:"filters/value"})},data(){return{open:!1}},methods:{handleFilterChanged(t,e){this.$store.dispatch("global-filters/post",{filter:t,value:e}).then(()=>{this.$store.dispatch("setLoading",!0),location.href=Oe})},handleOpened(){this.open=!0},handleClosed(){this.open=!1},async init(){await this.$store.dispatch("global-filters/get")}},created(){this.init()}};var Xp=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpGlobalFilters"},[e.open?[s("div",{staticClass:"position-absolute inset-0",staticStyle:{"z-index":"1"}})]:e._e(),e._l(e.rootFilters,function(a){return[s("FilterSelect",{key:a.key,staticStyle:{"z-index":"2"},attrs:{label:null,values:a.values,value:e.filterValue(a.key),multiple:a.multiple,required:a.required,template:a.template,"search-keys":a.searchKeys,searchable:a.searchable,global:""},on:{input:function(n){return e.handleFilterChanged(a,n)},open:function(n){return e.handleOpened(a)},close:function(n){return e.handleClosed(a)}}})]})],2)},Jp=[],Zp=r(Yp,Xp,Jp,!1,null,null,null,null);const ef=Zp.exports;function tf(t,{store:e}){e.registerModule("global-filters",xp),t.component("sharp-global-filters",ef)}const _t="UPDATE",sf={namespaced:!0,modules:{filters:oe,commands:gp},state:{dashboardKey:null,data:null,widgets:null,fields:null,config:null,layout:null},mutations:{[_t](t,{data:e,layout:s,widgets:a,config:n,fields:i}){t.data=e,t.widgets=a,t.layout=s,t.config=n,t.fields=i},setDashboardKey(t,e){t.dashboardKey=e}},actions:{update({commit:t,dispatch:e},{data:s,widgets:a,layout:n,config:i,fields:l,filtersValues:d}){return t(_t,{data:s,widgets:a,layout:n,config:i,fields:l}),Promise.all([e("filters/update",{filters:i.filters,values:d}),e("commands/update",{commands:i.commands})])},async get({state:t,dispatch:e,getters:s},{filtersValues:a}){const n=await bp({dashboardKey:t.dashboardKey,filters:s["filters/getQueryParams"](a)});await e("update",{...n,filtersValues:a})},postCommand({state:t},{command:e,query:s,data:a}){return yp({dashboardKey:t.dashboardKey,commandKey:e.key,query:s,data:a})},getCommandForm({state:t},{command:e,query:s}){return Cp({dashboardKey:t.dashboardKey,commandKey:e.key,query:s})}}},af={name:"SharpWidgetPanel",inheritAttrs:!1,components:{TemplateRenderer:z},props:{value:Object,title:String,template:String,link:String},methods:{lang:o}};var nf=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpWidgetPanel"},[e.title?[s("h2",{staticClass:"SharpWidget__title mb-2"},[e._v(" "+e._s(e.title)+" ")])]:e._e(),s("TemplateRenderer",{attrs:{name:"WidgetPanel",template:e.template,"template-data":e.value.data}}),e.link?[s("a",{staticClass:"stretched-link",attrs:{href:e.link}},[s("span",{staticClass:"visually-hidden"},[e._v(" "+e._s(e.lang("dashboard.widget.link_label"))+" ")])])]:e._e()],2)},rf=[],lf=r(af,nf,rf,!1,null,null,null,null);const of=lf.exports,df={name:"SharpWidgetOrderedList",components:{DataList:qt,DataListRow:Fe},props:{value:Object,title:String,html:Boolean},computed:{items(){return this.value.data},columns(){return[{key:"label",size:12,sizeXS:12,html:this.html}]}},methods:{hasCount(t){return typeof t.count=="number"||!!t.count}}};var cf=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpWidgetOrderedList w-100"},[s("h2",{staticClass:"SharpWidget__title mb-3 px-3"},[e._v(" "+e._s(e.title)+" ")]),s("DataList",{staticClass:"SharpWidgetOrderedList__list",attrs:{items:e.items,columns:e.columns,"hide-header":""},scopedSlots:e._u([{key:"item",fn:function({item:a}){return[s("DataListRow",{attrs:{url:a.url,columns:e.columns,row:a},scopedSlots:e._u([e.hasCount(a)?{key:"append",fn:function(){return[s("span",{staticClass:"SharpTag SharpTag--default"},[e._v(e._s(a.count))])]},proxy:!0}:null],null,!0)})]}}])})],1)},uf=[],hf=r(df,cf,uf,!1,null,null,null,null);const mf=hf.exports,pf={props:{title:String,link:String,value:Object},methods:{lang:o}};var ff=function(){var e=this,s=e._self._c;return s("div",[e.title?[s("h2",{staticClass:"SharpWidget__title mb-2"},[e._v(" "+e._s(e.title)+" ")])]:e._e(),s("div",{staticClass:"d-flex align-items-center"},[s("p",{staticClass:"display-5 fw-bold mb-0",style:{color:e.value.data.color}},[e._v(" "+e._s(e.value.data.figure)+" "),e.value.data.unit?[s("span",{staticClass:"fs-5 fw-normal"},[e._v(e._s(e.value.data.unit))])]:e._e()],2),e.value.data.evolution?[s("div",{staticClass:"d-flex align-items-center ms-3",style:{color:e.value.data.evolution.increase?"#198754":"#dc3545"}},[e.value.data.evolution.increase?[s("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor"}},[s("path",{attrs:{"fill-rule":"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z","clip-rule":"evenodd"}})])]:[s("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor"}},[s("path",{attrs:{"fill-rule":"evenodd",d:"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z","clip-rule":"evenodd"}})])],s("span",{staticClass:"ms-1"},[e._v(" "+e._s(e.value.data.evolution.value)+" ")])],2)]:e._e()],2),e.link?[s("div",{staticClass:"text-start mt-2"},[s("a",{attrs:{href:e.link}},[e._v(" "+e._s(e.lang("dashboard.widget.link_label"))+" ")])])]:e._e()],2)},_f=[],gf=r(pf,ff,_f,!1,null,null,null,null);const vf=gf.exports;function Ge(){return{chart:{animations:{enabled:!1},toolbar:{show:!1,tools:{pan:!1,zoom:!0,download:!1}},locales:[mn,pn,fn,_n,gn],defaultLocale:document.documentElement.lang},legend:{showForSingleSeries:!0},tooltip:{y:{title:{formatter:(t,{seriesIndex:e})=>t!==`series-${e+1}`?`${t}:`:""}}}}}function ia(t){var e;return!!(((e=t.legend)==null?void 0:e.show)??!0)}function We(t){const e=document.createElement("canvas").getContext("2d");return t.map(s=>(e.fillStyle=s,e.fillStyle))}const bf={components:{ApexChart:$e},props:{chartData:Object,options:Object},computed:{hasLegends(){return ia(this.chartOptions)},chartOptions(){return we({},Ge(),{colors:this.chartData.colors,labels:this.chartData.labels,legend:{position:"bottom"},stroke:{width:4},dataLabels:{enabled:!1}},this.options)}}};var yf=function(){var e=this,s=e._self._c;return s("div",{staticClass:"mt-2",class:{"mb-2":e.hasLegends}},[s("ApexChart",{attrs:{type:"area",series:e.chartData.series,options:e.chartOptions,height:e.options.chart.height}})],1)},Cf=[],$f=r(bf,yf,Cf,!1,null,null,null,null);const wf=$f.exports;function Sf(t){const e=(t==null?void 0:t.datasets)??[],s=(t==null?void 0:t.labels)??[];return{series:e.map(a=>({data:a.data,name:a.label})),colors:We(e.map(a=>a.color)),labels:s}}const kf={components:{ApexChart:$e},props:{chartData:Object,options:Object},computed:{hasLegends(){return ia(this.chartOptions)},chartOptions(){return we({},Ge(),{legend:{position:"bottom"},labels:this.chartData.labels,colors:this.chartData.colors,grid:{padding:{right:12}}},this.options)}}};var xf=function(){var e=this,s=e._self._c;return s("div",{class:{"mb-2":e.hasLegends}},[s("ApexChart",{attrs:{type:"bar",series:e.chartData.series,options:e.chartOptions,height:e.options.chart.height}})],1)},Ff=[],Lf=r(kf,xf,Ff,!1,null,null,null,null);const Bf=Lf.exports;function Of(t){const e=(t==null?void 0:t.datasets)??[],s=(t==null?void 0:t.labels)??[];return{series:e.map(a=>({data:a.data,name:a.label})),colors:We(e.map(a=>a.color)),labels:s}}const Ef={components:{ApexChart:$e},props:{chartData:Object,options:Object},computed:{chartOptions(){return we({},Ge(),{colors:this.chartData.colors,labels:this.chartData.labels,legend:{position:"right"}},this.options)}}};var If=function(){var e=this,s=e._self._c;return s("div",[s("ApexChart",{attrs:{type:"pie",series:e.chartData.series,options:e.chartOptions,height:e.options.chart.height}})],1)},Tf=[],Af=r(Ef,If,Tf,!1,null,null,null,null);const Rf=Af.exports;function Df(t){const e=((t==null?void 0:t.datasets)??[]).filter(s=>{var a;return((a=s.data)==null?void 0:a.length)>0});return{series:e.map(s=>s.data[0]),colors:We(e.map(s=>s.color)),labels:e.map(s=>s.label??"")}}function Pf(t){if(t==="line")return wf;if(t==="bar")return Bf;if(t==="pie")return Rf}function zf(t,e){if(t==="line")return Sf(e);if(t==="bar")return Of(e);if(t==="pie")return Df(e)}const Mf={name:"SharpWidgetChart",props:{display:String,title:String,value:Object,ratioX:Number,ratioY:Number,height:Number,minimal:Boolean,showLegend:{type:Boolean,default:!0},dateLabels:Boolean,options:Object},data(){return{zoomed:!1}},computed:{classes(){return[`SharpWidgetChart--${this.display}`,{"SharpWidgetChart--aspect-ratio":!this.height}]},style(){return{"--ratio-x":this.ratioX,"--ratio-y":this.ratioY}},chartComp(){return Pf(this.display)},chartData(){return zf(this.display,this.value)},chartOptions(){var t,e,s;return{chart:{toolbar:{show:this.zoomed},height:this.height??"100%",width:"100%",sparkline:{enabled:this.minimal},parentHeightOffset:0,events:{zoomed:()=>{this.zoomed=!0}}},xaxis:{type:!((t=this.options)!=null&&t.horizontal)&&this.dateLabels?"datetime":"category"},plotOptions:{bar:{horizontal:!!((e=this.options)!=null&&e.horizontal)}},legend:{show:this.showLegend&&!this.minimal},stroke:{curve:((s=this.options)==null?void 0:s.curved)??!0?"smooth":"straight"}}}}};var jf=function(){var e=this,s=e._self._c;return s("div",[e.title?[s("h2",{staticClass:"SharpWidget__title mb-2 mt-3 px-3"},[e._v(" "+e._s(e.title)+" ")])]:e._e(),s(e.chartComp,{tag:"component",staticClass:"SharpWidgetChart",class:e.classes,style:e.style,attrs:{"chart-data":e.chartData,options:e.chartOptions}})],2)},Nf=[],Vf=r(Mf,jf,Nf,!1,null,null,null,null);const Uf=Vf.exports;function Hf(t){if(t==="graph")return Uf;if(t==="panel")return of;if(t==="list")return mf;if(t==="figure")return vf}const qf={name:"SharpWidget",props:{widgetType:String,widgetProps:Object,value:Object},computed:{classes(){return{"SharpWidget--chart":this.widgetType==="graph","SharpWidget--panel":this.widgetType==="panel","SharpWidget--link":this.widgetProps.link}},widgetComp(){return Hf(this.widgetType,this.widgetProps.display)}}};var Kf=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpWidget card",class:e.classes,attrs:{href:e.widgetProps.link}},[s("div",{staticClass:"card-body"},[s(e.widgetComp,e._b({tag:"component",attrs:{value:e.value}},"component",e.widgetProps,!1))],1)])},Gf=[],Wf=r(qf,Kf,Gf,!1,null,null,null,null);const ra=Wf.exports,Qf={name:"SharpActionBarDashboard",mixins:[y],components:{SharpFilter:de,CommandsDropdown:L},props:{commands:Array,filters:Array,showReset:Boolean},computed:{...A("dashboard",{filterValue:"filters/value"})}};var Yf=function(){var e=this,s=e._self._c;return s("div",{staticClass:"my-4"},[s("div",{staticClass:"row gx-3"},[s("div",{staticClass:"col"},[e.filters.length>0?[s("div",{staticClass:"row gx-2"},[e._l(e.filters,function(a){return[s("div",{staticClass:"col-auto"},[s("SharpFilter",{key:a.id,attrs:{filter:a,value:e.filterValue(a.key)},on:{input:function(n){return e.$emit("filter-change",a,n)}}})],1)]}),e.showReset?[s("div",{staticClass:"col-auto d-flex"},[s("button",{staticClass:"btn btn-sm btn-link d-inline-flex align-items-center fs-8",on:{click:function(a){return e.$emit("filters-reset",e.filters)}}},[e._v(" "+e._s(e.l("filters.reset_all"))+" ")])])]:e._e()],2)]:e._e()],2),e.commands.length?[s("div",{staticClass:"col-auto"},[s("CommandsDropdown",{attrs:{commands:e.commands},on:{select:function(a){return e.$emit("command",a)}},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(e.l("dashboard.commands.dashboard.label"))+" ")]},proxy:!0}],null,!1,2583331100)})],1)]:e._e()],2)])},Xf=[],Jf=r(Qf,Yf,Xf,!1,null,null,null,null);const Zf=Jf.exports,e_={components:{CommandsDropdown:L,Widget:ra,Grid:R,SectionTitle:ms,SharpFilter:de},props:{section:Object,commands:Array,filters:Array,showReset:Boolean},computed:{...A("dashboard",{filterValue:"filters/value"}),hasCommands(){var t;return(t=this.commands)==null?void 0:t.flat().length}},methods:{lang:o}};var t_=function(){var e=this,s=e._self._c;return s("div",{staticClass:"section"},[s("div",{staticClass:"row align-items-center"},[s("div",{staticClass:"col"},[s("SectionTitle",{attrs:{section:e.section}})],1),e.hasCommands||e.filters.length?[s("div",{staticClass:"col-auto align-self-end mb-2",class:{"w-100":e.filters.length}},[s("div",{staticClass:"row justify-content-end"},[e.filters.length?[s("div",{staticClass:"col"},[s("div",{staticClass:"row row-cols-auto gx-2"},[e._l(e.filters,function(a){return[s("SharpFilter",{key:a.id,attrs:{filter:a,value:e.filterValue(a.key)},on:{input:function(n){return e.$emit("filter-change",a,n)}}})]}),e.showReset?[s("div",{staticClass:"d-flex"},[s("button",{staticClass:"btn btn-sm d-inline-flex align-items-center btn-link",on:{click:function(a){return e.$emit("filters-reset",e.filters)}}},[e._v(" "+e._s(e.lang("filters.reset_all"))+" ")])])]:e._e()],2)])]:e._e(),e.hasCommands?[s("div",{staticClass:"col-auto"},[s("CommandsDropdown",{attrs:{commands:e.commands},on:{select:function(a){return e.$emit("command",a)}},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(e.lang("dashboard.commands.dashboard.label"))+" ")]},proxy:!0}],null,!1,3675307572)})],1)]:e._e()],2)])]:e._e()],2),s("Grid",{attrs:{rows:e.section.rows,"row-class":"g-3"},scopedSlots:e._u([{key:"default",fn:function({itemLayout:a}){return[e._t("default",null,{widgetLayout:a})]}}],null,!0)})],1)},s_=[],a_=r(e_,t_,s_,!1,null,null,null,null);const n_=a_.exports,i_={name:"SharpDashboardPage",mixins:[Ae],components:{Section:n_,Grid:R,Widget:ra,ActionBarDashboard:Zf,GlobalMessage:ae,CommandFormModal:qe,CommandViewPanel:Ke},data(){return{ready:!1}},watch:{$route:"init"},computed:{...vn("dashboard",{data:t=>t.data,widgets:t=>t.widgets,layout:t=>t.layout,config:t=>t.config,fields:t=>t.fields}),...A("dashboard",{rootFilters:"filters/rootFilters",filtersValues:"filters/values",getFiltersQueryParams:"filters/getQueryParams",getFiltersValuesFromQuery:"filters/getValuesFromQuery",filterNextQuery:"filters/nextQuery",filterDefaultQuery:"filters/defaultQuery",filterIsValuated:"filters/isValuated",commandsForType:"commands/forType"}),dashboardKey(){return this.$route.params.dashboardKey},commands(){return this.commandsForType("dashboard")||[]},commandsQuery(){return{...this.getFiltersQueryParams(this.filtersValues),...this.$route.query}}},methods:{sectionFilters(t){var e;return((e=this.config.filters)==null?void 0:e[t.key])??[]},handleCommandRequested(t){const e=this.commandsQuery;this.sendCommand(t,{postCommand:s=>this.$store.dispatch("dashboard/postCommand",{command:t,query:e,data:s}),getForm:s=>this.$store.dispatch("dashboard/getCommandForm",{command:t,query:{...e,...s}})})},handleFilterChanged(t,e){this.$router.push({query:{...this.$route.query,...this.filterNextQuery({filter:t,value:e})}})},handleFiltersReset(t){this.$router.push({query:{...this.$route.query,...this.filterDefaultQuery(t)}})},async init(){this.$store.commit("dashboard/setDashboardKey",this.dashboardKey),await Y(this.$store.dispatch("dashboard/get",{filtersValues:this.getFiltersValuesFromQuery(this.$route.query)}).catch(t=>(this.$emit("error",t),Promise.reject(t)))),this.ready=!0}},created(){this.init()}};var r_=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpDashboardPage",attrs:{"data-popover-boundary":""}},[e.ready?[s("div",{staticClass:"container"},[s("ActionBarDashboard",{attrs:{commands:e.commands,filters:e.rootFilters,"show-reset":e.filterIsValuated(e.rootFilters)},on:{command:e.handleCommandRequested,"filter-change":e.handleFilterChanged,"filters-reset":e.handleFiltersReset}}),e.config.globalMessage?[s("GlobalMessage",{attrs:{options:e.config.globalMessage,data:e.data,fields:e.fields}})]:e._e(),s("div",{staticClass:"mb-n4.5"},[e._l(e.layout.sections,function(a){return[s("Section",{staticClass:"mb-4.5",attrs:{section:a,commands:e.commandsForType(a.key),filters:e.sectionFilters(a),"show-reset":e.filterIsValuated(e.sectionFilters(a))},on:{command:e.handleCommandRequested,"filter-change":e.handleFilterChanged,"filters-reset":e.handleFiltersReset},scopedSlots:e._u([{key:"default",fn:function({widgetLayout:n}){return[s("Widget",{attrs:{"widget-type":e.widgets[n.key].type,"widget-props":e.widgets[n.key],value:e.data[n.key]}})]}}],null,!0)})]})],2)],2)]:e._e(),s("CommandFormModal",e._g(e._b({attrs:{command:e.currentCommand,"entity-key":e.dashboardKey}},"CommandFormModal",e.commandFormProps,!1),e.commandFormListeners)),s("CommandViewPanel",{attrs:{content:e.commandViewContent},on:{close:e.handleCommandViewPanelClosed}})],2)},l_=[],o_=r(i_,r_,l_,!1,null,null,null,null);const d_=o_.exports,c_=[{name:"dashboard",path:"/s-dashboard/:dashboardKey",component:d_}];function u_(t,{router:e,store:s}){s.registerModule("dashboard",sf),e.addRoutes(c_)}function h_({entityKey:t,instanceId:e}){return v.delete(`list/${t}/${e??""}`).then(s=>s.data)}function m_({entityKey:t,instances:e}){return v.post(`list/${t}/reorder`,{instances:e})}const gt="SET_ENTITY_KEY",vt="SET_QUERY",la={namespaced:!0,modules:{filters:oe},state(){return{entityKey:null,query:{}}},mutations:{[gt](t,e){t.entityKey=e},[vt](t,e){t.query=e}},getters:{query(t){return t.query}},actions:{update({dispatch:t},{data:e,layout:s,config:a,filtersValues:n}){return Promise.all([t("filters/update",{filters:a.filters,values:n})])},reorder({state:t},{instances:e}){return m_({entityKey:t.entityKey,instances:e})},setEntityKey({commit:t},e){t(gt,e)},setQuery({commit:t},e){t(vt,e)}}},p_={components:{Dropdown:$,DropdownItem:x,DropdownSeparator:U,CommandsDropdown:L,StateIcon:De,ModalSelect:Re,Button:_,Tooltip:ql},props:{config:Object,hasState:Boolean,state:[String,Number],stateDisabled:Boolean,stateOptions:Object,hasCommands:Boolean,commands:Array,selecting:Boolean,canDelete:Boolean},data(){return{stateModalVisible:!1}},computed:{hasActionsButton(){return this.hasCommands||this.hasState||this.canDelete}},methods:{l:o,handleStateChanged(t){this.$emit("state-change",t)},handleCommandRequested(t){this.$emit("command",t)},handleDeleteClicked(){this.$emit("delete")},async handleStateDropdownClicked(){await this.$nextTick(),this.$refs.stateDropdown.show()}}};var f_=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpEntityList__actions"},[s("div",{staticClass:"row align-items-center justify-content-end flex-nowrap gx-1"},[e.hasState?[s("div",{staticClass:"col-auto"},[s("Dropdown",{ref:"stateDropdown",attrs:{"toggle-class":"btn--opacity-1 btn--outline-hover",small:"","show-caret":!1,outline:"",right:"",disabled:e.stateDisabled,title:e.stateOptions?e.stateOptions.label:e.state},scopedSlots:e._u([{key:"text",fn:function(){return[s("StateIcon",{attrs:{color:e.stateOptions?e.stateOptions.color:"#fff"}})]},proxy:!0}],null,!1,1560251243)},[e._l(e.config.state.values,function(a){return[s("DropdownItem",{key:a.value,attrs:{active:e.state===a.value},on:{click:function(n){return e.handleStateChanged(a.value)}}},[s("StateIcon",{staticClass:"me-1",staticStyle:{"vertical-align":"-.125em"},attrs:{color:a.color}}),s("span",{staticClass:"text-truncate"},[e._v(e._s(a.label))])],1)]})],2)],1)]:e._e(),e.hasActionsButton?[s("div",{staticClass:"col-auto"},[s("CommandsDropdown",{staticClass:"SharpEntityList__commands-dropdown",attrs:{outline:"",commands:e.commands,"has-state":e.hasState,"toggle-class":["p-1 commands-toggle",{"opacity-50":e.selecting}],"show-caret":!1},on:{select:e.handleCommandRequested},scopedSlots:e._u([{key:"text",fn:function(){return[s("svg",{staticClass:"d-block",attrs:{width:"22",height:"22",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"}},[s("path",{attrs:{d:"M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z"}})])]},proxy:!0},e.hasState?{key:"prepend",fn:function(){return[s("DropdownItem",{attrs:{disabled:e.stateDisabled},on:{click:function(a){return a.preventDefault(),e.handleStateDropdownClicked.apply(null,arguments)}}},[s("div",{staticClass:"row align-items-center gx-2 flex-nowrap"},[s("div",{staticClass:"col-auto"},[s("StateIcon",{attrs:{color:e.stateOptions?e.stateOptions.color:"#fff"}})],1),s("div",{staticClass:"col"},[s("div",{staticClass:"row gx-2"},[e.stateDisabled?e._e():[s("div",{staticClass:"col-auto"},[e._v(" "+e._s(e.l("modals.entity_state.edit.title"))+" : ")])],s("div",{staticClass:"col-auto"},[e._v(" "+e._s(e.stateOptions?e.stateOptions.label:e.state)+" ")])],2)])])]),s("DropdownSeparator")]},proxy:!0}:null,e.canDelete?{key:"append",fn:function(){return[e.hasCommands?[s("DropdownSeparator")]:e._e(),s("DropdownItem",{attrs:{"link-class":"text-danger"},on:{click:e.handleDeleteClicked}},[e._v(" "+e._s(e.l("action_bar.form.delete_button"))+" ")])]},proxy:!0}:null],null,!0)})],1)]:e._e()],2)])},__=[],g_=r(p_,f_,__,!1,null,null,null,null);const v_=g_.exports,b_={name:"SharpEntityList",mixins:[ds,y,Ae],components:{Search:hs,SharpFilter:de,EntityActions:v_,DataList:qt,DataListRow:Fe,StateIcon:De,CommandsDropdown:L,Button:_,Modal:F,ModalSelect:Re,CommandFormModal:qe,CommandViewPanel:Ke,GlobalMessage:ae,DropdownItem:x,DropdownSeparator:U,Loading:I,LoadingOverlay:ne},props:{entityKey:String,module:String,inline:Boolean,showCreateButton:{type:Boolean,default:!0},showReorderButton:{type:Boolean,default:!0},showSearchField:{type:Boolean,default:!0},showEntityState:{type:Boolean,default:!0},hiddenCommands:Object,filters:Array,visible:{type:Boolean,default:!0},focusedItem:Number},data(){return{ready:!1,loading:!1,page:0,search:"",sortedBy:null,sortDir:null,sortDirs:{},reordering:!1,reorderedItems:null,selecting:!1,selectedItems:[],deletingItem:null,containers:null,layout:null,data:null,fields:null,config:null,authorizations:null,forms:null,breadcrumb:null,currentCommandInstanceId:null}},watch:{query(t,e){Pt(t,e)||this.init()},visible(t){t&&!this.ready&&this.init()}},computed:{classes(){return{"SharpEntityList--has-state-only":this.hasStateOnly}},rootFilters(){return this.storeGetter("filters/rootFilters")},resolvedFilters(){return this.filters??this.rootFilters},isFiltersValuated(){return this.storeGetter("filters/isValuated")(this.resolvedFilters)||this.search},filtersValues(){return this.storeGetter("filters/values")},filterNextQuery(){return this.storeGetter("filters/nextQuery")},filterDefaultQuery(){return this.storeGetter("filters/defaultQuery")(this.resolvedFilters)},getFiltersValuesFromQuery(){return this.storeGetter("filters/getValuesFromQuery")},query(){return this.storeGetter("query")},commandsQuery(){return{...this.storeGetter("filters/getQueryParams")(this.filtersValues),...this.query}},hasMultiforms(){return!!this.forms},hasShowPage(){return!!this.config.hasShowPage},apiParams(){return this.query},apiPath(){return`list/${this.entityKey}`},actionBarProps(){var t,e;return this.ready?{ready:!0,count:this.totalCount,forms:this.multiforms,commands:this.currentEntityCommands,dropdownCommands:this.dropdownCommands,primaryCommand:this.primaryCommand,reordering:this.reordering,selecting:this.selecting,canCreate:this.canCreate,canReorder:this.canReorder,canSearch:this.canSearch,canSelect:this.canSelect,breadcrumb:(t=this.breadcrumb)==null?void 0:t.items,showBreadcrumb:!!((e=this.breadcrumb)!=null&&e.visible),selectedCount:this.selectedItems.length}:{ready:!1}},actionBarListeners(){return{command:this.handleEntityCommandRequested,"search-submit":this.handleSearchSubmitted,"filter-change":this.handleFilterChanged,"reorder-click":this.handleReorderButtonClicked,"reorder-submit":this.handleReorderSubmitted,"select-click":this.handleSelectButtonClicked,"select-cancel":this.handleSelectCancelled,create:this.handleCreateButtonClicked}},allowedEntityCommands(){return(this.config.commands.entity||[]).map(t=>t.filter(e=>this.isEntityCommandAllowed(e)))},currentEntityCommands(){return this.selecting?this.allowedEntityCommands.map(t=>t.filter(e=>e.instance_selection)):this.allowedEntityCommands},dropdownCommands(){return this.currentEntityCommands.map(t=>t.filter(e=>!e.primary))},primaryCommand(){return this.currentEntityCommands.flat().find(t=>t.primary)},multiforms(){return this.forms?Object.values(this.forms):null},canCreate(){return this.showCreateButton&&!!this.authorizations.create},canReorder(){return this.showReorderButton&&this.config.reorderable&&this.authorizations.update&&this.items.length>1},canSearch(){return this.showSearchField&&!!this.config.searchable},canSelect(){return this.allowedEntityCommands.flat().some(t=>t.instance_selection)},items(){var t;return((t=this.data)==null?void 0:t.list.items)??[]},columns(){return this.layout.map(t=>({...t,...this.containers[t.key]}))},paginated(){return!!this.config.paginated},totalCount(){var t;return((t=this.data)==null?void 0:t.list.totalCount)??this.items.length},pageSize(){var t;return(t=this.data)==null?void 0:t.list.pageSize},hasActionsColumn(){return this.reordering?!1:this.items.some(t=>this.instanceHasState(t)||this.instanceHasCommands(t)||this.instanceCanDelete(t))},hasStateOnly(){return this.items.some(t=>!this.instanceHasCommands(t)&&this.instanceHasState(t)&&!this.instanceHasStateAuthorization(t))}},methods:{storeGetter(t){return this.$store.getters[`${this.module}/${t}`]},storeDispatch(t,e){return this.$store.dispatch(`${this.module}/${t}`,e)},handleSearchSubmitted(t){this.search=t,this.storeDispatch("setQuery",{...this.query,search:t,page:1})},handleFilterChanged(t,e){this.storeDispatch("setQuery",{...this.query,...this.filterNextQuery({filter:t,value:e}),page:1})},handleResetAllClicked(){this.storeDispatch("setQuery",{...this.query,...this.filterDefaultQuery,search:null,page:1})},handleReorderButtonClicked(){this.reordering=!this.reordering,this.reorderedItems=this.reordering?[...this.items]:null,this.$emit("reordering",this.reordering)},handleReorderSubmitted(){return this.storeDispatch("reorder",{instances:this.reorderedItems.map(t=>this.instanceId(t))}).then(()=>{this.data.list.items=[...this.reorderedItems],this.reorderedItems=null,this.reordering=!1,this.$emit("reordering",!1)})},handleCreateButtonClicked(t){const e=t?this.formUrl({formKey:t.key}):this.formUrl();location.href=e},handleSelectButtonClicked(){this.selecting=!0},handleSelectCancelled(){this.stopSelecting()},stopSelecting(){this.selecting=!1,this.selectedItems=[]},instanceId(t){const e=this.config.instanceIdAttribute;return e?t[e]:t.id},instanceState(t){if(!this.instanceHasState(t))return null;const e=this.config.state.attribute;return e?t[e]:t.state},instanceHasState(t){return!!this.config.state&&this.showEntityState},instanceHasCommands(t){return this.instanceCommands(t).flat().length>0},instanceHasStateAuthorization(t){if(!this.instanceHasState(t))return!1;const{authorization:e}=this.config.state,s=this.instanceId(t);return Array.isArray(e)?e.includes(s):!!e},instanceCommands(t){return(this.config.commands.instance||[]).reduce((e,s)=>[...e,s.filter(a=>this.isInstanceCommandAllowed(t,a))],[])},instanceStateOptions(t){if(!this.config.state)return null;const e=this.instanceState(t);return this.config.state.values.find(s=>s.value===e)},instanceForm(t){const e=this.instanceId(t);return this.multiforms.find(s=>s.instances.includes(e))},instanceUrl(t){const e=this.instanceId(t);if(!this.instanceHasViewAuthorization(t))return null;if(this.hasShowPage)return this.showUrl({instanceId:e});if(this.hasMultiforms){const s=this.instanceForm(t)||{};return this.formUrl({formKey:s.key,instanceId:e})}return this.formUrl({instanceId:e})},instanceHasViewAuthorization(t){const e=this.instanceId(t),s=this.authorizations.view;return Array.isArray(s)?s.includes(e):!!s},instanceIsFocused(t){const e=this.instanceId(t);return this.focusedItem&&this.focusedItem===e},instanceCanDelete(t){var a;const e=this.instanceId(t),s=Array.isArray(this.authorizations.delete)?(a=this.authorizations.delete)==null?void 0:a.includes(e):!!this.authorizations.delete;return!this.config.deleteHidden&&s},setState(t,e){const s=this.instanceId(t);return this.axiosInstance.post(`${this.apiPath}/state/${s}`,{attribute:this.config.state.attribute,value:e}).then(a=>{const{data:n}=a;this.handleCommandActionRequested(n.action,n)}).catch(a=>{var i,l;const n=(i=a.response)==null?void 0:i.data;((l=a.response)==null?void 0:l.status)===422&&D(n.message,{title:o("modals.state.422.title"),isError:!0})})},handleInstanceStateChanged(t,e){this.setState(t,e)},handleSortChanged({prop:t,dir:e}){this.storeDispatch("setQuery",{...this.query,page:1,sort:t,dir:e})},handleReorderedItemsChanged(t){this.reorderedItems=t},handlePageChanged(t){this.storeDispatch("setQuery",{...this.query,page:t})},async handleInstanceDeleteClicked(t){const e=this.instanceId(t);this.deletingItem=t;try{await Yt(this.config.deleteConfirmationText)&&(await h_({entityKey:this.entityKey,instanceId:e}),this.init())}finally{this.deletingItem=null}},formUrl({formKey:t,instanceId:e}={}){return ls({entityKey:t?`${this.entityKey}:${t}`:this.entityKey,instanceId:e},{append:!0})},showUrl({instanceId:t}={}){return Kr({entityKey:this.entityKey,instanceId:t},{append:!0})},tryParseNumber(t){if(Array.isArray(t))return t.map(this.tryParseNumber);let e=Number(t);return isNaN(Number(e))?t:e},filterValueOrDefault(t,e){return t!=null&&t!==""?this.tryParseNumber(t):e.default||(e.multiple?[]:null)},showLoading(){this.inline||this.$store.dispatch("setLoading",!0)},hideLoading(){this.inline||this.$store.dispatch("setLoading",!1)},initCommands(){this.addCommandActionHandlers({refresh:this.handleRefreshCommand})},handleInstanceCommandRequested(t,e){const s=this.instanceId(t);this.handleCommandRequested(e,{instanceId:s})},handleEntityCommandRequested(t){const e=this.selecting?this.selectedItems:null;this.handleCommandRequested(t,{selectedInstanceIds:e})},async handleCommandRequested(t,{instanceId:e,selectedInstanceIds:s}={}){const a=this.commandsQuery,n=this.commandEndpoint(t.key,e);this.currentCommandInstanceId=e,await this.sendCommand(t,{postCommand:i=>v.post(n,{query:{...a,ids:s},...i},{responseType:"blob"}),getForm:i=>v.get(`${n}/form`,{params:{...a,...i,ids:s}}).then(l=>l.data)}),this.stopSelecting()},handleRefreshCommand(t){const e=(s,a)=>s.find(n=>this.instanceId(a)===this.instanceId(n));this.data.list.items=this.items.map(s=>e(t.items,s)||s)},commandEndpoint(t,e){return`${this.apiPath}/command/${t}${e?`/${e}`:""}`},isEntityCommandAllowed(t){const e=this.hiddenCommands?this.hiddenCommands.entity:null;return!!t.authorization&&!(e||[]).includes(t.key)},isInstanceCommandAllowed(t,e){const s=this.instanceId(t),a=this.hiddenCommands?this.hiddenCommands.instance:null;return(Array.isArray(e.authorization)?e.authorization.includes(s):!!e.authorization)&&!(a||[]).includes(e.key)},mount({containers:t,layout:e,data:s,fields:a,config:n,authorizations:i,forms:l,breadcrumb:d}){this.containers=t,this.layout=e,this.data=s??{},this.fields=a??{},this.config={...n,commands:(n==null?void 0:n.commands)??{},filters:(n==null?void 0:n.filters)??[]},this.authorizations=i,this.forms=l,this.breadcrumb=d,this.page=this.data.list.page,!this.sortDir&&(this.sortDir=this.config.defaultSortDir),!this.sortedBy&&(this.sortedBy=this.config.defaultSort)},bindParams(t){let{search:e,page:s,sort:a,dir:n}=t;this.search=e,s&&(this.page=Number(s)),a&&(this.sortedBy=a),n&&(this.sortDir=n)},async init(){this.visible&&(this.loading=!0,await this.storeDispatch("setEntityKey",this.entityKey),await this.get().catch(t=>(this.$emit("error",t),Promise.reject(t))),this.bindParams(this.query),await this.storeDispatch("update",{config:this.config,filtersValues:this.getFiltersValuesFromQuery(this.query)}),this.$emit("change",{data:this.data,layout:this.layout,config:this.config,containers:this.containers,authorizations:this.authorizations,forms:this.forms}),this.ready=!0,this.loading=!1)}},beforeMount(){this.init(),this.initCommands()}};var y_=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpEntityList",class:e.classes},[e._t("action-bar",null,{props:e.actionBarProps,listeners:e.actionBarListeners}),e.ready?[s("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}]},[e.config.globalMessage?[s("GlobalMessage",{attrs:{options:e.config.globalMessage,data:e.data,fields:e.fields}})]:e._e(),s("DataList",{attrs:{items:e.items,columns:e.columns,page:e.page,paginated:e.paginated,"total-count":e.totalCount,"page-size":e.pageSize,reordering:e.reordering,sort:e.sortedBy,dir:e.sortDir},on:{change:e.handleReorderedItemsChanged,"sort-change":e.handleSortChanged,"page-change":e.handlePageChanged},scopedSlots:e._u([{key:"empty",fn:function(){return[e._v(" "+e._s(e.l("entity_list.empty_text"))+" ")]},proxy:!0},e.canSearch||e.resolvedFilters&&e.resolvedFilters.length?{key:"prepend",fn:function(){return[s("div",{staticClass:"p-3"},[s("div",{staticClass:"row gy-3 gx-4"},[e.canSearch?[s("div",{staticClass:"col-md-auto"},[s("Search",{staticClass:"h-100 mw-100",staticStyle:{"--width":"150px","--focused-width":"250px"},attrs:{value:e.search,placeholder:e.l("action_bar.list.search.placeholder"),disabled:e.reordering},on:{submit:e.handleSearchSubmitted}})],1)]:e._e(),e.resolvedFilters.length?[s("div",{staticClass:"col-md"},[s("div",{staticClass:"row gx-2 gy-2"},[e._l(e.resolvedFilters,function(a){return[s("div",{staticClass:"col-auto"},[s("SharpFilter",{key:a.id,attrs:{filter:a,value:e.filtersValues[a.key],disabled:e.reordering},on:{input:function(n){return e.handleFilterChanged(a,n)}}})],1)]}),e.isFiltersValuated?[s("div",{staticClass:"col-auto d-flex"},[s("button",{staticClass:"btn btn-link d-inline-flex align-items-center btn-sm fs-8",on:{click:e.handleResetAllClicked}},[e._v(" "+e._s(e.l("filters.reset_all"))+" ")])])]:e._e()],2)])]:e._e()],2)])]},proxy:!0}:null,{key:"item",fn:function({item:a}){return[s("DataListRow",{attrs:{url:e.instanceUrl(a),columns:e.columns,highlight:e.instanceIsFocused(a)||e.selecting&&e.selectedItems.includes(e.instanceId(a)),selecting:e.selecting,deleting:e.deletingItem?e.instanceId(a)===e.instanceId(e.deletingItem):!1,row:a},scopedSlots:e._u([e.selecting?{key:"prepend",fn:function(){return[s("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedItems,expression:"selectedItems"}],staticClass:"form-check-input d-block mt-0 me-4",attrs:{id:`check-${e.entityKey}-${e.instanceId(a)}`,type:"checkbox",name:e.entityKey},domProps:{value:e.instanceId(a),checked:Array.isArray(e.selectedItems)?e._i(e.selectedItems,e.instanceId(a))>-1:e.selectedItems},on:{change:function(n){var i=e.selectedItems,l=n.target,d=!!l.checked;if(Array.isArray(i)){var u=e.instanceId(a),c=e._i(i,u);l.checked?c<0&&(e.selectedItems=i.concat([u])):c>-1&&(e.selectedItems=i.slice(0,c).concat(i.slice(c+1)))}else e.selectedItems=d}}}),s("label",{staticClass:"d-block position-absolute start-0 top-0 w-100 h-100",staticStyle:{"z-index":"3"},attrs:{for:`check-${e.entityKey}-${e.instanceId(a)}`}},[s("span",{staticClass:"visually-hidden"},[e._v("Select")])])]},proxy:!0}:null,e.hasActionsColumn?{key:"append",fn:function(n){return[s("EntityActions",{attrs:{config:e.config,"has-state":e.instanceHasState(a),state:e.instanceState(a),"state-options":e.instanceStateOptions(a),"state-disabled":!e.instanceHasStateAuthorization(a),"has-commands":e.instanceHasCommands(a),commands:e.instanceCommands(a),"can-delete":e.instanceCanDelete(a),selecting:e.selecting},on:{command:function(i){return e.handleInstanceCommandRequested(a,i)},"state-change":function(i){return e.handleInstanceStateChanged(a,i)},delete:function(i){return e.handleInstanceDeleteClicked(a)}}})]}}:null],null,!0)})]}},{key:"append-body",fn:function(){return[e.inline&&e.loading?[s("LoadingOverlay",{attrs:{small:"",absolute:"",fade:""}})]:e._e()]},proxy:!0}],null,!0)})],2)]:e.visible&&e.inline?[s("Loading",{attrs:{small:"",fade:""}})]:e._e(),s("CommandFormModal",e._g(e._b({attrs:{command:e.currentCommand,"entity-key":e.entityKey,"instance-id":e.currentCommandInstanceId}},"CommandFormModal",e.commandFormProps,!1),e.commandFormListeners)),s("CommandViewPanel",{attrs:{content:e.commandViewContent},on:{close:e.handleCommandViewPanelClosed}})],2)},C_=[],$_=r(b_,y_,C_,!1,null,null,null,null);const oa=$_.exports,w_={components:{Dropdown:$,DropdownItem:x},props:{forms:Array},computed:{hasIcon(){var t;return(t=this.forms)==null?void 0:t.some(e=>e.icon)},visibleForms(){var t;return(t=this.forms)==null?void 0:t.filter(e=>!!e.label||e.icon)}},methods:{l:o,handleSelected(t){this.$emit("select",t)}}};var S_=function(){var e=this,s=e._self._c;return s("Dropdown",e._b({attrs:{text:e.l("action_bar.list.forms_dropdown")}},"Dropdown",e.$attrs,!1),[e._l(e.visibleForms,function(a){return[s("DropdownItem",{key:a.key,on:{click:function(n){return e.handleSelected(a)}}},[s("div",{staticClass:"row gx-2 flex-nowrap"},[e.hasIcon?[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"fa-fw"},[s("i",{staticClass:"fa",class:a.icon})])])]:e._e(),s("div",{staticClass:"col"},[e._v(" "+e._s(a.label)+" ")])],2)])]})],2)},k_=[],x_=r(w_,S_,k_,!1,null,null,null,null);const da=x_.exports,F_={props:{count:Number,search:String},methods:{lang:o},computed:{searchLabel(){return o("action_bar.list.search.title").replace(":search",this.search)}}};var L_=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpEntityListTitle"},[s("div",{staticClass:"row align-items-center gx-2 h-100"},[e.$slots.default?[s("div",{staticClass:"col-auto"},[e._t("default")],2)]:e._e(),e.count?[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"SharpEntityListTitle__info"},[s("div",{staticClass:"row",staticStyle:{"--bs-gutter-x":"inherit"}},[e.$slots.default?[s("div",{staticClass:"col-auto"},[e._v(" • ")])]:e._e(),s("div",{staticClass:"col"},[s("span",{staticClass:"text-nowrap"},[e._v(e._s(e.count)+" "+e._s(e.lang("action_bar.list.items_count")))])])],2)])])]:e._e(),e.search?[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"SharpEntityListTitle__info"},[s("div",{staticClass:"row",staticStyle:{"--bs-gutter-x":"inherit"}},[s("div",{staticClass:"col-auto"},[e._v(" • ")]),s("div",{staticClass:"col"},[s("span",{staticClass:"text-nowrap"},[e._v(e._s(e.searchLabel))])])])])])]:e._e()],2)])},B_=[],O_=r(F_,L_,B_,!1,null,null,null,null);const ca=O_.exports,E_={name:"SharpActionBarList",mixins:[y],components:{CommandsDropdown:L,EntityListTitle:ca,MultiformDropdown:da,Dropdown:$,DropdownItem:x,SharpFilter:de,Search:hs,Button:_,Breadcrumb:xe},props:{count:Number,filters:Array,filtersValues:Object,forms:Array,primaryCommand:Object,dropdownCommands:Array,canCreate:Boolean,canReorder:Boolean,canSelect:Boolean,reordering:Boolean,selecting:Boolean,selectedCount:Number,breadcrumb:Array,showBreadcrumb:Boolean},data(){return{stuck:!1}},computed:{hasForms(){return this.forms&&this.forms.length>0}},methods:{handleFilterChanged(t,e){this.$emit("filter-change",t,e)},handleReorderButtonClicked(){this.$emit("reorder-click"),document.activeElement.blur()},handleReorderSubmitButtonClicked(){this.$emit("reorder-submit")},handleCreateButtonClicked(){this.$emit("create")},handleCreateFormSelected(t){this.$emit("create",t)},handleCommandSelected(t){this.$emit("command",t)},handleSelectButtonClicked(){this.$emit("select-click")},handleSelectCancelled(){this.$emit("select-cancel")}},directives:{sticky:H}};var I_=function(){var e=this,s=e._self._c;return s("div",{directives:[{name:"sticky",rawName:"v-sticky"}],staticClass:"action-bar mt-4 mb-3 position-sticky ShowEntityListField__action-bar",on:{"stuck-change":function(a){e.stuck=a.detail}}},[s("div",{staticClass:"row align-items-center"},[s("div",{staticClass:"col position-relative"},[s("EntityListTitle",{attrs:{count:e.count}},[s("Breadcrumb",{attrs:{items:e.breadcrumb}})],1)],1),s("div",{staticClass:"col-auto position-relative"},[s("div",{staticClass:"row justify-content-end flex-nowrap gx-3"},[e.canReorder&&!e.selecting?[e.reordering?[s("div",{staticClass:"col-auto"},[s("Button",{attrs:{outline:""},on:{click:e.handleReorderButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.reorder_button.cancel"))+" ")])],1),s("div",{staticClass:"col-auto"},[s("Button",{on:{click:e.handleReorderSubmitButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.reorder_button.finish"))+" ")])],1)]:[s("div",{staticClass:"col-auto"},[s("Button",{attrs:{outline:""},on:{click:e.handleReorderButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.reorder_button"))+" ")])],1)]]:e._e(),e.canSelect&&!e.reordering?[e.selecting?[s("div",{staticClass:"col-auto"},[s("Button",{key:"cancel",attrs:{outline:""},on:{click:e.handleSelectCancelled}},[e._v(" "+e._s(e.l("action_bar.list.reorder_button.cancel"))+" ")])],1)]:[s("div",{staticClass:"col-auto"},[s("Button",{key:"select",attrs:{outline:""},on:{click:e.handleSelectButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.select_button"))+" ")])],1)]]:e._e(),e.dropdownCommands&&e.dropdownCommands.flat().length&&!e.reordering?[s("div",{staticClass:"col-auto"},[s("CommandsDropdown",{staticClass:"bg-white",attrs:{small:!1,outline:!e.selecting,commands:e.dropdownCommands,disabled:e.reordering,selecting:e.selecting},on:{select:e.handleCommandSelected},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(e.l("entity_list.commands.entity.label"))+" "),e.selecting?[e._v(" ("+e._s(e.selectedCount)+" selected) ")]:e._e()]},proxy:!0}],null,!1,3264030395)})],1)]:e._e(),e.primaryCommand&&!e.reordering&&!e.selecting?[s("div",{staticClass:"col-auto"},[s("Button",{on:{click:function(a){return e.handleCommandSelected(e.primaryCommand)}}},[e._v(" "+e._s(e.primaryCommand.label)+" ")])],1)]:e._e(),e.canCreate&&!e.reordering&&!e.selecting?[s("div",{staticClass:"col-auto"},[e.hasForms?[s("MultiformDropdown",{attrs:{forms:e.forms,right:""},on:{select:e.handleCreateFormSelected}})]:[s("Button",{attrs:{disabled:e.reordering||e.selecting},on:{click:e.handleCreateButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.create_button"))+" ")])]],2)]:e._e()],2)])])])},T_=[],A_=r(E_,I_,T_,!1,null,null,null,null);const R_=A_.exports,D_={name:"SharpEntityListPage",components:{EntityList:oa,ActionBarList:R_},data(){return{ready:!1}},watch:{query:"handleQueryChanged","$route.query":"init"},computed:{...A("entity-list",["query"]),entityKey(){return this.$route.params.entityKey}},methods:{handleQueryChanged(t){const e=this.$router.resolve({query:t}).route;this.$route.fullPath!==e.fullPath&&this.$router.push({query:{...t}})},handleError(t){this.$emit("error",t)},async init(){await this.$store.dispatch("entity-list/setQuery",{...this.$route.query}),this.ready=!0}},created(){this.init()}};var P_=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpEntityListPage",attrs:{"data-popover-boundary":""}},[s("div",{staticClass:"container"},[e.ready?[s("EntityList",{attrs:{"entity-key":e.entityKey,module:"entity-list"},on:{error:e.handleError},scopedSlots:e._u([{key:"action-bar",fn:function({props:a,listeners:n}){return[s("ActionBarList",e._g(e._b({},"ActionBarList",a,!1),n))]}}],null,!1,4144326494)})]:e._e()],2)])},z_=[],M_=r(D_,P_,z_,!1,null,null,null,null);const j_=M_.exports,N_=[{name:"entity-list",path:"/s-list/:entityKey",component:j_}];function V_(t,{router:e,store:s}){s.registerModule("entity-list",la),e.addRoutes(N_)}function U_({entityKey:t,instanceId:e}){return v.get(`show/${t}/${e||""}`).then(s=>s.data)}function H_({entityKey:t,instanceId:e}){return v.delete(`show/${t}/${e||""}`).then(s=>s.data)}function q_({entityKey:t,instanceId:e,commandKey:s,data:a}){return v.post(`show/${t}/command/${s}/${e||""}`,{...a},{responseType:"blob"})}function K_({entityKey:t,instanceId:e,commandKey:s,query:a}){return v.get(`show/${t}/command/${s}${e?`/${e}`:""}/form`,{params:{...a}}).then(n=>n.data)}function G_({entityKey:t,instanceId:e,value:s}){return v.post(`show/${t}/state/${e||""}`,{value:s}).then(a=>a.data)}const bt="SET_ENTITY_KEY",yt="SET_INSTANCE_ID",Ct="SET_SHOW_VIEW",W_={namespaced:!0,modules:{filters:oe,"entity-lists":{namespaced:!0}},state:{entityKey:null,instanceId:null,show:null},mutations:{[Ct](t,e){t.show=e},[bt](t,e){t.entityKey=e},[yt](t,e){t.instanceId=e}},getters:{entityKey(t){return t.entityKey},instanceId(t){return t.instanceId},config(t){return t.show.config},fields(t){return t.show.fields},layout(t){return t.show.layout},data(t){return t.show.data},locales(t){var e;return(e=t.show)==null?void 0:e.locales},breadcrumb(t){return t.show.breadcrumb},authorizations(t){return t.show.authorizations},canEdit(t,e){return e.authorizations.update},canChangeState(t,e){return!!e.config.state&&e.config.state.authorization},authorizedCommands(t,e){return((e.config.commands||{}).instance||[]).map(a=>a.filter(n=>n.authorization))},instanceState(t,e){return e.config.state?e.data[e.config.state.attribute]:null},instanceStateOptions(t,e){var s;return(s=e.config.state)==null?void 0:s.values.find(a=>a.value===e.instanceState)},stateValues(t,e){var s;return(s=e.config.state)==null?void 0:s.values}},actions:{async get({state:t,commit:e}){const s=await U_({entityKey:t.entityKey,instanceId:t.instanceId});return e(Ct,s),s},delete({state:t}){return H_({entityKey:t.entityKey,instanceId:t.instanceId})},postCommand({state:t},{command:e,data:s}){return q_({entityKey:t.entityKey,instanceId:t.instanceId,commandKey:e.key,data:s})},getCommandForm({state:t},{command:e,query:s}){return K_({entityKey:t.entityKey,instanceId:t.instanceId,commandKey:e.key,query:s})},postState({state:t,getters:e},s){return G_({entityKey:t.entityKey,instanceId:t.instanceId,attribute:e.config.state.attribute,value:s})},setEntityKey({commit:t},e){t(bt,e)},setInstanceId({commit:t},e){t(yt,e)}}},Q_={mixins:[y],components:{DropdownSeparator:U,LocaleSelect:le,Breadcrumb:xe,CommandsDropdown:L,Dropdown:$,DropdownItem:x,StateIcon:De,Button:_,ModalSelect:Re},props:{commands:Array,formUrl:String,backUrl:String,canEdit:Boolean,editDisabled:Boolean,canChangeState:Boolean,showBackButton:Boolean,state:[String,Number],stateOptions:Object,stateValues:Array,breadcrumb:Array,showBreadcrumb:Boolean,currentLocale:String,locales:Array,canDelete:Boolean},data(){return{showTitle:!1}},computed:{hasCommands(){var t;return((t=this.commands)==null?void 0:t.flat().length)>0},hasState(){return!!this.state},title(){var t;return this.breadcrumb&&this.showBreadcrumb?(t=this.breadcrumb[this.breadcrumb.length-1])==null?void 0:t.name:null}},methods:{handleEditButtonClicked(){this.$emit("edit")},handleCommandSelected(t){this.$emit("command",t)},handleStateChanged(t){this.$emit("state-change",t)},handleDeleteClicked(){this.$emit("delete")},handleScroll(){this.showTitle=document.querySelector(".ShowPage__content").getBoundingClientRect().top<0},handleLocaleChanged(t){this.$emit("locale-change",t)}}};var Y_=function(){var e=this,s=e._self._c;return s("div",{staticClass:"action-bar mt-4 mb-3"},[s("div",{staticClass:"row align-items-center gx-3"},[s("div",{staticClass:"col"},[e.showBreadcrumb?[s("Breadcrumb",{attrs:{items:e.breadcrumb}})]:e._e()],2),e.locales&&e.locales.length?[s("div",{staticClass:"col-auto"},[s("LocaleSelect",{attrs:{outline:"",right:"",locale:e.currentLocale,locales:e.locales},on:{change:e.handleLocaleChanged}})],1)]:e._e(),e.hasState?[s("div",{staticClass:"col-auto"},[s("Dropdown",{attrs:{"toggle-class":{"bg-white":!e.canChangeState},"show-caret":e.canChangeState,outline:"",right:"",disabled:!e.canChangeState},scopedSlots:e._u([{key:"text",fn:function(){return[s("StateIcon",{staticClass:"me-1",staticStyle:{"vertical-align":"-.125em"},attrs:{color:e.stateOptions?e.stateOptions.color:"#fff"}}),s("span",{staticClass:"text-truncate"},[e._v(e._s(e.stateOptions?e.stateOptions.label:e.state))])]},proxy:!0}],null,!1,2123308645)},[e._l(e.stateValues,function(a){return[s("DropdownItem",{key:a.value,attrs:{active:e.state===a.value},nativeOn:{mouseup:function(n){return n.preventDefault(),e.handleStateChanged(a.value)}}},[s("StateIcon",{staticClass:"me-1",staticStyle:{"vertical-align":"-.125em"},attrs:{color:a.color}}),s("span",{staticClass:"text-truncate"},[e._v(e._s(a.label))])],1)]})],2)],1)]:e._e(),e.hasCommands||e.canDelete?[s("div",{staticClass:"col-auto"},[s("CommandsDropdown",{attrs:{outline:"",small:!1,commands:e.commands},on:{select:e.handleCommandSelected},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(e.l("entity_list.commands.instance.label"))+" ")]},proxy:!0},e.canDelete?{key:"append",fn:function(){return[e.hasCommands?[s("DropdownSeparator")]:e._e(),s("DropdownItem",{attrs:{"link-class":"text-danger"},on:{click:e.handleDeleteClicked}},[e._v(" "+e._s(e.l("action_bar.form.delete_button"))+" ")])]},proxy:!0}:null],null,!0)})],1)]:e._e(),e.canEdit?[s("div",{staticClass:"col-auto"},[s("Button",{attrs:{href:e.formUrl,disabled:e.editDisabled}},[e._v(" "+e._s(e.l("action_bar.show.edit_button"))+" ")])],1)]:e._e()],2)])},X_=[],J_=r(Q_,Y_,X_,!1,null,null,null,null);const Z_=J_.exports,eg={mixins:[y],components:{CommandsDropdown:L,MultiformDropdown:da,Button:_},props:{ready:Boolean,count:Number,hasSearchQuery:Boolean,primaryCommand:Object,dropdownCommands:Array,forms:Array,canCreate:Boolean,canReorder:Boolean,canSelect:Boolean,reordering:Boolean,selecting:Boolean,selectedCount:Number,collapsed:Boolean,hasActiveQuery:Boolean,sticky:Boolean},data(){return{stuck:!1}},computed:{hasForms(){return this.forms&&this.forms.length>0},hasLeftControls(){return!1},hasRightControls(){return this.canReorder||this.canCreate||!!this.primaryCommand||this.hasDropdownCommands},hasOuterTitle(){return this.$slots.default&&(!this.ready||this.hasLeftControls)},hasDropdownCommands(){var t;return((t=this.dropdownCommands)==null?void 0:t.flat().length)>0},barVisible(){return this.collapsed?!this.hasLeftControls:!0}},methods:{handleFilterChanged(t,e){this.$emit("filter-change",t,e)},handleReorderButtonClicked(){this.$emit("reorder-click"),document.activeElement.blur()},handleReorderSubmitButtonClicked(){this.$emit("reorder-submit")},handleCommandSelected(t){this.$emit("command",t)},handleCreateButtonClicked(){this.$emit("create")},handleCreateFormSelected(t){this.$emit("create",t)},handleSelectButtonClicked(){this.$emit("select-click")},handleSelectCancelled(){this.$emit("select-cancel")}},directives:{sticky:H}};var tg=function(){var e=this,s=e._self._c;return s("div",{directives:[{name:"sticky",rawName:"v-sticky",value:e.sticky,expression:"sticky"}],staticClass:"action-bar",class:{"position-sticky":e.sticky},on:{"stuck-change":function(a){e.stuck=a.detail}}},[s("div",{staticClass:"position-relative"},[e.hasOuterTitle?[s("div",{staticClass:"mb-2"},[e._t("default")],2)]:e._e(),e.ready&&e.barVisible?[s("div",{staticClass:"row align-items-end align-content-end",attrs:{"data-sticky-anchor":""}},[s("div",{staticClass:"col-sm align-self-end"},[e._t("default")],2),e.hasRightControls&&!e.collapsed?[s("div",{staticClass:"col-sm-auto mb-2"},[s("div",{staticClass:"row flex-nowrap justify-content-end g-2 gx-md-3"},[e.canReorder?[s("div",{staticClass:"col-auto"},[e.reordering?[s("div",{staticClass:"row gx-3"},[s("div",{staticClass:"col-auto"},[s("Button",{attrs:{outline:"",small:""},on:{click:e.handleReorderButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.reorder_button.cancel"))+" ")])],1),s("div",{staticClass:"col-auto"},[s("Button",{attrs:{variant:"primary",small:""},on:{click:e.handleReorderSubmitButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.reorder_button.finish"))+" ")])],1)])]:[s("Button",{attrs:{outline:"",small:""},on:{click:e.handleReorderButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.reorder_button"))+" ")])]],2)]:e._e(),e.canSelect&&!e.reordering?[e.selecting?[s("div",{staticClass:"col-auto"},[s("Button",{key:"cancel",attrs:{small:"",outline:""},on:{click:e.handleSelectCancelled}},[e._v(" "+e._s(e.l("action_bar.list.reorder_button.cancel"))+" ")])],1)]:[s("div",{staticClass:"col-auto"},[s("Button",{key:"select",attrs:{small:"",outline:""},on:{click:e.handleSelectButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.select_button"))+" ")])],1)]]:e._e(),e.hasDropdownCommands&&!e.reordering?[s("div",{staticClass:"col-auto"},[s("CommandsDropdown",{staticClass:"bg-white",attrs:{small:"",outline:!e.selecting,commands:e.dropdownCommands,disabled:e.reordering,selecting:e.selecting},on:{select:e.handleCommandSelected},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(e.l("entity_list.commands.entity.label"))+" "),e.selecting?[e._v(" ("+e._s(e.selectedCount)+" selected) ")]:e._e()]},proxy:!0}],null,!1,3264030395)})],1)]:e._e(),e.primaryCommand&&!e.reordering?[s("div",{staticClass:"col-auto"},[s("Button",{attrs:{variant:"primary",small:""},on:{click:function(a){return e.handleCommandSelected(e.primaryCommand)}}},[e._v(" "+e._s(e.primaryCommand.label)+" ")])],1)]:e._e(),e.canCreate&&!e.reordering?[s("div",{staticClass:"col-auto"},[s("div",{staticClass:"action-bar__element"},[e.hasForms?[s("MultiformDropdown",{attrs:{forms:e.forms,variant:"primary",right:"",small:""},on:{select:e.handleCreateFormSelected}})]:[s("Button",{attrs:{variant:"primary",small:""},on:{click:e.handleCreateButtonClicked}},[e._v(" "+e._s(e.l("action_bar.list.create_button"))+" ")])]],2)])]:e._e()],2)])]:e._e()],2)]:e._e()],2)])},sg=[],ag=r(eg,tg,sg,!1,null,null,null,null);const ng=ag.exports,ig={props:{label:String}};var rg=function(){var e=this,s=e._self._c;return s("div",[e.label?[s("div",{staticClass:"show-field__label form-label"},[e._v(e._s(e.label))])]:e._e(),s("div",{staticClass:"show-field__content"},[e._t("default")],2)],2)},lg=[],og=r(ig,rg,lg,!1,null,null,null,null);const q=og.exports;function K(t,e,{lazy:s}={}){t.$watch(e,a=>{t.$emit("visible-change",a)},{immediate:!s})}const dg={mixins:[y],components:{EntityListTitle:ca,EntityList:oa,CommandsDropdown:L,ActionBar:ng,FieldLayout:q},props:{fieldKey:String,entityListKey:String,showCreateButton:Boolean,showReorderButton:Boolean,showSearchField:Boolean,showEntityState:Boolean,showCount:Boolean,hiddenFilters:Object,hiddenCommands:Object,label:String,emptyVisible:Boolean,collapsable:Boolean},data(){return{list:null,collapsed:this.collapsable&&!this.getFocusedItem(),focusedItem:this.getFocusedItem(),sticky:!1}},computed:{classes(){return{"ShowEntityListField--collapsed":this.collapsed}},storeModule(){return`show/entity-lists/${this.fieldKey}`},query(){return this.storeGetter("query")},filters(){return this.storeGetter("filters/rootFilters")},getFiltersQueryParams(){return this.storeGetter("filters/getQueryParams")},filtersValues(){return this.storeGetter("filters/values")},isVisible(){var t;if(this.hasCollapse||this.emptyVisible)return!0;if(this.list){const{data:e,authorizations:s}=this.list;return!!(((t=e.list.items)==null?void 0:t.length)>0||this.showCreateButton&&s.create||this.hasActiveQuery)}},visibleFilters(){return this.hiddenFilters?this.filters.filter(t=>!(t.key in this.hiddenFilters)):this.filters},hasActiveQuery(){const t=this.visibleFilters.some(e=>this.filtersValues[e.key]!=null);return!!this.query.search||t},hasCollapse(){return this.collapsable}},methods:{hasCommands(t){return t&&t.some(e=>e&&e.length>0)},storeGetter(t){return this.$store.getters[`${this.storeModule}/${t}`]},async handleChanged(t){this.list=t,await this.$nextTick(),this.layout()},handleDetailsToggle(t){this.collapsed=!t.target.open},getFocusedItem(){const t=qr();if(t!=null&&t.name&&Nr(t.params.entityKey,this.entityListKey)&&t.params.instanceId&&t.path.length>this.$route.path.length)return Number(t.params.instanceId)},layout(){this.sticky=this.$el.offsetHeight>window.innerHeight-nl()}},created(){const t=this.storeModule.split("/");this.$store.hasModule(t)||this.$store.registerModule(t,la),this.hiddenFilters&&this.$store.dispatch(`${this.storeModule}/setQuery`,this.getFiltersQueryParams(this.hiddenFilters)),K(this,()=>this.isVisible,{lazy:!0})},mounted(){if(this.focusedItem){const t=this.$el.getBoundingClientRect();window.scrollBy(0,t.top-100)}window.addEventListener("resize",()=>this.layout())}};var cg=function(){var e=this,s=e._self._c;return s("FieldLayout",{staticClass:"ShowEntityListField",class:e.classes},[s("EntityList",{attrs:{"entity-key":e.entityListKey,module:e.storeModule,"show-create-button":e.showCreateButton,"show-reorder-button":e.showReorderButton,"show-search-field":e.showSearchField,"show-entity-state":e.showEntityState,"hidden-commands":e.hiddenCommands,filters:e.visibleFilters,visible:!e.collapsed,"focused-item":e.focusedItem,inline:""},on:{change:e.handleChanged,reordering:function(a){return e.$emit("reordering",a)}},scopedSlots:e._u([{key:"action-bar",fn:function({props:a,listeners:n}){return[s("ActionBar",e._g(e._b({staticClass:"ShowEntityListField__action-bar",attrs:{collapsed:e.collapsed,"has-active-query":e.hasActiveQuery,sticky:e.sticky}},"ActionBar",a,!1),n),[e.hasCollapse?[s("div",{staticClass:"section__header section__header--collapsable position-relative"},[s("div",{staticClass:"row align-items-center gx-0 h-100"},[s("div",{staticClass:"col-auto"},[s("details",{attrs:{open:!e.collapsed},on:{toggle:e.handleDetailsToggle}},[s("summary",{staticClass:"stretched-link"},[s("span",{staticClass:"visually-hidden"},[e._v(e._s(e.label))])])])]),s("div",{staticClass:"col"},[s("EntityListTitle",{attrs:{count:e.showCount?a.count:null}},[s("h2",{staticClass:"ShowEntityListField__label section__title mb-0"},[e._v(" "+e._s(e.label)+" ")])])],1)])])]:[s("div",{staticClass:"section__header d-grid"},[s("EntityListTitle",{attrs:{count:e.showCount?a.count:null}},[s("h2",{staticClass:"ShowEntityListField__label section__title mb-0"},[e._v(" "+e._s(e.label)+" ")])])],1)]],2)]}}])})],1)},ug=[],hg=r(dg,cg,ug,!1,null,null,null,null);const mg=hg.exports;function $t(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent}function pg(t,e){const s=[...t.matchAll(/\S+\s*/g)];return s.length>e?s.slice(0,e).map(a=>a[0]).join(""):t}function fg(t){var e;return{name:`Embed_${t.tag}`,template:`
            <component :is="embedOptions.tag" class="embed">
                <EmbedRenderer
                    :data="embedData"
                    :options="embedOptions"
                >
                    <slot />
                </EmbedRenderer>
            </component>
        `,components:{EmbedRenderer:Zs},inject:["state"],props:{...(e=t.attributes)==null?void 0:e.filter(s=>s!=="slot").reduce((s,a)=>({...s,[a]:null}),{})},data(){return{index:0}},computed:{embedOptions(){return t},embedData(){var a;const s=this.state.embeds[t.key][this.index];return{...(a=t.attributes)==null?void 0:a.reduce((n,i)=>({...n,[i]:Js(this.$props[i])}),{}),...s}}},created(){this.index=this.state.embeds[t.key].length,this.state.embeds[t.key].push(this.embedData),is(this.embedOptions.tag)}}}const _g={components:{Button:_,FieldLayout:q},props:{value:Object,label:String,collapsed:{type:Boolean,default:!0},root:{type:Boolean,default:!0}},data(){return{thumbnailWidth:0}},computed:{...A("show",["entityKey","instanceId"]),classes(){return{"ShowFileField--has-label":!!this.label,"ShowFileField--has-placeholder":!this.hasThumbnail,"ShowFileField--root":this.root}},thumbnailColClasses(){return{"ShowFileField__thumbnail-col--collapsed":!this.hasThumbnail&&this.collapsed}},downloadUrl(){var t,e;return ws({entityKey:this.entityKey,instanceId:this.instanceId,disk:(t=this.value)==null?void 0:t.disk,path:(e=this.value)==null?void 0:e.path})},fileName(){var t;return((t=this.value)==null?void 0:t.name)??""},hasThumbnail(){return!!this.thumbnailUrl},thumbnailUrl(){var t;return(t=this.value)==null?void 0:t.thumbnail},thumbnailStyle(){return{"max-height":this.thumbnailWidth?`${this.thumbnailWidth}px`:null}},sizeLabel(){var t;return(t=this.value)!=null&&t.size?Te(this.value.size):null},iconClass(){const t=this.fileName.split(".").pop(),e=bn(t);return e==="fa-file-csv"?`fas ${e}`:`far ${e}`},isVisible(){return!!this.value}},methods:{lang:o,async layout(){this.$refs.thumbnail&&(this.thumbnailWidth=this.$refs.thumbnail.parentElement.offsetWidth)},handleThumbnailLoaded(){this.layout()}},created(){K(this,()=>this.isVisible)},mounted(){this.layout(),this.handleResize=E(this.layout,150),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize)}};var gg=function(){var e=this,s=e._self._c;return s("FieldLayout",{staticClass:"ShowFileField",class:e.classes,attrs:{label:e.label}},[s("div",{staticClass:"row mx-n2"},[s("div",{staticClass:"col-3 px-2 align-self-center ShowFileField__thumbnail-col",class:e.thumbnailColClasses},[e.hasThumbnail?[s("div",{staticClass:"ShowFileField__thumbnail-container"},[s("img",{ref:"thumbnail",staticClass:"ShowFileField__thumbnail",style:e.thumbnailStyle,attrs:{src:e.thumbnailUrl,alt:""},on:{load:e.handleThumbnailLoaded}})])]:[s("div",{staticClass:"ShowFileField__placeholder text-center"},[s("i",{class:e.iconClass})])]],2),s("div",{staticClass:"col px-2",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"ShowFileField__name text-truncate mb-2"},[e._v(" "+e._s(e.fileName)+" ")]),s("div",{staticClass:"ShowFileField__info"},[s("div",{staticClass:"row mx-n2 h-100"},[e.sizeLabel?[s("div",{staticClass:"col-auto px-2"},[s("div",{staticClass:"ShowFileField__size text-muted"},[e._v(" "+e._s(e.sizeLabel)+" ")])])]:e._e(),s("div",{staticClass:"col-auto px-2"},[s("div",{staticClass:"text-muted"},[s("i",{staticClass:"fa fas fa-download"}),s("a",{staticStyle:{color:"inherit"},attrs:{href:e.downloadUrl,download:e.fileName}},[e._v(" "+e._s(e.lang("show.file.download"))+" ")])])])],2)])])])])},vg=[],bg=r(_g,gg,vg,!1,null,null,null,null);const ua=bg.exports,yg={components:{ShowFile:ua},inject:["state"],props:{name:String,path:String,disk:String,filterCrop:String,filterRotate:String},computed:{value(){const t={name:this.name,path:this.path,disk:this.disk},e=this.state.files.find(s=>W(s,t));return{...t,...e}},filters(){const t={crop:Ss(this.filterCrop),rotate:ks(this.filterRotate)};return Object.values(t).every(e=>e==null)?null:t}},created(){this.state.files.push({name:this.name,path:this.path,disk:this.disk,filters:this.filters})}};var Cg=function(){var e=this,s=e._self._c;return s("ShowFile",{staticClass:"embed",attrs:{value:e.value,root:!1}})},$g=[],wg=r(yg,Cg,$g,!1,null,null,null,null);const wt=wg.exports,Sg={props:{content:String}};var kg=function(){var e=this,s=e._self._c;return s("div",{staticClass:"card mb-3 html-content overflow-auto",attrs:{"data-html-content":"true"}},[s("div",{staticClass:"card-body"},[s("pre",{staticClass:"overflow-visible mb-0"},[e._v(e._s(e.content))])])])},xg=[],Fg=r(Sg,kg,xg,!1,null,null,null,null);const Lg=Fg.exports,Bg={props:{content:String,embeds:Object},provide(){return{state:this.state}},data(){return{state:{files:[],embeds:{}}}},watch:{content:"handleContentChanged"},computed:{component(){return{template:`<div>${this.formattedContent}</div>`,components:{"x-sharp-file":wt,"x-sharp-image":wt,"html-content":Lg,...Object.values(this.embeds??{}).reduce((t,e)=>({...t,[e.tag]:fg(e)}),{})}}},formattedContent(){const t=document.createElement("template");return t.innerHTML=this.content,t.content.querySelectorAll("[data-html-content]").forEach(e=>{const s=document.createElement("html-content");s.setAttribute("content",e.innerHTML.trim()),t.content.insertBefore(s,e),t.content.removeChild(e)}),t.innerHTML}},methods:{async init(){const t=this.$store.getters["show/entityKey"],e=this.$store.getters["show/instanceId"],s=this.state.files;s.length>0&&(this.state.files=await Me({entityKey:t,instanceId:e,files:s,thumbnailWidth:xs,thumbnailHeight:Fs})),Object.entries(this.state.embeds).filter(([a,n])=>n.length>0).forEach(async([a,n])=>{const i=await Xs({entityKey:t,instanceId:e,embedKey:a,embeds:n});this.state.embeds={...this.state.embeds,[a]:i}})},initState(){this.state.files=[],this.state.embeds=Object.fromEntries(Object.entries(this.embeds??{}).map(([t])=>[t,[]]))},async handleContentChanged(){this.initState(),await this.$nextTick(),await this.init()}},created(){this.initState()},mounted(){this.init()}};var Og=function(){var e=this,s=e._self._c;return s(e.component,{tag:"component"})},Eg=[],Ig=r(Bg,Og,Eg,!1,null,null,null,null);const Tg=Ig.exports,Ag={mixins:[y],components:{FieldLayout:q,TextRenderer:Tg},props:{value:[Object,String],collapseToWordCount:Number,label:String,emptyVisible:Boolean,html:Boolean,localized:Boolean,locale:String,embeds:Object},data(){return{expanded:!1}},computed:{classes(){return{"ShowTextField--html":this.html}},resolvedValue(){var t;return this.localized?(t=this.value)==null?void 0:t[this.locale]:this.value},currentContent(){return this.resolvedValue?this.hasCollapsed&&!this.expanded?this.collapsedContent:this.html?this.resolvedValue:$t(this.resolvedValue).trim():null},hasCollapsed(){return!!this.collapsedContent},collapsedContent(){if(!this.collapseToWordCount||!this.value)return null;const t=this.resolvedValue.trim(),e=$t(t),s=this.html?t:e,a=pg(e,this.collapseToWordCount);return a.length<e.length?yn(s,a.length+2,{html:this.html}):null},isVisible(){return!!this.value||this.emptyVisible}},methods:{handleToggleClicked(){this.expanded=!this.expanded}},created(){K(this,()=>this.isVisible)}};var Rg=function(){var e=this,s=e._self._c;return s("FieldLayout",{staticClass:"ShowTextField",class:e.classes,attrs:{label:e.label}},[e.html?[s("TextRenderer",{staticClass:"ShowTextField__content",attrs:{content:e.currentContent,embeds:e.embeds}})]:[s("div",{staticClass:"ShowTextField__content"},[e._v(e._s(e.currentContent))])],e.hasCollapsed?[s("div",{staticClass:"mt-2"},[s("a",{staticClass:"ShowTextField__more",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),e.handleToggleClicked.apply(null,arguments)}}},[e.expanded?[e._v(" - "+e._s(e.l("show.text.show_less"))+" ")]:[e._v(" + "+e._s(e.l("show.text.show_more"))+" ")]],2)])]:e._e()],2)},Dg=[],Pg=r(Ag,Rg,Dg,!1,null,null,null,null);const zg=Pg.exports,Mg={components:{FieldLayout:q},props:{value:String,label:String},computed:{isVisible(){return!!this.value}},created(){K(this,()=>this.isVisible)}};var jg=function(){var e=this,s=e._self._c;return s("FieldLayout",{staticClass:"ShowPictureField"},[s("div",{staticClass:"text-center"},[s("img",{staticClass:"ShowPictureField__thumbnail",attrs:{src:e.value,alt:""}})])])},Ng=[],Vg=r(Mg,jg,Ng,!1,null,null,null,null);const Ug=Vg.exports,Hg={components:{Grid:R,UnknownField:Le,FieldLayout:q},props:{value:Array,itemFields:{type:Object,required:!0},layout:Object,label:String,emptyVisible:Boolean},computed:{isEmpty(){return!this.value||this.value.length===0},isVisible(){return!this.isEmpty||this.emptyVisible},classes(){return{"ShowListField--empty":this.isEmpty}},fileFieldsCollapsed(){return this.allValuesOfType("file").every(e=>e&&!e.thumbnail)}},methods:{lang:o,fieldOptions(t){const e=this.itemFields?{...this.itemFields[t.key]}:null;return e||console.error(`Show list field: unknown field "${t.key}"`),e.type==="file"&&(e.collapsed=this.fileFieldsCollapsed),e},fieldValue(t,e){return t?t[e.key]:null},allValuesOfType(t){return(this.value||[]).reduce((e,s)=>[...e,...Object.entries(s).filter(([a])=>{const n=this.itemFields[a];return n&&n.type===t}).map(([a,n])=>n)],[])}},created(){K(this,()=>this.isVisible)}};var qg=function(){var e=this,s=e._self._c;return s("FieldLayout",{staticClass:"ShowListField",class:e.classes,attrs:{label:e.label}},[s("div",{staticClass:"ShowListField__content"},[e.isEmpty?[s("em",{staticClass:"ShowListField__empty text-muted"},[e._v(e._s(e.lang("show.list.empty")))])]:[s("div",{staticClass:"ShowListField__list"},[e._l(e.value,function(a){return[s("div",{staticClass:"ShowListField__item"},[s("Grid",{staticClass:"ShowListField__fields-grid",attrs:{rows:e.layout.item},scopedSlots:e._u([{key:"default",fn:function({itemLayout:n}){return[e.fieldOptions(n)?[s("ShowField",{attrs:{options:e.fieldOptions(n),value:e.fieldValue(a,n),"config-identifier":n.key,root:!1}})]:[s("UnknownField",{attrs:{name:n.key}})]]}}],null,!0)})],1)]})],2)]],2)])},Kg=[],Gg=r(Hg,qg,Kg,!1,null,null,null,null);const Wg=Gg.exports,Qg={entityList:mg,text:zg,picture:Ug,file:ua,list:Wg};function Yg(t){return ss(t)?as(t):Qg[t]}const Xg={mixins:[os],props:{value:{},options:Object,layout:Object,locale:String,locales:Array,collapsable:Boolean,root:{type:Boolean,default:!0}},data(){return{visible:!0}},computed:{component(){return this.options?Yg(this.options.type):null},props(){return{...this.options}},classes(){return[`show-field--${this.options.type}`]},isVisible(){return!!this.component&&this.visible}},methods:{handleVisiblityChanged(t){this.visible=t,this.$emit("visible-change",t)}}};var Jg=function(){var e=this,s=e._self._c;return s("div",{directives:[{name:"show",rawName:"v-show",value:e.isVisible,expression:"isVisible"}],staticClass:"show-field",class:e.classes},[s(e.component,e._g(e._b({tag:"component",attrs:{"field-key":e.options.key,"field-config-identifier":e.mergedConfigIdentifier,value:e.value,layout:e.layout,collapsable:e.collapsable,root:e.root,locale:e.locale,locales:e.locales},on:{"visible-change":e.handleVisiblityChanged}},"component",e.props,!1),e.$listeners))],1)},Zg=[],ev=r(Xg,Jg,Zg,!1,null,null,null,null);const ha=ev.exports,tv={components:{Grid:R,CommandsDropdown:L,SectionTitle:ms},props:{section:Object,fieldsRowClass:Function,collapsable:Boolean,layout:{type:String,validator:t=>["card","contents"].includes(t),default:"card"},commands:Array},data(){return{collapsed:this.collapsable}},computed:{classes(){return[`ShowSection--layout-${this.layout}`]},hasCollapse(){return this.collapsable},hasCommands(){var t;return((t=this.commands)==null?void 0:t.flat().length)>0},wrapperElement(){return this.hasCollapse?"details":"div"}},methods:{lang:o,handleCommandSelected(t){this.$emit("command",t)}}};var sv=function(){var e=this,s=e._self._c;return s("div",{staticClass:"ShowSection",class:e.classes},[s("div",{staticClass:"row"},[e.hasCollapse||e.section.title?[s("div",{staticClass:"col"},[s("SectionTitle",{attrs:{section:e.section,collapsable:e.hasCollapse,collapsed:e.collapsed},on:{toggle:function(a){e.collapsed=!a}}})],1)]:e._e(),e.hasCommands&&!e.collapsed?[s("div",{staticClass:"col-auto align-self-end mb-2"},[s("CommandsDropdown",{attrs:{outline:"",commands:e.commands},on:{select:e.handleCommandSelected},scopedSlots:e._u([{key:"text",fn:function(){return[e._v(" "+e._s(e.lang("entity_list.commands.instance.label"))+" ")]},proxy:!0}],null,!1,511806523)})],1)]:e._e()],2),e.collapsed?e._e():[s("div",{staticClass:"ShowSection__content"},[s("Grid",{staticClass:"ShowSection__grid",attrs:{rows:[e.section.columns],"col-class":()=>"ShowSection__col"},scopedSlots:e._u([{key:"default",fn:function({itemLayout:a}){return[s("Grid",{staticClass:"ShowPage__fields-grid",attrs:{rows:a.fields,"row-class":e.fieldsRowClass},scopedSlots:e._u([{key:"default",fn:function({itemLayout:n}){return[e._t("default",null,{fieldLayout:n})]}}],null,!0)})]}}],null,!1,3782670149)})],1)]],2)},av=[],nv=r(tv,sv,av,!1,null,null,null,null);const iv=nv.exports,rv={mixins:[Ae],components:{Section:iv,ActionBarShow:Z_,Grid:R,ShowField:ha,UnknownField:Le,CommandFormModal:qe,CommandViewPanel:Ke,GlobalMessage:ae,LocaleSelect:le},data(){return{ready:!1,fieldsVisible:null,locale:null,refreshKey:0,reorderingLists:{}}},computed:{...A("show",["entityKey","instanceId","fields","layout","data","config","locales","breadcrumb","authorizations","instanceState","instanceStateOptions","canEdit","authorizedCommands","stateValues","canChangeState"]),classes(){return{"ShowPage--localized":this.localized,"ShowPage--title":this.title}},formUrl(){const t=this.config.multiformAttribute?this.data[this.config.multiformAttribute]:null,e=t?`${this.entityKey}:${t}`:this.entityKey;return ls({entityKey:e,instanceId:this.instanceId},{append:!0})},backUrl(){return es(this.breadcrumb.items)},showBackButton(){return!!this.backUrl},breadcrumbItems(){return this.breadcrumb.items},localized(){var t;return((t=this.locales)==null?void 0:t.length)>0},isSingle(){return!!this.config.isSingle},canDelete(){var t;return((t=this.authorizations)==null?void 0:t.delete)&&!this.isSingle},title(){var t,e;return!this.ready||!this.config.titleAttribute?null:(t=this.fields[this.config.titleAttribute])!=null&&t.localized?(e=this.data[this.config.titleAttribute])==null?void 0:e[this.locale]:this.data[this.config.titleAttribute]},isReordering(){return Object.values(this.reorderingLists).some(t=>t)}},methods:{fieldOptions(t){var s;const e=(s=this.fields)==null?void 0:s[t.key];return e||console.error(`Show page: unknown field "${t.key}"`),e},fieldValue(t){var e;return(e=this.data)==null?void 0:e[t.key]},isFieldVisible(t){var e;return((e=this.fieldsVisible)==null?void 0:e[t.key])!==!1},isSectionCollapsable(t){return t.collapsable&&!this.sectionHasField(t,"entityList")},sectionLayout(t){return this.sectionHasField(t,"entityList")?"contents":"card"},sectionCommands(t){return t.key?(this.config.commands[t.key]??[]).map(e=>e.filter(s=>s.authorization)):null},fieldsRowClass(t){return["ShowPage__fields-row",...t.map(s=>`ShowPage__fields-row--${this.fieldOptions(s).type}`)]},sectionFields(t){return t.columns.reduce((e,s)=>[...e,...s.fields.flat()],[])},isSectionVisible(t){var s;return this.sectionFields(t).some(a=>this.isFieldVisible(a))||((s=this.sectionCommands(t))==null?void 0:s.flat().length)},sectionHasField(t,e){return this.sectionFields(t).some(a=>{const n=this.fieldOptions(a);return n&&n.type===e})},handleFieldVisibilityChanged(t,e){this.fieldsVisible={...this.fieldsVisible,[t]:e}},handleLocaleChanged(t){this.locale=t},handleReordering(t,e){this.reorderingLists={[t]:e}},handleCommandRequested(t){this.sendCommand(t,{postCommand:e=>this.$store.dispatch("show/postCommand",{command:t,data:e}),getForm:e=>this.$store.dispatch("show/getCommandForm",{command:t,query:{...e}})})},handleStateChanged(t){return this.$store.dispatch("show/postState",t).then(e=>{this.handleCommandActionRequested(e.action,e)}).catch(e=>{var a,n;const s=(a=e.response)==null?void 0:a.data;((n=e.response)==null?void 0:n.status)===422&&D(s.message,{title:o("modals.state.422.title"),isError:!0})})},async handleDeleteClicked(){await Yt(this.config.deleteConfirmationText)&&(await this.$store.dispatch("show/delete"),location.replace(this.backUrl??"/"))},handleRefreshCommand(){this.init()},initCommands(){this.addCommandActionHandlers({refresh:this.handleRefreshCommand})},updateDocumentTitle(t){var s,a;const e=(a=(s=t.breadcrumb)==null?void 0:s.items[t.breadcrumb.items.length-1])==null?void 0:a.documentTitleLabel;e&&(document.title=`${e}, ${document.title}`)},async init(){var e;await this.$store.dispatch("show/setEntityKey",this.$route.params.entityKey),await this.$store.dispatch("show/setInstanceId",this.$route.params.instanceId);const t=await Y(this.$store.dispatch("show/get").catch(s=>(this.$emit("error",s),Promise.reject(s))));ns(t.notifications),this.updateDocumentTitle(t),this.localized&&(this.locale=(e=this.locales)==null?void 0:e[0]),this.ready=!0,this.refreshKey++}},beforeMount(){this.init(),this.initCommands()}};var lv=function(){var e=this,s=e._self._c;return s("div",{staticClass:"ShowPage",class:e.classes},[s("div",{staticClass:"container"},[e.ready?[s("ActionBarShow",{attrs:{commands:e.authorizedCommands,state:e.instanceState,"state-options":e.instanceStateOptions,"state-values":e.stateValues,"form-url":e.formUrl,"back-url":e.backUrl,"can-edit":e.canEdit,"can-change-state":e.canChangeState,"show-back-button":e.showBackButton,breadcrumb:e.breadcrumbItems,"show-breadcrumb":e.breadcrumb.visible,"edit-disabled":e.isReordering,locales:e.locales,"current-locale":e.locale,"can-delete":e.canDelete},on:{command:e.handleCommandRequested,"state-change":e.handleStateChanged,"locale-change":e.handleLocaleChanged,delete:e.handleDeleteClicked}}),e.config.globalMessage?[s("GlobalMessage",{attrs:{options:e.config.globalMessage,data:e.data,fields:e.fields}})]:e._e(),s("div",{staticClass:"ShowPage__content"},[e.title||e.localized?[s("div",{class:e.title?"mb-3":"mb-4"},[s("div",{staticClass:"row align-items-center gx-3 gx-md-4"},[e.localized?void 0:e._e(),e.title?[s("div",{staticClass:"col",staticStyle:{"min-width":"0"}},[s("h1",{staticClass:"mb-0 text-truncate h2",attrs:{"data-top-bar-title":""},domProps:{innerHTML:e._s(e.title)}})])]:e._e()],2)])]:e._e(),e._l(e.layout.sections,function(a){return[s("Section",{directives:[{name:"show",rawName:"v-show",value:e.isSectionVisible(a),expression:"isSectionVisible(section)"}],staticClass:"ShowPage__section",attrs:{section:a,layout:e.sectionLayout(a),"fields-row-class":e.fieldsRowClass,collapsable:e.isSectionCollapsable(a),commands:e.sectionCommands(a)},on:{command:e.handleCommandRequested},scopedSlots:e._u([{key:"default",fn:function({fieldLayout:n}){return[e.fieldOptions(n)?[s("ShowField",{key:e.refreshKey,attrs:{options:e.fieldOptions(n),value:e.fieldValue(n),locale:e.locale,locales:e.locales,"config-identifier":n.key,layout:n,collapsable:a.collapsable},on:{"visible-change":function(i){return e.handleFieldVisibilityChanged(n.key,i)},reordering:function(i){return e.handleReordering(n.key,i)}}})]:[s("UnknownField",{attrs:{name:n.key}})]]}}],null,!0)})]})],2)]:[s("ActionBarShow")]],2),s("CommandFormModal",e._g(e._b({attrs:{command:e.currentCommand,"entity-key":e.entityKey,"instance-id":e.instanceId}},"CommandFormModal",e.commandFormProps,!1),e.commandFormListeners)),s("CommandViewPanel",{attrs:{content:e.commandViewContent},on:{close:e.handleCommandViewPanelClosed}})],1)},ov=[],dv=r(rv,lv,ov,!1,null,null,null,null);const cv=dv.exports,uv=[{name:"show",path:"/(.*)?/s-show/:entityKey/:instanceId?",component:cv}];function hv(t,{router:e,store:s}){e.addRoutes(uv),s.registerModule("show",W_),t.component("ShowField",ha)}function mv({query:t}){return v.get("/search",{params:{q:t}}).then(e=>e.data)}const pv={components:{Modal:F,Loading:I},props:{placeholder:String},data(){return{query:"",resultSets:null,loading:!1,modalVisible:!1}},computed:{visibleResultSets(){return(this.resultSets??[]).filter(t=>{var e,s;return((e=t.results)==null?void 0:e.length)||t.showWhenEmpty||((s=t.validationErrors)==null?void 0:s.length)})}},methods:{lang:o,async getResults(t){if(!(t!=null&&t.length))return;const e=setTimeout(()=>{this.loading=!0},200);try{this.resultSets=await mv({query:t})}finally{clearTimeout(e),this.loading=!1}},open(){this.modalVisible=!0,this.query="",this.resultSets=null},handleInput(){this.debouncedGetResults(this.query)},highlight(t){var e;return(e=this.query)!=null&&e.length?t.replace(new RegExp(this.query,"gi"),s=>`<mark class="px-0">${s}</mark>`):t},handleWindowKeydown(t){var s;const e=t.target.isContentEditable||/^(?:input|textarea|select)$/i.test(t.target.tagName);(((s=t.key)==null?void 0:s.toLowerCase())==="k"&&(t.metaKey||t.ctrlKey)||!e&&t.key==="/")&&(t.preventDefault(),this.open())}},created(){this.debouncedGetResults=E(this.getResults,200)},mounted(){window.addEventListener("keydown",this.handleWindowKeydown)},destroyed(){window.removeEventListener("keydown",this.handleWindowKeydown)}};var fv=function(){var e=this,s=e._self._c;return s("div",[s("button",{staticClass:"btn d-inline-flex btn-sm btn-outline-light border-0",on:{click:e.open}},[s("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor"}},[s("path",{attrs:{"fill-rule":"evenodd",d:"M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z","clip-rule":"evenodd"}})])]),s("Modal",{attrs:{visible:e.modalVisible,"no-close-on-backdrop":!1,"no-enforce-focus":!1,"hide-footer":"","body-class":"pb-5"},on:{"update:visible":function(a){e.modalVisible=a},shown:function(a){return e.$refs.input.focus()}},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.lang("action_bar.list.search.placeholder"))+" ")]},proxy:!0}])},[s("div",{staticClass:"position-relative"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.query,expression:"query"}],ref:"input",staticClass:"form-control pe-4.5",attrs:{type:"text",placeholder:e.placeholder},domProps:{value:e.query},on:{input:[function(a){a.target.composing||(e.query=a.target.value)},e.handleInput]}}),e.loading?[s("Loading",{staticClass:"position-absolute top-50 translate-middle-y",staticStyle:{right:".5rem"},attrs:{small:""}})]:e._e()],2),e.visibleResultSets.length&&e.query?[s("div",{staticClass:"mt-4.5 mb-n4.5"},[e._l(e.visibleResultSets,function(a){return[s("section",{staticClass:"mb-4.5"},[a.label?[s("h6",{staticClass:"d-flex mb-3"},[a.icon?[s("i",{staticClass:"fa fa-fw me-2",class:a.icon})]:e._e(),e._v(" "+e._s(a.label)+" ")],2)]:e._e(),(a.validationErrors||[]).length?[s("div",{staticClass:"text-danger fs-7"},[e._l(a.validationErrors,function(n){return[s("div",[e._v(e._s(n))])]})],2)]:e._e(),(a.results||[]).length?[s("div",{staticClass:"list-group"},[e._l(a.results,function(n){return[s("a",{staticClass:"list-group-item fs-7 list-group-item-action",attrs:{href:n.link}},[s("div",{domProps:{innerHTML:e._s(e.highlight(n.label))}}),n.detail?[s("div",{staticClass:"fs-8 text-muted",domProps:{innerHTML:e._s(e.highlight(n.detail))}})]:e._e()],2)]})],2)]:(a.validationErrors||[]).length?e._e():[s("div",{staticClass:"text-muted fs-7"},[e._v(" "+e._s(a.emptyStateLabel||e.lang("entity_list.empty_text"))+" ")])]],2)]})],2)]:e._e()],2)],1)},_v=[],gv=r(pv,fv,_v,!1,null,null,null,null);const vv=gv.exports;function bv(t){t.component("sharp-global-search",vv)}const yv={name:"SharpActionView",components:{Modal:F,LoadingOverlay:ne,TopBar:jl},provide(){return{axiosInstance:Zt()}},data(){return{showErrorPage:!1,errorPageData:null}},computed:{dialogs(){return this.$store.state.dialogs},isLoading(){return this.$store.getters.isLoading}},methods:{handlePageError(t){const{response:{status:e,data:s},config:{method:a}}=t;(a==="get"&&e===404||e===403)&&(this.showErrorPage=!0,this.errorPageData={status:e,message:s.message})}}};var Cv=function(){var e=this,s=e._self._c;return s("div",{staticClass:"SharpActionView"},[s("TopBar",{scopedSlots:e._u([{key:"right",fn:function(){return[s("div",{staticClass:"row align-items-center gx-4"},[e.$slots.search?[s("div",{staticClass:"col-auto"},[e._t("search")],2)]:e._e(),s("div",{staticClass:"col-auto"},[e._t("user-dropdown")],2)],2)]},proxy:!0}],null,!0)}),e.showErrorPage?[s("div",{staticClass:"container"},[s("h1",[e._v("Error "+e._s(e.errorPageData.status))]),s("p",[e._v(e._s(e.errorPageData.message))])])]:[s("router-view",{on:{error:e.handlePageError}}),s("notifications",{staticStyle:{top:"6rem",right:"1rem"},attrs:{position:"top right","animation-name":"slideRight",reverse:""},scopedSlots:e._u([{key:"body",fn:function({item:a,close:n}){return[s("div",{staticClass:"toast show mb-3",class:`border-${a.type}`,attrs:{role:"alert","aria-live":"assertive","aria-atomic":"true","data-test":"notification"}},[s("div",{staticClass:"toast-header"},[s("strong",{staticClass:"me-auto"},[e._v(e._s(a.title))]),s("button",{staticClass:"btn-close",attrs:{type:"button","data-test":"close-notification","aria-label":"Close"},on:{click:n}})]),a.text?[s("div",{staticClass:"toast-body",domProps:{innerHTML:e._s(a.text)}})]:e._e()],2)]}}])}),e._l(e.dialogs,function(a){return[s("Modal",e._b({key:a.id,on:{ok:a.okCallback,hidden:a.hiddenCallback}},"Modal",a.props,!1),[s("div",{domProps:{innerHTML:e._s(a.text)}})])]})],s("LoadingOverlay",{staticClass:"SharpActionView__loading",attrs:{visible:e.isLoading,fade:""}})],2)},$v=[],wv=r(yv,Cv,$v,!1,null,null,null,null);const Sv=wv.exports,kv={name:"SharpLeftNav",mixins:[Wr("lg")],components:{Loading:I},props:{currentEntity:Object,title:String,collapseable:{type:Boolean,default:!0},hidden:Boolean},data(){return{ready:!1,collapsed:!1,state:"expanded"}},watch:{collapsed:{handler(t){document.body.classList.toggle("leftNav--collapsed",this.collapsed),this.state=t?"collapsing":"expanding",setTimeout(this.updateState,250)}}},computed:{currentIcon(){var t;return(t=this.currentEntity)==null?void 0:t.icon},classes(){return[`SharpLeftNav--${this.state}`,{"SharpLeftNav--collapseable":this.collapseable,"SharpLeftNav--hidden":this.hidden}]}},methods:{updateState(){this.state=this.collapsed?"collapsed":"expanded"},handleClicked(){this.collapsed&&(this.collapsed=!1)},async init(){this.$store.dispatch("setCurrentEntity",this.currentEntity),this.ready=!0}},created(){this.collapsed=this.isViewportSmall&&!this.hidden,this.updateState(),this.init(),this.hidden&&document.body.classList.add("leftNav--hidden")}};var xv=function(){var e=this,s=e._self._c;return s("nav",{staticClass:"SharpLeftNav",class:e.classes,attrs:{role:"navigation","aria-label":"Menu Sharp"},on:{click:e.handleClicked}},[s("div",{staticClass:"SharpLeftNav__top-icon"},[s("i",{staticClass:"fa",class:e.currentIcon})]),s("div",{staticClass:"flex-grow-0"},[s("div",{staticClass:"SharpLeftNav__title-container position-relative"},[e._t("title",function(){return[s("h2",{staticClass:"SharpLeftNav__title mb-0"},[e._v(e._s(e.title))])]})],2)]),e.hidden?e._e():[s("div",{staticClass:"flex-grow-1 position-relative",staticStyle:{"min-height":"0"}},[s("div",{staticClass:"SharpLeftNav__content d-flex flex-column"},[s("div",{staticClass:"SharpLeftNav__inner flex-grow-1 pb-5",staticStyle:{"min-height":"0"}},[e._t("default")],2),s("a",{staticClass:"SharpLeftNav__collapse-button btn btn-text",attrs:{href:"#"},on:{click:function(a){a.preventDefault(),a.stopPropagation(),e.collapsed=!e.collapsed}}},[s("svg",{staticClass:"SharpLeftNav__collapse-arrow",staticStyle:{fill:"currentColor"},attrs:{width:"8",height:"12",viewBox:"0 0 8 12","fill-rule":"evenodd"}},[s("path",{attrs:{d:"M7.5 10.6L2.8 6l4.7-4.6L6.1 0 0 6l6.1 6z"}})])])])])]],2)},Fv=[],Lv=r(kv,xv,Fv,!1,null,null,null,null);const Bv=Lv.exports;m.use(Cn);m.use(Vn,{installComponents:!1});m.use(Ft);m.use(xt);const B=V(),O=T();m.use(vp,{store:O,router:B});m.use(u_,{store:O,router:B});m.use(V_,{store:O,router:B});m.use(tf,{store:O,router:B});m.use(np,{store:O,router:B});m.use(hv,{store:O,router:B});m.use(Kl,{store:O,router:B});m.use(bv,{store:O,router:B});m.component("sharp-action-view",Sv);m.component("sharp-left-nav",Bv);m.component("sharp-nav-section",ui);m.component("sharp-nav-item",ri);new m({el:"#sharp-app",store:O,router:B});
