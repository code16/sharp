import{d as W,W as A,a6 as ge,o as t,A as c,q as ve,a7 as we,a8 as ke,r as v,a9 as le,J as ce,y as fe,X as he,Y as Z,a0 as ee,aa as pe,ab as me,ac as U,a as r,w as o,j as C,u as e,Q as ae,b as B,t as S,c as y,k as E,ad as te,i as _,v as ye,ae as $e,a4 as Ce,$ as Se,V as O,af as ne,H as $,F as h,ag as Q,ah as Fe,ai as Ke,aj as ze,_ as L,ak as J,al as Y,am as M,an as ie,B as Be,ao as Re,G as Ve,I as Ie,ap as Le,aq as Ue,ar as qe,as as Ae,at as xe,au as oe,av as Ee,a5 as Te,S as De,aw as Pe,ax as je,ay as He,az as Ne,aA as G,aB as Qe,aC as Ge}from"./sharp-ByW3i59E.js";import{_ as We,a as re,b as de,p as Xe}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-D2LJ1l6a.js";import{E as Oe,_ as Je,u as Ye,a as Me,b as ue}from"./useEntityListHighlightedItem-BK4K1L43.js";import{_ as Ze}from"./Title.vue_vue_type_script_setup_true_lang-l4Axm4jF.js";import{_ as ea}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-DY5i5dm_.js";import{D as aa,_ as ta}from"./Dashboard-B9x6p95f.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-naOsYsfc.js";const sa=W({__name:"Section",props:{section:{}},setup(K){const i=A(K.section.collapsable),n=ge({collapsed:i,onCollapseToggle(){i.value=!i.value}});return(a,d)=>(t(),c("section",null,[ve(a.$slots,"default",we(ke(n)))]))}});class la{constructor(s,i,n){Object.assign(this,s),this.entityKey=i,this.instanceId=n}get formUrl(){return v().params.instanceId?v("code16.sharp.form.edit",{parentUri:le(),entityKey:this.entityKey,instanceId:this.instanceId}):v("code16.sharp.form.create",{parentUri:le(),entityKey:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var s;return(s=this.config.state)==null?void 0:s.values.find(i=>i.value===this.instanceState)}get allowedInstanceCommands(){var s,i;return(i=(s=this.config.commands)==null?void 0:s.instance)==null?void 0:i.map(n=>n.filter(a=>a.authorization))}getTitle(s){var i;return this.title?typeof this.title=="object"?(i=this.title)==null?void 0:i[s]:this.title:null}sectionFields(s){return s.columns.map(i=>i.fields.flat().map(n=>this.fields[n.key])).flat().filter(Boolean)}sectionHasField(s,i){return this.sectionFields(s).some(n=>n.type===i)}sectionCommands(s){return s.key?(this.config.commands[s.key]??[]).map(i=>i.filter(n=>n.authorization)):null}sectionShouldBeVisible(s,i){return s.columns.map(n=>n.fields).flat(2).some(n=>this.fieldShouldBeVisible(n,i))}fieldRowShouldBeVisible(s,i,n=this.fields,a=this.data){return s.some(d=>this.fieldShouldBeVisible(d,i,n,a))}fieldShouldBeVisible(s,i,n=this.fields,a=this.data){var R;const d=n[s.key];if(!d)return ce("app.debug");if(d.type==="entityList"||d.type==="dashboard")return d.authorizations.view;if(d.emptyVisible)return!0;if(d.type==="text"){const m=a[d.key];return d.localized?!!((R=m==null?void 0:m.text)!=null&&R[i]):!!(m!=null&&m.text)}if(d.type==="list"){const m=a[d.key];return(m==null?void 0:m.length)>0}return!!a[d.key]}}function na(){const K=A({}),s=fe(()=>Object.values(K.value).some(n=>n));function i(n,a){K.value[n]=a}return{isReordering:s,onEntityListReordering:i}}const ia={class:"flex items-center gap-x-4"},oa=W({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},highlightedInstanceId:{},ariaLabelledby:{}},setup(K){const s=K,i=A(),n=A(s.collapsable&&!s.highlightedInstanceId),a=A(null),d=he(),R=Z("entityList",{reload:(l,{formModal:u})=>{T(a.value.query),ee.reload({headers:{"X-No-Preload":"1"},only:["notifications"]}),u.shouldReopen&&u.reopen()},refresh:(l,{formModal:u})=>{a.value=a.value.withRefreshedItems(l.items),u.shouldReopen&&u.reopen()}}),m=pe({data:null,collapsed:n.value},`entityList_${s.field.key}`);m.value.data&&!n.value&&k(m.value.data),!me()&&!n.value&&V();async function V(){const l=await U.get(s.field.endpointUrl,{preloaded:!0}).then(u=>u.data);k(l)}function k(l){a.value=new Oe(l,s.field.entityListKey,s.field.hiddenFilters,s.field.hiddenCommands),d.update(l.config.filters,l.filterValues),m.value.data=l}async function T(l){const u=await U.get(v("code16.sharp.api.list",{entityKey:s.field.entityListKey}),{params:l}).then(p=>p.data);k(u)}async function H(l,u){const p=await U.post(v("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:a.value.query,filterValues:d.nextValues(l,u),hiddenFilters:s.field.hiddenFilters}).then(w=>w.data);k(p)}async function D(){const l=await U.post(v("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:{...a.value.query,search:null},filterValues:d.defaultValues(d.rootFilters),hiddenFilters:s.field.hiddenFilters}).then(u=>u.data);k(l)}function P(){n.value=!n.value,m.value.collapsed=n.value,a.value||V()}return(l,u)=>(t(),c("div",{ref_key:"el",ref:i},[r(Je,ye({"entity-list":a.value,"entity-key":l.field.entityListKey,filters:e(d),commands:e(R),"show-count":l.field.showCount,"show-create-button":l.field.showCreateButton,"show-reorder-button":l.field.showReorderButton,"show-search-field":l.field.showSearchField,"show-entity-state":l.field.showEntityState,"highlighted-instance-id":l.highlightedInstanceId,collapsed:n.value,title:l.field.label,inline:"","onUpdate:query":T,onFilterChange:H,onReset:D,onReordering:u[0]||(u[0]=p=>l.$emit("reordering",p))},l.$attrs),{"card-header":o(()=>[C("div",ia,[r(e(ae),{id:l.ariaLabelledby,class:"line-clamp-2"},{default:o(()=>[B(S(l.field.label),1)]),_:1},8,["id"]),l.collapsable?(t(),y(e(E),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:P},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:1})):_("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-count","show-create-button","show-reorder-button","show-search-field","show-entity-state","highlighted-instance-id","collapsed","title"])],512))}}),ra={class:"flex items-center gap-x-4"},da=W({__name:"Dashboard",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},ariaLabelledby:{}},setup(K){const s=K,i=A(s.collapsable),n=A(null),a=he(),d=(l,{formModal:u})=>{T(n.value.query),ee.reload({headers:{"X-No-Preload":"1"},only:["notifications"]}),u.shouldReopen&&u.reopen()},R=Z("dashboard",{reload:d,refresh:(l,{formModal:u})=>{d({action:"reload"},{formModal:u})}}),m=pe({data:null,collapsed:i.value},`dashboard_${s.field.key}`);m.value.data&&!i.value&&k(m.value.data),!me()&&!i.value&&V();async function V(){const l=await U.get(s.field.endpointUrl,{preloaded:!0}).then(u=>u.data);k(l)}function k(l){n.value=new aa(l,s.field.dashboardKey,s.field.hiddenFilters,s.field.hiddenCommands),a.update(l.config.filters,l.filterValues),m.value.data=l}async function T(l){const u=await U.get(v("code16.sharp.api.dashboard",{dashboardKey:s.field.dashboardKey}),{params:l}).then(p=>p.data);k(u)}async function H(l,u){const p=await U.post(v("code16.sharp.api.dashboard.filters.store",{dashboardKey:s.field.dashboardKey}),{query:n.value.query,filterValues:a.nextValues(l,u),hiddenFilters:s.field.hiddenFilters}).then(w=>w.data);k(p)}async function D(l){const u=await U.post(v("code16.sharp.api.dashboard.filters.store",{dashboardKey:s.field.dashboardKey}),{query:{...n.value.query,search:null},filterValues:a.defaultValues(l),hiddenFilters:s.field.hiddenFilters}).then(p=>p.data);k(u)}function P(){i.value=!i.value,m.value.collapsed=i.value,n.value||V()}return(l,u)=>(t(),y(ta,ye({dashboard:n.value,"dashboard-key":l.field.dashboardKey,filters:e(a),commands:e(R),collapsed:i.value,title:l.field.label,inline:"",onFilterChange:H,onFiltersReset:D},l.$attrs),{title:o(()=>[C("div",ra,[r(e(ae),{id:l.ariaLabelledby,class:"line-clamp-2"},{default:o(()=>[B(S(l.field.label),1)]),_:1},8,["id"]),l.collapsable?(t(),y(e(E),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:P},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:1})):_("",!0)])]),_:1},16,["dashboard","dashboard-key","filters","commands","collapsed","title"]))}}),ua={class:"@container"},ca={key:0,class:"container"},fa={class:"grid gap-6 @3xl:gap-10"},ha={key:0,class:"container"},pa={class:"font-mono"},ma={class:"font-mono"},ya={class:"flex flex-wrap gap-4"},_a={class:"flex gap-4"},ba=["aria-label"],ga=["aria-label"],va={class:"truncate"},wa={class:"uppercase text-xs"},ka={key:2,class:"flex gap-2"},$a={class:"truncate"},Ca={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},Ia=W({__name:"Show",props:{show:{},breadcrumb:{}},setup(K){var u;const s=K,{entityKey:i,instanceId:n}=v().params,a=new la(s.show,i,n),d=A((u=a.locales)==null?void 0:u[0]),{isReordering:R,onEntityListReordering:m}=na(),V=Z("show"),{highlightedEntityKey:k,highlightedInstanceId:T}=Ye();$e("show",a);const H=fe(()=>{var p;return a.layout.sections[0]&&(a.sectionHasField(a.layout.sections[0],"entityList")||a.layout.sections[0].title||(p=a.sectionCommands(a.layout.sections[0]))!=null&&p.flat().length)||!a.layout.sections.length?[{key:null,title:"",collapsable:!1,columns:[]},...a.layout.sections]:a.layout.sections});function D(p){V.send(p,{postCommand:v("code16.sharp.api.show.command.instance",{entityKey:i,instanceId:n,commandKey:p.key}),getForm:n?v("code16.sharp.api.show.command.instance.form",{entityKey:i,instanceId:n,commandKey:p.key}):v("code16.sharp.api.show.command.singleInstance.form",{entityKey:i,commandKey:p.key}),entityKey:i,instanceId:n,query:Xe(location.search)})}function P(p){U.post(v("code16.sharp.api.show.state",{entityKey:i,instanceId:n}),{value:p}).then(w=>{V.handleCommandResponse(w.data)}).catch(w=>{var f,F;const X=(f=w.response)==null?void 0:f.data;((F=w.response)==null?void 0:F.status)===422&&Qe(X.message,{title:L("sharp::modals.state.422.title"),isError:!0})})}async function l(){await Ge(a.config.deleteConfirmationText)&&ee.delete(v("code16.sharp.show.delete",{parentUri:v().params.parentUri,entityKey:i,instanceId:n}))}return(p,w)=>{const X=Ce("SharpShowField");return t(),y(Se,null,{breadcrumb:o(()=>[e(ce)("sharp.display_breadcrumb")?(t(),y(ea,{key:0,breadcrumb:p.breadcrumb},null,8,["breadcrumb"])):_("",!0)]),default:o(()=>[r(Ze,{breadcrumb:p.breadcrumb},null,8,["breadcrumb"]),r(We,{commands:e(V)},{default:o(()=>[C("div",ua,[C("div",{class:O(e(a).pageAlert&&!e(a).pageAlert.sectionKey?"pt-4":"pt-6 @3xl:pt-10")},[e(a).pageAlert&&!e(a).pageAlert.sectionKey?(t(),c("div",ca,[r(ne,{class:"mb-4","page-alert":e(a).pageAlert},null,8,["page-alert"])])):_("",!0),C("div",fa,[(t(!0),c(h,null,$(H.value,(f,F)=>Q((t(),y(sa,{class:"min-w-0",section:f,"aria-labelledby":`section-${F}-title`},{default:o(({collapsed:N,onCollapseToggle:_e})=>{var se;return[(se=e(a).pageAlert)!=null&&se.sectionKey&&e(a).pageAlert.sectionKey===f.key?(t(),c("div",ha,[r(ne,{class:"mb-4","page-alert":e(a).pageAlert},null,8,["page-alert"])])):_("",!0),e(a).sectionHasField(f,"entityList")?(t(!0),c(h,{key:1},$(f.columns,j=>(t(),c(h,null,[(t(!0),c(h,null,$(j.fields,z=>(t(),c(h,null,[(t(!0),c(h,null,$(z,g=>(t(),c(h,null,[e(a).fields[g.key]?(t(),c(h,{key:0},[e(a).fields[g.key].authorizations.view?(t(),y(oa,{key:0,field:e(a).fields[g.key],collapsable:f.collapsable,value:null,"highlighted-instance-id":e(k)===e(a).fields[g.key].entityListKey?e(T):null,"aria-labelledby":`section-${F}-title`,onReordering:q=>e(m)(g.key,q)},null,8,["field","collapsable","highlighted-instance-id","aria-labelledby","onReordering"])):_("",!0)],64)):(t(),c(h,{key:1},[w[1]||(w[1]=B(" Undefined EntityList ")),C("span",pa,S(g.key),1)],64))],64))),256))],64))),256))],64))),256)):e(a).sectionHasField(f,"dashboard")?(t(!0),c(h,{key:2},$(f.columns,j=>(t(),c(h,null,[(t(!0),c(h,null,$(j.fields,z=>(t(),c(h,null,[(t(!0),c(h,null,$(z,g=>(t(),c(h,null,[e(a).fields[g.key]?(t(),c(h,{key:0},[e(a).fields[g.key].authorizations.view?(t(),y(da,{key:0,field:e(a).fields[g.key],collapsable:f.collapsable,value:null,"aria-labelledby":`section-${F}-title`},null,8,["field","collapsable","aria-labelledby"])):_("",!0)],64)):(t(),c(h,{key:1},[w[2]||(w[2]=B(" Undefined Dashboard ")),C("span",ma,S(g.key),1)],64))],64))),256))],64))),256))],64))),256)):(t(),y(Fe,{key:3},{default:o(()=>{var j;return[f.title||F==0||f.collapsable||(j=e(a).sectionCommands(f))!=null&&j.flat().length?(t(),y(Ke,{key:0,class:"data-overflowing-viewport:sticky",collapsed:N},{default:o(()=>{var z,g,q,I;return[C("div",ya,[C("div",_a,[f.title||F==0&&e(a).getTitle(d.value)?(t(),y(e(ae),{key:0,id:`section-${F}-title`,class:"py-1 -my-1",innerHTML:f.title||F==0&&e(ze)(e(a).getTitle(d.value))},null,8,["id","innerHTML"])):_("",!0),f.collapsable?(t(),y(e(E),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:_e},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):_("",!0)]),(z=e(a).sectionCommands(f))!=null&&z.flat().length?(t(),c("div",{key:0,class:O(["ml-auto flex -my-1 justify-end",{invisible:N}]),role:"group","aria-label":e(L)("sharp::show.section_menu.aria_label",{title:f.title})},[r(e(J),null,{default:o(()=>[r(e(Y),{"as-child":""},{default:o(()=>[r(e(E),{class:"h-8",size:"sm",variant:"outline"},{default:o(()=>[B(S(e(L)("sharp::entity_list.commands.instance.label"))+" ",1),r(re)]),_:1})]),_:1}),r(e(M),null,{default:o(()=>[r(de,{commands:e(a).sectionCommands(f),onSelect:D},null,8,["commands"])]),_:2},1024)]),_:2},1024)],10,ba)):_("",!0),F==0?(t(),c("div",{key:1,class:O(["ml-auto flex flex-wrap -my-1 justify-end gap-2",{invisible:N}]),role:"group","aria-label":e(L)("sharp::show.section_menu.aria_label",{title:e(a).getTitle(d.value)})},[e(a).config.state?(t(),y(e(J),{key:0},{default:o(()=>[r(e(Y),{"as-child":""},{default:o(()=>[r(e(E),{class:"pointer-events-auto h-8 -mx-2 disabled:opacity-100 hover:bg-transparent aria-expanded:bg-transparent",variant:"ghost",size:"sm",disabled:!e(a).config.state.authorization,"aria-label":e(L)("sharp::show.state_dropdown.aria_label")},{default:o(()=>[r(Me,{"state-value":e(a).instanceStateValue},{default:o(()=>{var b;return[B(S((b=e(a).instanceStateValue)==null?void 0:b.label),1)]}),_:1},8,["state-value"])]),_:1},8,["disabled","aria-label"])]),_:1}),r(e(M),null,{default:o(()=>[(t(!0),c(h,null,$(e(a).config.state.values,b=>(t(),y(e(ie),{key:b.value,"model-value":b.value===e(a).instanceState,"onUpdate:modelValue":x=>x&&P(b.value)},{default:o(()=>[r(ue,{class:"mr-1.5","state-value":b},null,8,["state-value"]),C("span",va,S(b.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):_("",!0),(g=e(a).locales)!=null&&g.length?(t(),y(e(Be),{key:1,modelValue:d.value,"onUpdate:modelValue":w[0]||(w[0]=b=>d.value=b)},{default:o(()=>[r(Re,{class:"pointer-events-auto mr-auto"}),r(e(Ve),null,{default:o(()=>[(t(!0),c(h,null,$(e(a).locales,b=>(t(),y(e(Ie),{key:b,value:b},{default:o(()=>[C("span",wa,S(b),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):_("",!0),(q=e(a).allowedInstanceCommands)!=null&&q.flat().length||e(a).authorizations.delete||e(a).config.state&&e(a).config.state.authorization||e(a).authorizations.update?(t(),c("div",ka,[(I=e(a).allowedInstanceCommands)!=null&&I.flat().length||e(a).authorizations.delete||e(a).config.state&&e(a).config.state.authorization?(t(),y(e(J),{key:0},{default:o(()=>[r(e(Y),{"as-child":""},{default:o(()=>[r(e(E),{class:"pointer-events-auto h-8",variant:"outline",size:"sm"},{default:o(()=>[B(S(e(L)("sharp::entity_list.commands.instance.label"))+" ",1),r(re)]),_:1})]),_:1}),r(e(M),null,{default:o(()=>{var b;return[e(a).config.state&&e(a).config.state.authorization?(t(),c(h,{key:0},[r(e(Le),null,{default:o(()=>[r(e(Ue),null,{default:o(()=>[r(e(qe),null,{default:o(()=>[B(S(e(L)("sharp::modals.entity_state.edit.title")),1)]),_:1}),r(e(Ae),null,{default:o(()=>[r(e(xe),null,{default:o(()=>[(t(!0),c(h,null,$(e(a).config.state.values,x=>(t(),y(e(ie),{key:x.value,"model-value":x.value===e(a).instanceState,"onUpdate:modelValue":be=>be&&P(x.value)},{default:o(()=>[r(ue,{class:"mr-1.5","state-value":x},null,8,["state-value"]),C("span",$a,S(x.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),r(e(oe),{class:"last:hidden"})],64)):_("",!0),r(de,{commands:e(a).allowedInstanceCommands,onSelect:D},null,8,["commands"]),e(a).authorizations.delete?(t(),c(h,{key:1},[(b=e(a).allowedInstanceCommands)!=null&&b.flat().length?(t(),y(e(oe),{key:0})):_("",!0),r(e(Ee),{class:"text-destructive",onClick:l},{default:o(()=>[B(S(e(L)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):_("",!0)]}),_:1})]),_:1})):_("",!0),e(a).authorizations.update?(t(),y(e(E),{key:1,class:"h-8 pointer-events-auto",size:"sm",disabled:e(R),"as-child":""},{default:o(()=>[r(e(Te),{as:e(R)?"button":"a",href:e(a).formUrl},{default:o(()=>[B(S(s.show.config.editButtonLabel||e(L)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):_("",!0)])):_("",!0)],10,ga)):_("",!0)])]}),_:2},1032,["collapsed"])):_("",!0),Q(r(e(De),null,{default:o(()=>[C("div",Ca,[(t(!0),c(h,null,$(f.columns,(z,g)=>(t(),c("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:Pe({"--size":`${z.size}`})},[r(je,{class:"gap-x-4 gap-y-6"},{default:o(()=>[(t(!0),c(h,null,$(z.fields,q=>Q((t(),y(He,null,{default:o(()=>[(t(!0),c(h,null,$(q,I=>Q((t(),y(Ne,{layout:I},{default:o(()=>[r(X,{field:e(a).fields[I.key],"field-layout":I,value:e(a).data[I.key],locale:d.value,collapsable:f.collapsable,"entity-key":e(i),"instance-id":e(n),"is-right-col":g>0&&g===f.columns.length-1,row:q,onReordering:b=>e(m)(I.key,b)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[G,e(a).fieldShouldBeVisible(I,d.value)]])),256))]),_:2},1536)),[[G,e(a).fieldRowShouldBeVisible(q,d.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[G,f.columns.map(z=>z.fields).flat(2).length&&!N]])]}),_:2},1024))]}),_:2},1032,["section","aria-labelledby"])),[[G,e(a).sectionShouldBeVisible(f,d.value)||F==0]])),256))])],2)])]),_:1},8,["commands"])]),_:1})}}});export{Ia as default};
