import{d as X,W as x,a6 as be,o as t,A as c,q as ge,a7 as ve,a8 as we,J as ue,y as ce,X as fe,Y as Z,a0 as ee,a9 as he,aa as me,ab as q,r as S,a as r,w as o,j as $,e,Q as ae,b as B,t as C,c as y,k as E,ac as te,i as _,v as pe,ad as ke,a4 as $e,$ as Ce,V as W,ae as se,H as k,F as h,af as Q,ag as Se,ah as Fe,ai as ze,_ as I,aj as J,ak as Y,al as M,am as ne,B as Ke,an as Be,G as Re,I as Ve,ao as Le,ap as Ie,aq as qe,ar as Ue,as as xe,at as ie,au as Ae,a5 as Ee,S as Te,av as De,aw as je,ax as He,ay as Pe,az as G,aA as Ne,aB as Qe}from"./sharp-DbYRl0Ma.js";import{_ as Ge,a as oe,b as re,p as Xe}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-BWhk_XY_.js";import{E as Oe,_ as We,u as Je,a as Ye,b as de}from"./useEntityListHighlightedItem-Ckuy4Tvj.js";import{_ as Me}from"./Title.vue_vue_type_script_setup_true_lang-DSNhGV3k.js";import{_ as Ze}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-Cfr2qE_w.js";import{D as ea,_ as aa}from"./Dashboard-1KmnU79N.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-DtTR16bm.js";const ta=X({__name:"Section",props:{section:{}},setup(z){const i=x(z.section.collapsable),n=be({collapsed:i,onCollapseToggle(){i.value=!i.value}});return(a,d)=>(t(),c("section",null,[ge(a.$slots,"default",ve(we(n)))]))}});class la{constructor(l,i,n){Object.assign(this,l),this.entityKey=i,this.instanceId=n}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var l;return(l=this.config.state)==null?void 0:l.values.find(i=>i.value===this.instanceState)}get allowedInstanceCommands(){var l,i;return(i=(l=this.config.commands)==null?void 0:l.instance)==null?void 0:i.map(n=>n.filter(a=>a.authorization))}getTitle(l){var i;return this.title?typeof this.title=="object"?(i=this.title)==null?void 0:i[l]:this.title:null}sectionFields(l){return l.columns.map(i=>i.fields.flat().map(n=>this.fields[n.key])).flat().filter(Boolean)}sectionHasField(l,i){return this.sectionFields(l).some(n=>n.type===i)}sectionCommands(l){return l.key?(this.config.commands[l.key]??[]).map(i=>i.filter(n=>n.authorization)):null}sectionShouldBeVisible(l,i){return l.columns.map(n=>n.fields).flat(2).some(n=>this.fieldShouldBeVisible(n,i))}fieldRowShouldBeVisible(l,i,n=this.fields,a=this.data){return l.some(d=>this.fieldShouldBeVisible(d,i,n,a))}fieldShouldBeVisible(l,i,n=this.fields,a=this.data){var R;const d=n[l.key];if(!d)return ue("app.debug");if(d.type==="entityList"||d.type==="dashboard")return d.authorizations.view;if(d.emptyVisible)return!0;if(d.type==="text"){const p=a[d.key];return d.localized?!!((R=p==null?void 0:p.text)!=null&&R[i]):!!(p!=null&&p.text)}if(d.type==="list"){const p=a[d.key];return(p==null?void 0:p.length)>0}return!!a[d.key]}}function sa(){const z=x({}),l=ce(()=>Object.values(z.value).some(n=>n));function i(n,a){z.value[n]=a}return{isReordering:l,onEntityListReordering:i}}const na={class:"flex items-center gap-x-4"},ia=X({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},highlightedInstanceId:{},ariaLabelledby:{}},setup(z){const l=z,i=x(),n=x(l.collapsable&&!l.highlightedInstanceId),a=x(null),d=fe(),R=Z("entityList",{reload:(s,{formModal:u})=>{T(a.value.query),ee.reload({headers:{"X-No-Preload":"1"},only:["notifications"]}),u.shouldReopen&&u.reopen()},refresh:(s,{formModal:u})=>{a.value=a.value.withRefreshedItems(s.items),u.shouldReopen&&u.reopen()}}),p=he({data:null,collapsed:n.value},`entityList_${l.field.key}`);p.value.data&&!n.value&&w(p.value.data),!me()&&!n.value&&V();async function V(){const s=await q.get(l.field.endpointUrl,{preloaded:!0}).then(u=>u.data);w(s)}function w(s){a.value=new Oe(s,l.field.entityListKey,l.field.hiddenFilters,l.field.hiddenCommands),d.update(s.config.filters,s.filterValues),p.value.data=s}async function T(s){const u=await q.get(S("code16.sharp.api.list",{entityKey:l.field.entityListKey}),{params:s}).then(m=>m.data);w(u)}async function P(s,u){const m=await q.post(S("code16.sharp.api.list.filters.store",{entityKey:l.field.entityListKey}),{query:a.value.query,filterValues:d.nextValues(s,u),hiddenFilters:l.field.hiddenFilters}).then(v=>v.data);w(m)}async function D(){const s=await q.post(S("code16.sharp.api.list.filters.store",{entityKey:l.field.entityListKey}),{query:{...a.value.query,search:null},filterValues:d.defaultValues(d.rootFilters),hiddenFilters:l.field.hiddenFilters}).then(u=>u.data);w(s)}function j(){n.value=!n.value,p.value.collapsed=n.value,a.value||V()}return(s,u)=>(t(),c("div",{ref_key:"el",ref:i},[r(We,pe({"entity-list":a.value,"entity-key":s.field.entityListKey,filters:e(d),commands:e(R),"show-count":s.field.showCount,"show-create-button":s.field.showCreateButton,"show-reorder-button":s.field.showReorderButton,"show-search-field":s.field.showSearchField,"show-entity-state":s.field.showEntityState,"highlighted-instance-id":s.highlightedInstanceId,collapsed:n.value,title:s.field.label,inline:"","onUpdate:query":T,onFilterChange:P,onReset:D,onReordering:u[0]||(u[0]=m=>s.$emit("reordering",m))},s.$attrs),{"card-header":o(()=>[$("div",na,[r(e(ae),{id:s.ariaLabelledby,class:"line-clamp-2"},{default:o(()=>[B(C(s.field.label),1)]),_:1},8,["id"]),s.collapsable?(t(),y(e(E),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:j},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:1})):_("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-count","show-create-button","show-reorder-button","show-search-field","show-entity-state","highlighted-instance-id","collapsed","title"])],512))}}),oa={class:"flex items-center gap-x-4"},ra=X({__name:"Dashboard",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},ariaLabelledby:{}},setup(z){const l=z,i=x(l.collapsable),n=x(null),a=fe(),d=(s,{formModal:u})=>{T(n.value.query),ee.reload({headers:{"X-No-Preload":"1"},only:["notifications"]}),u.shouldReopen&&u.reopen()},R=Z("dashboard",{reload:d,refresh:(s,{formModal:u})=>{d({action:"reload"},{formModal:u})}}),p=he({data:null,collapsed:i.value},`dashboard_${l.field.key}`);p.value.data&&!i.value&&w(p.value.data),!me()&&!i.value&&V();async function V(){const s=await q.get(l.field.endpointUrl,{preloaded:!0}).then(u=>u.data);w(s)}function w(s){n.value=new ea(s,l.field.dashboardKey,l.field.hiddenFilters,l.field.hiddenCommands),a.update(s.config.filters,s.filterValues),p.value.data=s}async function T(s){const u=await q.get(S("code16.sharp.api.dashboard",{dashboardKey:l.field.dashboardKey}),{params:s}).then(m=>m.data);w(u)}async function P(s,u){const m=await q.post(S("code16.sharp.api.dashboard.filters.store",{dashboardKey:l.field.dashboardKey}),{query:n.value.query,filterValues:a.nextValues(s,u),hiddenFilters:l.field.hiddenFilters}).then(v=>v.data);w(m)}async function D(s){const u=await q.post(S("code16.sharp.api.dashboard.filters.store",{dashboardKey:l.field.dashboardKey}),{query:{...n.value.query,search:null},filterValues:a.defaultValues(s),hiddenFilters:l.field.hiddenFilters}).then(m=>m.data);w(u)}function j(){i.value=!i.value,p.value.collapsed=i.value,n.value||V()}return(s,u)=>(t(),y(aa,pe({dashboard:n.value,"dashboard-key":s.field.dashboardKey,filters:e(a),commands:e(R),collapsed:i.value,title:s.field.label,inline:"",onFilterChange:P,onFiltersReset:D},s.$attrs),{title:o(()=>[$("div",oa,[r(e(ae),{id:s.ariaLabelledby,class:"line-clamp-2"},{default:o(()=>[B(C(s.field.label),1)]),_:1},8,["id"]),s.collapsable?(t(),y(e(E),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:j},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:1})):_("",!0)])]),_:1},16,["dashboard","dashboard-key","filters","commands","collapsed","title"]))}}),da={class:"@container"},ua={key:0,class:"container"},ca={class:"grid gap-6 @3xl:gap-10"},fa={key:0,class:"container"},ha={class:"font-mono"},ma={class:"font-mono"},pa={class:"flex flex-wrap gap-4"},ya={class:"flex gap-4"},_a=["aria-label"],ba=["aria-label"],ga={class:"truncate"},va={class:"uppercase text-xs"},wa={key:2,class:"flex gap-2"},ka={class:"truncate"},$a={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},Va=X({__name:"Show",props:{show:{},breadcrumb:{}},setup(z){var u;const l=z,{entityKey:i,instanceId:n}=S().params,a=new la(l.show,i,n),d=x((u=a.locales)==null?void 0:u[0]),{isReordering:R,onEntityListReordering:p}=sa(),V=Z("show"),{highlightedEntityKey:w,highlightedInstanceId:T}=Je();ke("show",a);const P=ce(()=>{var m;return a.layout.sections[0]&&(a.sectionHasField(a.layout.sections[0],"entityList")||a.layout.sections[0].title||(m=a.sectionCommands(a.layout.sections[0]))!=null&&m.flat().length)||!a.layout.sections.length?[{key:null,title:"",collapsable:!1,columns:[]},...a.layout.sections]:a.layout.sections});function D(m){V.send(m,{postCommand:S("code16.sharp.api.show.command.instance",{entityKey:i,instanceId:n,commandKey:m.key}),getForm:n?S("code16.sharp.api.show.command.instance.form",{entityKey:i,instanceId:n,commandKey:m.key}):S("code16.sharp.api.show.command.singleInstance.form",{entityKey:i,commandKey:m.key}),entityKey:i,instanceId:n,query:Xe(location.search)})}function j(m){q.post(S("code16.sharp.api.show.state",{entityKey:i,instanceId:n}),{value:m}).then(v=>{V.handleCommandResponse(v.data)}).catch(v=>{var f,F;const O=(f=v.response)==null?void 0:f.data;((F=v.response)==null?void 0:F.status)===422&&Ne(O.message,{title:I("sharp::modals.state.422.title"),isError:!0})})}async function s(){await Qe(a.config.deleteConfirmationText)&&ee.delete(S("code16.sharp.show.delete",{parentUri:S().params.parentUri,entityKey:i,instanceId:n}))}return(m,v)=>{const O=$e("SharpShowField");return t(),y(Ce,null,{breadcrumb:o(()=>[e(ue)("sharp.display_breadcrumb")?(t(),y(Ze,{key:0,breadcrumb:m.breadcrumb},null,8,["breadcrumb"])):_("",!0)]),default:o(()=>[r(Me,{breadcrumb:m.breadcrumb},null,8,["breadcrumb"]),r(Ge,{commands:e(V)},{default:o(()=>[$("div",da,[$("div",{class:W(e(a).pageAlert&&!e(a).pageAlert.sectionKey?"pt-4":"pt-6 @3xl:pt-10")},[e(a).pageAlert&&!e(a).pageAlert.sectionKey?(t(),c("div",ua,[r(se,{class:"mb-4","page-alert":e(a).pageAlert},null,8,["page-alert"])])):_("",!0),$("div",ca,[(t(!0),c(h,null,k(P.value,(f,F)=>Q((t(),y(ta,{class:"min-w-0",section:f,"aria-labelledby":`section-${F}-title`},{default:o(({collapsed:N,onCollapseToggle:ye})=>{var le;return[(le=e(a).pageAlert)!=null&&le.sectionKey&&e(a).pageAlert.sectionKey===f.key?(t(),c("div",fa,[r(se,{class:"mb-4","page-alert":e(a).pageAlert},null,8,["page-alert"])])):_("",!0),e(a).sectionHasField(f,"entityList")?(t(!0),c(h,{key:1},k(f.columns,H=>(t(),c(h,null,[(t(!0),c(h,null,k(H.fields,K=>(t(),c(h,null,[(t(!0),c(h,null,k(K,g=>(t(),c(h,null,[e(a).fields[g.key]?(t(),c(h,{key:0},[e(a).fields[g.key].authorizations.view?(t(),y(ia,{key:0,field:e(a).fields[g.key],collapsable:f.collapsable,value:null,"highlighted-instance-id":e(w)===e(a).fields[g.key].entityListKey?e(T):null,"aria-labelledby":`section-${F}-title`,onReordering:U=>e(p)(g.key,U)},null,8,["field","collapsable","highlighted-instance-id","aria-labelledby","onReordering"])):_("",!0)],64)):(t(),c(h,{key:1},[v[1]||(v[1]=B(" Undefined EntityList ")),$("span",ha,C(g.key),1)],64))],64))),256))],64))),256))],64))),256)):e(a).sectionHasField(f,"dashboard")?(t(!0),c(h,{key:2},k(f.columns,H=>(t(),c(h,null,[(t(!0),c(h,null,k(H.fields,K=>(t(),c(h,null,[(t(!0),c(h,null,k(K,g=>(t(),c(h,null,[e(a).fields[g.key]?(t(),c(h,{key:0},[e(a).fields[g.key].authorizations.view?(t(),y(ra,{key:0,field:e(a).fields[g.key],collapsable:f.collapsable,value:null,"aria-labelledby":`section-${F}-title`},null,8,["field","collapsable","aria-labelledby"])):_("",!0)],64)):(t(),c(h,{key:1},[v[2]||(v[2]=B(" Undefined Dashboard ")),$("span",ma,C(g.key),1)],64))],64))),256))],64))),256))],64))),256)):(t(),y(Se,{key:3},{default:o(()=>{var H;return[f.title||F==0||f.collapsable||(H=e(a).sectionCommands(f))!=null&&H.flat().length?(t(),y(Fe,{key:0,class:"data-overflowing-viewport:sticky",collapsed:N},{default:o(()=>{var K,g,U,L;return[$("div",pa,[$("div",ya,[f.title||F==0&&e(a).getTitle(d.value)?(t(),y(e(ae),{key:0,id:`section-${F}-title`,class:"py-1 -my-1",innerHTML:f.title||F==0&&e(ze)(e(a).getTitle(d.value))},null,8,["id","innerHTML"])):_("",!0),f.collapsable?(t(),y(e(E),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:ye},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):_("",!0)]),(K=e(a).sectionCommands(f))!=null&&K.flat().length?(t(),c("div",{key:0,class:W(["ml-auto flex -my-1 justify-end",{invisible:N}]),role:"group","aria-label":e(I)("sharp::show.section_menu.aria_label",{title:f.title})},[r(e(J),null,{default:o(()=>[r(e(Y),{"as-child":""},{default:o(()=>[r(e(E),{class:"h-8",size:"sm",variant:"outline"},{default:o(()=>[B(C(e(I)("sharp::entity_list.commands.instance.label"))+" ",1),r(oe)]),_:1})]),_:1}),r(e(M),null,{default:o(()=>[r(re,{commands:e(a).sectionCommands(f),onSelect:D},null,8,["commands"])]),_:2},1024)]),_:2},1024)],10,_a)):_("",!0),F==0?(t(),c("div",{key:1,class:W(["ml-auto flex flex-wrap -my-1 justify-end gap-2",{invisible:N}]),role:"group","aria-label":e(I)("sharp::show.section_menu.aria_label",{title:e(a).getTitle(d.value)})},[e(a).config.state?(t(),y(e(J),{key:0},{default:o(()=>[r(e(Y),{"as-child":""},{default:o(()=>[r(e(E),{class:"pointer-events-auto h-8 -mx-2 disabled:opacity-100 hover:bg-transparent aria-expanded:bg-transparent",variant:"ghost",size:"sm",disabled:!e(a).config.state.authorization,"aria-label":e(I)("sharp::show.state_dropdown.aria_label")},{default:o(()=>[r(Ye,{"state-value":e(a).instanceStateValue},{default:o(()=>{var b;return[B(C((b=e(a).instanceStateValue)==null?void 0:b.label),1)]}),_:1},8,["state-value"])]),_:1},8,["disabled","aria-label"])]),_:1}),r(e(M),null,{default:o(()=>[(t(!0),c(h,null,k(e(a).config.state.values,b=>(t(),y(e(ne),{key:b.value,"model-value":b.value===e(a).instanceState,"onUpdate:modelValue":A=>A&&j(b.value)},{default:o(()=>[r(de,{class:"mr-1.5","state-value":b},null,8,["state-value"]),$("span",ga,C(b.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):_("",!0),(g=e(a).locales)!=null&&g.length?(t(),y(e(Ke),{key:1,modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=b=>d.value=b)},{default:o(()=>[r(Be,{class:"pointer-events-auto mr-auto"}),r(e(Re),null,{default:o(()=>[(t(!0),c(h,null,k(e(a).locales,b=>(t(),y(e(Ve),{key:b,value:b},{default:o(()=>[$("span",va,C(b),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):_("",!0),(U=e(a).allowedInstanceCommands)!=null&&U.flat().length||e(a).authorizations.delete||e(a).config.state&&e(a).config.state.authorization||e(a).authorizations.update?(t(),c("div",wa,[(L=e(a).allowedInstanceCommands)!=null&&L.flat().length||e(a).authorizations.delete||e(a).config.state&&e(a).config.state.authorization?(t(),y(e(J),{key:0},{default:o(()=>[r(e(Y),{"as-child":""},{default:o(()=>[r(e(E),{class:"pointer-events-auto h-8",variant:"outline",size:"sm"},{default:o(()=>[B(C(e(I)("sharp::entity_list.commands.instance.label"))+" ",1),r(oe)]),_:1})]),_:1}),r(e(M),null,{default:o(()=>{var b;return[e(a).config.state&&e(a).config.state.authorization?(t(),c(h,{key:0},[r(e(Le),null,{default:o(()=>[r(e(Ie),null,{default:o(()=>[r(e(qe),null,{default:o(()=>[B(C(e(I)("sharp::modals.entity_state.edit.title")),1)]),_:1}),r(e(Ue),null,{default:o(()=>[r(e(xe),null,{default:o(()=>[(t(!0),c(h,null,k(e(a).config.state.values,A=>(t(),y(e(ne),{key:A.value,"model-value":A.value===e(a).instanceState,"onUpdate:modelValue":_e=>_e&&j(A.value)},{default:o(()=>[r(de,{class:"mr-1.5","state-value":A},null,8,["state-value"]),$("span",ka,C(A.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),r(e(ie),{class:"last:hidden"})],64)):_("",!0),r(re,{commands:e(a).allowedInstanceCommands,onSelect:D},null,8,["commands"]),e(a).authorizations.delete?(t(),c(h,{key:1},[(b=e(a).allowedInstanceCommands)!=null&&b.flat().length?(t(),y(e(ie),{key:0})):_("",!0),r(e(Ae),{class:"text-destructive",onClick:s},{default:o(()=>[B(C(e(I)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):_("",!0)]}),_:1})]),_:1})):_("",!0),e(a).authorizations.update?(t(),y(e(E),{key:1,class:"h-8 pointer-events-auto",size:"sm",disabled:e(R),"as-child":""},{default:o(()=>[r(e(Ee),{as:e(R)?"button":"a",href:e(a).config.formEditUrl},{default:o(()=>[B(C(l.show.config.editButtonLabel||e(I)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):_("",!0)])):_("",!0)],10,ba)):_("",!0)])]}),_:2},1032,["collapsed"])):_("",!0),Q(r(e(Te),null,{default:o(()=>[$("div",$a,[(t(!0),c(h,null,k(f.columns,(K,g)=>(t(),c("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:De({"--size":`${K.size}`})},[r(je,{class:"gap-x-4 gap-y-6"},{default:o(()=>[(t(!0),c(h,null,k(K.fields,U=>Q((t(),y(He,null,{default:o(()=>[(t(!0),c(h,null,k(U,L=>Q((t(),y(Pe,{layout:L},{default:o(()=>[r(O,{field:e(a).fields[L.key],"field-layout":L,value:e(a).data[L.key],locale:d.value,collapsable:f.collapsable,"entity-key":e(i),"instance-id":e(n),"is-right-col":g>0&&g===f.columns.length-1,row:U,onReordering:b=>e(p)(L.key,b)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[G,e(a).fieldShouldBeVisible(L,d.value)]])),256))]),_:2},1536)),[[G,e(a).fieldRowShouldBeVisible(U,d.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[G,f.columns.map(K=>K.fields).flat(2).length&&!N]])]}),_:2},1024))]}),_:2},1032,["section","aria-labelledby"])),[[G,e(a).sectionShouldBeVisible(f,d.value)||F==0]])),256))])],2)])]),_:1},8,["commands"])]),_:1})}}});export{Va as default};
