import{d as Y,al as T,aS as he,o as a,A as u,q as me,ay as pe,az as ye,r as b,aT as Z,J as ne,y as ie,aA as _e,aB as oe,aN as re,aU as ge,aV as be,aW as q,a as o,w as n,j as $,u as e,Q as de,b as I,t as C,c as m,k as E,aX as ue,i as g,v as ve,aY as we,aR as ke,aC as $e,V as W,aD as Ce,H as S,F as _,aZ as N,a_ as Se,a$ as ze,_ as B,aK as X,aL as J,aM as M,b0 as ee,B as Re,b1 as Fe,G as Be,I as Ve,b2 as Ie,b3 as Ke,b4 as Le,b5 as Ue,b6 as xe,b7 as te,b8 as Ee,X as Te,S as qe,aO as Ae,b9 as Pe,ba as je,bb as He,bc as G,bd as De,be as Ne}from"./sharp-D7i_HHpp.js";import{c as Ge,a as ae,b as se,p as Oe}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-CzSPd-CP.js";import{E as Qe,_ as We,u as Xe,a as Je,b as le}from"./useEntityListHighlightedItem-D_Wtd_U1.js";import{_ as Me}from"./Title.vue_vue_type_script_setup_true_lang-Bt-PJrzm.js";import{_ as Ye}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-UhMHnJaz.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-i4oJ3zsv.js";const Ze=Y({__name:"Section",props:{section:{}},setup(z){const i=T(z.section.collapsable),l=he({collapsed:i,onCollapseToggle(){i.value=!i.value}});return(t,d)=>(a(),u("section",null,[me(t.$slots,"default",pe(ye(l)))]))}});class et{constructor(s,i,l){Object.assign(this,s),this.entityKey=i,this.instanceId=l}get formUrl(){return b().params.instanceId?b("code16.sharp.form.edit",{parentUri:Z(),entityKey:this.entityKey,instanceId:this.instanceId}):b("code16.sharp.form.create",{parentUri:Z(),entityKey:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var s;return(s=this.config.state)==null?void 0:s.values.find(i=>i.value===this.instanceState)}get allowedInstanceCommands(){var s,i;return(i=(s=this.config.commands)==null?void 0:s.instance)==null?void 0:i.map(l=>l.filter(t=>t.authorization))}getTitle(s){var i;return this.title?typeof this.title=="object"?(i=this.title)==null?void 0:i[s]:this.title:null}sectionFields(s){return s.columns.map(i=>i.fields.flat().map(l=>this.fields[l.key])).flat().filter(Boolean)}sectionHasField(s,i){return this.sectionFields(s).some(l=>l.type===i)}sectionCommands(s){return s.key?(this.config.commands[s.key]??[]).map(i=>i.filter(l=>l.authorization)):null}sectionShouldBeVisible(s,i){return s.columns.map(l=>l.fields).flat(2).some(l=>this.fieldShouldBeVisible(l,i))}fieldRowShouldBeVisible(s,i,l=this.fields,t=this.data){return s.some(d=>this.fieldShouldBeVisible(d,i,l,t))}fieldShouldBeVisible(s,i,l=this.fields,t=this.data){var K;const d=l[s.key];if(!d)return ne("app.debug");if(d.type==="entityList"||d.emptyVisible)return!0;if(d.type==="text"){const p=t[d.key];return d.localized?!!((K=p==null?void 0:p.text)!=null&&K[i]):!!(p!=null&&p.text)}if(d.type==="list"){const p=t[d.key];return(p==null?void 0:p.length)>0}return!!t[d.key]}}function tt(){const z=T({}),s=ie(()=>Object.values(z.value).some(l=>l));function i(l,t){z.value[l]=t}return{isReordering:s,onEntityListReordering:i}}const at={class:"flex items-center gap-x-4"},st=Y({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},highlightedInstanceId:{},ariaLabelledby:{}},setup(z){const s=z,i=T(),l=T(s.collapsable&&!s.highlightedInstanceId),t=T(null),d=_e(),K=oe("entityList",{reload:(r,{formModal:f})=>{A(t.value.query),re.reload({headers:{"X-No-Preload":"1"},only:["notifications"]}),f.shouldReopen&&f.reopen()},refresh:(r,{formModal:f})=>{t.value=t.value.withRefreshedItems(r.items),f.shouldReopen&&f.reopen()}}),p=ge({data:null,collapsed:l.value},`entityList_${s.field.key}`);p.value.data&&!l.value&&L(p.value.data),!be()&&!l.value&&x();async function x(){const r=await q.get(s.field.endpointUrl,{preloaded:!0}).then(f=>f.data);L(r)}function L(r){t.value=new Qe(r,s.field.entityListKey,s.field.hiddenFilters,s.field.hiddenCommands),d.update(r.config.filters,r.filterValues),p.value.data=r}async function A(r){const f=await q.get(b("code16.sharp.api.list",{entityKey:s.field.entityListKey}),{params:r}).then(y=>y.data);L(f)}async function O(r,f){const y=await q.post(b("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:t.value.query,filterValues:d.nextValues(r,f),hiddenFilters:s.field.hiddenFilters}).then(v=>v.data);L(y)}async function P(){const r=await q.post(b("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:{...t.value.query,search:null},filterValues:d.defaultValues(d.rootFilters),hiddenFilters:s.field.hiddenFilters}).then(f=>f.data);L(r)}function j(){l.value=!l.value,p.value.collapsed=l.value,t.value||x()}return(r,f)=>(a(),u("div",{ref_key:"el",ref:i},[o(We,ve({"entity-list":t.value,"entity-key":r.field.entityListKey,filters:e(d),commands:e(K),"show-count":r.field.showCount,"show-create-button":r.field.showCreateButton,"show-reorder-button":r.field.showReorderButton,"show-search-field":r.field.showSearchField,"show-entity-state":r.field.showEntityState,"highlighted-instance-id":r.highlightedInstanceId,collapsed:l.value,title:r.field.label,inline:"","onUpdate:query":A,onFilterChange:O,onReset:P,onReordering:f[0]||(f[0]=y=>r.$emit("reordering",y))},r.$attrs),{"card-header":n(()=>[$("div",at,[o(e(de),{id:r.ariaLabelledby,class:"line-clamp-2"},{default:n(()=>[I(C(r.field.label),1)]),_:1},8,["id"]),r.collapsable?(a(),m(e(E),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:j},{default:n(()=>[o(e(ue),{class:"w-4 h-4"})]),_:1})):g("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-count","show-create-button","show-reorder-button","show-search-field","show-entity-state","highlighted-instance-id","collapsed","title"])],512))}}),lt={class:"@container"},nt={key:0,class:"container"},it={class:"grid gap-6 @3xl:gap-10"},ot={class:"font-mono"},rt={class:"flex flex-wrap gap-4"},dt={class:"flex gap-4"},ut=["aria-label"],ct=["aria-label"],ft={class:"truncate"},ht={class:"uppercase text-xs"},mt={key:2,class:"flex gap-3"},pt={class:"truncate"},yt={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},$t=Y({__name:"Show",props:{show:{},breadcrumb:{}},setup(z){var f;const s=z,{entityKey:i,instanceId:l}=b().params,t=new et(s.show,i,l),d=T((f=t.locales)==null?void 0:f[0]),{isReordering:K,onEntityListReordering:p}=tt(),x=oe("show"),{highlightedEntityKey:L,highlightedInstanceId:A}=Xe();we("show",t);const O=ie(()=>{var y;return t.layout.sections[0]&&(t.sectionHasField(t.layout.sections[0],"entityList")||t.layout.sections[0].title||(y=t.sectionCommands(t.layout.sections[0]))!=null&&y.flat().length)||!t.layout.sections.length?[{key:null,title:"",collapsable:!1,columns:[]},...t.layout.sections]:t.layout.sections});function P(y){x.send(y,{postCommand:b("code16.sharp.api.show.command.instance",{entityKey:i,instanceId:l,commandKey:y.key}),getForm:l?b("code16.sharp.api.show.command.instance.form",{entityKey:i,instanceId:l,commandKey:y.key}):b("code16.sharp.api.show.command.singleInstance.form",{entityKey:i,commandKey:y.key}),entityKey:i,instanceId:l,query:Oe(location.search)})}function j(y){q.post(b("code16.sharp.api.show.state",{entityKey:i,instanceId:l}),{value:y}).then(v=>{x.handleCommandResponse(v.data)}).catch(v=>{var c,w;const Q=(c=v.response)==null?void 0:c.data;((w=v.response)==null?void 0:w.status)===422&&De(Q.message,{title:B("sharp::modals.state.422.title"),isError:!0})})}async function r(){await Ne(t.config.deleteConfirmationText)&&re.delete(b("code16.sharp.show.delete",{parentUri:b().params.parentUri,entityKey:i,instanceId:l}))}return(y,v)=>{const Q=ke("SharpShowField");return a(),m($e,null,{breadcrumb:n(()=>[e(ne)("sharp.display_breadcrumb")?(a(),m(Ye,{key:0,breadcrumb:y.breadcrumb},null,8,["breadcrumb"])):g("",!0)]),default:n(()=>[o(Me,{breadcrumb:y.breadcrumb},null,8,["breadcrumb"]),o(Ge,{commands:e(x)},{default:n(()=>[$("div",lt,[$("div",{class:W(e(t).pageAlert?"pt-4":"pt-6 @3xl:pt-10")},[e(t).pageAlert?(a(),u("div",nt,[o(Ce,{class:"mb-4","page-alert":e(t).pageAlert},null,8,["page-alert"])])):g("",!0),$("div",it,[(a(!0),u(_,null,S(O.value,(c,w)=>N((a(),m(Ze,{class:"min-w-0",section:c,"aria-labelledby":`section-${w}-title`},{default:n(({collapsed:H,onCollapseToggle:ce})=>[e(t).sectionHasField(c,"entityList")?(a(!0),u(_,{key:0},S(c.columns,D=>(a(),u(_,null,[(a(!0),u(_,null,S(D.fields,R=>(a(),u(_,null,[(a(!0),u(_,null,S(R,k=>(a(),u(_,null,[e(t).fields[k.key]?(a(),m(st,{key:0,field:e(t).fields[k.key],collapsable:c.collapsable,value:null,"highlighted-instance-id":e(L)===e(t).fields[k.key].entityListKey?e(A):null,"aria-labelledby":`section-${w}-title`,onReordering:V=>e(p)(k.key,V)},null,8,["field","collapsable","highlighted-instance-id","aria-labelledby","onReordering"])):(a(),u(_,{key:1},[v[1]||(v[1]=I(" Undefined EntityList ")),$("span",ot,C(k.key),1)],64))],64))),256))],64))),256))],64))),256)):(a(),m(Se,{key:1},{default:n(()=>{var D;return[c.title||w==0||c.collapsable||(D=e(t).sectionCommands(c))!=null&&D.flat().length?(a(),m(ze,{key:0,class:"data-overflowing-viewport:sticky",collapsed:H},{default:n(()=>{var R,k,V,F;return[$("div",rt,[$("div",dt,[c.title||w==0&&e(t).getTitle(d.value)?(a(),m(e(de),{key:0,id:`section-${w}-title`,class:"py-1 -my-1",innerHTML:c.title||w==0&&e(t).getTitle(d.value)},null,8,["id","innerHTML"])):g("",!0),c.collapsable?(a(),m(e(E),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:ce},{default:n(()=>[o(e(ue),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):g("",!0)]),(R=e(t).sectionCommands(c))!=null&&R.flat().length?(a(),u("div",{key:0,class:W(["ml-auto flex -my-1 justify-end",{invisible:H}]),role:"group","aria-label":e(B)("sharp::show.section_menu.aria_label",{title:c.title})},[o(e(X),null,{default:n(()=>[o(e(J),{"as-child":""},{default:n(()=>[o(e(E),{class:"h-8",size:"sm",variant:"outline"},{default:n(()=>[I(C(e(B)("sharp::entity_list.commands.instance.label"))+" ",1),o(ae)]),_:1})]),_:1}),o(e(M),null,{default:n(()=>[o(se,{commands:e(t).sectionCommands(c),onSelect:P},null,8,["commands"])]),_:2},1024)]),_:2},1024)],10,ut)):g("",!0),w==0?(a(),u("div",{key:1,class:W(["ml-auto flex flex-wrap -my-1 justify-end gap-3",{invisible:H}]),role:"group","aria-label":e(B)("sharp::show.section_menu.aria_label",{title:e(t).getTitle(d.value)})},[e(t).config.state?(a(),m(e(X),{key:0},{default:n(()=>[o(e(J),{"as-child":""},{default:n(()=>[o(e(E),{class:"pointer-events-auto h-8 -mx-2 disabled:opacity-100 hover:bg-transparent aria-expanded:bg-transparent",variant:"ghost",size:"sm",disabled:!e(t).config.state.authorization,"aria-label":e(B)("sharp::show.state_dropdown.aria_label")},{default:n(()=>[o(Je,{"state-value":e(t).instanceStateValue},{default:n(()=>{var h;return[I(C((h=e(t).instanceStateValue)==null?void 0:h.label),1)]}),_:1},8,["state-value"])]),_:1},8,["disabled","aria-label"])]),_:1}),o(e(M),null,{default:n(()=>[(a(!0),u(_,null,S(e(t).config.state.values,h=>(a(),m(e(ee),{key:h.value,"model-value":h.value===e(t).instanceState,"onUpdate:modelValue":U=>U&&j(h.value)},{default:n(()=>[o(le,{class:"mr-1.5","state-value":h},null,8,["state-value"]),$("span",ft,C(h.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):g("",!0),(k=e(t).locales)!=null&&k.length?(a(),m(e(Re),{key:1,modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=h=>d.value=h)},{default:n(()=>[o(Fe,{class:"pointer-events-auto mr-auto"}),o(e(Be),null,{default:n(()=>[(a(!0),u(_,null,S(e(t).locales,h=>(a(),m(e(Ve),{key:h,value:h},{default:n(()=>[$("span",ht,C(h),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):g("",!0),(V=e(t).allowedInstanceCommands)!=null&&V.flat().length||e(t).authorizations.delete||e(t).config.state&&e(t).config.state.authorization||e(t).authorizations.update?(a(),u("div",mt,[(F=e(t).allowedInstanceCommands)!=null&&F.flat().length||e(t).authorizations.delete||e(t).config.state&&e(t).config.state.authorization?(a(),m(e(X),{key:0},{default:n(()=>[o(e(J),{"as-child":""},{default:n(()=>[o(e(E),{class:"pointer-events-auto h-8",variant:"outline",size:"sm"},{default:n(()=>[I(C(e(B)("sharp::entity_list.commands.instance.label"))+" ",1),o(ae)]),_:1})]),_:1}),o(e(M),null,{default:n(()=>{var h;return[e(t).config.state&&e(t).config.state.authorization?(a(),u(_,{key:0},[o(e(Ie),null,{default:n(()=>[o(e(Ke),null,{default:n(()=>[o(e(Le),null,{default:n(()=>[I(C(e(B)("sharp::modals.entity_state.edit.title")),1)]),_:1}),o(e(Ue),null,{default:n(()=>[o(e(xe),null,{default:n(()=>[(a(!0),u(_,null,S(e(t).config.state.values,U=>(a(),m(e(ee),{key:U.value,"model-value":U.value===e(t).instanceState,"onUpdate:modelValue":fe=>fe&&j(U.value)},{default:n(()=>[o(le,{class:"mr-1.5","state-value":U},null,8,["state-value"]),$("span",pt,C(U.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),o(e(te),{class:"last:hidden"})],64)):g("",!0),o(se,{commands:e(t).allowedInstanceCommands,onSelect:P},null,8,["commands"]),e(t).authorizations.delete?(a(),u(_,{key:1},[(h=e(t).allowedInstanceCommands)!=null&&h.flat().length?(a(),m(e(te),{key:0})):g("",!0),o(e(Ee),{class:"text-destructive",onClick:r},{default:n(()=>[I(C(e(B)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):g("",!0)]}),_:1})]),_:1})):g("",!0),e(t).authorizations.update?(a(),m(e(E),{key:1,class:"h-8 pointer-events-auto",size:"sm",disabled:e(K),"as-child":""},{default:n(()=>[o(e(Te),{as:e(K)?"button":"a",href:e(t).formUrl},{default:n(()=>[I(C(s.show.config.editButtonLabel||e(B)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):g("",!0)])):g("",!0)],10,ct)):g("",!0)])]}),_:2},1032,["collapsed"])):g("",!0),N(o(e(qe),null,{default:n(()=>[$("div",yt,[(a(!0),u(_,null,S(c.columns,(R,k)=>(a(),u("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:Ae({"--size":`${R.size}`})},[o(Pe,{class:"gap-x-4 gap-y-6"},{default:n(()=>[(a(!0),u(_,null,S(R.fields,V=>N((a(),m(je,null,{default:n(()=>[(a(!0),u(_,null,S(V,F=>N((a(),m(He,{layout:F},{default:n(()=>[o(Q,{field:e(t).fields[F.key],"field-layout":F,value:e(t).data[F.key],locale:d.value,collapsable:c.collapsable,"entity-key":e(i),"instance-id":e(l),"is-right-col":k>0&&k===c.columns.length-1,row:V,onReordering:h=>e(p)(F.key,h)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[G,e(t).fieldShouldBeVisible(F,d.value)]])),256))]),_:2},1536)),[[G,e(t).fieldRowShouldBeVisible(V,d.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[G,c.columns.map(R=>R.fields).flat(2).length&&!H]])]}),_:2},1024))]),_:2},1032,["section","aria-labelledby"])),[[G,e(t).sectionShouldBeVisible(c,d.value)||w==0]])),256))])],2)])]),_:1},8,["commands"])]),_:1})}}});export{$t as default};
