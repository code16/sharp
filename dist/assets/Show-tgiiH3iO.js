import{d as Z,ak as T,aS as fe,o as a,A as u,q as me,ax as he,ay as pe,r as b,aT as ee,J as ne,y as ie,az as ye,aA as oe,aU as _e,aV as ge,aW as A,a as o,w as n,j as k,u as e,Q as re,b as V,t as $,c as h,k as E,aX as de,i as g,v as be,aY as ve,aR as we,aB as ke,V as W,aC as $e,H as S,F as _,aZ as D,a_ as Ce,a$ as Se,_ as B,aJ as J,aK as X,aL as Y,Y as ze,b0 as te,B as Re,b1 as Fe,G as Be,I as Ie,b2 as Ve,b3 as Ke,b4 as Le,b5 as Ue,b6 as xe,b7 as ae,b8 as Ee,X as Te,S as Ae,aN as qe,b9 as je,ba as He,bb as Pe,bc as N,bd as De,be as Ne,aM as Ge}from"./sharp-BjiO_Q2w.js";import{c as Oe,a as se,b as le,p as Qe}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-BPcrTlbW.js";import{E as We,_ as Je,u as Xe,a as M}from"./useEntityListHighlightedItem-DqNIHgfB.js";import{_ as Ye}from"./Title.vue_vue_type_script_setup_true_lang-DMmzTSp6.js";import{_ as Me}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-C3glmU7G.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-gPAmv_eq.js";const Ze=Z({__name:"Section",props:{section:{}},setup(z){const i=T(z.section.collapsable),l=fe({collapsed:i,onCollapseToggle(){i.value=!i.value}});return(t,d)=>(a(),u("section",null,[me(t.$slots,"default",he(pe(l)))]))}});class et{constructor(s,i,l){Object.assign(this,s),this.entityKey=i,this.instanceId=l}get formUrl(){return b().params.instanceId?b("code16.sharp.form.edit",{parentUri:ee(),entityKey:this.entityKey,instanceId:this.instanceId}):b("code16.sharp.form.create",{parentUri:ee(),entityKey:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var s;return(s=this.config.state)==null?void 0:s.values.find(i=>i.value===this.instanceState)}get allowedInstanceCommands(){var s,i;return(i=(s=this.config.commands)==null?void 0:s.instance)==null?void 0:i.map(l=>l.filter(t=>t.authorization))}getTitle(s){var i;return this.title?typeof this.title=="object"?(i=this.title)==null?void 0:i[s]:this.title:null}sectionFields(s){return s.columns.map(i=>i.fields.flat().map(l=>this.fields[l.key])).flat().filter(Boolean)}sectionHasField(s,i){return this.sectionFields(s).some(l=>l.type===i)}sectionCommands(s){return s.key?(this.config.commands[s.key]??[]).map(i=>i.filter(l=>l.authorization)):null}sectionShouldBeVisible(s,i){return s.columns.map(l=>l.fields).flat(2).some(l=>this.fieldShouldBeVisible(l,i))}fieldRowShouldBeVisible(s,i,l=this.fields,t=this.data){return s.some(d=>this.fieldShouldBeVisible(d,i,l,t))}fieldShouldBeVisible(s,i,l=this.fields,t=this.data){var K;const d=l[s.key];if(!d)return ne("app.debug");if(d.type==="entityList"||d.emptyVisible)return!0;if(d.type==="text"){const p=t[d.key];return d.localized?!!((K=p==null?void 0:p.text)!=null&&K[i]):!!(p!=null&&p.text)}if(d.type==="list"){const p=t[d.key];return(p==null?void 0:p.length)>0}return!!t[d.key]}}function tt(){const z=T({}),s=ie(()=>Object.values(z.value).some(l=>l));function i(l,t){z.value[l]=t}return{isReordering:s,onEntityListReordering:i}}const at={class:"flex items-center gap-x-4"},st=Z({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},highlightedInstanceId:{},ariaLabelledby:{}},setup(z){const s=z,i=T(),l=T(s.collapsable&&!s.highlightedInstanceId),t=T(null),d=ye(),K=oe("entityList",{reload:(r,{formModal:f})=>{L(),f.shouldReopen&&f.reopen()},refresh:(r,{formModal:f})=>{t.value=t.value.withRefreshedItems(r.items),f.shouldReopen&&f.reopen()}}),p=_e({data:null,collapsed:l.value},`entityList_${s.field.key}`);p.value.data&&!l.value&&U(p.value.data),!ge()&&!l.value&&L();async function L(){const r=await A.get(s.field.endpointUrl,{fetchOptions:{cache:"no-store"}}).then(f=>f.data);U(r)}function U(r){t.value=new We(r,s.field.entityListKey,s.field.hiddenFilters,s.field.hiddenCommands),d.update(r.config.filters,r.filterValues),p.value.data=r}async function G(r){const f=await A.get(b("code16.sharp.api.list",{entityKey:s.field.entityListKey}),{params:r}).then(y=>y.data);U(f)}async function O(r,f){const y=await A.post(b("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:t.value.query,filterValues:d.nextValues(r,f),hiddenFilters:s.field.hiddenFilters}).then(v=>v.data);U(y)}async function q(){const r=await A.post(b("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:{...t.value.query,search:null},filterValues:d.defaultValues(d.rootFilters),hiddenFilters:s.field.hiddenFilters}).then(f=>f.data);U(r)}function j(){l.value=!l.value,p.value.collapsed=l.value,t.value||L()}return(r,f)=>(a(),u("div",{ref_key:"el",ref:i},[o(Je,be({"entity-list":t.value,"entity-key":r.field.entityListKey,filters:e(d),commands:e(K),"show-create-button":r.field.showCreateButton,"show-reorder-button":r.field.showReorderButton,"show-search-field":r.field.showSearchField,"show-entity-state":r.field.showEntityState,"highlighted-instance-id":r.highlightedInstanceId,collapsed:l.value,title:r.field.label,inline:"","onUpdate:query":G,onFilterChange:O,onReset:q,onReordering:f[0]||(f[0]=y=>r.$emit("reordering",y))},r.$attrs),{"card-header":n(()=>[k("div",at,[o(e(re),{id:r.ariaLabelledby,class:"line-clamp-2"},{default:n(()=>[V($(r.field.label),1)]),_:1},8,["id"]),r.collapsable?(a(),h(e(E),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:j},{default:n(()=>[o(e(de),{class:"w-4 h-4"})]),_:1})):g("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-create-button","show-reorder-button","show-search-field","show-entity-state","highlighted-instance-id","collapsed","title"])],512))}}),lt={class:"@container"},nt={key:0,class:"container"},it={class:"grid gap-6 @3xl:gap-10"},ot={class:"font-mono"},rt={class:"flex flex-wrap gap-4"},dt={class:"flex gap-4"},ut=["aria-label"],ct=["aria-label"],ft={class:"truncate"},mt={class:"uppercase text-xs"},ht={key:2,class:"flex gap-3"},pt={class:"truncate"},yt={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},$t=Z({__name:"Show",props:{show:{},breadcrumb:{}},setup(z){var f;const s=z,{entityKey:i,instanceId:l}=b().params,t=new et(s.show,i,l),d=T((f=t.locales)==null?void 0:f[0]),{isReordering:K,onEntityListReordering:p}=tt(),L=oe("show"),{highlightedEntityKey:U,highlightedInstanceId:G}=Xe();ve("show",t);const O=ie(()=>{var y;return t.layout.sections[0]&&(t.sectionHasField(t.layout.sections[0],"entityList")||t.layout.sections[0].title||(y=t.sectionCommands(t.layout.sections[0]))!=null&&y.flat().length)||!t.layout.sections.length?[{key:null,title:"",collapsable:!1,columns:[]},...t.layout.sections]:t.layout.sections});function q(y){L.send(y,{postCommand:b("code16.sharp.api.show.command.instance",{entityKey:i,instanceId:l,commandKey:y.key}),getForm:l?b("code16.sharp.api.show.command.instance.form",{entityKey:i,instanceId:l,commandKey:y.key}):b("code16.sharp.api.show.command.singleInstance.form",{entityKey:i,commandKey:y.key}),entityKey:i,instanceId:l,query:Qe(location.search)})}function j(y){A.post(b("code16.sharp.api.show.state",{entityKey:i,instanceId:l}),{value:y}).then(v=>{L.handleCommandResponse(v.data)}).catch(v=>{var c,w;const Q=(c=v.response)==null?void 0:c.data;((w=v.response)==null?void 0:w.status)===422&&De(Q.message,{title:B("sharp::modals.state.422.title"),isError:!0})})}async function r(){await Ne(t.config.deleteConfirmationText)&&Ge.delete(b("code16.sharp.show.delete",{parentUri:b().params.parentUri,entityKey:i,instanceId:l}))}return(y,v)=>{const Q=we("SharpShowField");return a(),h(ke,null,{breadcrumb:n(()=>[e(ne)("sharp.display_breadcrumb")?(a(),h(Me,{key:0,breadcrumb:y.breadcrumb},null,8,["breadcrumb"])):g("",!0)]),default:n(()=>[o(Ye,{breadcrumb:y.breadcrumb},null,8,["breadcrumb"]),o(Oe,{commands:e(L)},{default:n(()=>[k("div",lt,[k("div",{class:W(e(t).pageAlert?"pt-4":"pt-6 @3xl:pt-10")},[e(t).pageAlert?(a(),u("div",nt,[o($e,{class:"mb-4","page-alert":e(t).pageAlert},null,8,["page-alert"])])):g("",!0),k("div",it,[(a(!0),u(_,null,S(O.value,(c,w)=>D((a(),h(Ze,{class:"min-w-0",section:c,"aria-labelledby":`section-${w}-title`},{default:n(({collapsed:H,onCollapseToggle:ue})=>[e(t).sectionHasField(c,"entityList")?(a(!0),u(_,{key:0},S(c.columns,P=>(a(),u(_,null,[(a(!0),u(_,null,S(P.fields,R=>(a(),u(_,null,[(a(!0),u(_,null,S(R,C=>(a(),u(_,null,[e(t).fields[C.key]?(a(),h(st,{key:0,field:e(t).fields[C.key],collapsable:c.collapsable,value:null,"highlighted-instance-id":e(U)===e(t).fields[C.key].entityListKey?e(G):null,"aria-labelledby":`section-${w}-title`,onReordering:I=>e(p)(C.key,I)},null,8,["field","collapsable","highlighted-instance-id","aria-labelledby","onReordering"])):(a(),u(_,{key:1},[v[1]||(v[1]=V(" Undefined EntityList ")),k("span",ot,$(C.key),1)],64))],64))),256))],64))),256))],64))),256)):(a(),h(Ce,{key:1},{default:n(()=>{var P;return[c.title||w==0||c.collapsable||(P=e(t).sectionCommands(c))!=null&&P.flat().length?(a(),h(Se,{key:0,class:"data-[overflowing-viewport]:sticky",collapsed:H},{default:n(()=>{var R,C,I,F;return[k("div",rt,[k("div",dt,[c.title||w==0&&e(t).getTitle(d.value)?(a(),h(e(re),{key:0,id:`section-${w}-title`,innerHTML:c.title||w==0&&e(t).getTitle(d.value)},null,8,["id","innerHTML"])):g("",!0),c.collapsable?(a(),h(e(E),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:ue},{default:n(()=>[o(e(de),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):g("",!0)]),(R=e(t).sectionCommands(c))!=null&&R.flat().length?(a(),u("div",{key:0,class:W(["ml-auto flex -my-1 justify-end",{invisible:H}]),role:"group","aria-label":e(B)("sharp::show.section_menu.aria_label",{title:c.title})},[o(e(J),null,{default:n(()=>[o(e(X),{"as-child":""},{default:n(()=>[o(e(E),{class:"h-8",size:"sm",variant:"outline"},{default:n(()=>[V($(e(B)("sharp::entity_list.commands.instance.label"))+" ",1),o(se)]),_:1})]),_:1}),o(e(Y),null,{default:n(()=>[o(le,{commands:e(t).sectionCommands(c),onSelect:q},null,8,["commands"])]),_:2},1024)]),_:2},1024)],10,ut)):g("",!0),w==0?(a(),u("div",{key:1,class:W(["ml-auto flex flex-wrap -my-1 justify-end gap-3",{invisible:H}]),role:"group","aria-label":e(B)("sharp::show.section_menu.aria_label",{title:e(t).getTitle(d.value)})},[e(t).config.state?(a(),h(e(J),{key:0},{default:n(()=>[o(e(X),{"as-child":""},{default:n(()=>[o(e(E),{class:"pointer-events-auto h-8 -mx-2 disabled:opacity-100",variant:"ghost",size:"sm",disabled:!e(t).config.state.authorization,"aria-label":e(B)("sharp::show.state_dropdown.aria_label")},{default:n(()=>[o(e(ze),{variant:"outline"},{default:n(()=>{var m;return[o(M,{class:"-ml-0.5 mr-1.5","state-value":e(t).instanceStateValue},null,8,["state-value"]),V(" "+$((m=e(t).instanceStateValue)==null?void 0:m.label),1)]}),_:1})]),_:1},8,["disabled","aria-label"])]),_:1}),o(e(Y),null,{default:n(()=>[(a(!0),u(_,null,S(e(t).config.state.values,m=>(a(),h(e(te),{key:m.value,"model-value":m.value===e(t).instanceState,"onUpdate:modelValue":x=>x&&j(m.value)},{default:n(()=>[o(M,{class:"mr-1.5","state-value":m},null,8,["state-value"]),k("span",ft,$(m.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):g("",!0),(C=e(t).locales)!=null&&C.length?(a(),h(e(Re),{key:1,modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=m=>d.value=m)},{default:n(()=>[o(Fe,{class:"pointer-events-auto mr-auto"}),o(e(Be),null,{default:n(()=>[(a(!0),u(_,null,S(e(t).locales,m=>(a(),h(e(Ie),{key:m,value:m},{default:n(()=>[k("span",mt,$(m),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):g("",!0),(I=e(t).allowedInstanceCommands)!=null&&I.flat().length||e(t).authorizations.delete||e(t).config.state&&e(t).config.state.authorization||e(t).authorizations.update?(a(),u("div",ht,[(F=e(t).allowedInstanceCommands)!=null&&F.flat().length||e(t).authorizations.delete||e(t).config.state&&e(t).config.state.authorization?(a(),h(e(J),{key:0},{default:n(()=>[o(e(X),{"as-child":""},{default:n(()=>[o(e(E),{class:"pointer-events-auto h-8",variant:"outline",size:"sm"},{default:n(()=>[V($(e(B)("sharp::entity_list.commands.instance.label"))+" ",1),o(se)]),_:1})]),_:1}),o(e(Y),null,{default:n(()=>{var m;return[e(t).config.state&&e(t).config.state.authorization?(a(),u(_,{key:0},[o(e(Ve),null,{default:n(()=>[o(e(Ke),null,{default:n(()=>[o(e(Le),null,{default:n(()=>[V($(e(B)("sharp::modals.entity_state.edit.title")),1)]),_:1}),o(e(Ue),null,{default:n(()=>[o(e(xe),null,{default:n(()=>[(a(!0),u(_,null,S(e(t).config.state.values,x=>(a(),h(e(te),{key:x.value,"model-value":x.value===e(t).instanceState,"onUpdate:modelValue":ce=>ce&&j(x.value)},{default:n(()=>[o(M,{class:"mr-1.5","state-value":x},null,8,["state-value"]),k("span",pt,$(x.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),o(e(ae),{class:"last:hidden"})],64)):g("",!0),o(le,{commands:e(t).allowedInstanceCommands,onSelect:q},null,8,["commands"]),e(t).authorizations.delete?(a(),u(_,{key:1},[(m=e(t).allowedInstanceCommands)!=null&&m.flat().length?(a(),h(e(ae),{key:0})):g("",!0),o(e(Ee),{class:"text-destructive",onClick:r},{default:n(()=>[V($(e(B)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):g("",!0)]}),_:1})]),_:1})):g("",!0),e(t).authorizations.update?(a(),h(e(E),{key:1,class:"h-8 pointer-events-auto",size:"sm",disabled:e(K),"as-child":""},{default:n(()=>[o(e(Te),{as:e(K)?"button":"a",href:e(t).formUrl},{default:n(()=>[V($(s.show.config.editButtonLabel||e(B)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):g("",!0)])):g("",!0)],10,ct)):g("",!0)])]}),_:2},1032,["collapsed"])):g("",!0),D(o(e(Ae),null,{default:n(()=>[k("div",yt,[(a(!0),u(_,null,S(c.columns,(R,C)=>(a(),u("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:qe({"--size":`${R.size}`})},[o(je,{class:"gap-x-4 gap-y-6"},{default:n(()=>[(a(!0),u(_,null,S(R.fields,I=>D((a(),h(He,null,{default:n(()=>[(a(!0),u(_,null,S(I,F=>D((a(),h(Pe,{layout:F},{default:n(()=>[o(Q,{field:e(t).fields[F.key],"field-layout":F,value:e(t).data[F.key],locale:d.value,collapsable:c.collapsable,"entity-key":e(i),"instance-id":e(l),"is-right-col":C===c.columns.length-1,row:I,onReordering:m=>e(p)(F.key,m)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[N,e(t).fieldShouldBeVisible(F,d.value)]])),256))]),_:2},1536)),[[N,e(t).fieldRowShouldBeVisible(I,d.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[N,c.columns.map(R=>R.fields).flat(2).length&&!H]])]}),_:2},1024))]),_:2},1032,["section","aria-labelledby"])),[[N,e(t).sectionShouldBeVisible(c,d.value)||w==0]])),256))])],2)])]),_:1},8,["commands"])]),_:1})}}});export{$t as default};
