import{d as W,W as x,a6 as _e,o as t,A as c,q as be,a7 as ge,a8 as ve,r as v,a9 as se,J as de,y as ue,X as ce,Y as Z,a0 as ee,aa as fe,ab as he,ac as U,a as r,w as o,j as C,u as e,Q as ae,b as B,t as S,c as y,k as T,ad as te,i as b,v as me,ae as we,a4 as ke,$ as $e,V as O,af as Ce,H as $,F as f,ag as Q,ah as Se,ai as Fe,aj as ze,_ as L,ak as J,al as Y,am as M,an as le,B as Ke,ao as Be,G as Re,I as Ve,ap as Ie,aq as Le,ar as Ue,as as qe,at as xe,au as ne,av as Ee,a5 as Te,S as De,aw as Pe,ax as Ae,ay as je,az as He,aA as G,aB as Ne,aC as Qe}from"./sharp-DKZgsroX.js";import{_ as Ge,a as ie,b as oe,p as We}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-CmkC0cDD.js";import{E as Xe,_ as Oe,u as Je,a as Ye,b as re}from"./useEntityListHighlightedItem-0Zoj2Wc0.js";import{_ as Me}from"./Title.vue_vue_type_script_setup_true_lang-mcYnE4nb.js";import{_ as Ze}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-Cj3Ity3c.js";import{D as ea,_ as aa}from"./Dashboard-VfoAZeZa.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-BbvFDyiT.js";const ta=W({__name:"Section",props:{section:{}},setup(z){const i=x(z.section.collapsable),n=_e({collapsed:i,onCollapseToggle(){i.value=!i.value}});return(a,d)=>(t(),c("section",null,[be(a.$slots,"default",ge(ve(n)))]))}});class sa{constructor(s,i,n){Object.assign(this,s),this.entityKey=i,this.instanceId=n}get formUrl(){return v().params.instanceId?v("code16.sharp.form.edit",{parentUri:se(),entityKey:this.entityKey,instanceId:this.instanceId}):v("code16.sharp.form.create",{parentUri:se(),entityKey:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var s;return(s=this.config.state)==null?void 0:s.values.find(i=>i.value===this.instanceState)}get allowedInstanceCommands(){var s,i;return(i=(s=this.config.commands)==null?void 0:s.instance)==null?void 0:i.map(n=>n.filter(a=>a.authorization))}getTitle(s){var i;return this.title?typeof this.title=="object"?(i=this.title)==null?void 0:i[s]:this.title:null}sectionFields(s){return s.columns.map(i=>i.fields.flat().map(n=>this.fields[n.key])).flat().filter(Boolean)}sectionHasField(s,i){return this.sectionFields(s).some(n=>n.type===i)}sectionCommands(s){return s.key?(this.config.commands[s.key]??[]).map(i=>i.filter(n=>n.authorization)):null}sectionShouldBeVisible(s,i){return s.columns.map(n=>n.fields).flat(2).some(n=>this.fieldShouldBeVisible(n,i))}fieldRowShouldBeVisible(s,i,n=this.fields,a=this.data){return s.some(d=>this.fieldShouldBeVisible(d,i,n,a))}fieldShouldBeVisible(s,i,n=this.fields,a=this.data){var R;const d=n[s.key];if(!d)return de("app.debug");if(d.type==="entityList"||d.type==="dashboard")return d.authorizations.view;if(d.emptyVisible)return!0;if(d.type==="text"){const p=a[d.key];return d.localized?!!((R=p==null?void 0:p.text)!=null&&R[i]):!!(p!=null&&p.text)}if(d.type==="list"){const p=a[d.key];return(p==null?void 0:p.length)>0}return!!a[d.key]}}function la(){const z=x({}),s=ue(()=>Object.values(z.value).some(n=>n));function i(n,a){z.value[n]=a}return{isReordering:s,onEntityListReordering:i}}const na={class:"flex items-center gap-x-4"},ia=W({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},highlightedInstanceId:{},ariaLabelledby:{}},setup(z){const s=z,i=x(),n=x(s.collapsable&&!s.highlightedInstanceId),a=x(null),d=ce(),R=Z("entityList",{reload:(l,{formModal:u})=>{D(a.value.query),ee.reload({headers:{"X-No-Preload":"1"},only:["notifications"]}),u.shouldReopen&&u.reopen()},refresh:(l,{formModal:u})=>{a.value=a.value.withRefreshedItems(l.items),u.shouldReopen&&u.reopen()}}),p=fe({data:null,collapsed:n.value},`entityList_${s.field.key}`);p.value.data&&!n.value&&k(p.value.data),!he()&&!n.value&&V();async function V(){const l=await U.get(s.field.endpointUrl,{preloaded:!0}).then(u=>u.data);k(l)}function k(l){a.value=new Xe(l,s.field.entityListKey,s.field.hiddenFilters,s.field.hiddenCommands),d.update(l.config.filters,l.filterValues),p.value.data=l}async function D(l){const u=await U.get(v("code16.sharp.api.list",{entityKey:s.field.entityListKey}),{params:l}).then(h=>h.data);k(u)}async function H(l,u){const h=await U.post(v("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:a.value.query,filterValues:d.nextValues(l,u),hiddenFilters:s.field.hiddenFilters}).then(w=>w.data);k(h)}async function P(){const l=await U.post(v("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:{...a.value.query,search:null},filterValues:d.defaultValues(d.rootFilters),hiddenFilters:s.field.hiddenFilters}).then(u=>u.data);k(l)}function A(){n.value=!n.value,p.value.collapsed=n.value,a.value||V()}return(l,u)=>(t(),c("div",{ref_key:"el",ref:i},[r(Oe,me({"entity-list":a.value,"entity-key":l.field.entityListKey,filters:e(d),commands:e(R),"show-count":l.field.showCount,"show-create-button":l.field.showCreateButton,"show-reorder-button":l.field.showReorderButton,"show-search-field":l.field.showSearchField,"show-entity-state":l.field.showEntityState,"highlighted-instance-id":l.highlightedInstanceId,collapsed:n.value,title:l.field.label,inline:"","onUpdate:query":D,onFilterChange:H,onReset:P,onReordering:u[0]||(u[0]=h=>l.$emit("reordering",h))},l.$attrs),{"card-header":o(()=>[C("div",na,[r(e(ae),{id:l.ariaLabelledby,class:"line-clamp-2"},{default:o(()=>[B(S(l.field.label),1)]),_:1},8,["id"]),l.collapsable?(t(),y(e(T),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:A},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:1})):b("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-count","show-create-button","show-reorder-button","show-search-field","show-entity-state","highlighted-instance-id","collapsed","title"])],512))}}),oa={class:"flex items-center gap-x-4"},ra=W({__name:"Dashboard",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},ariaLabelledby:{}},setup(z){const s=z,i=x(s.collapsable),n=x(null),a=ce(),d=(l,{formModal:u})=>{D(n.value.query),ee.reload({headers:{"X-No-Preload":"1"},only:["notifications"]}),u.shouldReopen&&u.reopen()},R=Z("dashboard",{reload:d,refresh:(l,{formModal:u})=>{d({action:"reload"},{formModal:u})}}),p=fe({data:null,collapsed:i.value},`dashboard_${s.field.key}`);p.value.data&&!i.value&&k(p.value.data),!he()&&!i.value&&V();async function V(){const l=await U.get(s.field.endpointUrl,{preloaded:!0}).then(u=>u.data);k(l)}function k(l){n.value=new ea(l,s.field.dashboardKey,s.field.hiddenFilters,s.field.hiddenCommands),a.update(l.config.filters,l.filterValues),p.value.data=l}async function D(l){const u=await U.get(v("code16.sharp.api.dashboard",{dashboardKey:s.field.dashboardKey}),{params:l}).then(h=>h.data);k(u)}async function H(l,u){const h=await U.post(v("code16.sharp.api.dashboard.filters.store",{dashboardKey:s.field.dashboardKey}),{query:n.value.query,filterValues:a.nextValues(l,u),hiddenFilters:s.field.hiddenFilters}).then(w=>w.data);k(h)}async function P(l){const u=await U.post(v("code16.sharp.api.dashboard.filters.store",{dashboardKey:s.field.dashboardKey}),{query:{...n.value.query,search:null},filterValues:a.defaultValues(l),hiddenFilters:s.field.hiddenFilters}).then(h=>h.data);k(u)}function A(){i.value=!i.value,p.value.collapsed=i.value,n.value||V()}return(l,u)=>(t(),y(aa,me({dashboard:n.value,"dashboard-key":l.field.dashboardKey,filters:e(a),commands:e(R),collapsed:i.value,title:l.field.label,inline:"",onFilterChange:H,onFiltersReset:P},l.$attrs),{title:o(()=>[C("div",oa,[r(e(ae),{id:l.ariaLabelledby,class:"line-clamp-2"},{default:o(()=>[B(S(l.field.label),1)]),_:1},8,["id"]),l.collapsable?(t(),y(e(T),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:A},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:1})):b("",!0)])]),_:1},16,["dashboard","dashboard-key","filters","commands","collapsed","title"]))}}),da={class:"@container"},ua={key:0,class:"container"},ca={class:"grid gap-6 @3xl:gap-10"},fa={class:"font-mono"},ha={class:"font-mono"},ma={class:"flex flex-wrap gap-4"},pa={class:"flex gap-4"},ya=["aria-label"],_a=["aria-label"],ba={class:"truncate"},ga={class:"uppercase text-xs"},va={key:2,class:"flex gap-2"},wa={class:"truncate"},ka={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},Ra=W({__name:"Show",props:{show:{},breadcrumb:{}},setup(z){var u;const s=z,{entityKey:i,instanceId:n}=v().params,a=new sa(s.show,i,n),d=x((u=a.locales)==null?void 0:u[0]),{isReordering:R,onEntityListReordering:p}=la(),V=Z("show"),{highlightedEntityKey:k,highlightedInstanceId:D}=Je();we("show",a);const H=ue(()=>{var h;return a.layout.sections[0]&&(a.sectionHasField(a.layout.sections[0],"entityList")||a.layout.sections[0].title||(h=a.sectionCommands(a.layout.sections[0]))!=null&&h.flat().length)||!a.layout.sections.length?[{key:null,title:"",collapsable:!1,columns:[]},...a.layout.sections]:a.layout.sections});function P(h){V.send(h,{postCommand:v("code16.sharp.api.show.command.instance",{entityKey:i,instanceId:n,commandKey:h.key}),getForm:n?v("code16.sharp.api.show.command.instance.form",{entityKey:i,instanceId:n,commandKey:h.key}):v("code16.sharp.api.show.command.singleInstance.form",{entityKey:i,commandKey:h.key}),entityKey:i,instanceId:n,query:We(location.search)})}function A(h){U.post(v("code16.sharp.api.show.state",{entityKey:i,instanceId:n}),{value:h}).then(w=>{V.handleCommandResponse(w.data)}).catch(w=>{var m,F;const X=(m=w.response)==null?void 0:m.data;((F=w.response)==null?void 0:F.status)===422&&Ne(X.message,{title:L("sharp::modals.state.422.title"),isError:!0})})}async function l(){await Qe(a.config.deleteConfirmationText)&&ee.delete(v("code16.sharp.show.delete",{parentUri:v().params.parentUri,entityKey:i,instanceId:n}))}return(h,w)=>{const X=ke("SharpShowField");return t(),y($e,null,{breadcrumb:o(()=>[e(de)("sharp.display_breadcrumb")?(t(),y(Ze,{key:0,breadcrumb:h.breadcrumb},null,8,["breadcrumb"])):b("",!0)]),default:o(()=>[r(Me,{breadcrumb:h.breadcrumb},null,8,["breadcrumb"]),r(Ge,{commands:e(V)},{default:o(()=>[C("div",da,[C("div",{class:O(e(a).pageAlert?"pt-4":"pt-6 @3xl:pt-10")},[e(a).pageAlert?(t(),c("div",ua,[r(Ce,{class:"mb-4","page-alert":e(a).pageAlert},null,8,["page-alert"])])):b("",!0),C("div",ca,[(t(!0),c(f,null,$(H.value,(m,F)=>Q((t(),y(ta,{class:"min-w-0",section:m,"aria-labelledby":`section-${F}-title`},{default:o(({collapsed:N,onCollapseToggle:pe})=>[e(a).sectionHasField(m,"entityList")?(t(!0),c(f,{key:0},$(m.columns,j=>(t(),c(f,null,[(t(!0),c(f,null,$(j.fields,K=>(t(),c(f,null,[(t(!0),c(f,null,$(K,g=>(t(),c(f,null,[e(a).fields[g.key]?(t(),c(f,{key:0},[e(a).fields[g.key].authorizations.view?(t(),y(ia,{key:0,field:e(a).fields[g.key],collapsable:m.collapsable,value:null,"highlighted-instance-id":e(k)===e(a).fields[g.key].entityListKey?e(D):null,"aria-labelledby":`section-${F}-title`,onReordering:q=>e(p)(g.key,q)},null,8,["field","collapsable","highlighted-instance-id","aria-labelledby","onReordering"])):b("",!0)],64)):(t(),c(f,{key:1},[w[1]||(w[1]=B(" Undefined EntityList ")),C("span",fa,S(g.key),1)],64))],64))),256))],64))),256))],64))),256)):e(a).sectionHasField(m,"dashboard")?(t(!0),c(f,{key:1},$(m.columns,j=>(t(),c(f,null,[(t(!0),c(f,null,$(j.fields,K=>(t(),c(f,null,[(t(!0),c(f,null,$(K,g=>(t(),c(f,null,[e(a).fields[g.key]?(t(),c(f,{key:0},[e(a).fields[g.key].authorizations.view?(t(),y(ra,{key:0,field:e(a).fields[g.key],collapsable:m.collapsable,value:null,"aria-labelledby":`section-${F}-title`},null,8,["field","collapsable","aria-labelledby"])):b("",!0)],64)):(t(),c(f,{key:1},[w[2]||(w[2]=B(" Undefined Dashboard ")),C("span",ha,S(g.key),1)],64))],64))),256))],64))),256))],64))),256)):(t(),y(Se,{key:2},{default:o(()=>{var j;return[m.title||F==0||m.collapsable||(j=e(a).sectionCommands(m))!=null&&j.flat().length?(t(),y(Fe,{key:0,class:"data-overflowing-viewport:sticky",collapsed:N},{default:o(()=>{var K,g,q,I;return[C("div",ma,[C("div",pa,[m.title||F==0&&e(a).getTitle(d.value)?(t(),y(e(ae),{key:0,id:`section-${F}-title`,class:"py-1 -my-1",innerHTML:m.title||F==0&&e(ze)(e(a).getTitle(d.value))},null,8,["id","innerHTML"])):b("",!0),m.collapsable?(t(),y(e(T),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:pe},{default:o(()=>[r(e(te),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):b("",!0)]),(K=e(a).sectionCommands(m))!=null&&K.flat().length?(t(),c("div",{key:0,class:O(["ml-auto flex -my-1 justify-end",{invisible:N}]),role:"group","aria-label":e(L)("sharp::show.section_menu.aria_label",{title:m.title})},[r(e(J),null,{default:o(()=>[r(e(Y),{"as-child":""},{default:o(()=>[r(e(T),{class:"h-8",size:"sm",variant:"outline"},{default:o(()=>[B(S(e(L)("sharp::entity_list.commands.instance.label"))+" ",1),r(ie)]),_:1})]),_:1}),r(e(M),null,{default:o(()=>[r(oe,{commands:e(a).sectionCommands(m),onSelect:P},null,8,["commands"])]),_:2},1024)]),_:2},1024)],10,ya)):b("",!0),F==0?(t(),c("div",{key:1,class:O(["ml-auto flex flex-wrap -my-1 justify-end gap-2",{invisible:N}]),role:"group","aria-label":e(L)("sharp::show.section_menu.aria_label",{title:e(a).getTitle(d.value)})},[e(a).config.state?(t(),y(e(J),{key:0},{default:o(()=>[r(e(Y),{"as-child":""},{default:o(()=>[r(e(T),{class:"pointer-events-auto h-8 -mx-2 disabled:opacity-100 hover:bg-transparent aria-expanded:bg-transparent",variant:"ghost",size:"sm",disabled:!e(a).config.state.authorization,"aria-label":e(L)("sharp::show.state_dropdown.aria_label")},{default:o(()=>[r(Ye,{"state-value":e(a).instanceStateValue},{default:o(()=>{var _;return[B(S((_=e(a).instanceStateValue)==null?void 0:_.label),1)]}),_:1},8,["state-value"])]),_:1},8,["disabled","aria-label"])]),_:1}),r(e(M),null,{default:o(()=>[(t(!0),c(f,null,$(e(a).config.state.values,_=>(t(),y(e(le),{key:_.value,"model-value":_.value===e(a).instanceState,"onUpdate:modelValue":E=>E&&A(_.value)},{default:o(()=>[r(re,{class:"mr-1.5","state-value":_},null,8,["state-value"]),C("span",ba,S(_.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):b("",!0),(g=e(a).locales)!=null&&g.length?(t(),y(e(Ke),{key:1,modelValue:d.value,"onUpdate:modelValue":w[0]||(w[0]=_=>d.value=_)},{default:o(()=>[r(Be,{class:"pointer-events-auto mr-auto"}),r(e(Re),null,{default:o(()=>[(t(!0),c(f,null,$(e(a).locales,_=>(t(),y(e(Ve),{key:_,value:_},{default:o(()=>[C("span",ga,S(_),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):b("",!0),(q=e(a).allowedInstanceCommands)!=null&&q.flat().length||e(a).authorizations.delete||e(a).config.state&&e(a).config.state.authorization||e(a).authorizations.update?(t(),c("div",va,[(I=e(a).allowedInstanceCommands)!=null&&I.flat().length||e(a).authorizations.delete||e(a).config.state&&e(a).config.state.authorization?(t(),y(e(J),{key:0},{default:o(()=>[r(e(Y),{"as-child":""},{default:o(()=>[r(e(T),{class:"pointer-events-auto h-8",variant:"outline",size:"sm"},{default:o(()=>[B(S(e(L)("sharp::entity_list.commands.instance.label"))+" ",1),r(ie)]),_:1})]),_:1}),r(e(M),null,{default:o(()=>{var _;return[e(a).config.state&&e(a).config.state.authorization?(t(),c(f,{key:0},[r(e(Ie),null,{default:o(()=>[r(e(Le),null,{default:o(()=>[r(e(Ue),null,{default:o(()=>[B(S(e(L)("sharp::modals.entity_state.edit.title")),1)]),_:1}),r(e(qe),null,{default:o(()=>[r(e(xe),null,{default:o(()=>[(t(!0),c(f,null,$(e(a).config.state.values,E=>(t(),y(e(le),{key:E.value,"model-value":E.value===e(a).instanceState,"onUpdate:modelValue":ye=>ye&&A(E.value)},{default:o(()=>[r(re,{class:"mr-1.5","state-value":E},null,8,["state-value"]),C("span",wa,S(E.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),r(e(ne),{class:"last:hidden"})],64)):b("",!0),r(oe,{commands:e(a).allowedInstanceCommands,onSelect:P},null,8,["commands"]),e(a).authorizations.delete?(t(),c(f,{key:1},[(_=e(a).allowedInstanceCommands)!=null&&_.flat().length?(t(),y(e(ne),{key:0})):b("",!0),r(e(Ee),{class:"text-destructive",onClick:l},{default:o(()=>[B(S(e(L)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):b("",!0)]}),_:1})]),_:1})):b("",!0),e(a).authorizations.update?(t(),y(e(T),{key:1,class:"h-8 pointer-events-auto",size:"sm",disabled:e(R),"as-child":""},{default:o(()=>[r(e(Te),{as:e(R)?"button":"a",href:e(a).formUrl},{default:o(()=>[B(S(s.show.config.editButtonLabel||e(L)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):b("",!0)])):b("",!0)],10,_a)):b("",!0)])]}),_:2},1032,["collapsed"])):b("",!0),Q(r(e(De),null,{default:o(()=>[C("div",ka,[(t(!0),c(f,null,$(m.columns,(K,g)=>(t(),c("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:Pe({"--size":`${K.size}`})},[r(Ae,{class:"gap-x-4 gap-y-6"},{default:o(()=>[(t(!0),c(f,null,$(K.fields,q=>Q((t(),y(je,null,{default:o(()=>[(t(!0),c(f,null,$(q,I=>Q((t(),y(He,{layout:I},{default:o(()=>[r(X,{field:e(a).fields[I.key],"field-layout":I,value:e(a).data[I.key],locale:d.value,collapsable:m.collapsable,"entity-key":e(i),"instance-id":e(n),"is-right-col":g>0&&g===m.columns.length-1,row:q,onReordering:_=>e(p)(I.key,_)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[G,e(a).fieldShouldBeVisible(I,d.value)]])),256))]),_:2},1536)),[[G,e(a).fieldRowShouldBeVisible(q,d.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[G,m.columns.map(K=>K.fields).flat(2).length&&!N]])]}),_:2},1024))]),_:2},1032,["section","aria-labelledby"])),[[G,e(a).sectionShouldBeVisible(m,d.value)||F==0]])),256))])],2)])]),_:1},8,["commands"])]),_:1})}}});export{Ra as default};
